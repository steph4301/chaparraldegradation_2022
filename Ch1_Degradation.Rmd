---
title: "Chapter 1: Degradation"
author: "Stephanie Ma Lucero"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_depth: 1
    toc_float: true
---


```{r formatting, echo=FALSE}

# file:///Users/work/Downloads/rmarkdown%20(1).pdf

#OPTION - DEFAULT - EFFECTS
#echo - TRUE - display code in output document
#error FALSE - TRUE (display error messages in doc), FALSE (stop render when error occurs)
#eval - TRUE - run code in chunk
#include - TRUE - include chunk in doc after running
#message - TRUE - display code messages in document
#warning - TRUE - display code warnings in document

#results "markup"
#- "asis" (passthrough results)
#- "hide" (don't display results)
#- "hold" (put all results below all code)

#fig.align - "default" "left", "right", or "center"
#fig.alt - NULL alt text for a figure
#fig.cap - NULL - figure caption as a character string
#fig.path - "figure/" prefix for generating figure file paths
#fig.width &
#fig.height 7 plot dimensions in inches
#out.width rescales output width, e.g. "75%", "300px"
#collapse FALSE collapse all sources & output into a single block
#comment "##" prefix for each line of results
#child NULL files(s) to knit and then include
#purl TRUE include or exclude a code chunk when
#extracting source code with knitr::purl()
#See more options and defaults by running str(knitr::opts_chunk$get())

# opts_chunk = to add gray code chunks

# view - prints to a new tab
# print - prints all rows in document
# head - prints first 6 rows in document
```

# Install your Packages

+ You only need to do this once. 

+ Install packages in the Console. 

```{r install packages, message=FALSE}

install.packages(c("ggplot2", "ggpubr", "tidyverse", "broom", "AICcmodavg", "tidyverse", "janitor"))

install.packages("multcompView")

# install An Bui's California color pallets
install.packages("devtools")
devtools::install_github("an-bui/calecopal")
```

# Install your Libraries

+ You'll need to do this every time you restart R.  

```{r install libraries, include=FALSE}}

library(tidyverse) # includes ggplot2, dplyr, tidyr, readr, purr, tibble, stringr, forcats
library(ggplot2) # data visualization
library(readr)
library(dplyr)

library(ggpubr) # customize ggplot2 for publication
library(broom)
library(AICcmodavg)
library(vegan)
library(readxl) # for .xls and .xlsx sheets
library(janitor)
library(calecopal) 
library(multcompView)
```

# Upload your csv files

+ Save them to your GitHub folder

+ Use snake_case = no capitals or spaces

+ You can preview, name, and Import files from the Files tab

```{r upload all csv files, include = FALSE}}

# ABOVE GROUND 
# overall species richness, native richness
abrich_full <- read.csv("~/Dropbox/GRADSCHOOL/Dissertation/R_dissertation/GitHub/https:/github.com/steph4301/chaparraldegradation_2022.git/deg_abrich.csv", header = TRUE, na.strings=c("","NA"))

# percent cover
abcover_full <- read.csv("~/Dropbox/GRADSCHOOL/Dissertation/R_dissertation/chaparraldegradation_2022b/deg_percentcover_byspecies_bylifeform.csv", header = TRUE, na.strings=c("","NA"))

# abcoverspp <- read.csv("~/Dropbox/GRADSCHOOL/Dissertation/R_dissertation/deg_percentcover_byspecies.csv")
# abcoverdist <- read_csv("~/Dropbox/GRADSCHOOL/Dissertation/R_dissertation/deg_percentcover_bydistance.csv") # this file is here just in case I need it.

# native shrub density 
shrubdensitylife <- read_csv("~/Dropbox/GRADSCHOOL/Dissertation/R_dissertation/deg_beltdensity_bylifestage.csv") #StandType, Site, rep, ScientificName, dead, immature, mature, resprout, seedling.
shrubdensityspp <- read_csv("~/Dropbox/GRADSCHOOL/Dissertation/R_dissertation/deg_beltdensity_byspecies.csv")
shrubdensityalive <- read_csv("~/Dropbox/GRADSCHOOL/Dissertation/R_dissertation/deg_beltdensity_seperatealive.csv")

# stand height 
standheight <- read_csv("~/Dropbox/GRADSCHOOL/Dissertation/R_dissertation/deg_maxheight.csv")

# BELOW GROUND #
# overall species richness, native richness, germination
seedbank <- read_csv("~/Dropbox/GRADSCHOOL/Dissertation/R_dissertation/GitHub/https:/github.com/steph4301/chaparraldegradation_2022.git/deg_seedbank.csv")


# STAND COMPARISON #
# species richness, native richness
#standrich <--
  
# species richness, native richness
#standlifestage <--

```

## Remember to keep your data **tidy**

Tidy data follows three principles: 
 
1. Each **variable** has its own column 
 
2. Each **observation** has its own row 
 
3. Each **value** has its own cell 

Some other random tidy principles include:
- **efficient code**: using one concise function in the place of many
- using **snake case**: file names and column headers in lowercase and with underscores instead of spaces
- use of the **pipe** operator

The ` %>% ` symbol is known as a pipe operator and essentially allows you to run multiple commands at one time that all act on the same object (a dataset, a matrix, a vector of values, whatever). You can create this symbol with the shortcut **command + shift + m**. 

The '|' symbol will create an AND function
survey %>% # call tibble
  filter((sex == "male" & height > 70) | (sex == "female" & height < 55)) %>% # filter picks out rows/observations ## we're selecting observations that are men > 70 in tall AND women < 55 in tall
  select(sex, height, fastest) # selects picks out columns/variables

### Types of data

Your type of data determines how you can shape your story

#### Main groups

+ **Numerical** --> numbers (woot!)

+ **Categorical** --> characteristics, like words.



#### Subgroups

+ **Continuous** --> numbers can take on **any** value (e.g., height, weight, temperature)
  

+ **Discrete** --> numbers or words can only be **certain** values (e.g., days of the week, # of kids in a class, pet type)
  
  
  
#### Sub-subgroup of discrete

+ **Nominal** --> discrete units **with no order** (e.g., languages, countries, ICUN status)
  
  
+ **Ordinal** --> discrete unites **with order** (e.g., months of year, levels of education, TA reviews)
  


### Basics of Tidyverse functions

#### 1. Pipe operator `%>` : chains function together

```{r pipe operator}
# using pipe operator
"hello" %>% rep(times = 4)

# without pipe operator
rep("hello", times = 4)
```


#### 2. Tibble : type of dataframe suited for tidyverse

Check dataframe:
+ class(df)

Convert dataframe to tibble:
+ df <- as_tibble(df)
+ class(df)


#### 3. dplyr package : tool for data manipulation

+ a. `filter()` and `select()` for sub-setting

+ b. `mutate()` for transforming variables

+ c. `group_by()` and `summarise()` for numerical summaries

+ d. `fivenum()` for all 5 summaries 



# **LET'S DO THIS! :D**




# ABOVE GROUND 

Let's look at the dataset: abrich

What are the questions I'm asking?

Hypothesis 1. Above ground chaparral communities are not significantly different between stands with increasing amounts of degradation.

+ 1a.	Stands with greater degradation have significantly lower **overall species richness** above ground

+ 1b. Create an **NMDS** of of species between stands.

+ 1c. Stands with greater degradation have significantly lower **native species richness** above ground

+ 1d. Stands with greater degradation have significantly less **shrub cover**

+ 1e. Stands with greater degradation have significantly lower **shrub density**

+ 1f.	Stands with greater degradation have significantly shorter **canopy height** 

My prediction: Degraded above ground is not the same as Intact above ground. Matrix above ground falls somewhere in between.


## 1. Overall speices richness

With my abrich data, I specifically want to look at:
  + 1. my data in a useful format
  + 2. the number of unique species from each sampling location (belt and point)
  + 3. the average and SE of unique species at each samling location
  + 4. if the number of unique species at each samling location are different by standtype

First, I need to organize the data...
```{r ab total species richness}

dim(abrich_full)
abrich <- abrich_full[1:3170, 1:12]
dim(abrich)
head(abrich)
tail(abrich)

# convert dataframe to tibble
abrich <- abrich %>% 
  as_tibble(abrich) 

class(abrich) # now a tibble
# [1] "tbl_df"     "tbl"        "data.frame"

```
... and create a new column for SITE_REP.
```{r create site_rep column}
abrich$site_rep<- paste(abrich$site, abrich$rep, sep="_") # combine site and rep to one column
head(abrich) # look at new column site_rep, last column
```

Second, I need to calculate the **number of unique species** from each sampling location (belt and point).

```{r ab total unique species, include=TRUE}

abrich_totalrich <- abrich %>% # call tibble
  filter(site_rep != "Intact4_4") %>% #omit Intact 4 from data
  filter(!is.na(species)) %>% # omit blank cells in species 
  group_by(standtype, site_rep) %>% # group by stand type (column 1) and site_rep (column 2)
   select(species) %>%  # selects picks out columns/variables
   dplyr::summarize(total_species_richness = n_distinct(species)) # summarize the number of unique speices per site and rep 

print(abrich_totalrich)
```
+ I can also calculate the **mean** and **standard errors** of the total species richness from each sampling location (belt and point).
```{r calculating total species richness mean and SD}

abrich_totalrich_meanSD <- abrich_totalrich %>%
  group_by(standtype) %>%
  summarise_at(vars(total_species_richness), funs(mean,sd)) 
 
print(abrich_totalrich_meanSD)

```

Third, I need to calculate the average and SE of the unique species from each sampling location (belt and point)

+ ANOVA - to compare means of groups

```{r anova, include=TRUE}
abrich_totalrich_anova <- aov(total_species_richness ~ standtype, data = abrich_totalrich) #ANOVA comparing total species richness per standtype
summary.aov(abrich_totalrich_anova) #show ANOVA output

1-pf(22.01/21.11, 2, 13) # calculate p-value
# [1] 0.3802219

#print(abrich_totalrich_anova) # recalls formula, Sum of Squares, Deg. of Freedom, Residuals
```

+ Tukey test post-hoc to find differences

```{r tukey posthoc, include=TRUE}
abrich_totalrich_tukey <- TukeyHSD(abrich_totalrich_anova, conf.level=.95) 
print(abrich_totalrich_tukey)
```
Fourth, and **finally**, plot **TOTAL SPECIES RICHNESS**!

+ color pallet <3
```{r An Bui's California colors}
names(cal_palettes)
```

```{r color pallet for abrich_totalrich}
cal_palette(name = "chaparral2", n = 3, type = "continuous")
#Intact, Matrix, Degraded
# values = c('#D98A63', '#9FC2B0', '#A7C2CD')
```

+ column graph
```{r column total species richnes , include = TRUE}

#  column plot
abrich_totalrich_plot <- ggplot(abrich_totalrich_meanSD, aes(x = standtype, y = mean, fill = standtype)) +
  geom_col(position = "dodge", width = 0.8) +
  geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                 position=position_dodge(.9)) +
  labs(title = "Species Richness", x = "Stand Type", y = "Average Species Richness") +
  scale_fill_manual(values = c('#D3E3CA', '#92A587', '#2F3525')) + # manual colors
#   scale_fill_manual(values = cal_palette('chaparral3')) + # continuous colors
                       theme_bw()
abrich_totalrich_plot + scale_x_discrete(limits=c("intact", "matrix", "degraded"),
                                         labels=c("intact" = "Intact", "matrix" = "Matrix", "degraded" = "Degraded"))
```

+ line graph
```{r line graph abrich total species richness, include=TRUE}
#  line plot
ggplot(abrich_totalrich_meanSD, aes(x = standtype, y = mean, fill = standtype)) +
  geom_line() +
  geom_point() +
  geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                position=position_dodge(0.05)) + 
  labs(title="Total Species Richness", x = "Stand Type", y = "Average Species Richness") +
  theme_classic() +
  scale_color_manual(values = c('#999999','#E69F00', '#E69F00'))
```


## 2. Overall native speices richness

### With my abrich data, I specifically want to look at:
  + 1. the number of unique native species from each sampling location (belt and point)
  + 2. the average and SE of unique native species at each sampling location
  + 3. if the number of unique native species at each sampling location are different by standtype

First, I need to filter for only native species. 
```{r ab native species richness, message=FALSE}
abrich_natrich <- abrich %>% # call tibble
  filter(site_rep != "Intact4_4") %>% # omit data from Intact 4
  filter(!is.na(species)) %>% # omit blank cells in species 
  filter(status == "native") %>% # filter to select only native species
  group_by(standtype, site_rep) %>% # group by stand type (column 1) and site_rep (column 2)
   select(species) %>%  # selects picks out columns/variables
   dplyr::summarize(native_species_richness = n_distinct(species)) # summarize the number of unique speices per site and rep 

print(abrich_natrich)
```
Second, calculate the average and SE of unique native species at each sampling location.
```{r calculating native species richness mean and SD, message=FALSE}

abrich_natrich_meanSD <- abrich_natrich %>%
  group_by(standtype) %>%
  summarise_at(vars(native_species_richness), funs(mean,sd)) 
 
print(abrich_natrich_meanSD)

```

Third, calculate if the number of unique native species at each sampling location are significantly different by standtype.

+ ANOVA - to compare means of groups

```{r abrich_natrich anova, include=TRUE}

abrich_natrich_anova <- aov(native_species_richness ~ standtype, data = abrich_natrich) #ANOVA comparing native species richness per standtype
summary.aov(abrich_natrich_anova) #show ANOVA output

# print(abrich_natrich_anova) # recalls formula, Sum of Squares, Deg. of Freedom, Residuals
```

+ Tukey test post-hoc to find differences
```{r tukey posthoc, include=TRUE}
abrich_natrich_tukey <- TukeyHSD(abrich_natrich_anova, conf.level=.95) 
print(abrich_natrich_tukey)

```
Fourth, and **finally**, plot **NATIVE SPECIES RICHNESS**!

+ color pallet <3
```{r An Bui's California colors}
names(cal_palettes)
```

```{r color pallet for abrich_natrich}
cal_palette(name = "chaparral2", n = 3, type = "continuous")
#Intact, Matrix, Degraded
# values = c('#D98A63', '#9FC2B0', '#A7C2CD')
```

+ column graph
```{r column native species richnes , include = TRUE}

#  column plot
abrich_natrich_plot <- ggplot(abrich_natrich_meanSD, aes(x = standtype, y = mean, fill = standtype)) +
  geom_col(position = "dodge", width = 0.8) +
  geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                 position=position_dodge(.9)) +
  labs(title = "Native Species Richness", x = "Stand Type", y = "Average Native Species Richness") + # title, axes titles
  scale_fill_manual(values = c('#D3E3CA', '#92A587', '#2F3525'), # manual colors
                    limits = c("intact", "matrix", "degraded"), # "limits" reorders the x-axis
                    labels = c("Intact", "Matrix", "Degraded")) + # "labels" changes the name
#   scale_fill_manual(values = cal_palette('chaparral3')) + # continuous colors
                    theme_bw()
abrich_natrich_plot + scale_x_discrete(limits=c("intact", "matrix", "degraded"),
                                         labels=c("intact" = "Intact", "matrix" = "Matrix", "degraded" = "Degraded"))
```

+ line graph
```{r line graph abrich total species richness, include=TRUE}
#  line plot
ggplot(abrich_natrich_meanSD, aes(x = standtype, y = mean, fill = standtype)) +
  geom_line() +
  geom_point() +
  geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                position=position_dodge(0.05)) + 
  labs(title="Native Species Richness", x = "Stand Type", y = "Average Native Species Richness") +
  theme_classic() +
  scale_color_manual(values = c('#999999','#E69F00', '#E69F00'))
```


## 3. Percent cover 

### With my percent cover data, I specifically want to look at:
  + 1. Percent cover by status (native, nonnative) by stand
  + 2. Percent cover by status by lifeform (fern, herb, shrub, grass) by stand
  
To calculate percent cover by status (native, nonnative) by stand I will: 
  + 3. Calculate the average and SE of native and nonnative percent cover at each stand
  + 4. calculate if native and nonnative cover is different between stands (ANOVA, tukey)
  + 5. Graph the results

To calculate percent cover by status (native, nonnative) by lifeform (herb, shrub, grass, fern) by stand I will: 
  + 6. Calculate the average and SE of native and nonnative percent cover at each stand
  + 7. calculate if native and nonnative cover is different between stands (ANOVA, tukey)
  + 8. Graph the results

First, I need to organize the data...
```{r ab percent cover by status, include = TRUE}

dim(abcover_full)
# [1] 113   6
head(abcover_full)
tail(abcover_full)

# convert dataframe to tibble
abcover_full <- abcover_full %>% 
  as_tibble(abcover_full) 

class(abcover_full) # now a tibble
# [1] "tbl_df"     "tbl"        "data.frame"

```
... including reordering the classes...
```{r reorder classes to Intact Matrix Degraded}
abcover_full_v <- abcover_full %>%
  mutate(standtype = fct_relevel(standtype, 
            "intact", "matrix", "degraded"))
```

... and creating new columns for SITE_REP and SITE_REP_DISTANCE
```{r create site_rep column and site_rep_dist column}
abcover_full_v$site_rep <- paste(abcover_full_v$site, abcover_full_v$rep, sep="_") # combine site and rep to one column

abcover_full_v$site_rep_dist <- paste(abcover_full_v$site_rep, abcover_full_v$distance, sep="_") # combine site and rep to one column

head(abcover_full_v) # look at new columns
```
... and omit "ground" as a status.
```{r filter for native and non-native only}
abcover_full_v_omitground <- filter(abcover_full_v, status !="ground")
head(abcover_full_v_omitground)
```

Now, I need to calculate % cover of native and non-native cover by site_rep_dist.
```{r unique species by site_rep_dist, inclue = TRUE}
abcover_bystatus <- abcover_full_v_omitground %>% 
  group_by(standtype, site, rep, site_rep, status) %>% 
  filter(!is.na(species)) %>% # omit blank cells in species 
  dplyr::summarize(count_per_dist = n_distinct(site_rep_dist), percentcover = n_distinct(site_rep_dist)/41)
# print(abcover_bystatus) # prints all rows of table
# head (abcover_bystatus) # prints first 6 rows of table
view(abcover_bystatus) # prints to new tab
```

... and then calculate means and SD by status (native, non-native) by stand type. 
```{r calculating percent cover mean and SD by status by stand, include=TRUE}
abcover_bystatus_meanSD <- abcover_bystatus %>%
  group_by(standtype, status) %>%
  summarise_at(vars(percentcover), funs(mean,sd)) 
 
print(abcover_bystatus_meanSD)
```
... and, finally, calculate significant differences.
+ ANOVA - to compare means of groups 
```{r create a new column just in case, include=FALSE}
abcover_bystatus$stand_status <- paste(abcover_bystatus$standtype, abcover_bystatus$status, sep="_") # combine stand and status label to one column
view(abcover_bystatus)
```
1) standtypes by their native or nonnative species
```{r filter by status, include=TRUE}
abcover_bystatus_nat <- abcover_bystatus %>%
  filter(status == "native") # filter for native species
abcover_bystatus_non <- abcover_bystatus %>%
  filter(status == "nonnative") # filter for non-native species
```

```{r aov then tu, include=TRUE}


abcover_bystatus_nat_tukey <- TukeyHSD(abcover_bystatus_nat_aov <- aov(percentcover ~ status, data = abcover_bystatus_nat))


aov(percentcover ~ status, data = abcover_bystatus_mat) 
summary.aov(abcover_bystatus_mat_aov) #show ANOVA output for status at INTACT stand


```


2) native and nonnative status by standtypes
```{r filter by standtype, include=TRUE}
abcover_bystatus_int <- abcover_bystatus %>%
  filter(standtype == "intact") # filter for intact stand
abcover_bystatus_mat <- abcover_bystatus %>%
  filter(standtype == "matrix") # filter for matrix stand
abcover_bystatus_deg <- abcover_bystatus %>%
  filter(standtype == "degraded") # filter for degraded stand
```

```{r filter by standtype, include=TRUE}

```


```{r}
abcover_bystatus_mat_aov <- aov(percentcover ~ status, data = abcover_bystatus_mat) 
summary.aov(abcover_bystatus_mat_aov) #show ANOVA output for status at INTACT stand


abcover_bystatus_anova <- abcover_bystatus %>% 
  dplyr::filter(standtype == "intact") %>% 
  aov(percentcover ~ status, data = abcover_bystatus) %>% 
  summary.aov(abcover_bystatus_anova)

# print(abcover_bystatus_anova) # recalls formula, Sum of Squares, Deg. of Freedom, Residuals
```
+ Tukey test post-hoc to find differences
```{r abcover_bystatus tukey posthoc, include=TRUE}
abcover_bystatus_tukey <- TukeyHSD(abcover_bystatus_anova, conf.level=.95) 
print(abcover_bystatus_tukey)

```

The last step is to plot the data. 
```{r plotting percent coverby status by standtype, include=TRUE}
#  column plot

abcover_bystatus_plot <- ggplot(abcover_bystatus_meanSD, aes(x = standtype, y = mean, fill = status)) +
  geom_col(position = "dodge", width = 0.8) +
  geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                 position=position_dodge(.9)) +
               labs(title = "Percent Cover", x = "Stand Type", y = "Average Percent Cover (%)") + # title, axes titles
 # scale_fill_manual(values = c('#D3E3CA', '#92A587', '#2F3525'), # manual colors
   scale_fill_manual(values = cal_palette('chaparral2')) +  # continuous colors
  #                  limits = c("intact", "matrix", "degraded"), # "limits" reorders the x-axis
  #                  labels = c("Intact", "Matrix", "Degraded")) + # "labels" changes the name
                    theme_bw() +
  scale_x_discrete(limits=c("intact", "matrix", "degraded"),
                                         labels=c("intact" = "Intact", "matrix" = "Matrix", "degraded" = "Degraded"))

print(abcover_bystatus_plot)  
```

```{r}
abcover_byspecies %>% 
  group_by(standtype, site, rep, species) %>% 
  filter(!is.na(species)) %>% # omit blank cells in species 
  dplyr::summarize(count_per_dist = n_distinct(site_rep_dist))
```

## THIS IS SO MESSY
Now, I need to calculate % cover of native and non-native cover by site_rep_dist.
```{r percent cover of lifeform by site_rep, inclue = TRUE}
abcover_bylf <- abcover_full_v_omitground %>% 
  group_by(standtype, site, rep, site_rep, lifeform) %>% 
  filter(!is.na(species)) %>% # omit blank cells in species 
  dplyr::summarize(count_per_dist = n_distinct(site_rep_dist), percentcover = n_distinct(site_rep_dist)/41)
# print(abcover_bystatus) # prints all rows of table
# head (abcover_bystatus) # prints first 6 rows of table
head(abcover_bylf) # prints to new tab
```
.. and then calculate means and SD by status (native, non-native) by stand type. 
```{r calculating percent cover mean and SD by lifeform by stand, include=TRUE}
abcover_bylf_meanSD <- abcover_bylf %>%
  group_by(standtype, lifeform) %>%
  summarise_at(vars(percentcover), funs(mean,sd)) 
 
print(abcover_bylf_meanSD)
```
```{r}
abcover_bylf_aov <- aov(percentcover ~ lifeform + standtype, data = abcover_bylf) 
summary.aov(abcover_bylf_aov) #show ANOVA output for status at INTACT stand
```
+ Tukey test post-hoc to find differences
```{r abcover_bystatus tukey posthoc, include=TRUE}
abcover_bylf_tukey <- TukeyHSD(abcover_bylf_aov, conf.level=.95) 
print(abcover_bylf_tukey)

```


## 5. Shrub cover 

### With my shrub percent cover data, I specifically want to look at:
  + 1. Shrub percent cover by stand
  + 2. Percent cover by status by lifeform (fern, herb, shrub, grass) by stand





```{r abcover select native and nonnative status, include=TRUE}

## START HERE... WHAT AM I REALLY DOING? DRAW OUT THE TABLE YOU WANT TO MAKE. I DON'T THINK I NEED TO SUMMARIZE. I THINK I CAN FILTER AND GO STRAIGHT TO CALCULATING MEANS/SD
## 
## 
## 
## 
abcoverstat <- abcoverstatlf %>% # call tibble
  filter(status == "Native" | status == "Non-native") %>% # filter to select only native and non-native species
  group_by(standtype, site_rep, status) %>% # group by stand type (column 1) and site_rep (column 2)
   select(status) %>%  # selects picks out columns/variables
  dplyr::summarize(nat_nonnat = n_distinct(status))
  
  
abcoverstat

   dplyr::count(nat_nonnat = abcoverstatlf_omitground,status) # summarize the number of unique speices per site and rep 

print(abcoverstat)

##
##
abcoverstat <- abcoverstatlf_omitground %>% # call tibble
  group_by(standtype, site_rep) %>% # group by stand type (column 1) and site_rep (column 2)
   select(status) %>%  # selects picks out columns/variables
   dplyr::count(nat_nonnat = abcoverstatlf_omitground,status) # summarize the number of unique speices per site and rep 

print(abcoverstat)

##

abrich_natrich <- abrich %>% # call tibble
  filter(!is.na(species)) %>% # omit blank cells in species 
  filter(status == "native") %>% # filter to select only native species
  group_by(standtype, site_rep) %>% # group by stand type (column 1) and site_rep (column 2)
   select(species) %>%  # selects picks out columns/variables
   dplyr::summarize(native_species_richness = n_distinct(species)) # summarize the number of unique speices per site and rep 

print(abrich_natrich)
```


Second, I need to caluclate the mean and SD of native and non-native cover at each site by site_rep.
```{r calculating percent cover mean and SD of native and nonnative}

abcoverstat_meanSD <- abcoverstatlf %>%
  group_by(standtype) %>% 
  summarise_at(vars(total_species_richness), funs(mean,sd)) 
 
print(abrich_totalrich_meanSD)

```

Third, I need to calculate the average and SE of the unique species from each sampling location (belt and point)

+ ANOVA - to compare means of groups

```{r anova, include=TRUE}
abrich_totalrich_anova <- aov(total_species_richness ~ standtype, data = abrich_totalrich) #ANOVA comparing total species richness per standtype
summary.aov(abrich_totalrich_anova) #show ANOVA output
#             Df    Sum Sq  Mean Sq   F value   Pr(>F)
# standtype    2   44.02    22.01     1.043     0.38
# Residuals   13  274.42    21.11 

1-pf(22.01/21.11, 2, 13) # calculate p-value
# [1] 0.3802219

#print(abrich_totalrich_anova) # recalls formula, Sum of Squares, Deg. of Freedom, Residuals
```

+ Tukey test post-hoc to find differences

```{r tukey posthoc, include=TRUE}
abrich_totalrich_tukey <- TukeyHSD(abrich_totalrich_anova, conf.level=.95) 
print(abrich_totalrich_tukey)
# nothing is significant
# intact-degraded = 0.38
# matrix-degraded = 0.59
# matrix-intact = 0.88
```
Fourth, and **finally**, plot **TOTAL SPECIES RICHNESS**!

+ color pallet <3
```{r An Bui's California colors}
names(cal_palettes)
```

```{r color pallet for abrich_totalrich}
cal_palette(name = "chaparral2", n = 3, type = "continuous")
#Intact, Matrix, Degraded
# values = c('#D98A63', '#9FC2B0', '#A7C2CD')
```

+ column graph
```{r column total species richnes , include = TRUE}

#  column plot
ggplot(abrich_totalrich_meanSD, aes(x = standtype, y = mean, fill = standtype)) +
  geom_col(position = "dodge", width = 0.8) +
  geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                 position=position_dodge(.9)) +
  labs(title = "Species Richness", x = "Stand Type", y = "Average Species Richness") +
  scale_fill_manual(values = c('#D3E3CA', '#92A587', '#2F3525')) + # manual colors
#   scale_fill_manual(values = cal_palette('chaparral3')) + # continuous colors
                       theme_bw()
```

+ line graph
```{r line graph abrich total species richness, include=TRUE}
#  line plot
ggplot(abrich_totalrich_meanSD, aes(x = standtype, y = mean, fill = standtype)) +
  geom_line() +
  geom_point() +
  geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                position=position_dodge(0.05)) + 
  labs(title="Total Species Richness", x = "Stand Type", y = "Average Species Richness") +
  theme_classic() +
  scale_color_manual(values = c('#999999','#E69F00', '#E69F00'))
```

```{r from Austen}




# total richness between enhanced and degraded stands
abrich %>% group_by(site) %>% dplyr::summarize(total_species_richness = n_distinct(species, na.omit))
#   site  total_species_richness
#   <chr>                  <int>
# 1 DEG1                      20
# 2 DEG2                      20
# 3 ENH1                      47
# 4 ENH2 stop()
                     48

# double-checking total richness between enhanced and degraded stands
length(unique(subset(seedbank, site == "DEG1")$species)) # 20
length(unique(subset(seedbank, site == "DEG2")$species)) # 20
length(unique(subset(seedbank, site == "ENH1")$species)) # 47
length(unique(subset(seedbank, site == "ENH2")$species)) # 48

# native richness between enhanced and degraded stands
seedbank %>% filter(status == "native") %>% group_by(site) %>% dplyr::summarize(total_species_richness = n_distinct(species))
#   site  total_species_richness
#   <chr>                  <int>
# 1 DEG1                      13
# 2 DEG2                      13
# 3 ENH1                      13
# 4 ENH2                      18

# double-checking native richness between enhanced and degraded stands
length(unique(subset(seedbank, status == "native" & site == "DEG1")$species)) # 13
length(unique(subset(seedbank, status == "native" & site == "DEG2")$species)) # 13
length(unique(subset(seedbank, status == "native" & site == "ENH1")$species)) # 13
length(unique(subset(seedbank, status == "native" & site == "ENH2")$species)) # 18

# at each site (e.g., select: Enhanced), compare the native species richness between four soil treatments (Control, Oven, Charate, Oven + Charate)
native.treatment <- seedbank %>% filter(status == "native") %>% group_by(site, treatment) %>% dplyr::summarize(native_species_richness = n_distinct(species))
native.treatment
#    site  treatment    native_species_richness
#    <chr> <chr>                         <int>
#  1 DEG1  charate                          13
#  2 DEG1  control                          13
#  3 DEG1  oven                             13
#  4 DEG1  ovenchar                         13
#  5 DEG2  charate                          13
#  6 DEG2  control                          13
#  7 DEG2  oven                             13
#  8 DEG2  ovenchar                         13
#  9 ENH1  charate                           7
# 10 ENH1  control                           8
# 11 ENH1  oven                              6
# 12 ENH1  ovenchar                          9
# 13 ENH1  pretreatment                      1
# 14 ENH2  charate                           6
# 15 ENH2  control                          10
# 16 ENH2  oven                             12
# 17 ENH2  ovenchar                          9
# 18 ENH2  pretreatment                      3

ggplot(native.treatment, aes(x = site, y = native_species_richness, fill = treatment)) +
  geom_col(position = "dodge", width = 0.8)

```



## SEEEDBANK - LOOKING AT THE STRUCTURE OF YOUR DATA
```{r seedbank, data structure, basic visualization}

####### LOOKING AT THE STRUCTURE OF YOUR DATA #############

head(seedbank)

# You can set the column data type with cols()... e.g.,
## cols(
##   species = col_character(),
##   bill_length_mm = col_double()
## )
#  or only load specific columns.
seedbank[c(1:1465),]

str(seedbank) # gives us the structure of the data frame

summary(seedbank) # some summary stats for each variable

# seedbank has 1507 observations (rows) of 15 variables (columns)
# so there are 1507 individuals in our dataset and 8 different traits associated with each penguin

# Checking what type of data a column has:
# class(seedbank$species)

# to pull out one row of data we could index using brackets [ ]
# remember bROWs before columns
# to get all variables for the third row we want row 3 and all columns
# data[3, ]
# what if I just want to look at the first 2 variables for the first 10 rowbs
seedbank[1:1465, ]

####### VISUALIZING YOUR DATA #############

# histogram to to get an idea how the data are distributed
hist(seedbank$totalcount)

# what if we want to look at two variables and see how they relate? are they correlated?
plot(data=seedbank, bill_length_mm ~ bill_depth_mm)

# we can separate out those groups for a given variable using a boxplot
boxplot(data=seedbank, totalcount ~ treatment)

```
## SEEDBANK - PLOTTING DATA
```{r}
# A ggplot needs to know: (1) what data you are using (2) what data to plot, x, y… (3) what type of graph (geom) to make

# looking at totalcount by species
# ggplot needs to know: 1) we are using the seedbank data, 2) we want to plot species and totalcount, 3) and to make a boxplot

ggplot(data=seedbank, aes(x=species, y=totalcount, fill=treatment))+
  geom_boxplot()+
  scale_fill_brewer(palette="Dark2")+
  labs(x = "Species",
       y = "Total Count (n)",
       title = " Germination by Species and Treatment")+
  theme_bw()

ggplot(data=seedbank, aes(x=site, y=totalcount, fill=site))+
  geom_boxplot()+
  scale_fill_brewer(palette="Dark2")+
  labs(x = "Site",
       y = "Total Count (n)",
       title = " Germination by Site")+
  theme_bw()

```




```{r seedbank - native species list}
# from Joanna
head(seedbank)

native_richness_stand <- seedbank %>% #take my data_seedbankgrowout data frame AND THEN…
  filter(seedbank, status_native == "native", preserve = FALSE) %>% #retain only natives 
  distinct(species) %>% #retain only distinct/unique rows so that each row is a unique species 
  group_by(stand) %>%
  summarize(native_richness = length(species)) #calculate number of rows/species per stand

stop()


penguins %>% 
  group_by(species) %>% 
  summarise(mean_bill_length=mean(bill_length_mm, na.rm = TRUE),
            sd_bill_length=sd(bill_length_mm, na.rm = TRUE),
            mean_bill_depth=mean(bill_depth_mm, na.rm = TRUE),
            sd_bill_depth=sd(bill_depth_mm, na.rm = TRUE))

# For total richness, you’ll just delete the filter(native_status == “native”). 
# For per treatment, you’ll just replace group_by(treatment). 


Then you’ll want to check if your data are normally distributed. I’m assuming you want to do ANOVA of richness? For stand, you only have 2 groupings (enhanced vs degraded), so you'll actually just do a t-test for normal data:
#t-test for native richness by stand
native_richness_stand_ttest <- t.test(native_richness ~ stand, data = native_richness_stand)
summary(native_richness_stand_ttest) #show t.test output

For treatment, you'll have >2 groupings so you'll need to do an ANOVA + post-hoc pairwise:
#ANOVA for native richness by treatment
native_richness_treatment_anova <- aov(native_richness ~ treatment, data = native_richness_treatment) #ANOVA comparing native richness per treatment
summary(native_richness_treatment_anova) #show ANOVA output
native_richness_treatment_tukey <- emmeans(native_richness_treatment_anova, list(pairwise ~ treatment, adjust = "tukey") #calculate pairwise post-hoc tukey


```

```{r}
#t-test for native richness by stand
native_richness_stand_ttest <- t.test(native_richness ~ stand, data = native_richness_stand)
summary(native_richness_stand_ttest) #show t.test output
```

```{r useful code}
## List of Column headers
names(belt) # header names of the columns

## Print all values in a column
speciesnames = list(a$species)
summary(speciesnames)

## Print summary of values in a column
# head(belttransect, n=5)
# belt$species # all data entries in species column
# ls(speciesnames)
# ls(belt$standtype)

speciesnames <-summarize(group_by(belt, species))
#Mean=mean(Sepal.Length(),
#SD=sd(Sepal.Length())

## AVERAGE
# head(belttransect, n=5)
# belt$species # all data entries in species column
# ls(speciesnames)
# ls(belt$standtype)

speciesnames <-summarize(group_by(belt, species))
#Mean=mean(Sepal.Length(),
#SD=sd(Sepal.Length())
```


