---
title: "Ch1_Degradation_seedbankNMDS"
author: "Stephanie Ma Lucero"
date: "2023-03-23"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Load libraries
```{r install libraries, message=FALSE}

library(tidyverse) # includes ggplot2, dplyr, tidyr, readr, purr, tibble, stringr, forcats
library(ggplot2) # data visualization
library(readr)
library(dplyr)
library(ggpubr) # customize ggplot2 for publication
library(broom)
library(AICcmodavg)
library(vegan)
library(readxl) # for .xls and .xlsx sheets
library(janitor)
library(calecopal) 
library(multcompView)
library(plotly)
library(ggvegan)
library(here)
library(cowplot)
library(ggthemes)
library(ggpubr) # customize ggplot2 for publication

# dune data: https://www.rpubs.com/RGrieger/545184

```

# Initial data prep
```{r load deg_seedbank csv}
# 
seedbank_load_raw <- read.csv("deg_seedbank_20231007.csv", header = TRUE, na.strings=c("","NA"))

seedbank_load <- seedbank_load_raw %>% 
  dplyr::select(c("stand", "site", "soilcore", "depth_name", "treatment", "rep", "species_diversity", "genus_abundance", "lifeform", "status", "lifescycle", "family", "count"))
  
seedbank_load$count <- as.numeric(seedbank_load$count)
str(seedbank_load)
         
print(seedbank_load)
unique(seedbank_load$stand)
unique(seedbank_load$site)
unique(seedbank_load$soilcore)
unique(seedbank_load$depth_name)
unique(seedbank_load$treatment)
unique(seedbank_load$status)
sort(unique(seedbank_load$species_diversity))
sort(unique(seedbank_load$genus_abundance))
sort(unique(seedbank_load$family))
sort(unique(seedbank_load$lifeform))
sort(unique(seedbank_load$lifescycle))
```

(1) Organize the seed bank data by converting the df into a tibble.
```{r preparing df, include = TRUE}

dim(seedbank_load)
# [1] 2126   13
head(seedbank_load)
tail(seedbank_load)

# convert dataframe to tibble
seedbank_load <- as_tibble(seedbank_load) 
class(seedbank_load) # now a tibble
```

(2) Organize the seedbank data by reordering the classes: Intact, Matrix, Degraded.
```{r reorder stand classes}
seedbank_load_v <- seedbank_load %>%
  mutate(stand = fct_relevel(stand, 
            "intact", "enhanced", "degraded")) %>% 
  mutate(treatment = fct_relevel(treatment, 
                                 "control", "charate", "oven", "ovenchar")) %>% 
  mutate(family = case_when(
    family ==  "Asteraceae  " ~ "Asteraceae", # old name ~ new name
    family ==  "Cucurbitaceae  " ~ "Cucurbitaceae",
    family ==  "Euphorbiaceae  " ~ "Euphorbiaceae",
    family ==  "Fabaceae  " ~ "Fabaceae",
    family ==  "Juncaceae  " ~ "Juncaceae",
    family ==  "Liliaceae  " ~ "Liliaceae",
    family ==  "Namaceae  " ~ "Namaceae",
    family ==  "Phrymaceae  " ~ "Phrymaceae",
  #  family == "Phrymaceae  "  ~ "Phrymaceae",
    family ==  "Poaceae  " ~ "Poaceae",
    family == "Themidaceae  " ~ "Themidaceae", 
     TRUE ~ as.character(family)  # Keep other observations unchanged
  )) %>% 
   mutate(species_diversity = case_when(
     species_diversity == "Astragalus trichopodus " ~ "Astragalus trichopodus",
     species_diversity == "Erodium spp. "  ~ "Erodium spp.",
     species_diversity == "Festuca myuros " ~ "Festuca myuros",
     species_diversity == "Lactuca serriola " ~ "Lactuca serriola",
     species_diversity ==   "Lupinus bicolor "   ~ "Lupinus bicolor", 
     species_diversity ==  "Salvia leucophylla "   ~ "Salvia leucophylla", 
     species_diversity == "Thysanocarpus spp. " ~ "Thysanocarpus spp.",     
     TRUE ~ as.character(species_diversity)  # Keep other observations unchanged
  )) %>% 
   mutate(lifescycle = case_when(
     lifescycle == "annual or biannual" ~ "biannual", # old name ~ new name
       TRUE ~ as.character(lifescycle)  # Keep other observations unchanged
  )) %>% 
  mutate(genus_abundance = case_when(
    genus_abundance == "Lactuca serriola "  ~ "Lactuca serriola",
    genus_abundance == "Lupinus bicolor "   ~ "Lupinus bicolor", 
    genus_abundance == "Thysanocarpus spp. "  ~ "Thysanocarpus spp.",
    genus_abundance == "Unknown Phrymaceae  " ~ "Unknown Phrymaceae",
    TRUE ~ as.character(genus_abundance)  # Keep other observations unchanged
  )) 
```

(3) Create new columns for SITE_CORE, SITE_CORE_DEPTH, SITE_CORE_DEPTH_TREATMENT, SITE_TREATMENT, SITE_DEPTH for seed bank data. 
```{r combine columns}

# combine SITE and CORE to one column
seedbank_load_v$stand_core <- paste(seedbank_load_v$site, seedbank_load_v$soilcore, sep="_") 

# combine SITE_CORE and DEPT to one column
seedbank_load_v$stand_core_depth <- paste(seedbank_load_v$stand_core, seedbank_load_v$depth_name, sep="_") 

# combine SITE_CORE_DEPTH and TREATMENT to one column
seedbank_load_v$stand_core_depth_treat <- paste(seedbank_load_v$stand_core_depth, seedbank_load_v$treatment, sep="_") 

glimpse(seedbank_load_v)
```

(4) Omit "pre-treatment" as a treatment since I'm only interested in Control, Char, Oven, and CharOven treatments
```{r omit pretreatment data}

seedbank_load_v_omitpretreatment <- seedbank_load_v %>% 
  filter(!str_detect(treatment, "pretreat")) 
head(seedbank_load_v_omitpretreatment)

unique(seedbank_load_v_omitpretreatment$treatment) # list unique treatments --> ordered: control, charate, oven, ovenchar
unique(seedbank_load_v_omitpretreatment$status) # list unique treatments --> native, nonnative
unique(seedbank_load_v_omitpretreatment$genus_abundance) # list unique species --> 52 species
unique(seedbank_load_v_omitpretreatment$stand_core) # unique stand_core --> 26 = 7 + 10 + 9
sort(unique(seedbank_load_v_omitpretreatment$family))

# write.csv(seedbank_load_v_omitpretreatment, "~/Dropbox/GRADSCHOOL/Dissertation/R_dissertation/chaparraldegradation_2022b/processed/seedbank_load_v_omitpretreatment.csv")
```

# Load clean data 

### - germination by depth and treatment
```{r load standardized germination data, inlude = TRUE}
germination_m2_raw <- read_xlsx("processed/germination_m2.xlsx")
average_cover <- read.csv("nat_nn_cover.csv", header = TRUE, na.strings=c("","NA"))

germination_depthtreat <- germination_m2_raw %>%
  mutate(site = fct_relevel(site, 
            "INT1", "INT2", "INT3","ENH1", "ENH2", "DEG1", "DEG2")) %>% 
  mutate(treatment = fct_relevel(treatment, 
                                 "control", "charate", "oven", "ovenchar")) %>% 
  left_join(average_cover, by = 'site') %>% 
  dplyr::select(stand, site, depth_name, subsample_g, treatment, species_diversity, genus_abundance, lifeform, status, lifescycle, family, count, stand_core, stand_core_depth, stand_core_depth_treat, n_per_g, native_shrub, nonnative_grass)

glimpse(germination_depthtreat)
```
# UPDATED STACKED FIGURE: Stacked germination by family (January 2024)
### - germination (n/g soil) by family
```{r germination (n/g soil) by family}

# updated code on jan 21, 2024
seedbank_byfamily_new <- germination_depthtreat %>% # prior df: seedbank_load_v_omitpretreatment
 filter(count > 0) %>% 
   group_by(stand, site, stand_core, family, status) %>%  
  # This will give a data point for every species based on germination numbers per species
  dplyr::summarize(germ_nperg_family = sum(n_per_g), 
                   N_species = length(unique(species_diversity)), 
                   total_count = sum(count))
  
head(seedbank_byfamily_new)
sort(unique(seedbank_byfamily_new$family)) # df before transpose - use for ellipses
# N = 25 families
n_distinct(seedbank_byfamily_new$family) # 25 
```

```{r FIGURE germination (n/g soil) by family}
family_native <- ggplot(seedbank_byfamily_new %>%  
         dplyr::filter(status == "native"),   
       aes(fill=family, y=germ_nperg_family, x=stand_core)) + 
  geom_bar(position="stack", stat="identity") +
  ylim(0, 2)+
  #ggtitle("Germination (#/g soil) by Family and Status") +
  labs(x="Sampling Location", y="Germination (#/g soil)") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  facet_wrap(~ status)

family_native_print <- family_native + theme(legend.position = c(0.1, 0.2)) # Key location offset from (0,0)

family_nn <- ggplot(seedbank_byfamily_new %>%  
         dplyr::filter(status == "nonnative"),   
       aes(fill=family, y=germ_nperg_family, x=stand_core)) + 
  geom_bar(position="stack", stat="identity") +
  ylim(0, 2)+
  #ggtitle("Germination (#/g soil) by Family and Status") +
  labs(x="Sampling Location", y="Germination (#/g soil)") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  facet_wrap(~ status)

# With the par( ) function, you can include the option mfrow=c(nrows, ncols) to create a matrix of nrows x ncols plots that are filled in by row. mfcol=c(nrows, ncols) fills in the matrix by columns.

# option 1
# ggarrange(family_native, family_nn, 
#           labels = c("A", "B"),
#           ncol = 1, nrow = 2)
# 
# option 2
ggdraw() +
  draw_plot(family_native, x = 0.02, y = .5, width = 1, height = .5) +
  draw_plot(family_nn, x = 0.02, y = 0, width = 1, height = .5) +
 # draw_plot(bp, x = 0, y = 0, width = 1, height = 0.5) +
  draw_plot_label(label = c("A", "B"), size = 10,
                  x = c(0, 0), y = c(1, .5))
```
# UPDATED NMDS FIGURE: NMDS by genus (January 2024)
### - data prep
```{r updated nmds data prep}
# species in columns
# sites or observations in rows

seedbank_nperg_bysamplocation <- germination_depthtreat %>% 
  group_by(stand, site, stand_core, genus_abundance) %>% # lifeform, status, lifescycle, family
  filter(count > 0) %>% 
  filter(!is.na(genus_abundance)) %>% # omit blank cells in species 
  dplyr::summarize(totalgerm_nperg_genus = sum(n_per_g)) 

head(seedbank_nperg_bysamplocation) # df before transpose - use for ellipses
dim(seedbank_nperg_bysamplocation) #330   5
```

### - transpose data 
```{r updated transpose data by species for nmds, include=TRUE}

# species in columns down
# observations or sites in rows across

seedbank_nperg_bysamplocation_nmdsprep <- seedbank_nperg_bysamplocation %>% 
 tidyr::spread(genus_abundance, totalgerm_nperg_genus) %>% # transpose data so columns are stand_core
  replace(is.na(.), 0) # replace NA with zeros --> isn't compatible with character columns

view(seedbank_nperg_bysamplocation_nmdsprep)

# write.csv(seedbank_nperg_bysamplocation_nmdsprep, "~/Dropbox/GRADSCHOOL/Dissertation/R_dissertation/chaparraldegradation_2022b/processed/seedbank_NMDS_202401.csv")
```

### - replace NAs with zeros
```{r updated replace NAs with zeros}
seedbank_nperg_bysamplocation_nmdsprep_num <- seedbank_nperg_bysamplocation_nmdsprep %>% 
    ungroup() %>% 
  dplyr::select(!c('stand', 'site', 'stand_core')) %>% 
  replace(is.na(.), 0)
  
head(seedbank_nperg_bysamplocation_nmdsprep_num) # only numbers
dim(seedbank_nperg_bysamplocation_nmdsprep_num) # 26 55
```

### - stress tests
```{r updated stress tests}
# USE THIS ONE!

# str(seedbank_nperg_bysamplocation_nmdsprep)
# stand_core_depth -->  tibble [89 × 52]

# the AUTOTRANSFORM = F skips the automatic data transformations and uses the input data as is
# - when the raw data contains the information you need (e.g., abundance)
# - when you have a small number of samples or small number of variables
# - when you want to preseve the original scale of the data (e.g., interested in the absolute differences between two sets of measurements)
seedbank_nperg_bysamplocation_nmds <- metaMDS(seedbank_nperg_bysamplocation_nmdsprep_num, autotransform = F)

# uses the RAUP-CRICK dissimilarity index to calculate pairwise dissimilarities
# - adjusts for spp richness
# - downweights importance of rare spp 
# - more useful when interested in community STRUCTURE rather than individual species
# - takes into account differences in species evenness
#seedbank_nperg_bysamplocation_nmds <- metaMDS(seedbank_nperg_bysamplocation_nmdsprep_num, distance = "raup")
# stress tests are really low ==> I may have insufficient data. :/
```
### - scores
```{r updated scores nmds}
scores(seedbank_nperg_bysamplocation_nmds)
```
### - stressplot
```{r updated stress test}

stressplot(seedbank_nperg_bysamplocation_nmds)
# if stress tests are really low ==> I may have insufficient data. :/

#plot_df <- scores(seedbank_bysitecore_nmds, display = "sites") %>% # from An's code
#  as.data.frame() %>% 
#  rownames_to_column("stand_core") %>% 
#  full_join(seedbank_bysitecore, by = "stand_core")

nmds_df_nperg <- data.frame(seedbank_nperg_bysamplocation_nmds$points, seedbank_nperg_bysamplocation_nmdsprep) # from chatgpt

```

### - ggplot color
```{r updated ggplot bw}
colnames(nmds_df_nperg)[colnames(nmds_df_nperg) == 'site'] <- 'hillslope' # rename "site" to "hillslope"

seedbank_nperg_nmds_color <- ggplot(nmds_df_nperg, 
       aes(x = MDS1, y = MDS2, color = hillslope, shape = hillslope)) + # shape = site, color = site
  geom_point(size = 3, alpha = 0.8) +
  scale_color_manual(values = c("orange", "brown", "green", "darkgreen", "lightblue", "blue", "navy")) + #"gray0", "gray30", "gray60"
  scale_shape_manual(values = c(16,16, 15, 15, 17, 17, 17)) + 
  theme_bw() +
  #stat_ellipse(linetype = 2, size = 1) +
  labs(title = "NMDS: by germination (#/g soil)")
```
### - ggplot color vectors
```{r updated nmds color and vectors with envfit function}
# code from An Bui: https://rpubs.com/an-bui/vegan-cheat-sheet 

nmds_nperg_df <- data.frame(seedbank_nperg_bysamplocation_nmds$points, seedbank_nperg_bysamplocation_nmdsprep) # code from chatgpt. Adds NMDS1 and NMDS2 values to dataframe.

seedbank_nperg_bysamplocation_nmdsprep <- seedbank_nperg_bysamplocation_nmdsprep %>% 
  mutate(standtype_ID = 1)
seedbank_nperg_bysamplocation_nmdsprep$standtype_ID <- 1:26 #shorten df to first 26 rows

plot_below_df_nperg <- scores(seedbank_nperg_bysamplocation_nmds, display = "sites") %>% 
  as.data.frame() %>% 
  rownames_to_column("standtype_ID") %>% 
  mutate_at(c('standtype_ID'), as.numeric) %>% 
  full_join(seedbank_nperg_bysamplocation_nmdsprep, by = "standtype_ID") %>%  
  select(!c(standtype_ID))

 dim(plot_below_df_nperg) # 26 rows
```

```{r updated extract pvalues}

# envfit() takes the output of metaMDS() and the species matrix you created
fit_below_nperg <- envfit(seedbank_nperg_bysamplocation_nmds, seedbank_nperg_bysamplocation_nmdsprep, perm = 999) # pvalues for spp and stand, site, stand_core

# extract p-values for each species
fit_below_pvals_nperg <- fit_below_nperg$vectors$pvals %>% 
  as.data.frame() %>% 
  rownames_to_column("species") %>% 
  dplyr::rename("pvals" = ".") %>% 
  filter(!species == 'standtype_ID')
view(fit_below_pvals_nperg)
```

```{r updated extract coordinates for genus_abundance}
# extract coordinates for species, only keep species with p-val = 0.05
fit_below_spp_nperg <- fit_below_nperg %>% 
  scores(., display = "vectors") %>% 
  as.data.frame() %>% 
  rownames_to_column("species") %>% 
  full_join(., fit_below_pvals_nperg, by = "species") %>% 
  filter(pvals <= 0.002) %>% # limited number for visual clarity
  filter(!species == 'standtype_ID')
dim(fit_below_spp_nperg)
```

```{r updated nmds plot with vectors }
# by standtype
nmdsbelow_plot_new_nperg <- ggplot(plot_below_df_nperg, 
                                   aes(x = NMDS1, y = NMDS2)) +
  coord_equal() +
  geom_point(aes(color = stand, shape = stand), size = 3, alpha = 0.8) + #shape = stand_core
  stat_ellipse(aes(color = stand)) +
   scale_color_manual(values = c("darkgreen", "darkmagenta", "darkgoldenrod1")) +
  geom_segment(data = fit_below_spp_nperg, aes(x = 0, xend = NMDS1, y = 0, yend = NMDS2),
               arrow = arrow(length = unit(0.25, "cm")),
               col = "black") +
  geom_text(data = fit_below_spp_nperg, aes(label = species),  
            position = position_jitter(width = 0.4, height = 0.5))
nmdsbelow_plot_new_nperg + theme_bw()

# by hillslope
colnames(plot_below_df_nperg)[colnames(plot_below_df_nperg) == 'site'] <- 'hillslope' # rename "site" to "hillslope"

nmdsbelow_plot_new_nperg <- ggplot(plot_below_df_nperg, 
                                   aes(x = NMDS1, y = NMDS2)) +
  coord_equal() +
  geom_point(aes(color = hillslope, shape = hillslope), size = 3, alpha = 0.8) + #shape = stand_core
 # stat_ellipse(aes(color = stand)) +
 scale_color_manual(values = c("orange", "brown", "green", "darkgreen", "lightblue", "cornflowerblue", "blue")) + #"gray0",
   scale_shape_manual(values = c(16,16, 15, 15, 17, 17, 17)) + 
  theme_bw() +
  geom_segment(data = fit_below_spp_nperg, aes(x = 0, xend = NMDS1, y = 0, yend = NMDS2),
               arrow = arrow(length = unit(0.25, "cm")),
               col = "black") +
  geom_text(data = fit_below_spp_nperg, aes(label = species),  
            position = position_jitter(width = 0.0, height = 0.4)
            )
nmdsbelow_plot_new_nperg + theme_bw()
nmdsbelow_plot_new_nperg + theme_bw()
nmdsbelow_plot_new_nperg + theme_bw()
nmdsbelow_plot_new_nperg + theme_bw()
nmdsbelow_plot_new_nperg + theme_bw()
nmdsbelow_plot_new_nperg + theme_bw()
nmdsbelow_plot_new_nperg + theme_bw()
nmdsbelow_plot_new_nperg + theme_bw()
```





# OG CODE: Stacked germination by family (2023)
```{r stacked germination by family, include=TRUE}
# data prep 
# this is the df you'll call to set GROUPS: seedbank_bysitecore

# original code written by Kit in 2023
seedbank_byfamily <- seedbank_load_v_omitpretreatment %>% 
    #filter(!is.na(genus_abundance)) %>% # omit blank cells 
   group_by(stand, site, rep, stand_core, family) %>% # by stand_core and species 
   # This will give a data point for every species based on germination numbers per species
   #group_by(stand_core_depth, species) %>% # by stand_core_depth - DOES NOT CONSIDER TREATMENT
   #group_by(stand_core_detph_treat, species) %>% # by stand_core_depth_treat
   dplyr::summarize(totalgerm_family = sum(count)) 
head(seedbank_byfamily)
sort(unique(seedbank_byfamily$family)) # df before transpose - use for ellipses
# N = 26 families
# "Phrymaceae" and "Phrymaceae  "
```

### - Figure: proportion of germination

```{r calculate proportion of germination, include = FALSE}
seedbank_byfamily_count <- seedbank_byfamily %>% # calculate the total number of hits to then calculate proportion 
  group_by(stand_core) %>%
  dplyr::summarize(totalgerm_family_bystandcore = sum(totalgerm_family))


seedbank_byfamily_proportion <- seedbank_byfamily %>%
  left_join(seedbank_byfamily_count, by = c("stand_core")) %>%
  mutate(proportion_germination = (totalgerm_family/totalgerm_family_bystandcore)*100) %>%
  dplyr::select(!c(totalgerm_family, totalgerm_family_bystandcore))

#this is with just the counts
ggplot(seedbank_byfamily, aes(fill=family, y=totalgerm_family, x=stand_core)) + 
  geom_bar(position="fill", stat="identity") +
  ggtitle("Relative Germination by Family") +
  labs(x="Soil Core", y="Relative Germination") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

#this is the percents we calculated
ggplot(seedbank_byfamily_proportion, aes(fill=family, y=proportion_germination, x=stand_core)) + 
  geom_bar(position="stack", stat="identity") +
  ggtitle("Relative Germination by Family") +
  labs(x="Soil Core", y="Relative Germination") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```

### - Figure: stacked germination by family and status
```{r tacked germination by family and status FIGURE, include=TRUE}

seedbank_byfamily_status <- seedbank_load_v_omitpretreatment %>% 
   #filter(!is.na(genus_abundance)) %>% # omit blank cells 
  group_by(stand, site, rep, stand_core,family, status) %>% # by stand_core and species 
  # This will give a data point for every species based on germination numbers per species
  #group_by(stand_core_depth, species) %>% # by stand_core_depth - DOES NOT CONSIDER TREATMENT
  #group_by(stand_core_detph_treat, species) %>% # by stand_core_depth_treat
  dplyr::summarize(totalgerm_family = sum(count)) 

seedbank_byfamily_status_count <- seedbank_byfamily_status %>% # calculate the total number of hits to then calculate proportion 
  group_by(stand_core, status) %>%
  dplyr::summarize(totalgerm_family_bystandcore = sum(totalgerm_family))

seedbank_byfamilystatus_proportion <- seedbank_byfamily_status %>%
  left_join(seedbank_byfamily_count, by = c("stand_core")) %>%
  mutate(proportion_germination = (totalgerm_family/totalgerm_family_bystandcore)*100) %>%
  dplyr::select(!c(totalgerm_family, totalgerm_family_bystandcore))

#this is the percents we calculated
ggplot(seedbank_byfamilystatus_proportion %>%  
         dplyr::filter(status == "native" | status == "nonnative"), 
       aes(fill=family, y=proportion_germination, x=stand_core)) + 
  geom_bar(position="stack", stat="identity") +
  ggtitle("Relative Germination by Family and Status") +
  labs(x="Soil Core", y="Relative Germination") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  facet_wrap(~ status)
```

### Figure: stacked Germination by family with shrub -- Kit
```{r}
abcover_sum <- read.csv("processed/coverstatus.csv")
abcover_sum[,12] <- c("INT1", "INT2", "INT3", "ENH1", "ENH1", "ENH1", "ENH2", "ENH2", "ENH2", "DEG1", "DEG1", "DEG1", "DEG2", "DEG2", "DEG2") 

abcover_sum <- abcover_sum %>%
  rename(hill = V12) %>%
  dplyr::select(!c(X, standtype, site_rep, native_fern, native_forb, nonnative_fern, nonnative_forb, nonnative_shrub, native_grass)) %>%
  group_by(hill) %>%
  summarise(across(nonnative_grass:native_shrub, mean)) 

abcover_sum <- cbind(abcover_sum[1], stack(abcover_sum[2:3])) %>%
  rename(proportion = values,
         type = ind) %>%
  mutate(proportion = 100*proportion)


seedbank_byfamilystatus_proportion_1 <- seedbank_byfamilystatus_proportion %>%
  group_by(site, family, status) %>%
  summarize(across(proportion_germination, mean))


seedbank_byfamilystatus_proportion_hill <- seedbank_byfamily_status %>%
  left_join(seedbank_byfamily_count, by = c("stand_core")) %>%
  group_by(family, site) %>%
  summarise(across(totalgerm_family:totalgerm_family_bystandcore, mean)) %>%
  mutate(proportion_germination = (totalgerm_family/totalgerm_family_bystandcore)*100)



# %>%
  # dplyr::select(!c(totalgerm_family, totalgerm_family_bystandcore))






ggplot(seedbank_byfamilystatus_proportion %>%  
         dplyr::filter(status == "native" | status == "nonnative"), 
       aes(fill=family, y=proportion_germination, x=stand_core)) + 
  geom_bar(position="stack", stat="identity") +
  ggtitle("Relative Germination by Family and Status") +
  labs(x="Soil Core", y="Relative Germination") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  facet_wrap(~ status)

barwidth <- 0.35

ggplot() + 
    geom_bar(data = abcover_sum, 
             mapping = aes(x = as.numeric(interaction(hill)) + barwidth, y = proportion, fill = type), 
             stat="identity", 
             position='stack', 
             width = barwidth) + 
    scale_fill_manual(values = c("green3", "pink2")) +
    new_scale_fill() +
    geom_bar(data = subset(seedbank_byfamilystatus_proportion_1, status == "nonnative"), 
             mapping = aes(x = as.numeric(interaction(site)), y = proportion_germination, fill = family), 
             stat="identity", 
             position='stack' , 
             width = barwidth) +
    ggtitle("Nonnative") +
    xlab("site")
    scale_x_continuous(breaks=c(1.25,2.25,3.25,4.25,5.25,6.25,7.25),labels=c("Deg1","Deg2","Enh1", "Enh1", "Int1", "Int2", "Int3")) 
```

# Total germination by stand_core
```{r Total germination by stand_core, include=TRUE}
seedbank_load_v_omitpretreatment %>% 
  dplyr::filter(stand_core == "DEG2_7") %>% 
  print(n_distinct(species_diversity))

seedbank_load_v_omitpretreatment_1 <- seedbank_load_v_omitpretreatment %>% 
  dplyr::filter(count > 0)

seedbank_sppr <- seedbank_load_v_omitpretreatment %>% # <-- this is species richness
  dplyr::filter(count > 0) %>% 
   group_by(stand, stand_core) %>% 
   dplyr::summarize(total_germination = n_distinct(species_diversity))
 print(seedbank_sppr)

seedbank_sppr_bystand <- seedbank_sppr %>% 
  # na.omit() %>%  
   group_by(stand) %>% 
   dplyr::summarize(mean_germination = mean(total_germination), # <-- this is total germination. WHAT AM I DOING? 
                    sd = sd(total_germination),
                    N = length(total_germination),
                    SE = (sd(total_germination)) / sqrt(total_germination)
                    ) %>% 
 print(seedbank_sppr_bystand)


seedbank_sppr_regression <- ggplot(data = seedbank_sppr, 
        aes(x = nonnative_grass*100, y = percentcover_native*100, shape = standtype.x, color = standtype.x)) + #shape = standtype.x, color = standtype.x
   geom_point(size = 3, alpha = 0.8) +
    scale_shape_manual(values = c(16, 17, 18)) +
   ylim(0, 100)+
   xlim(0,100) +
  geom_smooth(method = "lm", se = FALSE, linetype = "solid", color = "black") +  # lm, loess, glm
   scale_color_manual(values = c(standcolors),
                      name = "Stand Type",
                      labels = c("intact" = "shrub dominated", 
                                 "matrix" = "matrix", 
                                 "degraded" = "grass dominated")) + #rename standtypes labels
   labs(x = "Non-native grass cover (%)", 
        y = "Native cover (%)", 
        title = "Total Native Cover by Non-native Grass Cover") +
   theme_bw() +  
   stat_poly_line() +
 #  stat_poly_eq(use_label(c("eq", "R2")))
    stat_poly_eq(
     aes(label = paste(after_stat(eq.label), stat(adj.rr.label), sep = "~~~~")),
   #  formula = formula6, 
     parse=TRUE
  ) +
 print(seedbank_sppr_regression)

```


# NMDS prep
(5.1) sum of germinates BY GENUS at each stand_core (e.g., present in one core = sum (char, control, oven, charoven)
```{r organize data for nmds, inclue = TRUE}

# species in columns
# sites or observations in rows

# this is the df you'll call to set GROUPS: seedbank_bysitecore
seedbank_bysitecore <- seedbank_load_v_omitpretreatment %>% 
  group_by(stand, site, stand_core, genus_abundance) %>% # by stand_core and species 
  # This will give a data point for every species based on germination numbers per species
  #group_by(stand_core_depth, species) %>% # by stand_core_depth - DOES NOT CONSIDER TREATMENT
  #group_by(stand_core_detph_treat, species) %>% # by stand_core_depth_treat
  filter(!is.na(genus_abundance)) %>% # omit blank cells in species 
  dplyr::summarize(totalgerm_genus = sum(count)) 

view(seedbank_bysitecore) # df before transpose - use for ellipses
```

(6) Prepare data for an NMDS
```{r transpose data by species for nmds, include=TRUE}

# species in columns down
# observations or sites in rows across

seedbank_bysitecore_nmdsprep <- seedbank_bysitecore %>% 
 tidyr::spread(genus_abundance, totalgerm_genus) %>% # transpose data so columns are stand_core_depth
  #tidyr::spread(stand_core_depth, totalgerm) %>% # transpose data so columns are stand_core_depth
  # tidyr::spread(stand_core_depth_treat, totalgerm) %>% # transpose data so columns are stand_core_depth_treat
  replace(is.na(.), 0) # replace NA with zeros --> isn't compatible with character columns

view(seedbank_bysitecore_nmdsprep)

```

```{r replace NAs with zeros}

# You don't need to run this right now

seedbank_bysitecore_nmdsprep_num <- seedbank_bysitecore_nmdsprep %>% 
  # use the ungroup() function to take out grouping
  ungroup() %>% 
  select(!c(stand_core, stand, site)) %>% # de-select these columns
  replace(is.na(.), 0)

view(seedbank_bysitecore_nmdsprep_num) # only numbers
# 26 x 42 
```

```{r write nmds matrix to csv}

write.csv(seedbank_bysitecore_nmdsprep_num, "~/Dropbox/GRADSCHOOL/Dissertation/R_dissertation/chaparraldegradation_2022b/processed/seedbank_NMDS_202310.csv")

```
# NMDS 
(7) NMDS 
```{r stress tests}
# USE THIS ONE!

str(seedbank_bysitecore_nmdsprep_num)
# stand_core_depth -->  tibble [89 × 52]

# the AUTOTRANSFORM = F skips the automatic data transformations and uses the input data as is
# - when the raw data contains the information you need (e.g., abundance)
# - when you have a small number of samples or small number of variables
# - when you want to preseve the original scale of the data (e.g., interested in the absolute differences betwen two sets of measurements)
seedbank_bysitecore_nmds <- metaMDS(seedbank_bysitecore_nmdsprep_num, autotransform = F)

# uses the RAUP-CRICK dissimilarity index to calculate pairwise dissimilarities
# - adjusts for spp richness
# - downweights importance of rare spp 
# - more useful when interested in community STRUCTURE rather than individual species
# - takes into account differences in species evenness
#seedbank_bysitecore_nmds <- metaMDS(seedbank_bysitecore_nmdsprep_num, distance = "raup")
# stress tests are really low ==> I may have insufficient data. :/


```

```{r scores nmds}

scores(seedbank_bysitecore_nmds)
```

```{r stress test}

stressplot(seedbank_bysitecore_nmds)
# if stress tests are really low ==> I may have insufficient data. :/

#plot_df <- scores(seedbank_bysitecore_nmds, display = "sites") %>% # from An's code
#  as.data.frame() %>% 
#  rownames_to_column("stand_core") %>% 
#  full_join(seedbank_bysitecore, by = "stand_core")

nmds_df <- data.frame(seedbank_bysitecore_nmds$points, seedbank_bysitecore_nmdsprep) # from chatgpt


```

```{r ggplot bw}
ggplot(nmds_df, aes(x = MDS1, y = MDS2, color = stand, shape = stand)) +
  geom_point(size = 3, alpha = 0.8) +
  scale_color_manual(values = c("gray0", "gray30", "gray60")) +
  theme_bw() +
  stat_ellipse(linetype = 2, size = 1) +
  labs(title = "NMDS: by seed bank germination counts", color = "Stand type", shape = "Stand type")
```

```{r ggplot color}
seedbank_nmds_plot_color <- ggplot(nmds_df, aes(x = MDS1, y = MDS2, color = stand, shape = stand)) +
  geom_point(size = 3, alpha = 0.8) +
  scale_color_manual(values = c("darkgreen", "darkmagenta", "darkgoldenrod1")) +
  theme_bw() +
  coord_equal() +
  #coord_fixed() +
  #theme_ipsum_rc() +
  theme(legend.position = c(0.15, 0.83)) + # x, y left corner: 0,0
  #stat_ellipse(level = .95, linetype = 2, size = 1) +
  stat_ellipse(linetype = 2, size = 1) +
  labs(title = "NMDS: by seed bank germination counts", color = "Stand type", shape = "Stand type")
seedbank_nmds_plot_color

```



```{r nmds color and vectors with envfit function}
# code from An Bui: https://rpubs.com/an-bui/vegan-cheat-sheet 

nmds_below_df <- data.frame(seedbank_bysitecore_nmds$points, seedbank_bysitecore_nmdsprep) # code from chatgpt. Adds NMDS1 and NMDS2 values to dataframe.

seedbank_bysitecore_nmdsprep <- seedbank_bysitecore_nmdsprep %>% 
  mutate(standtype_ID = 1)

seedbank_bysitecore_nmdsprep$standtype_ID <- 1:26 #shorten df to first 26 rows

plot_below_df <- scores(seedbank_bysitecore_nmds, display = "sites") %>% 
  as.data.frame() %>% 
  rownames_to_column("standtype_ID") %>% 
  mutate_at(c('standtype_ID'), as.numeric) %>% 
  full_join(seedbank_bysitecore_nmdsprep, by = "standtype_ID") %>%  
  select(!c(standtype_ID))

 view(plot_below_df)

# envfit() takes the output of metaMDS() and the species matrix you created
fit_below <- envfit(seedbank_bysitecore_nmds, seedbank_bysitecore_nmdsprep, perm = 999) # pvalues for spp and stand, site, stand_core

# extract p-values for each species
fit_below_pvals <- fit_below$vectors$pvals %>% 
  as.data.frame() %>% 
  rownames_to_column("species") %>% 
  dplyr::rename("pvals" = ".") %>% 
  filter(!species == 'standtype_ID')
view(fit_below_pvals)

# extract coordinates for species, only keep species with p-val = 0.05
fit_below_spp <- fit_below %>% 
  scores(., display = "vectors") %>% 
  as.data.frame() %>% 
  rownames_to_column("species") %>% 
  full_join(., fit_below_pvals, by = "species") %>% 
  filter(pvals <= 0.001) %>% # limited number for visual clarity
  filter(!species == 'standtype_ID')

# new plot
nmdsbelow_plot_new <- ggplot(plot_below_df, aes(x = NMDS1, y = NMDS2)) +
  coord_equal() +
  geom_point(aes(color = stand, shape = stand), size = 3, alpha = 0.8) +
  stat_ellipse(aes(color = stand)) +
   scale_color_manual(values = c("darkgreen", "darkmagenta", "darkgoldenrod1")) +
  geom_segment(data = fit_below_spp, aes(x = 0, xend = NMDS1, y = 0, yend = NMDS2),
               arrow = arrow(length = unit(0.25, "cm")),
               col = "black") +
  geom_text(data = fit_below_spp, aes(label = species),  
            position = position_jitter(width = 0.2, height = 0.3))
nmdsbelow_plot_new + theme_bw()

```





```{r plot nmds basics}
#basic normal plot
ordiplot(seedbank_bysitecore_nmds) # without point labels
ordiplot(seedbank_bysitecore_nmds, type = "t") # with point labels

#ggvegan to make a quick nice plot
autoplot(seedbank_bysitecore_nmds) # NMDS1 x NMDS2, Key = "Score": sites, species
# sites == total germ per species
# species == stand_core


#this makes a dataframe that gives a lot of control graphically 
seedbank_bysitecore_nmds_fort <- fortify(seedbank_bysitecore_nmds)


# vectors AND measurments
seedbank_bysitecore_nmds_fortplot <- ggplot() + 
  geom_point(data = subset(seedbank_bysitecore_nmds_fort, score == 'sites'),
             mapping = aes(x = NMDS1, y = NMDS2),
             color = 'black',
             size = 4,
             alpha = 1) +
  geom_segment(data = subset(seedbank_bysitecore_nmds_fort, score == 'species'),
               mapping = aes(x = 0, y = 0, xend = NMDS1, yend = NMDS2),
               arrow = arrow(length = unit(0.015, "npc"),
                             type = 'closed'),
               color = 'darkgrey',
               linewidth = 0.8) +
  geom_text(data = subset(seedbank_bysitecore_nmds_fort, score == 'species'),
             position = position_jitter(width = 0.2, height = 0.2),
            mapping = aes( x = NMDS1*1.1, y = NMDS2*1.1))+
  geom_abline(intercept = 0,slope = 0,linetype = "dashed", linewidth = 0.8,colour = "gray")+
  geom_vline(aes(xintercept = 0), linetype = "dashed", linewidth = 0.8, colour = "gray")+
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.line = element_line(colour = "black"))
seedbank_bysitecore_nmds_fortplot

#only vectors shown
seedbank_bysitecore_nmds_fortplot1 <- ggplot() + 
  geom_point(data = subset(seedbank_bysitecore_nmds_fort, score == 'sites'),
             mapping = aes(x = NMDS1, y = NMDS2),
             color = 'black',
             size = 3,
             alpha = 0) +
  geom_segment(data = subset(seedbank_bysitecore_nmds_fort, score == 'species'),
               mapping = aes(x = 0, y = 0, xend = NMDS1, yend = NMDS2),
               arrow = arrow(length = unit(0.015, "npc"),
                             type = 'closed'),
               color = 'darkgrey',
               linewidth = 0.8) +
  geom_text(data = subset(seedbank_bysitecore_nmds_fort, score == 'species'),
            position = position_jitter(width = 0.2, height = 0.2),
            mapping = aes(label = Label, x = NMDS1*1.1, y = NMDS2*1.1))+
  geom_abline(intercept = 0,slope = 0,linetype = "dashed", linewidth = 0.8,colour = "gray")+
  geom_vline(aes(xintercept = 0), linetype = "dashed", size = 0.8, colour = "gray")+
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.line = element_line(colour = "black"))
seedbank_bysitecore_nmds_fortplot1

#only measurements shown
seedbank_bysitecore_nmds_fortplot2 <- ggplot() + 
  geom_point(data = subset(seedbank_bysitecore_nmds_fort, Score == 'sites'),
             mapping = aes(x = NMDS1, y = NMDS2),
             color = 'black',
             alpha = 0.5) +
  geom_segment(data = subset(seedbank_bysitecore_nmds_fort, Score == 'species'),
               mapping = aes(x = 0, y = 0, xend = NMDS1, yend = NMDS2),
               arrow = arrow(length = unit(0.015, "npc"),
                             type = 'closed'),
               color = 'darkgrey',
               size = 0.8,
               alpha = 0) +
  geom_text(data = subset(seedbank_bysitecore_nmds_fort, Score == 'species'),
            mapping = aes(label = Label, x = NMDS1*1.1, y = NMDS2*1.1),
            alpha = 0)+
  geom_abline(intercept = 0,slope = 0,linetype = "dashed", size = 0.8,colour = "gray")+
  geom_vline(aes(xintercept = 0), linetype = "dashed", size = 0.8, colour = "gray")+
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.line = element_line(colour = "black"))

#interactive plots that I like
ggplotly(seedbank_bysitecore_nmds_fortplot)

#show both plots 
hi_below <- ggarrange(seedbank_nmds_plot_color, seedbank_bysitecore_nmds_fortplot, ncol = 1)
hi_below

```







```{r NMDS ellipses}

# from https://www.rpubs.com/RGrieger/545184 - dune data - adding ellipses
data(dune)
data("dune.env")
view(dune)
view(dune.env)

plot(seedbank_bysitecore_nmds, type = "n")

#adding ellipses
ordiplot(seedbank_bysitecore_nmds, type = "n", main = "ellipses")
orditorp(seedbank_bysitecore_nmds, display = "sites", labels = T, pch = c(16, 8, 12) [as.numeric(seedbank_bysitecore$stand)], col = c("green", "blue", "orange") [as.numeric(seedbank_bysitecore$stand)], cex = 1)
ordiellipse(seedbank_bysitecore_nmds, groups = seedbank_bysitecore$stand, draw = "polygon", lty = 1, col = "grey90")

ordiplot(seedbank_bysitecore_nmds,type="n")
orditorp(seedbank_bysitecore_nmds,display="species",col="red",air=0.01)
orditorp(seedbank_bysitecore_nmds,display="sites",cex=1.25,air=0.01)

str(seedbank_bysitecore_nmdsprep_num)
#tibble [90 × 27] (S3: tbl_df/tbl/data.frame)
treat=c(rep("treatment1",7),rep("treatment2",7), rep("treatment3",7)) 
ordiplot(abcover_byspecies_NMDS,type="n")
ordihull(abcover_byspecies_NMDS,groups=treat,draw="polygon",col="grey90",
         label=FALSE)
orditorp(abcover_byspecies_NMDS,display="species",col="red",air=0.01)
orditorp(abcover_byspecies_NMDS,display="sites",col=c(rep("green",50),rep("blue",50),re("orange",25)),
         air=0.01,cex=1.25)


```



(8) sum of germinates by species (e.g., present in one core = sum (char, control, oven, charoven)
```{r seedbank sum germinants by spp, inclue = TRUE}


seedbank_byspp <- seedbank_load_v_omitpretreatment %>% 
  group_by(species, stand_core) %>% # by stand_core
  #group_by(stand_core_depth, species) %>% # by stand_core_depth - DOES NOT CONSIDER TREATMENT
  #group_by(stand_core_detph_treat, species) %>% # by stand_core_depth_treat
  filter(!is.na(species)) %>% # omit blank cells in species 
  dplyr::summarize(totalgerm = sum(totalcount)) 

head(seedbank_byspp) 
```

(9) Prepare data for an NMDS
```{r transpose seedbank data by spp, include=TRUE}

seedbank_byspp_nmdsprep <- seedbank_byspp %>% 
  tidyr::spread(species, totalgerm) %>% # transpose data so columns are stand_core
  replace(is.na(.), 0) # replace NA with zeros
head(seedbank_byspp_nmdsprep)

seedbank_byspp_nmdsprep_num <- seedbank_byspp_nmdsprep %>% 
  # use the ungroup() function to take out grouping
  ungroup() %>% 
  select(!c(stand_core))
         
view(seedbank_byspp_nmdsprep_num) # only numbers
write.csv(seedbank_byspp_nmdsprep_num, "~/Dropbox/GRADSCHOOL/Dissertation/R_dissertation/chaparraldegradation_2022b/processed/seedbank_NMDS_byspp_202303.csv")
```

(10) NMDS 
```{r FROM KIT - nmds by species - use this code from KIT}
# USE THIS ONE!

str(seedbank_byspp_nmdsprep_num)
#tibble [27 × 90] (S3: tbl_df/tbl/data.frame)

# stress test, will run 20 times
seedbank_byspp_nmds <- metaMDS(seedbank_byspp_nmdsprep_num, distance = "raup")
# some data have empty spp

# stress test, will run 20 times
seedbank_byspp_nmds <- metaMDS(seedbank_byspp_nmdsprep_num, autotransform = F)
# stress tests are really low ==> I may have insufficient data. :/

stressplot(seedbank_byspp_nmds)
plot(seedbank_byspp_nmds)

#basic normal plot
ordiplot(seedbank_byspp_nmds) # without point labels
ordiplot(seedbank_byspp_nmds, type = "t") # with point labels

#ggvegan to make a quick nice plot
autoplot(seedbank_byspp_nmds) # NMDS1 x NMDS2, Key = "Score": sites, species
# sites == total germ per species
# species == stand_core


#this makes a dataframe that gives a lot of control graphically 
seedbank_byspp_nmds_fort <- fortify(seedbank_byspp_nmds)

seedbank_byspp_nmds_fortplot <- ggplot() + 
  geom_point(data = subset(seedbank_byspp_nmds_fort, Score == 'sites'),
             mapping = aes(x = NMDS1, y = NMDS2),
             color = 'black',
             alpha = 0.5) +
  geom_segment(data = subset(seedbank_byspp_nmds_fort, Score == 'species'),
               mapping = aes(x = 0, y = 0, xend = NMDS1, yend = NMDS2),
               arrow = arrow(length = unit(0.015, "npc"),
                             type = 'closed'),
               color = 'darkgrey',
               linewidth = 0.8) +
  geom_text(data = subset(seedbank_byspp_nmds_fort, Score == 'species'),
            mapping = aes(label = Label, x = NMDS1*1.1, y = NMDS2*1.1))+
  geom_abline(intercept = 0,slope = 0,linetype = "dashed", linewidth = 0.8,colour = "gray")+
  geom_vline(aes(xintercept = 0), linetype = "dashed", linewidth = 0.8, colour = "gray")+
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.line = element_line(colour = "black"))
seedbank_byspp_nmds_fort

#only vectors shown
seedbank_byspp_nmds_fortplot1 <- ggplot() + 
  geom_point(data = subset(seedbank_byspp_nmds_fort, Score == 'sites'),
             mapping = aes(x = NMDS1, y = NMDS2),
             color = 'black',
             alpha = 0) +
  geom_segment(data = subset(seedbank_byspp_nmds_fort, Score == 'species'),
               mapping = aes(x = 0, y = 0, xend = NMDS1, yend = NMDS2),
               arrow = arrow(length = unit(0.015, "npc"),
                             type = 'closed'),
               color = 'darkgrey',
               linewidth = 0.8) +
  geom_text(data = subset(seedbank_byspp_nmds_fort, Score == 'species'),
            mapping = aes(label = Label, x = NMDS1*1.1, y = NMDS2*1.1))+
  geom_abline(intercept = 0,slope = 0,linetype = "dashed", linewidth = 0.8,colour = "gray")+
  geom_vline(aes(xintercept = 0), linetype = "dashed", size = 0.8, colour = "gray")+
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.line = element_line(colour = "black"))
seedbank_byspp_nmds_fortplot1

#only measurements shown
seedbank_byspp_nmds_fortplot2 <- ggplot() + 
  geom_point(data = subset(seedbank_byspp_nmds_fort, Score == 'sites'),
             mapping = aes(x = NMDS1, y = NMDS2),
             color = 'black',
             alpha = 0.5) +
  geom_segment(data = subset(seedbank_byspp_nmds_fort, Score == 'species'),
               mapping = aes(x = 0, y = 0, xend = NMDS1, yend = NMDS2),
               arrow = arrow(length = unit(0.015, "npc"),
                             type = 'closed'),
               color = 'darkgrey',
               size = 0.8,
               alpha = 0) +
  geom_text(data = subset(seedbank_byspp_nmds_fort, Score == 'species'),
            mapping = aes(label = Label, x = NMDS1*1.1, y = NMDS2*1.1),
            alpha = 0)+
  geom_abline(intercept = 0,slope = 0,linetype = "dashed", size = 0.8,colour = "gray")+
  geom_vline(aes(xintercept = 0), linetype = "dashed", size = 0.8, colour = "gray")+
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.line = element_line(colour = "black"))
seedbank_byspp_nmds_fortplot2

#interactive plots that I like
ggplotly(seedbank_byspp_nmds_fortplot)

#show both plots 
hi3 <- ggarrange(seedbank_byspp_nmds_fortplot1, seedbank_byspp_nmds_fortplot2, ncol = 1)
hi3


ordiplot(seedbank_byspp_nmds,type="n")
orditorp(seedbank_byspp_nmds,display="species",col="red",air=0.01)
orditorp(seedbank_byspp_nmds,display="sites",cex=1.25,air=0.01)

str(seedbank_byspp_nmdsprep_num)
#tibble [27 × 90] (S3: tbl_df/tbl/data.frame)
# I don't think I can make this becuase my soil cores are diff number for each stand.
treat=c(rep("treatment1",7),rep("treatment2",7), rep("treatment3",7)) 
ordiplot(seedbank_byspp_nmds,type="n")
ordihull(seedbank_byspp_nmds,groups=treat,draw="polygon",col="grey90",
         label=FALSE)
orditorp(seedbank_byspp_nmds,display="species",col="red",air=0.01)
orditorp(seedbank_byspp_nmds,display="sites",col=c(rep("green",7),rep("blue",7),rep("orange",7)),
         air=0.01,cex=1.25)


```




