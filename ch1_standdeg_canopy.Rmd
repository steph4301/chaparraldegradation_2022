---
title: "ch1_standdeg_canopy"
author: "Stephanie Ma Lucero"
date: "2023-07-24"
output: html_document
---

### NOTES 

```{r adam sandler message, include=FALSE}

# jul31 
# You've figured out how to visualize the raw data with a histogram, jitter plot, and box plots
# and how to test for normality with the shapiro.test(df$responsevariable).
# None of the above ground percent cover data are normally distributed.
# Leave it and MOVE ON to your seedbank data. 
# 1. complete data collection of Bay 6 tray
# 2. open seedbank NMDS file 
# 3. add the INT seed bank data
# 4. open the file in R and 
# 5. look at hist(seedbank$abundance)
# From talking with Rob - get rid of the zeros in abundance data because you don't know if the seeds were there or not... just calculate means and stats on germination counts. If there was only one tray with Sp. A, you can't run stats on it because you only have one rep with Sp. A present. 

# October 11, 20203
# you need to rerun above ground data by transect, not grouped by stand type
# model = model_type(dependent_variable ~ independent_variable + covariate, data = dataset_name),


```


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libraries, message=FALSE}

library(here) # similar to set working directory
library(tidyverse) # data wrangling - includes ggplot2, dplyr, tidyr, readr, purr, tibble, stringr, forcats
# library(lubridate) # dates and times
library(ggplot2) # data visualization
library(gridExtra)
# library(readr)
library(dplyr)
library(ggthemes)
library(plotly)
library(ggpubr) # customize ggplot2 for publication
#library(broom)
#library(AICcmodavg)
library(vegan) #community ecology package - includes, MASS, cluster, mgcv
library(readxl) # for .xls and .xlsx sheets
#library(janitor)
library(multcompView) #Visualizations of Paired Comparisons, functions: TukeyHSD, dist{stats}, simint, simtest, csimint, csimtest{multcomp}, friedmanmc, kruskalmc{pgirmess}
#library(multcomp) # functions: multcompLetters2, multcompLetters3, multcompLetters4 using aov object
#library(DHARMa) #The ‘DHARMa’ package uses a simulation-based approach to create readily interpretable scaled (quantile) residuals for fitted (generalized) linear mixed models.
#citation("DHARMa")
```

```{r colors, include=TRUE}
devtools::install_github("an-bui/calecopal")

library(calecopal)
# all palettes
names(cal_palettes)

# Stand colors: INTACT, MATRIX, DEGRADED 
cal_palette(name = "chaparral3", n = 3, type = "continuous") 
#deg <- "#D3E3CA"
#mat <- "#92A587"
#int <- "#2F3525"
deg <- "gray60"
mat <- "gray40"
int <- "gray20"
line <- "red"

standcolors <- c(int, mat, deg)
standcolors_line <- c(line, int, mat, deg)

# Lifeform colors: shrub, grass, forb
cal_palette(name = "chaparral3", n = 3, type = "continuous") 
shrub <- "green4"
grass <- "yellow2"
forb <- "purple2"
lifeformcolors <- c(int, mat, deg)

# Status colors: native, exotic 
cal_palette(name = "chaparral1", n = 6, type = "continuous") 
native <- "gray50"
exotic <- "gray0"
statuscolors <- c(native, exotic)

```


```{r load csv, create columns, calculate - percent cover, echo=FALSE, eval=F}

# percent cover - belt transects, point intercept transects
abcover_full <- read.csv("~/Dropbox/GRADSCHOOL/Dissertation/R_dissertation/chaparraldegradation_2022b/deg_percentcover_byspecies_bylifeform.csv", header = TRUE, na.strings=c("","NA")) %>% 
  rename(speciescode = species.1 ) %>%
  mutate(standtype = fct_relevel(standtype, 
            "intact", "matrix", "degraded")) %>% 
  dplyr::select(!speciescode)
glimpse(abcover_full)
str(abcover_full)

#abcover_full$standtype <- factor(abcover_full$standtype, levels = c("intact", "matrix", "degraded"))

# convert dataframe to tibble
abcover_full_v <- as_tibble(abcover_full) 
class(abcover_full_v)

# combine site and rep to one column
abcover_full_v$site_rep <- paste(abcover_full_v$site, abcover_full_v$rep, sep="_") 

# combine site_rep and distance to one column
abcover_full_v$site_rep_dist <- paste(abcover_full_v$site_rep, abcover_full_v$distance, sep="_") 

# combine standtype and native/nonnative status to one column
abcover_full_v$stand_status <- paste(abcover_full_v$standtype, abcover_full_v$status, sep="_") 

abcover_full_v <- abcover_full_v %>% 
  mutate(site_rep = fct_relevel(site_rep, 
                                "Intact_1_1", "Intact_2_2", "Intact_3_3", "ENH1_1", "ENH1_2",    "ENH1_3"  ,   "ENH2_4"  ,   "ENH2_5"    , "ENH2_6"  , "DEG1_1"   ,  "DEG1_2"  ,   "DEG1_3"     ,"DEG2_4" ,    "DEG2_5"    , "DEG2_6" )) #%>%
  # mutate(standtype = case_when(standtype == "intact" ~ "shrub_dominated", 
  #                              standtype == "matrix" ~ "matrix",
  #                              standtype == "degraded" ~ "grass_dominated")) 

view(abcover_full_v) # look at new columns

abcover_full_v %>%  
  na.omit() %>%  
  group_by(standtype, rep) %>% 
  summarize(data_points = length(rep))

# omit "ground" as a status since interested in Native and Non-native species 
abcover_full_v_omitground <- filter(abcover_full_v, status !="ground")
glimpse(abcover_full_v_omitground)
```

# 1. PHYSICAL STRUCTURE 

### 1.1 Percent cover (horizontal variation)

```{r percent cover - abcover_vegcover, include = TRUE}
abcover_vegcover <- abcover_full_v %>% 
  filter(vertical == "1") %>% 
  group_by(standtype, site, rep) %>% 
  dplyr::summarize(count_per_transect = length(vertical), 
    percentcover_veg = length(vertical)/41, 
    percentcover_ground = (1-percentcover_veg)
    )
print(abcover_vegcover)

abcover_vegcover_long <- gather(abcover_vegcover, covertype, percentcover, percentcover_veg:percentcover_ground, factor_key = TRUE) 
abcover_vegcover_long
```

### 1.1A total % vegetation cover

```{r FIGURES totalvegcover, include=TRUE}

# 1) visualizing data - highlight all and run
hist(abcover_vegcover_long$percentcover) # histogram
ggplot(data = abcover_vegcover_long, aes(y = percentcover, x = site, fill = covertype)) +
    geom_boxplot() # boxplots
ggplot(data = abcover_vegcover_long, aes(y = percentcover, x = site, color = covertype)) + 
  geom_jitter()

# 2) visualize boxplots
ggplot(data = abcover_vegcover_long, aes(y = percentcover, x = site, fill = covertype))+
  geom_boxplot()+
  scale_y_continuous(breaks = seq(0,1,0.2), limits = c(0, 1))+
  xlab("Site")+
  ylab("Canopy cover (%)") +
 # scale_x_discrete(labels = c("intact" = "Intact", "matrix" = "Matrix",
 #                             "degraded" = "Degraded"))+
  theme_bw()+
  theme(text = element_text(size = 14), axis.text.y = element_text(size = 12), axis.text.x = element_text(size = 12))

# 3) jitter code
ggplot(data = abcover_vegcover_long, aes(x = site, y = percentcover, color = covertype))+ #start with the raw data
  #geom_jitter(width = 0.05, alpha = 0.25, pch=ifelse(grepl("c_", prop2mdata$stim), 17,19), cex=2.5)+ #use geom_jitter to add raw data points
  #geom_point(d = plotnewdata, aes(x = stim, y = stim.mean.prop2m), shape = rep(c(17,19),2), cex = 4)+ #now use geom_point to add the model estimate means
  #geom_linerange(d = plotnewdata, aes(x=stim,ymin=lse,ymax=use),size=1.5,position=position_dodge(width=0.25)) + #and geom_linerange to add the standard errors
  #things below this line just make it look pretty
  geom_jitter()+
  geom_point()+
  scale_y_continuous(breaks = seq(0,1,0.2), limits = c(0, 1.))+
  xlab("Stimulus")+
  ylab("Proportion approaching stimulus")+
  scale_x_discrete(labels = c("c_scents" = "Control Scents", "t_scents" = "Rival Scents",
                              "c_intruders" = "Control Intruders", "t_intruders" = "Rival Intruders"))+
  theme_bw()+
  theme(text = element_text(size = 14), axis.text.y = element_text(size = 12), axis.text.x = element_text(size = 12))
# end jitter code
```

```{r normality abcover total veg cover, include=TRUE}
shapiro.test(abcover_vegcover_long$percentcover)
# Shapiro-Wilk normality test
# data:  abcover_vegcover_long$percentcover
# W = 0.67222, p-value = 6.305e-07 <-- not normally distributed...

abcover_vegcover_long$site_rep <- paste(abcover_vegcover_long$site, abcover_vegcover_long$rep, sep="_") # combine site and rep form to one column

# total veg cover only
abcover_vegcover_long_vegonly <- abcover_vegcover_long %>% 
  filter(covertype == "percentcover_veg")

#testing for normality of veg cover only
shapiro.test(abcover_vegcover_long_vegonly$percentcover)
# 	Shapiro-Wilk normality test
# 
# data:  abcover_vegcover_long_vegonly$percentcover
# W = 0.73103, p-value = 0.0005447

ggqqplot(abcover_vegcover_long_vegonly$percentcover) 

abcover_vegcover_long_vegonly$site_rep <- paste(abcover_vegcover_long_vegonly$site, abcover_vegcover_long_vegonly$rep, sep="_") # combine site and rep form to one column

# code from --> http://www.sthda.com/english/wiki/kruskal-wallis-test-in-r
kruskal.test(covertype ~ standtype, data = abcover_vegcover_long_vegonly)
# ata:  covertype by standtype
# Kruskal-Wallis chi-squared = NaN, df = 2, p-value = NA
pairwise.wilcox.test(abcover_vegcover_long_vegonly$percentcover, abcover_vegcover_long_vegonly$standtype,
                 p.adjust.method = "BH")
#          intact matrix
# matrix   0.78   -     
# degraded 0.32   0.32  <-- nothing is significant
```

```{r mean sd of abcover by site, include=TRUE}
# mean SD
abcover_vegcover_meanSD <- abcover_vegcover_long %>%
  group_by(site, covertype) %>% # by site
  summarize(mean_cover = mean(percentcover),
            n = length((percentcover)),
            sd = sd(percentcover),
            se = ((sd(percentcover))/sqrt(length((percentcover)))))
print(abcover_vegcover_meanSD)

# no mean when by site_rep
```
```{r aov veg/ground cover by standtype, include=FALSE}
#testing for normality
shapiro.test(abcover_vegcover$percentcover_veg)
# 	Shapiro-Wilk normality test
# 
# data:  abcover_vegcover$percentcover_veg
# W = 0.73103, p-value = 0.0005447 <-- data not normally distributed
 
# code from --> http://www.sthda.com/english/wiki/kruskal-wallis-test-in-r
kruskal.test(percentcover_veg ~ standtype, data = abcover_vegcover)
# 	Kruskal-Wallis rank sum test
# 
# data:  percentcover_veg by standtype
# Kruskal-Wallis chi-squared = 3.0521, df = 2, p-value = 0.2174
pairwise.wilcox.test(abcover_vegcover$percentcover_veg, abcover_vegcover$standtype,
                 p.adjust.method = "BH")
#          intact matrix
# matrix   0.78   -     
# degraded 0.32   0.32  
# no differences in percentcover_veg between standtypes
```

```{r bar plot totalvegcover, include=TRUE}

# combine standtype and native/nonnative status to one column
abcover_vegcover$site_rep <- paste(abcover_vegcover$site, abcover_vegcover$rep, sep="_") 

#  column plot - by site_rep
abcover_vegcover_plot_2 <- ggplot(abcover_vegcover, aes(x = site_rep, y = percentcover_veg, fill = standtype)) +
  geom_col(position = "dodge", width = 0.8) +
  labs(
    title = "Total Vegetation Cover", 
    x = "Site", 
    y = "Percent Vegetation Cover (%)") + # title, axes titles
  scale_fill_manual(values = c(standcolors)) + # manual colors
  # scale_fill_manual(values = cal_palette('chaparral2')) +  # continuous colors
  #                  limits = c("intact", "matrix", "degraded"), # "limits" reorders the x-axis
  #                  labels = c("Intact", "Matrix", "Degraded")) + # "labels" changes the name
  theme_bw() #+
 # scale_x_discrete(
 #   limits=c("intact", "matrix", "degraded"),
 #   labels=c("intact" = "Intact", "matrix" = "Matrix", "degraded" = "Degraded")
 #   )
abcover_vegcover_plot_2

#  column plot - by SITE
abcover_vegcover_plot <- ggplot(abcover_vegcover_meanSD, aes(x = site, y = mean_cover, fill = covertype)) +
  geom_col(position = "dodge", width = 0.8) +
  geom_errorbar(
    aes(ymin=mean_cover-se, ymax=mean_cover+se), # mean +- SE
                width=.2, position=position_dodge(.9)) +
  labs(
    title = "Percent Canopy Cover", 
    x = "Site", 
    y = "Average Percent Canopy Cover (%)") + # title, axes titles
  scale_fill_manual(values = c(standcolors)) + # manual colors
  # scale_fill_manual(values = cal_palette('chaparral2')) +  # continuous colors
  #                  limits = c("intact", "matrix", "degraded"), # "limits" reorders the x-axis
  #                  labels = c("Intact", "Matrix", "Degraded")) + # "labels" changes the name
  theme_bw() #+
 # scale_x_discrete(
 #   limits=c("intact", "matrix", "degraded"),
 #   labels=c("intact" = "Intact", "matrix" = "Matrix", "degraded" = "Degraded")
 #   )
abcover_vegcover_plot
```

### 1.1B Percent cover by lifeform by native/nonnative status - there shouldn't be zeros in your df

```{r cover x status x lifeform - data prep, include = TRUE}
# line 933 from Ch1_Degradation_original.Rmd

# data prep
abcover_bylf_bystatus <- abcover_full_v_omitground %>% 
  group_by(standtype, lifeform, status, site, rep, site_rep) %>% 
  dplyr::summarize(
    count_per_transect = n_distinct(site_rep_dist), 
    percentcover = n_distinct(site_rep_dist)/41
    )
view(abcover_bylf_bystatus) # prints to new tab

# visualizing data

## histogram 
hist(abcover_bylf_bystatus$percentcover) 

## jitter - by site_rep
ggplot(data = abcover_bylf_bystatus, aes(y = percentcover*100, x = site_rep, color = lifeform)) + 
  geom_jitter()
ggplot(data = abcover_bylf_bystatus, aes(y = percentcover*100, x = lifeform, color = standtype)) + 
  geom_jitter()
ggplot(data = abcover_bylf_bystatus, aes(y = percentcover*100, x = standtype, color = status)) + 
  geom_jitter()

## boxplot
ggplot(data = abcover_bylf_bystatus, aes(y = percentcover*100, x = standtype, fill = lifeform)) +
    geom_boxplot() # boxplots

## jitter - by standtype
ggplot(data = abcover_bylf_bystatus, aes(y = percentcover*100, x = standtype, color = lifeform)) + 
  geom_jitter()
ggplot(data = abcover_bylf_bystatus, aes(y = percentcover*100, x = standtype, color = status)) + 
  geom_jitter()
ggplot(data = abcover_bylf_bystatus, aes(y = percentcover*100, x = standtype, color = status)) + 
  geom_point()
## boxplot
ggplot(data = abcover_bylf_bystatus, aes(y = percentcover*100, x = standtype, fill = lifeform)) +
    geom_boxplot() # boxplots

# testing for normality
shapiro.test(abcover_bylf_bystatus$percentcover)
#W = 0.90228, p-12838.200536385179 value = 0.0001246 <-- not normally distributed

#write.csv(abcover_bylf_bystatus,"processed/percentcover_bystatus_bylifeform.csv")
# GET RID OF ZEROS in df
cover_statuslf_matrix <- read.csv("percentcover_bystatus_bylifeform_matrix.csv", header = TRUE) %>% mutate(lifeform = case_when(lifeform == "herb" ~ "forb", 
                               TRUE ~ lifeform))
cover_statuslf_matrix <- cover_statuslf_matrix %>% 
  mutate(standtype = fct_relevel(standtype, 
            "intact", "matrix", "degraded"))
```

### STACKED proportion of Family by Transect
```{r proportion cover by family, include=TRUE}
# data prep
abcover_byfamily <- abcover_full_v_omitground %>% 
  group_by(standtype, site, rep, site_rep, family) %>% 
  #group_by(standtype, site, rep, site_rep, family, lifeform, status) %>% 
  dplyr::summarize(
    count_per_transect = n_distinct(site_rep_dist), 
    percentcover = (n_distinct(site_rep_dist)/41)*100
    )
view(abcover_byfamily) # prints to new tab
```



### - SHRUB

```{r cover by lf by status - aov, include=TRUE}
# SHRUB
# highlight all and run as one command

#abcover_bylf_bystatus_aov_shrub <- aov(percentcover ~ site * status, data = cover_statuslf_matrix %>% 
#                                   filter((lifeform == 'shrub'))) <-- native and non-native

abcover_bylf_bystatus_aov_shrubnat <- aov(percentcover ~ site, data = cover_statuslf_matrix %>% 
                                   filter((lifeform == 'shrub')) %>%  
                                  filter((status == 'native'))) # <-- NATIVE only
print(summary(abcover_bylf_bystatus_aov_shrubnat))
#            Df Sum Sq Mean Sq F value  Pr(>F)   
# site         6 0.7033 0.11722   10.85 0.00179 ** <-- 
# Residuals    8 0.0865 0.01081                   

print(TukeyHSD(abcover_bylf_bystatus_aov_shrubnat))
# $site
#                            diff          lwr        upr     p adj
# DEG2-DEG1         -1.056911e-01 -0.429744159 0.21836205 0.8584743
# ENH1-DEG1          3.170732e-01 -0.006979931 0.64112627 0.0556174
# ENH2-DEG1          6.504065e-02 -0.259012452 0.38909375 0.9823925
# Intact_1-DEG1      3.821138e-01 -0.076166471 0.84039411 0.1142444
# Intact_2-DEG1      3.821138e-01 -0.076166471 0.84039411 0.1142444
# Intact_3-DEG1      6.260163e-01  0.167735968 1.08429655 0.0089206 <--
# ENH1-DEG2          4.227642e-01  0.098711125 0.74681733 0.0117502
# ENH2-DEG2          1.707317e-01 -0.153321395 0.49478481 0.4727239
# Intact_1-DEG2      4.878049e-01  0.029524585 0.94608517 0.0364522
# Intact_2-DEG2      4.878049e-01  0.029524585 0.94608517 0.0364522
# Intact_3-DEG2      7.317073e-01  0.273427024 1.18998761 0.0033449
# ENH2-ENH1         -2.520325e-01 -0.576085623 0.07202058 0.1507687
# Intact_1-ENH1      6.504065e-02 -0.393239643 0.52332094 0.9970509
# Intact_2-ENH1      6.504065e-02 -0.393239643 0.52332094 0.9970509
# Intact_3-ENH1      3.089431e-01 -0.149337204 0.76722338 0.2485277
# Intact_1-ENH2      3.170732e-01 -0.141207122 0.77535346 0.2285600
# Intact_2-ENH2      3.170732e-01 -0.141207122 0.77535346 0.2285600
# Intact_3-ENH2      5.609756e-01  0.102695317 1.01925590 0.0170163
# Intact_2-Intact_1 -1.110223e-16 -0.561276438 0.56127644 1.0000000
# Intact_3-Intact_1  2.439024e-01 -0.317373999 0.80517888 0.6558165
# Intact_3-Intact_2  2.439024e-01 -0.317373999 0.80517888 0.6558165

ggplot(data = cover_statuslf_matrix %>% filter((lifeform == 'shrub')) %>% filter((status == 'native')), 
     aes(x = site_rep, y = percentcover*100, fill = standtype)) +
   geom_col(color = "black") +
  scale_fill_manual(values = standcolors) +
  labs(x = "Site", y = "Shrub Cover (%)", title = "Shrub Cover by Site") +
  theme_bw()

```

```{r SHRUB scatterplot}
# The arguments to spread():
# - data: Data object
# - key: Name of column containing the new column names
# - value: Name of column containing values
cover_statuslf_matrix$status_lifeform <- paste(cover_statuslf_matrix$status, cover_statuslf_matrix$lifeform, sep="_") # combine status and life form to one column
cover_statuslf_matrix_long <- cover_statuslf_matrix %>%
 dplyr::select(standtype, site_rep, percentcover, status_lifeform)
view(cover_statuslf_matrix_long)

cover_statuslf_matrix_wide1 <- cover_statuslf_matrix_long %>%
  spread(status_lifeform, percentcover)
view(cover_statuslf_matrix_wide1)

# scatterplot - shrub x nn grass
shub_grass_scatter <- ggplot(data = cover_statuslf_matrix_wide1, 
       aes(x = nonnative_grass*100, y = native_shrub*100, color = standtype)) + #color = standtype
  geom_point(size = 3, alpha = 0.8) +
  ylim(0, 100)+
  xlim(0,100) +
  geom_smooth(method = "gam", se = FALSE, linetype = "solid", color = "black") +  # lm, loess, glm
  scale_color_manual(values = c(standcolors),
                     name = "Stand Type",
                     labels = c("intact" = "shrub dominated", 
                                "matrix" = "matrix", 
                                "degraded" = "grass dominated")) + #rename standtypes labels
  labs(x = "Non-native grass cover (%)", 
       y = "Native shrub cover (%)", 
       title = "Native Shrub Cover by Non-native Grass Cover") +
  theme_bw()

shub_grass_scatter_print <- shub_grass_scatter+ theme(legend.position = c(0.15, 0.2))


ggsave("Ch1_Degradation_figures/shub_grass_scatter_print.png", shub_grass_scatter_print, width = 8, height = 6)

```

### - FORB

```{r forb native percent cover by site_rep, include=TRUE}

# FORB

cover_statuslf_matrix %>% 
  filter(lifeform == 'forb') %>% 
  group_by(site_rep, status) 

cover_statuslf_matrix %>% 
  filter(lifeform == 'forb' & status == "native") %>% 
  group_by(site_rep) 

cover_statuslf_matrix %>% 
  filter(lifeform == 'forb' & status == "nonnative") %>% 
  group_by(site_rep) 

# scatterplot - forb x nn grass
natforb_grass_scatter <- ggplot(data = cover_statuslf_matrix_wide1,
              aes(x = nonnative_grass*100, y = native_forb*100, color = standtype)) + #color = standtype
  geom_point(size = 3, alpha = 0.8) +
  ylim(0, 100)+
  xlim(0,100) +
  geom_smooth(method = "gam", se = FALSE, linetype = "solid", color = "black") +  # lm, loess, glm
  scale_color_manual(values = c(standcolors),
                     name = "Stand Type",
                     labels = c("intact" = "shrub dominated", 
                                "matrix" = "matrix", 
                                "degraded" = "grass dominated")) + #rename standtypes labels
  labs(x = "Non-native grass cover (%)", 
       y = "Native forb cover (%)", 
       title = "Native forb cover by non-native grass cover") +
  theme_bw()

# scatterplot - nnforb x nn grass
nnforb_grass_scatter <- ggplot(data = cover_statuslf_matrix_wide1,
              aes(x = nonnative_grass*100, y = nonnative_forb*100, color = standtype)) + #color = standtype
  geom_point(size = 3, alpha = 0.8) +
  ylim(0, 100)+
  xlim(0,100) +
  geom_smooth(method = "gam", se = FALSE, linetype = "solid", color = "black") +  # lm, loess, glm, gam
  scale_color_manual(values = c(standcolors),
                     name = "Stand Type",
                     labels = c("intact" = "shrub dominated", 
                                "matrix" = "matrix", 
                                "degraded" = "grass dominated")) + #rename standtypes labels
  labs(x = "Non-native grass cover (%)", 
       y = "Non-native forb cover (%)", 
       title = "Non-native forb cover by non-native grass cover") +
  theme_bw()

natforb_grass_scatter_print <- natforb_grass_scatter + theme(legend.position = c(0.15, 0.8))
nnforb_grass_scatter_print <- nnforb_grass_scatter+ theme(legend.position = c(0.15, 0.8))


# print the plots into a single figure
grid.arrange(natforb_grass_scatter_print, nnforb_grass_scatter_print, ncol = 1, nrow = 2)


ggsave("Ch1_Degradation_figures/natforb_grass_scatter.png", natforb_grass_scatter_print, width = 8, height = 6)
ggsave("Ch1_Degradation_figures/nnforb_grass_scatter.png", nnforb_grass_scatter_print, width = 8, height = 6)
```

```{r forb stats percent cover by site}

# FORB
abcover_bylf_bystatus_aov_forb <- aov(percentcover ~ standtype * status, data = cover_statuslf_matrix %>% filter((lifeform == 'forb')))

print(summary(abcover_bylf_bystatus_aov_forb))

print(TukeyHSD(abcover_bylf_bystatus_aov_forb))
## forb - native
abcover_bylf_bystatus_aov_forbnat <- aov(percentcover ~ standtype, data = cover_statuslf_matrix %>% filter((lifeform == 'forb')) %>% filter((status == 'native')))
print(summary(abcover_bylf_bystatus_aov_forbnat))
# Df  Sum Sq  Mean Sq F value Pr(>F)
#standtype    2 0.00512 0.002558   0.905   0.43
#Residuals   12 0.03391 0.002826  
print(TukeyHSD(abcover_bylf_bystatus_aov_forbnat))
#$standtype
#                      diff         lwr       upr     p adj
#intact-degraded 0.02845528 -0.07182408 0.1287347 0.7352620
#matrix-degraded 0.04065041 -0.04122735 0.1225282 0.4091252
#matrix-intact   0.01219512 -0.08808424 0.1124745 0.9438944 
# NO SIG differences
# forb - nonnative
abcover_bylf_bystatus_aov_forbnn <- aov(percentcover ~ standtype, data = cover_statuslf_matrix %>% filter((lifeform == 'forb')) %>% filter((status == 'nonnative')))
print(summary(abcover_bylf_bystatus_aov_forbnn))
#    Df Sum Sq Mean Sq F value   Pr(>F)    
#standtype    2 0.6180 0.30901    13.3 0.000904 ***
#Residuals   12 0.2789 0.02324    
print(TukeyHSD(abcover_bylf_bystatus_aov_forbnn))
#$standtype
#                      diff        lwr        upr     p adj
#intact-degraded -0.5081301 -0.7957264 -0.2205337 0.0013474 <-- Int - Deg
#matrix-degraded -0.3373984 -0.5722198 -0.1025769 0.0062271 <-- Mat - Deg
#matrix-intact    0.1707317 -0.1168647  0.4583281 0.2896736

```

### - GRASS
```{r grass}
# GRASS
abcover_bylf_bystatus_aov_grass <- aov(percentcover ~ standtype * status, data = cover_statuslf_matrix %>% 
                                   filter((lifeform == 'grass')))
print(summary(abcover_bylf_bystatus_aov_grass))
print(TukeyHSD(abcover_bylf_bystatus_aov_grass))
## grass - native
abcover_bylf_bystatus_aov_grassnat <- aov(percentcover ~ standtype, data = cover_statuslf_matrix %>% filter((lifeform == 'grass')) %>% filter((status == 'native')))
print(summary(abcover_bylf_bystatus_aov_grassnat))
# print(summary(abcover_bylf_bystatus_aov_grassnat))
#            Df Sum Sq Mean Sq F value   Pr(>F)    
#standtype    2 0.6728  0.3364   30.36 2.02e-05 ***
#Residuals   12 0.1330  0.0111  
print(TukeyHSD(abcover_bylf_bystatus_aov_grassnat))
#$standtype
#                       diff         lwr        upr     p adj
#intact-degraded  0.56097561  0.36240594  0.7595453 0.0000191 <-- Int - Deg
#matrix-degraded  0.07723577 -0.08489569  0.2393672 0.4370582
#matrix-intact   -0.48373984 -0.68230951 -0.2851702 0.0000808 <-- Int - Mat
# SIG MORE native grass at Intact
# nonnative
abcover_bylf_bystatus_aov_grassnn <- aov(percentcover ~ standtype, data = cover_statuslf_matrix %>% filter((lifeform == 'grass')) %>% filter((status == 'nonnative')))
print(summary(abcover_bylf_bystatus_aov_grassnn))
#            Df Sum Sq Mean Sq F value   Pr(>F)    
#standtype    2 1.3178  0.6589   55.46 8.66e-07 ***
#Residuals   12 0.1426  0.0119 
print(TukeyHSD(abcover_bylf_bystatus_aov_grassnn))
#$standtype
#                      diff        lwr         upr     p adj
#intact-degraded -0.8089431 -1.0145691 -0.60331712 0.0000006 <-- 
#matrix-degraded -0.2195122 -0.3874051 -0.05161929 0.0115409 <--
#matrix-intact    0.5894309  0.3838049  0.79505687 0.0000165 <-- 
# SIG different non-native grass among sites



# scatterplot - nnforb x nn grass
natgrass_grass_scatter <- ggplot(data = cover_statuslf_matrix_wide1,
              aes(x = nonnative_grass*100, y = native_grass*100, color = standtype)) + #color = standtype
  geom_point(size = 3, alpha = 0.8) +
  ylim(0, 100)+
  xlim(0,100) +
  geom_smooth(method = "gam", se = FALSE, linetype = "solid", color = "black") +  # lm, loess, glm, gam
  scale_color_manual(values = c(standcolors),
                     name = "Stand Type",
                     labels = c("intact" = "shrub dominated", 
                                "matrix" = "matrix", 
                                "degraded" = "grass dominated")) + #rename standtypes labels
  labs(x = "Non-native grass cover (%)", 
       y = "Native grass cover (%)", 
       title = "Native grass cover by non-native grass cover") +
  theme_bw()

natgrass_grass_scatter_print <- natgrass_grass_scatter + theme(legend.position = c(0.8, 0.8))

ggsave("Ch1_Degradation_figures/natgrass_grass_scatter_print.png", natgrass_grass_scatter_print, width = 8, height = 6)

```

```{r fern}
# FERN
abcover_bylf_bystatus_aov_fern <- aov(percentcover ~ standtype * status, data = cover_statuslf_matrix %>% 
                                   filter((lifeform == 'fern')))
print(summary(abcover_bylf_bystatus_aov_fern))
print(TukeyHSD(abcover_bylf_bystatus_aov_fern))
## fern - native
abcover_bylf_bystatus_aov_fernnat <- aov(percentcover ~ standtype, data = cover_statuslf_matrix %>% filter((lifeform == 'fern')) %>% filter((status == 'native')))
print(summary(abcover_bylf_bystatus_aov_fernnat))
print(TukeyHSD(abcover_bylf_bystatus_aov_fernnat))
#$standtype <-- can't really do stats on only one occurrence
#                         diff          lwr         upr   p adj
#intact-degraded  8.130081e-03 -0.002714893 0.018975056 0.15458 
#matrix-degraded  1.662443e-18 -0.008854884 0.008854884 1.00000
#matrix-intact   -8.130081e-03 -0.018975056 0.002714893 0.15458
# nonnative
abcover_bylf_bystatus_aov_fernnn <- aov(percentcover ~ standtype, data = cover_statuslf_matrix %>% filter((lifeform == 'fern')) %>% filter((status == 'nonnative')))
print(summary(abcover_bylf_bystatus_aov_fernnn))
print(TukeyHSD(abcover_bylf_bystatus_aov_fernnn))

abcover_bylf_bystatus_meanSD <- cover_statuslf_matrix %>%  
  group_by(lifeform, status, standtype) %>% 
  summarize(avg_cover = mean(percentcover), 
            sd = sd(percentcover),
            N = length(percentcover), 
            se = ((sd(percentcover))/sqrt(length((percentcover)))))

abcover_bylf_bystatus_meanSD$status_lifeform <- paste(abcover_bylf_bystatus_meanSD$status, abcover_bylf_bystatus_meanSD$lifeform, sep="_") # combine status and life form to one column
print(abcover_bylf_bystatus_meanSD) 
```

```{r percent cover x nn grass combine, include = TRUE}

# print the plots into a single figure
nncover_combined <- grid.arrange(shub_grass_scatter_print, natgrass_grass_scatter_print, natforb_grass_scatter_print, nnforb_grass_scatter_print, ncol = 2, nrow = 2,
  heights = c(1, 1),  # Adjust the height ratios between rows
  widths = c(1, 1)     # Adjust the width ratios between columns
)

ggsave("Ch1_Degradation_figures/nncover_combined.png", nncover_combined, width = 15, height = 10)
```

### - STATS
```{r plot abcover_bylf_meanSD, include = TRUE}
# line 965 in Ch1_Degradation_original.Rmd

#  column plot, 2 x 2 by lifeform
abcover_bylf_bystatus_meanSD_plot_wrap <- ggplot(abcover_bylf_bystatus_meanSD, aes(x = status, y = avg_cover, fill = standtype )) +
  facet_wrap(~ lifeform) +
  geom_col(position = "dodge", width = 0.8) +
  geom_errorbar(aes(ymin=avg_cover-se, ymax=avg_cover+se), width=.2,
                 position=position_dodge(.9)) +
  labs(title = "Percent Cover by status and standtype", x = "Status", y = "Average Percent Cover (%)") +
  scale_fill_manual(values = c(standcolors)) + # manual colors
#   scale_fill_manual(values = cal_palette('chaparral3')) + # continuous colors
                       theme_bw()

abcover_bylf_bystatus_meanSD_plot_wrap + scale_x_discrete(limits=c("intact", "matrix", "degraded"),
                                         labels=c("intact" = "Intact", "matrix" = "Matrix", "degraded" = "Degraded"))


```

### 1.2 Canopy height (vertical variation)

```{r load csv - canopy height, include=TRUE}
# stand height 

standheight_full <- read_csv("~/Dropbox/GRADSCHOOL/Dissertation/R_dissertation/chaparraldegradation_2022b/deg_maxheight.csv",
                             col_types = cols(
                               standtype = col_character(),
                               site = col_character(),
                               Transect_rep = col_character(),
                               Reading = col_character(),
                               Species = col_character(),
                               height_cm = col_double(),
                               next_tallest = col_character())) %>%
  dplyr::select('standtype', 'site', 'Transect_rep', 'Reading', 'Species', 'height_cm') %>% 
  rename(rep = Transect_rep, 
         reading = Reading, 
         species = Species) %>% 
  mutate(standtype = fct_relevel(standtype, "Intact", "Matrix", "Degraded")) %>% 
  filter(site!= "Intact_4")
view(standheight_full)

standheight_full %>%  
  group_by(site,rep) %>% 
  summarize(data_points = length(reading))
```

```{r max height plot, include = TRUE}

ggplot(standheight_full, aes(x = as.integer(reading)/2, y = height_cm, group = site_rep, color = site_rep)) +
  facet_wrap(~ standtype, scales = "free_y", ncol = 1) +
  geom_line() +
  labs(
    title = "Height vs Distance",
    x = "Distance (m)",
    y = "Height (cm)"
  ) +
  ylim(0, 500)+
  theme_bw()
```


```{r combine columns - canopy height, include = TRUE}

standheight_full$site_rep <- paste(standheight_full$site, standheight_full$rep, sep="_") # combine site and rep to one column

standheight_siterep_meanSD <- standheight_full %>%
  group_by(standtype, site_rep) %>%
  summarize(mean_height = mean(height_cm),
            n = length((height_cm)),
            sd = sd(height_cm),
            se = ((sd(height_cm))/sqrt(length((height_cm))))) %>% 
  print(standheight_siterep_meanSD) # prints: standtype - site_rep - mean... 

standheight_standtype_meanSD <- standheight_full %>%
  group_by(standtype, rep) %>%
  summarize(mean_height_byrep = mean(height_cm),
            n = length((height_cm)),
            sd = sd(height_cm),
            se = ((sd(height_cm))/sqrt(length((height_cm))))) %>% # equivalent to: standheight_siterep_meanSD
  group_by(standtype) %>% 
   summarize(mean_height_bystandtype_cm = mean(mean_height_byrep),
             n = length((mean_height_byrep)),
             sd_cm = sd(mean_height_byrep),
             se_cm = ((sd(mean_height_byrep))/sqrt(length((mean_height_byrep))))) %>% # summarizes by standtype
  print(standheight_standtype_meanSD)

# standtype mean_height_bystandtype N SD SE
#Intact	  150.29268	3	62.942199	36.339695
#Matrix	  90.17480	6	30.885894	12.609114
#Degraded	94.00813	6	6.593106	2.691624

```

```{r stand height - stats, include=TRUE}
summary(aov((mean_height ~ standtype) , data = standheight_siterep_meanSD)) # use by site, rep for stats... Intact n = 3, Matrix and Deg n = 6
#            Df Sum Sq Mean Sq F value Pr(>F)  
#standtype    2   8174    4087   3.799 0.0527 .
TukeyHSD(aov((mean_height ~ standtype) , data = standheight_siterep_meanSD), conf.level=.95) 
#$standtype
#                      diff        lwr       upr     p adj
#Matrix-Intact   -60.117886 -121.99488  1.759103 0.0571081
#Degraded-Intact -56.284553 -118.16154  5.592437 0.0760433
#Degraded-Matrix   3.833333  -46.68902 54.355684 0.9777065
# the stands are the same height - no sig difference in canopy height
```

```{r COV - stand height, include=TRUE}
standheight_cov <- standheight_siterep_meanSD %>% # Intact n = 3, Matrix and Deg n = 6
  group_by(standtype, site_rep) %>% 
  dplyr::summarize(cov = sd/mean_height) %>% # COV = SD / mean
  print(standheight_cov)

standheight_cov %>% 
  group_by(standtype) %>% 
  summarize(mean_cov = mean(cov),
            n = length((cov)),
            sd = sd(cov),
            se = ((sd(cov))/sqrt(length((cov)))))
#         mean_COV  N SD          SE
#Intact	  0.6187625	3	0.12556945	0.07249755 <-- larger number = more variation
#Matrix	  0.6668496	6	0.09217907	0.03763195 
#Degraded	0.3218140	6	0.11316173	0.04619808 <-- smaller number = less variation


summary(aov((cov ~ standtype) , data = standheight_cov))
#            Df Sum Sq Mean Sq F value   Pr(>F)    
#standtype    2 0.3943  0.1971   17.14 0.000304 ***
TukeyHSD(aov((cov ~ standtype) , data = standheight_cov), conf.level=.95) 
#$standtype
#                       diff        lwr         upr     p adj
#Matrix-Intact    0.04808716 -0.1542489  0.25042324 0.8045742
#Degraded-Intact -0.29694845 -0.4992845 -0.09461236 0.0053826 <-- Deg and Int
#Degraded-Matrix -0.34503560 -0.5102423 -0.17982888 0.0003305 <-- Deg and Mat

# Degraded sites are significantly more homogeneous than the INT and MAT standtypes
```
### 1.3 Shrub density 

```{r  load data - shrub density, include=TRUE}
#1. Every variable is a column --> ARCA_dead
#2. Each observation is a row --> DEG_1
#3. Each cell contains a single value --> N


# native shrub density 
shrubdensitylife_full <- read_csv("~/Dropbox/GRADSCHOOL/Dissertation/R_dissertation/chaparraldegradation_2022b/deg_beltdensity_bylifestage.csv", 
    col_types = cols(
      StandType = col_character(), 
      Site = col_character(),
      rep = col_character(),
      ScientificName = col_character(), 
      dead = col_integer(),
      immature = col_integer(),
      mature = col_integer(), 
      resprout = col_integer(), 
      seedling = col_integer()
      )
     ) %>% 
  rename(standtype = StandType, 
         site = Site, 
         species = ScientificName) %>%
  mutate(standtype = case_when(standtype == "Grass" ~ "degraded", 
                               standtype == "matrix" ~ "matrix",
                               standtype == "Intact" ~ "intact")) %>% 
  mutate(standtype = fct_relevel(standtype, 
            "intact", "matrix", "degraded"))
  
glimpse(shrubdensitylife_full)

#dim(shrubdensitylife_full)
#head(shrubdensitylife_full)
#tail(shrubdensitylife_full)
specnumber(shrubdensitylife_full)

# convert dataframe to tibble
shrubdensitylife_full <- as_tibble(shrubdensitylife_full) 
class(shrubdensitylife_full) # now a tibble
# [1] "tbl_df"     "tbl"        "data.frame"

shrubdensitylife_transposed <- gather(shrubdensitylife_full, "status", "count", 5:9) # transpose data from wide to long format
glimpse(shrubdensitylife_transposed)

shrubdensity <- shrubdensitylife_transposed # 
shrubdensity$site_rep <- paste(shrubdensity$site, shrubdensity$rep, sep="_") # combine site and rep to one column
head(shrubdensity) # look at new column site_rep, last column

shrubdensity %>% 
  group_by(site_rep, status) %>% 
  summarize(length_count = length(count)) %>% 
  print(shrubdensity_sum_bysiterep_meanSD)
# all site_rep have 5 status categories: dead, immature, mature, resprout, seedling 
# all status have 13 length_count --> 13 species per status
# take home = no missing data points

write.csv(shrubdensitylife_transposed,"processed/shrubdensitylife_transposed.csv")

# shrubdensityspp_full <- read_csv("~/Dropbox/GRADSCHOOL/Dissertation/R_dissertation/chaparraldegradation_2022b/deg_beltdensity_byspecies.csv")
# shrubdensityalive_full <- read_csv("~/Dropbox/GRADSCHOOL/Dissertation/R_dissertation/deg_beltdensity_seperatealive.csv")

```

#### ALIVE shrub density

```{r alive shrub dentsity 1m2 - mean SD, include=TRUE}

# ALIVE
shrubdensity_sum_bysiterep <- shrubdensity %>% # call tibble
  filter(status != "dead") %>% #omit dead shrubs
  group_by(standtype, site_rep) %>%  # lump immature, mature, resprout shrubs and seedlings
  summarize(aliveshrubdensity_80m2 = sum(count), 
            aliveshrubdensity_1m2 = aliveshrubdensity_80m2/80) %>% # 4m x 20 m belt transect
  print(shrubdensity_sum_bysiterep) 

shrubdensity_sum_bysiterep_meanSD <- shrubdensity_sum_bysiterep %>%
  group_by(standtype) %>%
  summarize(mean_aliveshrubdensity_1m2 = mean(aliveshrubdensity_1m2),
            n = length((aliveshrubdensity_1m2)),
            sd = sd(aliveshrubdensity_1m2),
            se = ((sd(aliveshrubdensity_1m2))/sqrt(length((aliveshrubdensity_1m2))))) %>% 
  print(shrubdensity_sum_bysiterep_meanSD)
#standtype    mean_aliveshrubdensity_1m2  n sd  se
#intact	      0.6375000	                  3	0.21323403	0.12311072
#matrix	      0.7750000	                  6	0.77245550	0.31535364
#degraded	    0.1895833	                  6	0.07600027	0.03102698


```

```{r alive shrub dentsity 1m2 - aov tukey, include=TRUE}

# ALIVE
summary(aov((aliveshrubdensity_1m2 ~ standtype) , data = shrubdensity_sum_bysiterep))
#            Df Sum Sq Mean Sq F value Pr(>F)
#standtype    2  1.086  0.5430     2.1  0.165
#Residuals   12  3.103  0.2586 

TukeyHSD(aov((aliveshrubdensity_1m2 ~ standtype) , data = shrubdensity_sum_bysiterep), conf.level=.95) 
#$standtype
#                      diff        lwr       upr     p adj
#matrix-intact    0.1375000 -0.8218272 1.0968272 0.9230712
#degraded-intact -0.4479167 -1.4072439 0.5114105 0.4505607
#degraded-matrix -0.5854167 -1.3687040 0.1978707 0.1560871

```

```{r alive shrub dentsity 1m2 - figures - tables, include=TRUE}

shrubdensity_sum_bysiterep_aov_1m2_column <- ggplot(shrubdensity_sum_bysiterep_meanSD, aes(x = standtype, y = mean_aliveshrubdensity_1m2, fill = standtype)) +
  geom_col(position = "dodge", width = 0.8) +
  geom_errorbar(
    aes(ymin=mean_aliveshrubdensity_1m2-se, ymax=mean_aliveshrubdensity_1m2+se), 
                width=.2, position=position_dodge(.9)) +
  labs(
    title = "Alive shrub density by stand type", 
    x = "Stand Type", 
    y = "Average alive shrub density (#/m2)") + # title, axes titles
  scale_fill_manual(values = c(standcolors)) + # manual colors
  # scale_fill_manual(values = cal_palette('chaparral2')) +  # continuous colors
  #                  limits = c("intact", "matrix", "degraded"), # "limits" reorders the x-axis
  #                  labels = c("Intact", "Matrix", "Degraded")) + # "labels" changes the name
  theme_bw()
shrubdensity_sum_bysiterep_aov_1m2_column

# table: standtype, species, lifestage
shrubdensity_table <- shrubdensity %>%
  mutate(status = case_when(status == "resprout" ~ "immature", 
                            TRUE ~ status)) %>% 
  mutate(status = fct_relevel(status, "mature", "immature", "seedling", "dead")) %>% 
  group_by(standtype, species, status) %>%
   rename(lifestage = status) %>% 
  summarize(N = sum(count)) %>%
  print(shrubdensity_table) 

shrubdensity_table_spread <- shrubdensity_table %>%  
  spread(key = lifestage, value = N) %>% 
  print(shrubdensity_table_spread)

#write.csv(shrubdensity_table_spread,"processed/shrubdensity_table_spread.csv")

shrubdensity_table_spread %>% 
  group_by(standtype) %>% 
  summarize(sum_mature = sum(mature), 
            sum_immature = sum(immature), 
            sum_seedling = sum(seedling), 
            sum_dead = sum(dead))
#standtype sum_mature sum_immature sum_seedlingsum_dead
#intact	  101	    45	  7	    22
#matrix	  297	    70	  5	    256
#degraded	72	    16	  3	    0
```

#### MATURE shrub density

```{r mature shrub density - mean SD, include=TRUE}

# MATURE 
shrubdensity_sum_bysiterep_mature <- shrubdensity %>%
  filter(status == "mature") %>% #select only mature shrubs
  group_by(standtype, site_rep) %>%  
  summarize(matureshrubdensity_80m2 = sum(count), 
            matureshrubdensity_1m2 = matureshrubdensity_80m2/80) %>% # 4m x 20 m belt transect
  print(shrubdensity_sum_bysiterep_mature) 

shrubdensity_sum_bysiterep_mature_meanSD <- shrubdensity_sum_bysiterep_mature %>%
  group_by(standtype) %>%
  summarize(mean_matureshrubdensity_1m2 = mean(matureshrubdensity_1m2),
            n = length((matureshrubdensity_1m2)),
            sd = sd(matureshrubdensity_1m2),
            se = ((sd(matureshrubdensity_1m2))/sqrt(length((matureshrubdensity_1m2))))) %>% 
  print(shrubdensity_sum_bysiterep_mature_meanSD)
#standtype    mean_matureshrubdensity_1m2  n sd  se
#intact	      0.4208333	                  3	0.22511571	0.12997062
#matrix	      0.6187500	                  6	0.52361424	0.21376462
#degraded	    0.1500000	                  6	0.06072479	0.02479079

```

```{r mature shrub density - aov tukey, include=TRUE}

# MATURE 
summary(aov((matureshrubdensity_1m2 ~ standtype) , data = shrubdensity_sum_bysiterep_mature))
#            Df Sum Sq Mean Sq F value Pr(>F)
#standtype    2 0.6624  0.3312   2.666   0.11
#Residuals   12 1.4907  0.1242  

TukeyHSD(aov((matureshrubdensity_1m2 ~ standtype) , data = shrubdensity_sum_bysiterep_mature), conf.level=.95) 
#$standtype
#                      diff        lwr        upr     p adj
#matrix-intact    0.1979167 -0.4669675 0.86280085 0.7135344
#degraded-intact -0.2708333 -0.9357175 0.39405085 0.5397636
#degraded-matrix -0.4687500 -1.0116257 0.07412566 0.0937921
```

#### IMMATURE shrub density

```{r immature shrub density, include=TRUE}

shrubdensity_sum_bysiterep_immature <- shrubdensity %>%
  filter(status == "immature") %>% #select only mature shrubs
  group_by(standtype, site_rep) %>%  
  summarize(immatureshrubdensity_80m2 = sum(count), 
            immatureshrubdensity_1m2 = immatureshrubdensity_80m2/80) %>% # 4m x 20 m belt transect
  print(shrubdensity_sum_bysiterep_immature) 

shrubdensity_sum_bysiterep_immature_meanSD <- shrubdensity_sum_bysiterep_immature %>%
  group_by(standtype) %>%
  summarize(mean_immatureshrubdensity_1m2 = mean(immatureshrubdensity_1m2),
            n = length((immatureshrubdensity_1m2)),
            sd = sd(immatureshrubdensity_1m2),
            se = ((sd(immatureshrubdensity_1m2))/sqrt(length((immatureshrubdensity_1m2))))) %>% 
  print(shrubdensity_sum_bysiterep_immature_meanSD)
#standtype  mean      n sd  se
#intact	    0.1833333	3	0.02886751	0.016666667
#matrix	    0.1395833	6	0.22184125	0.090566312
#degraded	  0.0312500	6	0.02200852	0.008984941

summary(aov((immatureshrubdensity_1m2 ~ standtype) , data = shrubdensity_sum_bysiterep_immature))
#Df  Sum Sq Mean Sq F value Pr(>F)
#standtype    2 0.05822 0.02911   1.396  0.285
#Residuals   12 0.25016 0.02085  

```
#### SEEDLING shrub density

```{r immature shrub density, include=TRUE}

shrubdensity_sum_bysiterep_seedling <- shrubdensity %>%
  filter(status == "seedling") %>% #select only mature shrubs
  group_by(standtype, site_rep) %>%  
  summarize(seedlingdensity_80m2 = sum(count), 
            seedlingdensity_1m2 = seedlingdensity_80m2/80) %>% # 4m x 20 m belt transect
  print(shrubdensity_sum_bysiterep_seedling) 

shrubdensity_sum_bysiterep_seedling_meanSD <- shrubdensity_sum_bysiterep_seedling %>%
  group_by(standtype) %>%
  summarize(mean_seedlingdensity_1m2 = mean(seedlingdensity_1m2),
            n = length((seedlingdensity_1m2)),
            sd = sd(seedlingdensity_1m2),
            se = ((sd(seedlingdensity_1m2))/sqrt(length((seedlingdensity_1m2))))) %>% 
  print(shrubdensity_sum_bysiterep_seedling_meanSD)
#standtype  mean      n sd  se
#intact	    0.02916667	3	0.04018188	0.023199018
#matrix	    0.01041667	6	0.01461306	0.005965759
#degraded	  0.00625000	6	0.01530931	0.00625000

summary(aov((seedlingdensity_1m2 ~ standtype) , data = shrubdensity_sum_bysiterep_seedling))
#Df  Sum Sq Mean Sq F value Pr(>F)
#standtype    2 0.001094 0.0005469     1.2  0.335
#Residuals   12 0.005469 0.0004557   

```
#### RESPROUT shrub density
```{r resprout density, include=TRUE}

shrubdensity_sum_bysiterep_respt <- shrubdensity %>%
  filter(status == "resprout") %>% #select only mature shrubs
  group_by(standtype, site_rep) %>%  
  summarize(resptdensity_80m2 = sum(count), 
            resptdensity_1m2 = resptdensity_80m2/80) %>% # 4m x 20 m belt transect
  print(shrubdensity_sum_bysiterep_respt) 

shrubdensity_sum_bysiterep_respt_meanSD <- shrubdensity_sum_bysiterep_respt %>%
  group_by(standtype) %>%
  summarize(mean_resptdensity_1m2 = mean(resptdensity_1m2),
            n = length((resptdensity_1m2)),
            sd = sd(resptdensity_1m2),
            se = ((sd(resptdensity_1m2))/sqrt(length((resptdensity_1m2))))) %>% 
  print(shrubdensity_sum_bysiterep_respt_meanSD)
#standtype  mean        n sd  se
#intact	    0.004166667	3	0.007216878	0.004166667
#matrix	    0.006250000	6	0.015309311	0.006250000
#degraded	  0.002083333	6	0.005103104	0.002083333

summary(aov((resptdensity_1m2 ~ standtype) , data = shrubdensity_sum_bysiterep_respt))
#Df  Sum Sq Mean Sq F value Pr(>F)
#standtype    2 0.0000521 2.604e-05   0.222  0.804
#Residuals   12 0.0014063 1.172e-04 
```

#### DEAD shrub density
```{r dead shrub density, include=TRUE}

shrubdensity_sum_bysiterep_dead <- shrubdensity %>%
  filter(status == "dead") %>% #select only mature shrubs
  group_by(standtype, site_rep) %>%  
  summarize(deaddensity_80m2 = sum(count), 
            deaddensity_1m2 = deaddensity_80m2/80) %>% # 4m x 20 m belt transect
  print(shrubdensity_sum_bysiterep_dead) 

shrubdensity_sum_bysiterep_dead_meanSD <- shrubdensity_sum_bysiterep_dead %>%
  group_by(standtype) %>%
  summarize(mean_deaddensity_1m2 = mean(deaddensity_1m2),
            n = length((deaddensity_1m2)),
            sd = sd(deaddensity_1m2),
            se = ((sd(deaddensity_1m2))/sqrt(length((deaddensity_1m2))))) %>% 
  print(shrubdensity_sum_bysiterep_dead_meanSD)
#standtype  mean      n sd  se
#intact	0.09166667	3	0.1371207	0.07916667
#matrix	0.53333333	6	1.2698097	0.51839764
#degraded	0.00000000	6	0.0000000	0.00000000

summary(aov((deaddensity_1m2 ~ standtype) , data = shrubdensity_sum_bysiterep_dead))
#Df  Sum Sq Mean Sq F value Pr(>F)
#standtype    2  0.927  0.4634   0.687  0.522
#Residuals   12  8.100  0.6750  
```

# END 


```{r above ground - species richness - native richness, include = FALSE}

### SPECIES RICHNESS DATA IS IN CH1_DEGRADATION_ABCOVERNMDS.RMD FILE ###






# species richness, native richness
abrich_full <- read.csv("~/Dropbox/GRADSCHOOL/Dissertation/R_dissertation/chaparraldegradation_2022b/deg_abrich.csv", header = TRUE, na.strings=c("","NA")) %>% 
  dplyr::select('trasecttype', 'standtype', 'site', 'rep', 'distance', 'vertical', 'species', 'lifeform', 'status', 'lifecycle', 'Family', 'lifestage') %>% 
  rename(transecttype = trasecttype, 
         family = Family)
glimpse(abrich_full)

# native shrub density 
shrubdensitylife_full <- read_csv("~/Dropbox/GRADSCHOOL/Dissertation/R_dissertation/chaparraldegradation_2022b/deg_beltdensity_bylifestage.csv", 
    col_types = cols(
      StandType = col_character(), 
      Site = col_character(),
      rep = col_integer(),
      ScientificName = col_character(), 
      dead = col_integer(),
      immature = col_integer(),
      mature = col_integer(), 
      resprout = col_integer(), 
      seedling = col_integer()
      )
     ) %>% 
  rename()
  


shrubdensityspp_full <- read_csv("~/Dropbox/GRADSCHOOL/Dissertation/R_dissertation/chaparraldegradation_2022b/deg_beltdensity_byspecies.csv")
# shrubdensityalive_full <- read_csv("~/Dropbox/GRADSCHOOL/Dissertation/R_dissertation/deg_beltdensity_seperatealive.csv")

```
