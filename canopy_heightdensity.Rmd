---
title: "ab canopy height"
author: "Stephanie Ma Lucero"
date: "2024-02-19"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r install libraries, message=FALSE}

library(here) # similar to set working directory
library(tidyverse) # data wrangling - includes ggplot2, dplyr, tidyr, readr, purr, tibble, stringr, forcats
library(readxl) # for .xls and .xlsx sheets
library(multcomp) # functions: multcompLetters2, multcompLetters3, multcompLetters4 using aov object
library(multcompView) #Visualizations of Paired Comparisons, functions: TukeyHSD, dist{stats}, simint, simtest, csimint, csimtest{multcomp}, friedmanmc, 
library(plotly)
library(calecopal) 

#library(vegan) #community ecology package - includes, MASS, cluster, mgcv
# library(lubridate) # dates and times
# library(readr)
#library(ggthemes)
#library(ggpubr) # customize ggplot2 for publication
#library(broom)
#library(AICcmodavg)
#library(janitor)
# kruskalmc{pgirmess}

```

# 1. HEIGHT
### data
```{r load csv - canopy height, include=TRUE}
# stand height 

standheight_full <- read_csv("deg_maxheight.csv",
                             col_types = cols(
                               standtype = col_character(),
                               site = col_character(),
                               Transect_rep = col_character(),
                               Reading = col_character(),
                               Species = col_character(),
                               height_cm = col_double(),
                               next_tallest = col_character())) %>%
  dplyr::select('standtype', 'site', 'Transect_rep', 'Reading', 'Species', 'height_cm') %>% 
  rename(rep = Transect_rep, 
         reading = Reading, 
         species = Species) %>% 
  mutate(site = case_when(site == "ENH_1" ~ "ENH1", # old name ~ new name
                          site == "ENH_2" ~ "ENH2",
                          site == "ENH_3" ~ "ENH3", 
                          site == "DEG_1" ~ "DEG1",
                          site == "DEG_2" ~ "DEG2", 
                          site == "DEG_3" ~ "DEG3", 
                          site == "Intact_1" ~ "Intact1", 
                           site == "Intact_2" ~ "Intact2", 
                           site == "Intact_3" ~ "Intact3", 
                          TRUE ~ site)) %>% 
    filter(site!= "Intact_4") %>% 
  mutate(site_rep = paste(site, rep, sep = "_")) %>%  # combine site and rep to one column
  mutate(site_rep = case_when(site_rep == "DEG2_4" ~ "DEG2_1", # old name ~ new name
                          site_rep == "DEG2_5" ~ "DEG2_2",
                          site_rep == "DEG2_6" ~ "DEG2_3", 
                          site_rep == "ENH2_4" ~ "ENH2_1",
                          site_rep == "ENH2_5" ~ "ENH2_2",
                          site_rep == "ENH2_6" ~ "ENH2_3", 
                          TRUE ~ site_rep)) %>% 
    mutate(standtype = fct_relevel(standtype, "Intact", "Matrix", "Degraded")) %>% 
    mutate(site_rep = fct_relevel(site_rep, "Intact1_1", "Intact2_2", "Intact3_3", 
                                  "ENH1_1", "ENH1_2", "ENH1_3", "ENH2_1", "ENH2_2", "ENH2_3",
                                  "DEG1_1", "DEG1_2", "DEG1_3", "DEG2_1", "DEG2_2", "DEG2_3")) 

nativecover_load <- read.csv("processed/abcover_nativecover_nngrasscover.csv") %>% 
 dplyr::select(c(site_rep, nonnative_grass, native_shrub)) %>% 
  mutate(site_rep = case_when(
    site_rep == "Intact_1_1" ~ "Intact1_1", # old name ~ new name
    site_rep == "Intact_2_2" ~ "Intact2_2",
    site_rep == "Intact_3_3" ~ "Intact3_3",
    site_rep == "DEG2_4" ~ "DEG2_1",
    site_rep == "DEG2_5" ~ "DEG2_2",
    site_rep == "DEG2_6" ~ "DEG2_3",
    site_rep == "ENH2_4" ~ "ENH2_1",
       site_rep == "ENH2_5" ~ "ENH2_2",
       site_rep == "ENH2_6" ~ "ENH2_3",
    TRUE ~ as.character(site_rep)  # Keep other observations unchanged
  ))

standheight <- standheight_full %>% 
    left_join(nativecover_load, by = 'site_rep') 
```

### colors
```{r}
# Stand colors: INTACT, MATRIX, DEGRADED 
cal_palette(name = "chaparral3", n = 3, type = "continuous") 
deg <- "#D3E3CA"
mat <- "#92A587"
int <- "#2F3525"
standcolors <- c(int, mat, deg)

# Lifeform colors: shrub, grass, forb
cal_palette(name = "chaparral3", n = 3, type = "continuous") 
shrub <- "#D3E3CA"
grass <- "#92A587"
forb <- "#2F3525"
lifeformcolors <- c(int, mat, deg)

# Status colors: native, exotic 
cal_palette(name = "chaparral1", n = 6, type = "continuous") 
native <- "#AEBFA8"
exotic <- "#F19B34"
statuscolors <- c(native, exotic)
```

### - data visualization
```{r max height data visualization, include = TRUE}

hist(standheight_full$height_cm)

ggplot(standheight_full, aes(x = as.integer(reading)/2, y = height_cm/100, group = site_rep, color = standtype)) +
 # facet_wrap(~ standtype, scales = "free_y", ncol = 1) +
  geom_line() +
  labs(
    title = "Canopy Height by Point-Intercept transect distance",
    x = "Distance (m)",
    y = "Height (m)"
  ) +
  ylim(0, 5)+
  theme_bw()

ggplot(data = standheight_full, 
       aes(x = site_rep, y = height_cm)) +
  geom_point() +
  theme(axis.text.x.bottom = element_text(angle = 90)) +  
  labs(x = "Transect ID", 
       y = "Canopy height (cm)", 
       title = "Canopy height (cm) by transect")

ggplot(standheight_full, 
       aes(x = site_rep, y = height_cm)) +
  geom_boxplot() +
  theme(axis.text.x.bottom = element_text(angle = 90)) +
  labs(x = "Transect ID", 
       y = "Canopy height (cm)", 
       title = "Canopy height (cm) by transect")
```

# HEIGHT - categorical
### site_rep (n = 15)
```{r stand height by site_rep, include = TRUE}

# mean SD by transect - 15 rows
standheight_siterep_meanSD <- standheight %>% 
  group_by(standtype, site, site_rep) %>%
  summarize(mean_height = mean(height_cm),
            n = length((height_cm)),
            sd = sd(height_cm),
            se = ((sd(height_cm))/sqrt(length((height_cm)))), 
            mean_nngrasscover = mean(nonnative_grass), 
            mean_nativeshrubcover = mean(native_shrub)) %>%  
   mutate(site = fct_relevel(site, "Intact1", "Intact2", "Intact3", 
                                  "ENH1", "ENH2", 
                                  "DEG1", "DEG2")) %>% 
   mutate(standtype = fct_relevel(standtype, "Intact", "Matrix", "Degraded")) %>% 
    mutate(site_rep = fct_relevel(site_rep, "Intact1_1", "Intact2_2", "Intact3_3", 
                                  "ENH1_1", "ENH1_2", "ENH1_3", "ENH2_1", "ENH2_2", "ENH2_3",
                                  "DEG1_1", "DEG1_2", "DEG1_3", "DEG2_1", "DEG2_2", "DEG2_3")) 

  
print(standheight_siterep_meanSD) # prints: standtype - site_rep - mean... 

```

```{r}
# columnn plot x site_rep
ggplot(standheight_siterep_meanSD, 
       aes(x = site_rep, y = mean_height, fill = standtype)) +
  geom_col(color = "black") +
  scale_fill_manual(values = standcolors) +
  geom_errorbar(aes(ymin = mean_height - se, ymax = mean_height + se), width = 0.5) +
   theme(axis.text.x.bottom = element_text(angle = 90)) +
  labs(x = "Transect ID", 
   y = "Mean canopy height (cm)", 
       title = "Mean canopy height (cm) by transect")

# columnn plot x site (aka. hillslope)
canopyheight_bar <- ggplot(standheight_site_meanSD %>% 
          mutate(site = case_when(
    site == "Intact_1" ~ "SD1", # old name ~ new name
      site == "Intact_2" ~ "SD2",
      site == "Intact_3" ~ "SD3",
    site == "ENH1" ~ "MX1",
      site == "ENH2" ~ "MX2",
      site == "DEG1" ~ "GD1",
      site == "DEG2" ~ "GD2",
    TRUE ~ as.character(site)  # Keep other observations unchanged
  )) %>% 
  rename(Hillslope = site) %>% # old name = new name
  mutate(Hillslope = fct_relevel(Hillslope, 
            "SD1", "SD2", "SD3", "MX1", "MX2", "GD1", "GD2"))
         , 
       aes(x = Hillslope, y = mean_height)) + #fill = standtype
  geom_col(color = "black") +
  #scale_fill_manual(values = standcolors) +
  geom_errorbar(aes(ymin = mean_height - se, ymax = mean_height + se), width = 0.5) +
   #theme(axis.text.x.bottom = element_text(angle = 90)) +
  labs(x = "Hillslope", 
   y = "Mean canopy height (cm)", 
       title = "Mean canopy height (cm) by hillslope")
canopyheight_bar
ggsave("Ch1_Degradation_figures/canopyheight_bar.png", canopyheight_bar, width = 8, height = 6)

# point with error bars - mean height x nngrass
ggplot(standheight_siterep_meanSD, 
       aes(x = mean_nngrasscover, y = mean_height, color = standtype)) +
  geom_point() +
  geom_errorbar(aes(ymin = mean_height - se, ymax = mean_height + se)) +
  # theme(axis.text.x.bottom = element_text(angle = 90)) +
  labs(x = "Non-native grass cover (%)", 
   y = "Mean canopy height (cm)", 
       title = "Mean canopy height (cm) per transect by non-native grass cover (%)")

# point with error bars x site
ggplot(standheight_site_meanSD, 
       aes(x = mean_nngrasscover, y = mean_height, color = site)) +
  geom_point()+
  geom_errorbar(aes(ymin = mean_height - se, ymax = mean_height + se)) +
   #theme(axis.text.x.bottom = element_text(angle = 90)) +
  labs(x = "Hillslope", 
   y = "Mean canopy height (cm)", 
       title = "Mean canopy height (cm) by hillslope")
# standtype site     mean_height     n    sd    se mean_nngrasscover mean_nativeshrubcover
#   <fct>     <chr>          <dbl> <int> <dbl> <dbl>             <dbl>                 <dbl>
# 1 Intact    Intact_1       146.     41 110.  17.2             0.244                  0.707
# 2 Intact    Intact_2        89.4    41  53.3  8.32            0.0732                 0.707
# 3 Intact    Intact_3       215.     41 109.  17.0             0.122                  0.951
# 4 Matrix    ENH1           116.    123  78.6  7.09            0.626                  0.642
# 5 Matrix    ENH2            64.5   123  44.6  4.02            0.846                  0.390
# 6 Degraded  DEG1            96.2   123  23.3  2.10            0.959                  0.325
# 7 Degraded  DEG2            91.8   123  38.0  3.43            0.951                  0.220
```

## stats
### - normality
```{r normality}
hist(standheight$height_cm)

shapiro.test(standheight$height_cm)
# 	Shapiro-Wilk normality test
# data:  standheight_full$height_cm
# W = 0.90732, p-value < 2.2e-16 <-- not normally distributed
```

### - mean height by hillslope 
```{r height by site stats, include = TRUE}

kruskal.test(height_cm ~ site, data = standheight)
# Kruskal-Wallis rank sum test
# 
# data:  height_cm by SITE
# Kruskal-Wallis chi-squared = 98.456, df = 6, p-value < 2.2e-16 <-- significant

pairwise.wilcox.test(standheight$height_cm, standheight$site,
                 p.adjust.method = "BH")
#          DEG1    DEG2    ENH1    ENH2    Intact_1 Intact_2
# DEG2     0.7707  -       -       -       -        -       
# ENH1     0.5132  0.1258  -       -       -        -       
# ENH2     1.4e-11 4.1e-07 9.1e-07 -       -        -       
# Intact_1 0.0223  0.0139  0.2486  0.0012  -        -       
# Intact_2 0.9924  0.9924  0.1258  0.0218  0.0363   -       
# Intact_3 2.2e-10 1.1e-09 8.5e-07 6.5e-13 0.0223   8.5e-07 
# 
# INT3 = taller than all other hillslopes
# INT2 = similar to DEG and ENH1
# INT1 = taller than DEG and ENH2
# ENH2 = shorter than all other hillslopes
```

### - KWtest by site_rep
```{r height by site_rep stats}

kruskal.test(height_cm ~ site_rep, data = standheight)
# Kruskal-Wallis rank sum test
# 
# data:  height_cm by SITE_REP
# Kruskal-Wallis chi-squared = 108.21, df = 14, p-value < 2.2e-16 <-- there are sig differences

pairwise.wilcox.test(standheight$height_cm, standheight$site_rep,
                 p.adjust.method = "BH")
#           DEG1_1  DEG1_2  DEG1_3  DEG2_1  DEG2_2  DEG2_3  ENH1_1  ENH1_2  ENH1_3  ENH2_1  ENH2_2  ENH2_3  Intact1_1 Intact2_2
# DEG1_2    0.04716 -       -       -       -       -       -       -       -       -       -       -       -         -        
# DEG1_3    0.00793 0.58907 -       -       -       -       -       -       -       -       -       -       -         -        
# DEG2_1    0.41016 0.45869 0.11792 -       -       -       -       -       -       -       -       -       -         -        
# DEG2_2    0.09542 0.72119 0.91270 0.61011 -       -       -       -       -       -       -       -       -         -        
# DEG2_3    0.63898 0.28765 0.10600 0.44577 0.17387 -       -       -       -       -       -       -       -         -        
# ENH1_1    0.07404 0.27538 0.25829 0.56390 0.88053 0.41016 -       -       -       -       -       -       -         -        
# ENH1_2    0.54994 0.42863 0.40877 0.29792 0.19663 0.35502 0.31081 -       -       -       -       -       -         -        
# ENH1_3    0.26132 0.05340 0.03912 0.09197 0.02673 0.10600 0.05315 0.77211 -       -       -       -       -         -        
# ENH2_1    8.6e-05 0.00048 0.00060 0.00462 0.03918 0.00098 0.02173 0.03976 0.00032 -       -       -       -         -        
# ENH2_2    2.8e-06 2.2e-05 2.2e-05 0.00169 0.02360 0.00011 0.01594 0.04716 0.00020 0.79009 -       -       -         -        
# ENH2_3    0.00046 0.00716 0.00983 0.02527 0.11387 0.00401 0.08484 0.05187 0.00095 0.49368 0.58907 -       -         -        
# Intact1_1 0.10762 0.07438 0.06278 0.05290 0.04193 0.07902 0.12226 0.72467 0.43908 0.01229 0.01594 0.01594 -         -        
# Intact2_2 0.43529 0.81915 0.56431 0.91873 0.63838 0.63898 0.85178 0.16836 0.05208 0.06034 0.04788 0.13437 0.05187   -        
# Intact3_3 1.0e-05 5.8e-07 1.9e-07 4.9e-06 1.3e-06 3.2e-06 1.4e-06 0.00524 0.00034 4.2e-08 2.4e-08 5.2e-08 0.03621   3.2e-06  

# DEG1_1 is diff than DEG1_2 and DEG1_3
# ENH1_1 is diff than ENH1_3
# INT1 and INT2 are barely similar. INT1 is diff than INT3.
# INT2 is diff than INT3.
```

### - lm by site_rep x shrub
```{r stand height lm native shrub}

height_native <- ggplot(standheight_siterep_meanSD,
       aes(x = mean_nativeshrubcover*100, y = mean_height, color = standtype)) +
  geom_point(size = 3, alpha = 0.8) +
  scale_shape_manual(values = c(16, 17, 18)) +
  scale_x_continuous(breaks = seq(0, 100, by = 10)) +  # Add tick marks every 0.1 on x-axis
  scale_y_continuous(breaks = seq(0, 250, by = 25)) +
  labs(x = "Native shrub cover (%)", 
       y = "Average canopy height (cm)", 
       title = "Average transect canopy height (cm) by Native shrub cover (%)"
       ) +
  scale_color_manual(values = c(standcolors),
                     name = "Stand Type",
                     labels = c("intact" = "shrub dominated", 
                                "matrix" = "matrix", 
                                "degraded" = "grass dominated")) + #rename standtypes labels
   geom_smooth(method = "lm", se = FALSE, linetype = "solid", color = "black") +   # lm, loess, glm
  theme_bw()
height_native

ggsave("Ch1_Degradation_figures/height_shrubcover.png", height_native, width = 8, height = 6)

summary(lm(mean_height ~ mean_nativeshrubcover, data = standheight_siterep_meanSD))
# Residual standard error: 28.31 on 13 degrees of freedom
# Multiple R-squared:  0.5059,	Adjusted R-squared:  0.4679 
# F-statistic: 13.31 on 1 and 13 DF,  p-value: 0.002948 <-- sig
# Residual standard error: 28.31 on 13 degrees of freedom
# Multiple R-squared:  0.5059,	Adjusted R-squared:  0.4679 
# F-statistic: 13.31 on 1 and 13 DF,  p-value: 0.002948

```

### - lm by site_rep x nn grass
```{r stand height lm nn grass}

height_nn <- ggplot(standheight_withcover,
       aes(x = nonnative_grass, y = mean_height, color = site)) +
  geom_point() +
  #geom_jitter() +
 # theme(axis.text.x.bottom = element_text(angle = 90)) +
  labs(x = "Non-native Grass Cover (%)", 
       y = "Canopy height (cm)", 
       title = "Canopy height (cm) by Non-native Grass cover (%)") +
   geom_smooth(method = "lm", se = FALSE, linetype = "solid", color = "black")   # lm, loess, glm
height_nn

ggsave("Ch1_Degradation_figures/height_nngrasscover.png", height_nn, width = 8, height = 6)

summary(lm(mean_height ~ mean_nngrasscover, data = standheight_siterep_meanSD))
#                   Estimate Std. Error t value Pr(>|t|)    
# (Intercept)         158.20      19.71   8.028 2.15e-06 ***
# mean_nngrasscover   -77.19      25.54  -3.023   0.0098 ** <-- sig
# Residual standard error: 30.86 on 13 degrees of freedom
# Multiple R-squared:  0.4127,	Adjusted R-squared:  0.3675 
# F-statistic: 9.136 on 1 and 13 DF,  p-value: 0.009805

```


### stand type (n = 3)
```{r  canopy height by stand type, include=FALSE}
# 
# # mean SD by site_rep - 3 stand types
# standheight_standtype_meanSD <- standheight_full %>%
#   group_by(standtype, site, site_rep) %>%
#   summarize(mean_height_byrep = mean(height_cm),
#             n = length((height_cm)),
#             sd = sd(height_cm),
#             se = ((sd(height_cm))/sqrt(length((height_cm))))) %>% # equivalent to: standheight_siterep_meanSD
#   group_by(site) %>% 
#    summarize(mean_height_bysiterep_cm = mean(mean_height_byrep),
#              n = length((mean_height_byrep)),
#              sd_cm = sd(mean_height_byrep),
#              se_cm = ((sd(mean_height_byrep))/sqrt(length((mean_height_byrep))))) %>% # summarizes by standtype
#   print(standheight_standtype_meanSD)

# standtype mean_height_bystandtype N SD SE
#Intact	  150.29268	3	62.942199	36.339695
#Matrix	  90.17480	6	30.885894	12.609114
#Degraded	94.00813	6	6.593106	2.691624


# site  mean_height_bysiterep_cm  n sd_cm
# DEG1	96.17073	3	7.511680	
# DEG2	91.84553	3	6.181969	
# ENH1	115.81301	3	20.023623	
# ENH2	64.53659	3	3.456451	
# Intact_1	146.43902	1	NA	
# Intact_2	89.36585	1	NA	
# Intact_3	215.07317	1	NA	
```

```{r canopy height by stand type - stats, include=FALSE}


shapiro.test(standheight_full$height_cm)
# 	Shapiro-Wilk normality test
# data:  standheight_full$height_cm
# W = 0.90732, p-value < 2.2e-16 <-- not normally distributed

kruskal.test(height_cm ~ standtype, data = standheight_full)
# 	Kruskal-Wallis rank sum test
# data:  height_cm by standtype
# Kruskal-Wallis chi-squared = 37.914, df = 2, p-value = 5.85e-09

pairwise.wilcox.test(standheight_full$height_cm, standheight_full$standtype,
                 p.adjust.method = "BH")
# Pairwise comparisons using Wilcoxon rank sum test with continuity correction 
# data:  standheight_full$height_cm and standheight_full$standtype 
#          Intact  Matrix 
# Matrix   9.7e-07 -      
# Degraded 9.7e-07 0.00042 <-- all are significantly different
# P value adjustment method: BH 
```

# COV 
```{r COV - by transect , include=TRUE}

standheight_cov_transect <- standheight_siterep_meanSD %>% # Intact n = 3, Matrix and Deg n = 6
  mutate(cov_bytransect = sd/mean_height) %>% # COV = SD / mean
  print(standheight_cov_transect)

standheight_cov_transect[order(standheight_cov_transect$cov_bytransect), ]

transectCOV %>% 
  group_by(site_rep) %>% 
  summarize(COV = (sd(mean_height))/(mean(mean_height)),
            n = length((dist_from_mean)),
            sd = sd(dist_from_mean),
            se = ((sd(dist_from_mean))/sqrt(length((dist_from_mean)))))
```


```{r COV by transect prep, include=FALSE}
#add mean height to site_rep

transect_prepCOV <- standheight_siterep_meanSD %>% 
  dplyr::select('site_rep', 'mean_height')

transectCOV <- standheight_full %>% 
  left_join(transect_prepCOV, by = 'site_rep') %>% 
  dplyr::select(!c("standtype.y", "site.y")) %>% 
  rename(standtype = standtype.x) %>% 
  rename(site = site.x) %>% 
  mutate(site = case_when(site == "Intact_1" ~ "INT1", # old name ~ new name
                          site == "Intact_2" ~ "INT2",
                          site == "Intact_3" ~ "INT3",
                              TRUE ~ site)) %>%
  mutate(dist_from_mean = height_cm - mean_height) %>% 
  left_join(nativecover, by = "site_rep")  %>% 
  mutate(site_rep = case_when(site_rep == "Intact_1_1" ~ "INT1_1", # old name ~ new name
                          site_rep == "Intact_2_2" ~ "INT2_2",
                          site_rep == "Intact_3_3" ~ "INT3_3",
                              TRUE ~ site_rep)) 
  #dplyr::select(!c("standtype", "standtype.y", "X")) %>% 
 # rename(standtype = standtype.x)
  

print(transectCOV)
```


### - figures
```{r graph distance from mean canopy height, include=FALSE}

# distance from mean canopy height x transect
# - scatterplot - site_rep
ggplot(data = transectCOV, # standheight_cov_transect
       aes(x = site_rep, y = dist_from_mean)) +
  geom_point() +
  theme(axis.text.x.bottom = element_text(angle = 90)) +
  labs(x = "Transect ID", 
       y = "Distance from mean canopy cover (cm)", 
       title = "Distance from mean canopy height (cm) by Transect ID")

# - scatterplot - site
ggplot(data = transectCOV, # standheight_cov_transect
       aes(x = site, y = dist_from_mean)) +
  geom_point() +
  theme(axis.text.x.bottom = element_text(angle = 90)) +
  labs(x = "Hillslope", 
       y = "Distance from mean canopy cover (cm)", 
       title = "Distance from mean canopy height (cm) by Hillslope")

# - box plot
ggplot(transectCOV, 
       aes(x = site_rep, y = dist_from_mean)) +
  geom_boxplot() +
  theme(axis.text.x.bottom = element_text(angle = 90)) +
  labs(x = "Transect ID", 
   y = "Distance from mean canopy height (cm)", 
       title = "Canopy height (cm) by transect")

# distance from mean canopy height x nn grass cover
ggplot(transectCOV, 
       aes(x = nonnative_grass, y = dist_from_mean)) +
  geom_point(aes(fill = standtype), colour = "black", size = 3, pch = 21) +
 # theme(axis.text.x.bottom = element_text(angle = 90)) +
labs(x = "Average non-native grass cover (%)", 
       y = "Distance from mean canopy height (cm)", 
       title = "Distance from mean canopy height (cm) by average non-native cover (%)")


# distance from mean canopy height x nn grass cover
ggplot(transectCOV, 
       aes(x = nonnative_grass, y = dist_from_mean)) +
  geom_point(aes(fill = site), colour = "black", size = 3, pch = 21) +
 # theme(axis.text.x.bottom = element_text(angle = 90)) +
labs(x = "Average non-native grass cover (%)", 
       y = "Distance from mean canopy height (cm)", 
       title = "Distance from mean canopy height (cm) by average non-native cover (%)")

```

### - stats
```{r stats for COV, include=FALSE}

histogram(transectCOV$dist_from_mean)

shapiro.test(transectCOV$dist_from_mean)
# Shapiro-Wilk normality test
# 
# data:  transectCOV$dist_from_mean
# W = 0.98131, p-value = 4.462e-07 <-- not normally distributed

kruskal.test(dist_from_mean ~ site, data = transectCOV)
# data:  dist_from_mean by site
# Kruskal-Wallis chi-squared = 1.5734, df = 6, p-value = 0.9545

# Kruskal-Wallis rank sum test
# 
# data:  dist_from_mean by site_rep
# Kruskal-Wallis chi-squared = 2.2501, df = 14, p-value = 0.9998 <-- no sig difference between transects

pairwise.wilcox.test(transectCOV$dist_from_mean, transectCOV$site_rep,
                 p.adjust.method = "BH")
# All values are equal to 1 because the mean is calculated from the raw values. SO - the cumulative "dist_to_mean" is going to be zero because that's how the mean is calculated - the mean is the centroid value of all raw data points. 
# So - analyze differences in transect height based on mean heights and SD... NOT COV since you have an N of 1.  
```


```{r COV - COV by hillslop, include=TRUE}
# standheight_cov <- standheight_siterep_meanSD %>% # Intact n = 3, Matrix and Deg n = 6
#    group_by(standtype, site, site_rep) %>% 
#    dplyr::summarize(cov = sd/mean_height) %>% # COV = SD / mean
#    print(standheight_cov)
# 
# view(standheight_cov)
# # standtype site  site_rep  cov
# # Intact	Intact_1	Intact_1_1	0.7541507	
# # Intact	Intact_2	Intact_2_2	0.5960149	
# # Intact	Intact_3	Intact_3_3	0.5061217	
# # Matrix	ENH1	ENH1_1	        0.6085122	
# # Matrix	ENH1	ENH1_2	        0.7766659	
# # Matrix	ENH1	ENH1_3	        0.5325727	
# # Matrix	ENH2	ENH2_4	        0.7603237	
# # Matrix	ENH2	ENH2_5	        0.6714455	
# # Matrix	ENH2	ENH2_6	        0.6515777	
# # Degraded	DEG1	DEG1_1      	0.2678440	
# # Degraded	DEG1	DEG1_2	      0.2364431	
# # Degraded	DEG1	DEG1_3	      0.1810220	
# # Degraded	DEG2	DEG2_4	      0.4092023	
# # Degraded	DEG2	DEG2_5	      0.4806065	
# # Degraded	DEG2	DEG2_6	      0.3557661	

```

```{r}
# grouped by standtype
standheight_cov %>% 
  group_by(site_rep) %>% # standtype
  summarize(mean_cov = mean(cov),
            n = length((cov)),
            sd = sd(cov),
            se = ((sd(cov))/sqrt(length((cov)))))
# standtype
#         mean_COV  N SD          SE
#Intact	  0.6187625	3	0.12556945	0.07249755 <-- larger number = more variation
#Matrix	  0.6668496	6	0.09217907	0.03763195 
#Degraded	0.3218140	6	0.11316173	0.04619808 <-- smaller number = less variation

# site_rep   mean_cov     n    sd    se
#  1 DEG1_1        0.268     1    NA    NA
#  2 DEG1_2        0.236     1    NA    NA
#  3 DEG1_3        0.181     1    NA    NA
#  4 DEG2_4        0.409     1    NA    NA
#  5 DEG2_5        0.481     1    NA    NA
#  6 DEG2_6        0.356     1    NA    NA
#  7 ENH1_1        0.609     1    NA    NA
#  8 ENH1_2        0.777     1    NA    NA
#  9 ENH1_3        0.533     1    NA    NA
# 10 ENH2_4        0.760     1    NA    NA
# 11 ENH2_5        0.671     1    NA    NA
# 12 ENH2_6        0.652     1    NA    NA
# 13 Intact_1_1    0.754     1    NA    NA
# 14 Intact_2_2    0.596     1    NA    NA
# 15 Intact_3_3    0.506     1    NA    NA

shapiro.test(standheight_cov$cov)
# Shapiro-Wilk normality test
# data:  standheight_cov$cov
# W = 0.94294, p-value = 0.4207 <-- normally distributed

summary(aov((cov ~ standtype) , data = standheight_cov))
#            Df Sum Sq Mean Sq F value   Pr(>F)    
#standtype    2 0.3943  0.1971   17.14 0.000304 *** <-- cov is significantly different by standtype

TukeyHSD(aov((cov ~ site) , data = standheight_cov), conf.level=.95) 
#$standtype
#                       diff        lwr         upr     p adj
#Matrix-Intact    0.04808716 -0.1542489  0.25042324 0.8045742
#Degraded-Intact -0.29694845 -0.4992845 -0.09461236 0.0053826 <-- Deg and Int
#Degraded-Matrix -0.34503560 -0.5102423 -0.17982888 0.0003305 <-- Deg and Mat

# Degraded sites are significantly more homogeneous than the INT and MAT standtypes

shapiro.test(standheight_cov_cover)
```

```{r canopy COV linear regression - native shrub, include=TRUE}

transectCOV_prep <- transectCOV %>% 
  dplyr::select(c(site_rep, native_shrub, nonnative_grass)) %>% 
  group_by(site_rep) %>% 
  summarize(native_shrub = mean(native_shrub),
            nonnative_grass = mean(nonnative_grass))

standheight_cov_cover <- standheight_cov %>% 
  mutate(site_rep = case_when(site_rep == "Intact_1_1" ~ "INT1_1", # old name ~ new name
                              site_rep == "Intact_2_2" ~ "INT2_2",
                              site_rep == "Intact_3_3" ~ "INT3_3",
                              TRUE ~ site_rep)) %>%
  left_join(transectCOV_prep , by = "site_rep") 


# stand cov x native shrub cover
cov_shrubcover <- ggplot(data = standheight_cov_cover %>% 
          mutate(site = case_when(
    site == "Intact_1" ~ "SD1", # old name ~ new name
      site == "Intact_2" ~ "SD2",
      site == "Intact_3" ~ "SD3",
    site == "ENH1" ~ "MX1",
      site == "ENH2" ~ "MX2",
      site == "DEG1" ~ "GD1",
      site == "DEG2" ~ "GD2",
    TRUE ~ as.character(site)  # Keep other observations unchanged
  )) %>% 
  rename(Hillslope = site), # %>% # new name = old name
  # dplyr::mutate(Hillslope = fct_relevel(Hillslope, 
  #           "SD1", "SD2", "SD3", "MX1", "MX2", "GD1", "GD2")), 
       aes(x = native_shrub*100, y = cov, color = Hillslope)) + #color = standtype
  geom_point(size = 3, alpha = 0.8) + # color = Hillslope
  ylim(0, 1) +
  xlim(0,100) +
  geom_smooth(method = "lm", se = FALSE, linetype = "solid", color = "black") +  # lm, loess, glm
  labs(x = "Native shrub cover (%)", 
       y = "Canopy Heterogeneity (COV)", 
       title = "Canopy Heterogeneity (COV) by Native Shrub cover (%)") +
  theme_bw() 
cov_shrubcover

ggsave("Ch1_Degradation_figures/cov_shrubcover.png", cov_shrubcover, width = 8, height = 6)

summary(lm(cov ~ native_shrub, data = standheight_cov_cover))
# Residual standard error: 0.1821 on 13 degrees of freedom
# Multiple R-squared:  0.1904,	Adjusted R-squared:  0.1281 
# F-statistic: 3.057 on 1 and 13 DF,  p-value: 0.1039
```

```{r canopy COV linear regression - nn grass, include=TRUE}
# stand COV x non-native grass cover

cov_nngrasscover <- ggplot(standheight_cov_cover %>%
                             dplyr::mutate(site = case_when(
                               site == "Intact_1" ~ "SD1", # old name ~ new name
      site == "Intact_2" ~ "SD2",
      site == "Intact_3" ~ "SD3",
      site == "ENH1" ~ "MX1",
      site == "ENH2" ~ "MX2",
      site == "DEG1" ~ "GD1",
      site == "DEG2" ~ "GD2",
    TRUE ~ as.character(site)  # Keep other observations unchanged
  )) %>%
  rename(Hillslope = site), #%>% # old name = new name
  # mutate(Hillslope = fct_relevel(Hillslope,
  #           "SD1", "SD2", "SD3", "MX1", "MX2", "GD1", "GD2")),
  aes(x = nonnative_grass*100, y = cov, color = Hillslope)) + #color = site
  geom_point(size = 3, alpha = 0.8) +
  ylim(0, 1)+
  xlim(0,100) +
  geom_smooth(method = "lm", se = FALSE, linetype = "solid", color = "black") +  # lm, loess, glm
  labs(x = "Non-native grass cover (%)", 
       y = "Canopy Heterogeneity (COV)", 
       title = "Canopy Heterogeneity (COV) by Non-native grass cover (%)") +
  theme_bw() 
#+  
 #  stat_poly_line() +
 #   stat_poly_eq(
 #    aes(label = paste(after_stat(eq.label), after_stat(adj.rr.label), sep = "~~~~")),
 #    formula = formula1, 
 #    parse=TRUE
 # )
cov_nngrasscover
ggsave("Ch1_Degradation_figures/cov_nncover.png", cov_nngrasscover, width = 8, height = 6)

cov_nngrass.lm <- lm(cov ~ nonnative_grass, 
                                      data = standheight_cov_cover)
summary(cov_nngrass.lm)
# Residual standard error: 0.183 on 13 degrees of freedom
# Multiple R-squared:  0.1826,	Adjusted R-squared:  0.1197 
# F-statistic: 2.903 on 1 and 13 DF,  p-value: 0.1122
```


# 3. DENSITY
### data
```{r  load data - shrub density, include=TRUE}
#1. Every variable is a column --> ARCA_dead
#2. Each observation is a row --> DEG_1
#3. Each cell contains a single value --> N


# native shrub density 
shrubdensitylife_load <- read_csv("deg_beltdensity_bylifestage.csv", 
    col_types = cols(
      StandType = col_character(), 
      Site = col_character(),
      rep = col_character(),
      ScientificName = col_character(), 
      dead = col_integer(),
      immature = col_integer(),
      mature = col_integer(), 
      resprout = col_integer(), 
      seedling = col_integer()
      )
     ) %>% 
  rename(standtype = StandType, 
         site = Site, 
         species = ScientificName) %>%
  mutate(standtype = case_when(standtype == "Grass" ~ "degraded", 
                               standtype == "matrix" ~ "matrix",
                               standtype == "Intact" ~ "intact")) %>% 
  mutate(standtype = fct_relevel(standtype, 
            "intact", "matrix", "degraded")) %>% 
  mutate(site_rep = paste(site, rep, sep = "_")) %>%  # combine site and rep to one column
  mutate(site_rep = case_when(
    site_rep == "Intact_1_1" ~ "Intact1_1", # old name ~ new name
     site_rep == "Intact_2_2" ~ "Intact2_2",
     site_rep == "Intact_3_3" ~ "Intact3_3",
     site_rep == "DEG2_4" ~ "DEG2_1",
     site_rep == "DEG2_5" ~ "DEG2_2",
     site_rep == "DEG2_6" ~ "DEG2_3",
     site_rep == "ENH2_4" ~ "ENH2_1",
        site_rep == "ENH2_5" ~ "ENH2_2",
        site_rep == "ENH2_6" ~ "ENH2_3",
     TRUE ~ as.character(site_rep))) %>%   # Keep other observations unchanged
   mutate(site_rep_species = paste(site_rep, species, sep = "_")) %>% 
  as_tibble() 

# transpose data from wide to long format
shrubdensity <- gather(shrubdensitylife_load, "status", "count", 5:9) 

view(shrubdensity) # look at new column site_rep, last column

# check for missing data

shrubdensity %>% 
  group_by(site_rep, status) %>% 
  summarize(length_count = length(count)) %>% 
  print(shrubdensity_sum_bysiterep_meanSD)
# all site_rep have 5 status categories: dead, immature, mature, resprout, seedling 
# all status have 13 length_count --> 13 species per status
# take home = no missing data points

sort(unique(shrubdensity$site_rep))
sort(unique(shrubdensity$species))
sort(unique(shrubdensity$site_rep_species))

# write.csv(shrubdensity,"processed/shrubdensity.csv")

# shrubdensityspp_full <- read_csv("~/Dropbox/GRADSCHOOL/Dissertation/R_dissertation/chaparraldegradation_2022b/deg_beltdensity_byspecies.csv")
# shrubdensityalive_full <- read_csv("~/Dropbox/GRADSCHOOL/Dissertation/R_dissertation/deg_beltdensity_seperatealive.csv")


```



# ALIVE shrub density

```{r alive shrub dentsity 1m2, include=TRUE}

# ALIVE
shrubdensity_sum_bysiterep <- shrubdensity %>% # call tibble
  filter(status != "dead") %>% #omit dead shrubs
   mutate(site = case_when(
    site == "Intact1" ~ "SD1", # old name ~ new name
      site == "Intact2" ~ "SD2",
      site == "Intact3" ~ "SD3",
    site == "ENH1" ~ "MX1",
      site == "ENH2" ~ "MX2",
      site == "DEG1" ~ "GD1",
      site == "DEG2" ~ "GD2",
    TRUE ~ as.character(site)  # Keep other observations unchanged
  )) %>% 
  rename(Hillslope = site) %>% # old name = new name
  mutate(Hillslope = fct_relevel(Hillslope, "SD1", "SD2", "SD3", "MX1", "MX2", "GD1", "GD2")) %>% 
  group_by(standtype, Hillslope, site_rep) %>%  # lump immature, mature, resprout shrubs and seedlings
  summarize(aliveshrubdensity_80m2 = sum(count), 
            aliveshrubdensity_1m2 = aliveshrubdensity_80m2/80)  # 4m x 20 m belt transect
view(shrubdensity_sum_bysiterep) 

```

- visualize
```{r density visualize}
hist(shrubdensity_sum_bysiterep$aliveshrubdensity_1m2)
boxplot(aliveshrubdensity_1m2 ~ Hillslope, data = shrubdensity_sum_bysiterep, col = "red")

ggplot(shrubdensity_sum_bysiterep, aes(x = Hillslope, y = aliveshrubdensity_1m2, color = site_rep)) +
  geom_point() +
  labs(x = "Hillslope", y = "Alive Shrub Density (per 1m^2)",
       title = "Scatter Plot of Hillslope vs Alive Shrub Density")
```

## stats
 - normality
```{r normality density}

shapiro.test(shrubdensity_sum_bysiterep$aliveshrubdensity_1m2)
# Shapiro-Wilk normality test
# 
# data:  shrubdensity_sum_bysiterep$aliveshrubdensity_1m2
# W = 0.694, p-value = 0.0002145 <-- not normal
```
 - KW density by hillslope (n = 15)
```{r density by site stats, include = TRUE}

kruskal.test(aliveshrubdensity_1m2 ~ Hillslope, data = shrubdensity_sum_bysiterep)
# Kruskal-Wallis rank sum test
# 
# data:  aliveshrubdensity_1m2 by Hillslope
# Kruskal-Wallis chi-squared = 9.5683, df = 6, p-value = 0.144

pairwise.wilcox.test(shrubdensity_sum_bysiterep$aliveshrubdensity_1m2, shrubdensity_sum_bysiterep$Hillslope,
                 p.adjust.method = "BH")
# data:  shrubdensity_sum_bysiterep$aliveshrubdensity_1m2 and shrubdensity_sum_bysiterep$Hillslope 
# 
#     SD1  SD2  SD3  MX1  MX2  GD1 
# SD2 1.00 -    -    -    -    -   
# SD3 1.00 1.00 -    -    -    -   
# MX1 1.00 1.00 1.00 -    -    -   
# MX2 1.00 0.81 0.81 0.81 -    -   
# GD1 0.81 0.81 0.81 0.81 0.81 -   
# GD2 0.81 0.81 0.81 0.81 0.81 1.00
# 
# P value adjustment method: BH 
```

- shrub density by species by site_rep
```{r alive shrub desity grouped by species}
shrubdensity_alive_byspp <- shrubdensity %>% # call tibble
  filter(status != "dead") %>% #omit dead shrubs
  group_by(species, site_rep) %>%  # lump immature, mature, resprout shrubs and seedlings
  summarize(aliveshrubdensity_80m2 = sum(count), 
            aliveshrubdensity_1m2 = aliveshrubdensity_80m2/80)  %>% # 4m x 20 m belt transect
  filter(aliveshrubdensity_1m2 > 0)
print(shrubdensity_alive_byspp) 

# write.csv(shrubdensity_alive_byspp, "Ch1_Degradation_figures/shrubdensity_alive_byspp.csv")
```

```{r left join cover}
# left_join
shrubdensity_sum_bysiterep_cover <- shrubdensity_sum_bysiterep %>%
 left_join(nativecover_load, by = "site_rep") 
view(shrubdensity_sum_bysiterep_cover) # n = 15
```

### lm  by shrub cover
```{r lm - density x nat shrub cover}
shrubdensity_nativeshrub.lm <- lm(aliveshrubdensity_1m2 ~ native_shrub, 
                                      data = shrubdensity_sum_bysiterep_cover)
summary(shrubdensity_nativeshrub.lm)
# Residual standard error: 0.4219 on 13 degrees of freedom
# Multiple R-squared:  0.4476,	Adjusted R-squared:  0.4051 
# F-statistic: 10.53 on 1 and 13 DF,  p-value: 0.00638 <-- significant
```

```{r figure linear regression - density x nat shrub cover}
alivedensity_shrubcover_linear <- ggplot(shrubdensity_sum_bysiterep_cover, 
       aes(x = native_shrub*100, y = aliveshrubdensity_1m2)) + 
   geom_point(aes(color = Hillslope, shape = Hillslope), size = 3, alpha = 0.8) +
  scale_color_manual(values = c( "lightblue", "cornflowerblue", "blue","green", "darkgreen", "orange", "brown")) + #"gray0",
   scale_shape_manual(values = c(17, 17, 17, 15, 15, 16,16)) + 
  ylim(0, 3)+
  xlim(0,100) +
  geom_smooth(method = "lm", se = FALSE, linetype = "solid", color = "black") +  # lm, loess, glm
  labs(x = "Native shrub cover (%)", 
       y = "Shrub Density (#/m^2)", 
       title = "Shrub density (per m^2) by native shrub cover") +
  theme_bw() +  
  stat_poly_line() +
  stat_poly_eq(use_label(c("eq", "R2")))
print(alivedensity_shrubcover_linear)
ggsave("Ch1_Degradation_figures/alivedensity_shrubcover_linear.png", alivedensity_shrubcover_linear, width = 8, height = 6)
```

### lm  by nn grass cover
```{r lm - density x nn grass cover}
shrubdensity_nngrass.lm <- lm(aliveshrubdensity_1m2 ~ nonnative_grass, 
                                      data = shrubdensity_sum_bysiterep_cover)
summary(shrubdensity_nngrass.lm)
# Residual standard error: 0.4913 on 13 degrees of freedom
# Multiple R-squared:  0.251,	Adjusted R-squared:  0.1934 
# F-statistic: 4.358 on 1 and 13 DF,  p-value: 0.05709 <-- not really sig
```

```{r linear regression - density x nn cover}
alivedensity_nngrasscover_linear <- ggplot(shrubdensity_sum_bysiterep_cover, 
       aes(x = nonnative_grass*100, y = aliveshrubdensity_1m2)) + 
   geom_point(aes(color = Hillslope, shape = Hillslope), size = 3, alpha = 0.8) +
  scale_color_manual(values = c( "lightblue", "cornflowerblue", "blue","green", "darkgreen", "orange", "brown")) + #"gray0",
   scale_shape_manual(values = c(17, 17, 17, 15, 15, 16,16)) + 
  ylim(0, 3)+
  xlim(0,100) +
  geom_smooth(method = "lm", se = FALSE, linetype = "solid", color = "black") +  # lm, loess, glm
  labs(x = "Non-native grass cover (%)", 
       y = "Shrub Density (#/m^2)", 
       title = "Shrub density (per m^2) by non-native grass cover") +
  theme_bw() +  
  stat_poly_line() +
  stat_poly_eq(use_label(c("eq", "R2")))
print(alivedensity_nngrasscover_linear)
ggsave("Ch1_Degradation_figures/alivedensity_nngrasscover_linear.png", alivedensity_nngrasscover_linear, width = 8, height = 6)
```


```{r alive shrub dentsity 1m2 - mean SD, include=TRUE}
shrubdensity_sum_bysiterep_meanSD <- shrubdensity_sum_bysiterep %>%
  group_by(standtype) %>%
  summarize(mean_aliveshrubdensity_1m2 = mean(aliveshrubdensity_1m2),
            n = length((aliveshrubdensity_1m2)),
            sd = sd(aliveshrubdensity_1m2),
            se = ((sd(aliveshrubdensity_1m2))/sqrt(length((aliveshrubdensity_1m2))))) %>% 
  print(shrubdensity_sum_bysiterep_meanSD)
#standtype    mean_aliveshrubdensity_1m2  n sd  se
#intact	      0.6375000	                  3	0.21323403	0.12311072
#matrix	      0.7750000	                  6	0.77245550	0.31535364
#degraded	    0.1895833	                  6	0.07600027	0.03102698

```

```{r alive shrub dentsity 1m2 - aov tukey, include=TRUE}

# ALIVE
summary(aov((aliveshrubdensity_1m2 ~ standtype) , data = shrubdensity_sum_bysiterep))
#            Df Sum Sq Mean Sq F value Pr(>F)
#standtype    2  1.086  0.5430     2.1  0.165
#Residuals   12  3.103  0.2586 

TukeyHSD(aov((aliveshrubdensity_1m2 ~ standtype) , data = shrubdensity_sum_bysiterep), conf.level=.95) 
#$standtype
#                      diff        lwr       upr     p adj
#matrix-intact    0.1375000 -0.8218272 1.0968272 0.9230712
#degraded-intact -0.4479167 -1.4072439 0.5114105 0.4505607
#degraded-matrix -0.5854167 -1.3687040 0.1978707 0.1560871

```

```{r alive shrub dentsity 1m2 - figures - tables, include=TRUE}

shrubdensity_sum_bysiterep_aov_1m2_column <- ggplot(shrubdensity_sum_bysiterep_meanSD, aes(x = standtype, y = mean_aliveshrubdensity_1m2, fill = standtype)) +
  geom_col(position = "dodge", width = 0.8) +
  geom_errorbar(
    aes(ymin=mean_aliveshrubdensity_1m2-se, ymax=mean_aliveshrubdensity_1m2+se), 
                width=.2, position=position_dodge(.9)) +
  labs(
    title = "Alive shrub density by stand type", 
    x = "Stand Type", 
    y = "Average alive shrub density (#/m2)") + # title, axes titles
  scale_fill_manual(values = c(standcolors)) + # manual colors
  # scale_fill_manual(values = cal_palette('chaparral2')) +  # continuous colors
  #                  limits = c("intact", "matrix", "degraded"), # "limits" reorders the x-axis
  #                  labels = c("Intact", "Matrix", "Degraded")) + # "labels" changes the name
  theme_bw()
shrubdensity_sum_bysiterep_aov_1m2_column

# table: standtype, species, lifestage
shrubdensity_table <- shrubdensity %>%
  mutate(status = case_when(status == "resprout" ~ "immature", 
                            TRUE ~ status)) %>% 
  mutate(status = fct_relevel(status, "mature", "immature", "seedling", "dead")) %>% 
  group_by(standtype, species, status) %>%
   rename(lifestage = status) %>% 
  summarize(N = sum(count)) %>%
  print(shrubdensity_table) 

shrubdensity_table_spread <- shrubdensity_table %>%  
  spread(key = lifestage, value = N) %>% 
  print(shrubdensity_table_spread)

#write.csv(shrubdensity_table_spread,"processed/shrubdensity_table_spread.csv")

shrubdensity_table_spread %>% 
  group_by(standtype) %>% 
  summarize(sum_mature = sum(mature), 
            sum_immature = sum(immature), 
            sum_seedling = sum(seedling), 
            sum_dead = sum(dead))
#standtype sum_mature sum_immature sum_seedlingsum_dead
#intact	  101	    45	  7	    22
#matrix	  297	    70	  5	    256
#degraded	72	    16	  3	    0
```

#### MATURE shrub density

```{r mature shrub density - mean SD, include=TRUE}

# MATURE 
shrubdensity_sum_bysiterep_mature <- shrubdensity %>%
  filter(status == "mature") %>% #select only mature shrubs
  group_by(standtype, site_rep) %>%  
  summarize(matureshrubdensity_80m2 = sum(count), 
            matureshrubdensity_1m2 = matureshrubdensity_80m2/80) # 4m x 20 m belt transect
  print(shrubdensity_sum_bysiterep_mature) 

shrubdensity_sum_bysiterep_mature_meanSD <- shrubdensity_sum_bysiterep_mature %>%
  group_by(standtype) %>%
  summarize(mean_matureshrubdensity_1m2 = mean(matureshrubdensity_1m2),
            n = length((matureshrubdensity_1m2)),
            sd = sd(matureshrubdensity_1m2),
            se = ((sd(matureshrubdensity_1m2))/sqrt(length((matureshrubdensity_1m2))))) %>% 
  print(shrubdensity_sum_bysiterep_mature_meanSD)
#standtype    mean_matureshrubdensity_1m2  n sd  se
#intact	      0.4208333	                  3	0.22511571	0.12997062
#matrix	      0.6187500	                  6	0.52361424	0.21376462
#degraded	    0.1500000	                  6	0.06072479	0.02479079

```

```{r mature shrub density - aov tukey, include=TRUE}

# MATURE 
summary(aov((matureshrubdensity_1m2 ~ standtype) , data = shrubdensity_sum_bysiterep_mature))
#            Df Sum Sq Mean Sq F value Pr(>F)
#standtype    2 0.6624  0.3312   2.666   0.11
#Residuals   12 1.4907  0.1242  

TukeyHSD(aov((matureshrubdensity_1m2 ~ standtype) , data = shrubdensity_sum_bysiterep_mature), conf.level=.95) 
#$standtype
#                      diff        lwr        upr     p adj
#matrix-intact    0.1979167 -0.4669675 0.86280085 0.7135344
#degraded-intact -0.2708333 -0.9357175 0.39405085 0.5397636
#degraded-matrix -0.4687500 -1.0116257 0.07412566 0.0937921
```

#### IMMATURE shrub density

```{r immature shrub density, include=TRUE}

shrubdensity_sum_bysiterep_immature <- shrubdensity %>%
  filter(status == "immature") %>% #select only mature shrubs
  group_by(standtype, site_rep) %>%  
  summarize(immatureshrubdensity_80m2 = sum(count), 
            immatureshrubdensity_1m2 = immatureshrubdensity_80m2/80)  # 4m x 20 m belt transect
  print(shrubdensity_sum_bysiterep_immature) 

shrubdensity_sum_bysiterep_immature_meanSD <- shrubdensity_sum_bysiterep_immature %>%
  group_by(standtype) %>%
  summarize(mean_immatureshrubdensity_1m2 = mean(immatureshrubdensity_1m2),
            n = length((immatureshrubdensity_1m2)),
            sd = sd(immatureshrubdensity_1m2),
            se = ((sd(immatureshrubdensity_1m2))/sqrt(length((immatureshrubdensity_1m2))))) %>% 
  print(shrubdensity_sum_bysiterep_immature_meanSD)
#standtype  mean      n sd  se
#intact	    0.1833333	3	0.02886751	0.016666667
#matrix	    0.1395833	6	0.22184125	0.090566312
#degraded	  0.0312500	6	0.02200852	0.008984941

summary(aov((immatureshrubdensity_1m2 ~ standtype) , data = shrubdensity_sum_bysiterep_immature))
#Df  Sum Sq Mean Sq F value Pr(>F)
#standtype    2 0.05822 0.02911   1.396  0.285
#Residuals   12 0.25016 0.02085  

```
#### SEEDLING shrub density

```{r immature shrub density, include=TRUE}

shrubdensity_sum_bysiterep_seedling <- shrubdensity %>%
  filter(status == "seedling") %>% #select only mature shrubs
  group_by(standtype, site_rep) %>%  
  summarize(seedlingdensity_80m2 = sum(count), 
            seedlingdensity_1m2 = seedlingdensity_80m2/80)  # 4m x 20 m belt transect
  print(shrubdensity_sum_bysiterep_seedling) 

shrubdensity_sum_bysiterep_seedling_meanSD <- shrubdensity_sum_bysiterep_seedling %>%
  group_by(standtype) %>%
  summarize(mean_seedlingdensity_1m2 = mean(seedlingdensity_1m2),
            n = length((seedlingdensity_1m2)),
            sd = sd(seedlingdensity_1m2),
            se = ((sd(seedlingdensity_1m2))/sqrt(length((seedlingdensity_1m2))))) %>% 
  print(shrubdensity_sum_bysiterep_seedling_meanSD)
#standtype  mean      n sd  se
#intact	    0.02916667	3	0.04018188	0.023199018
#matrix	    0.01041667	6	0.01461306	0.005965759
#degraded	  0.00625000	6	0.01530931	0.00625000

summary(aov((seedlingdensity_1m2 ~ standtype) , data = shrubdensity_sum_bysiterep_seedling))
#Df  Sum Sq Mean Sq F value Pr(>F)
#standtype    2 0.001094 0.0005469     1.2  0.335
#Residuals   12 0.005469 0.0004557   

```
#### RESPROUT shrub density
```{r resprout density, include=TRUE}

shrubdensity_sum_bysiterep_respt <- shrubdensity %>%
  filter(status == "resprout") %>% #select only mature shrubs
  group_by(standtype, site_rep) %>%  
  summarize(resptdensity_80m2 = sum(count), 
            resptdensity_1m2 = resptdensity_80m2/80) # 4m x 20 m belt transect
  print(shrubdensity_sum_bysiterep_respt) 

shrubdensity_sum_bysiterep_respt_meanSD <- shrubdensity_sum_bysiterep_respt %>%
  group_by(standtype) %>%
  summarize(mean_resptdensity_1m2 = mean(resptdensity_1m2),
            n = length((resptdensity_1m2)),
            sd = sd(resptdensity_1m2),
            se = ((sd(resptdensity_1m2))/sqrt(length((resptdensity_1m2))))) %>% 
  print(shrubdensity_sum_bysiterep_respt_meanSD)
#standtype  mean        n sd  se
#intact	    0.004166667	3	0.007216878	0.004166667
#matrix	    0.006250000	6	0.015309311	0.006250000
#degraded	  0.002083333	6	0.005103104	0.002083333

summary(aov((resptdensity_1m2 ~ standtype) , data = shrubdensity_sum_bysiterep_respt))
#Df  Sum Sq Mean Sq F value Pr(>F)
#standtype    2 0.0000521 2.604e-05   0.222  0.804
#Residuals   12 0.0014063 1.172e-04 
```

#### DEAD shrub density
```{r dead shrub density, include=TRUE}

shrubdensity_sum_bysiterep_dead <- shrubdensity %>%
  filter(status == "dead") %>% #select only mature shrubs
  group_by(standtype, site_rep) %>%  
  summarize(deaddensity_80m2 = sum(count), 
            deaddensity_1m2 = deaddensity_80m2/80) %>% # 4m x 20 m belt transect
  print(shrubdensity_sum_bysiterep_dead) 

shrubdensity_sum_bysiterep_dead_meanSD <- shrubdensity_sum_bysiterep_dead %>%
  group_by(standtype) %>%
  summarize(mean_deaddensity_1m2 = mean(deaddensity_1m2),
            n = length((deaddensity_1m2)),
            sd = sd(deaddensity_1m2),
            se = ((sd(deaddensity_1m2))/sqrt(length((deaddensity_1m2))))) %>% 
  print(shrubdensity_sum_bysiterep_dead_meanSD)
#standtype  mean      n sd  se
#intact	0.09166667	3	0.1371207	0.07916667
#matrix	0.53333333	6	1.2698097	0.51839764
#degraded	0.00000000	6	0.0000000	0.00000000

summary(aov((deaddensity_1m2 ~ standtype) , data = shrubdensity_sum_bysiterep_dead))
#Df  Sum Sq Mean Sq F value Pr(>F)
#standtype    2  0.927  0.4634   0.687  0.522
#Residuals   12  8.100  0.6750  
```

# END 

##Density Segmented
```{r shrub density}
abcover_nativecover_nngrasscover[1:3,2] <- c("Intact1_1", "Intact2_2", "Intact3_3")

shrubdensity_sum_bysiterep_all <- shrubdensity_sum_bysiterep %>% 
  left_join(shrubdensity_sum_bysiterep_seedling, by = c("site_rep", "standtype")) %>%
  left_join(shrubdensity_sum_bysiterep_immature, by = c("site_rep", "standtype")) %>%
  left_join(shrubdensity_sum_bysiterep_mature, by = c("site_rep", "standtype")) %>%
  left_join(shrubdensity_sum_bysiterep_respt, by = c("site_rep", "standtype")) %>%
  left_join(abcover_nativecover_nngrasscover, by = c("site_rep")) %>%
  dplyr::select("site_rep", "aliveshrubdensity_1m2", "seedlingdensity_1m2", "immatureshrubdensity_1m2", "matureshrubdensity_1m2", "resptdensity_1m2", "nonnative_grass", "native_shrub")

shrub_density <- ggplot(data = shrubdensity_sum_bysiterep_all, aes(x = site_rep)) +
  geom_point(aes(y = aliveshrubdensity_1m2, color = "alive")) +
  geom_point(aes(y = seedlingdensity_1m2, color = "seedling")) +
  geom_point(aes(y = immatureshrubdensity_1m2, color = "immature")) +
  geom_point(aes(y = matureshrubdensity_1m2, color = "mature")) +
  geom_point(aes(y = resptdensity_1m2, color = "resprout")) +
  scale_color_manual(values = c("red3", "yellow3", "green3", "blue3", "purple3"))

shrub_density1 <- ggplot(data = shrubdensity_sum_bysiterep_all, aes(x = nonnative_grass)) +
  geom_point(aes(y = aliveshrubdensity_1m2, color = "alive")) +
  geom_point(aes(y = seedlingdensity_1m2, color = "seedling")) +
  geom_point(aes(y = immatureshrubdensity_1m2, color = "immature")) +
  geom_point(aes(y = matureshrubdensity_1m2, color = "mature")) +
  geom_point(aes(y = resptdensity_1m2, color = "resprout")) +
  scale_color_manual(values = c("red3", "yellow3", "green3", "blue3", "purple3"))
shrub_density1

shrub_density2 <- ggplot(data = shrubdensity_sum_bysiterep_all, aes(x = native_shrub)) +
  geom_point(aes(y = aliveshrubdensity_1m2, color = "alive")) +
  geom_point(aes(y = seedlingdensity_1m2, color = "seedling")) +
  geom_point(aes(y = immatureshrubdensity_1m2, color = "immature")) +
  geom_point(aes(y = matureshrubdensity_1m2, color = "mature")) +
  geom_point(aes(y = resptdensity_1m2, color = "resprout")) +
  scale_color_manual(values = c("red3", "yellow3", "green3", "blue3", "purple3"))
shrub_density2

ggplotly(shrub_density)
```
