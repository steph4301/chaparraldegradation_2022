---
title: "Stand Deg: percent cover regressions, canopy height, shrub density"
author: "Stephanie Ma Lucero"
date: "2024-04-23"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Code to hang on to
- mutate(site_rep = paste(site, transect, sep = "_")) %>% # create a new third column
- unite("lifeform_status", 6:5, sep = "_") #combines characters in two columns to one column, withoutcreating a third column
- line types
-- "solid": A solid line.
-- "dashed": A dashed line.
-- "dotted": A dotted line.
-- "dotdash": Alternating dots and dashes.
-- "longdash": Long dashes.

```{r libraries, message=FALSE}
library(here) # similar to set working directory
library(tidyverse) # data wrangling - includes ggplot2, dplyr, tidyr, readr, purr, tibble, stringr, forcats
library(readxl) 
library(gridExtra)
library(cowplot)
library(MASS)


```
# colors
```{r colors, include=TRUE}
devtools::install_github("an-bui/calecopal")

library(calecopal)
# all palettes
names(cal_palettes)

#chaparral1
#chaparral2
cal_palette(name = "chaparral3", n = 20, type = "continuous") 

#species colors
HEAR <- "#D3E3CA"
RHOV <- "#92A587"
RHIL <- "#2F3525"

MAFA <- "gray60"
SALE <- "gray40"
ARCA <- "gray20"

scl <- 16
css <- 17

colors_scl <- c(HEAR, RHOV, RHIL)
colors_css <- c(MAFA, SALE, ARCA)

# Lifeform colors: shrub, grass, forb
shrub <- "green4"
grass <- "yellow2"
forb <- "purple2"
fern <- "black"
colors_lifeform <- c(shrub, grass, forb, fern)

# Status colors: native, exotic 
native <- "black"
nonnative <- "maroon"
unknown <- "lightblue"
colors_status <- c(native, nonnative, unknown)

# "orange", "lightblue", "limegreen", "deeppink","mediumpurple2", "darkgreen"
```

#NOTES Transect data overview - Years collected: 2017, 2019, 2024 - Sites: 1 and 2 - Comparing to intact sites: INT1, INT2, INT3, INT4, INT5

# load data

```{r load point intercept transect data from csv, include=TRUE}
file_transect_2019_load <- read_excel("deg_percentcover_byspecies_bylifeform_2024.xlsx", sheet = "2019_data")

# -- years 2017, 2019
# -- Site 1: transects 1-6
# -- Site 2: transects 1-6
# -- INT1, INT2, INT3, INT4

# Finding species == "Bromus spp." to rename them by species
# transect2019_bromus <- file_transect_2019_load %>%
#   filter(grepl("Bromus", species))
# 
# transect2019_bromusspp <- file_transect_2019_load %>% 
#   filter(species == "Bromus spp.")

transect2019 <- file_transect_2019_load %>% 
  dplyr::select(c(site, transect, year, distance, vertical, species)) %>% # select columns to full join with 2024 data
  filter(year %in% c(2017, 2019))  %>% #filter data to 2019 data
   dplyr::select(year, site, transect, distance, vertical, species) %>% 
   mutate(species = ifelse(# a condition, a value if the condition is true, and a value if the condition is false
                              site == 2 & transect == 5 & distance %in% c(2, 6, 9) & species == "Bromus spp.", "Bromus hordeaceus", species)) %>% 
    mutate(species = ifelse(site == 2 & transect == 5 & distance %in% c(10, 28) & species == "Bromus spp.", "Bromus rubens", species)) %>% 
    mutate(species = ifelse(site == 2 & transect == 6 & distance %in% c(23, 35, 37) & species == "Bromus spp.", "Bromus hordeaceus", species)) %>% 
    mutate(species = ifelse(site == "INT1" & transect == 1 & distance %in% c(24) & species == "Bromus spp.", "Bromus diandrus", species))


# View the data (optional)
#View(transect2019)
#sort(unique(transect2019$transect))
#sort(unique(transect2019$site))

file_transect_2024_load <- read.csv("Transects_2024 - transect.csv", header = TRUE, na.strings=c("","NA"))
# -- years 2024
# -- Site 1: transects 7-14
# -- Site 2: transects 7-21
# -- INT5
transect2024 <- file_transect_2024_load %>%  
  dplyr::select(c(site, transect, year, distance, vertical, species)) %>% 
  filter(species != "N/A") %>% 
   mutate(species = case_when(species == "Bromus spp." ~ "Bromus rubens", # oldname ~ newname
                              TRUE ~ species))
  
# View the data (optional)
#view(transect2024)
#sort(unique(transect2024$transect))
#sort(unique(transect2024$site))
```

## full join transect data

```{r full join}
abcover_fulljoin <- full_join(transect2019, transect2024, by = intersect(names(transect2019), names(transect2024)))

# View the data (optional)
#View(abcover_full)
#sort(unique(abcover_full$transect))
#sort(unique(abcover_full$site))
```

## species list

```{r convert to tibble}
# convert dataframe to tibble
abcover_fulljoin_tib <- as_tibble(abcover_fulljoin) 
class(abcover_fulljoin_tib)

abcover_full <- abcover_fulljoin_tib %>% 
   mutate(site_rep = paste(site, transect, sep = "_")) %>% # combine site and rep to one column
   mutate(site_rep_dist = paste(site_rep, distance, sep = "_")) %>%  # combine site_rep and distance to one column 
   mutate(species = case_when(species == "BG bare ground" ~ "bare_ground", # oldname ~ newname
                              species == "ground" ~ "bare_ground", 
                              species == "native_litter" ~ "litter",
                              species == "nonnative_thatch" ~ "thatch",
                              species == "Bromus diandrus BRDI" ~ "Bromus diandrus",
                              species == "Bromus rubens BRRU" ~ "Bromus rubens", 
                              species == "Bromus hordeaceus BRHO" ~ "Bromus hordeaceus", 
                              species == "Rapistrum rugosum - round pods" ~ "Rapistrum rugosum", 
                              species == "HIIN Hirschfeldia incana - long pods" ~ "Hirschfeldia incana", 
                              species == "Hirschfeldia incana - long pods" ~ "Hirschfeldia incana", 
                              species == "Salvia lucophylla" ~ "Salvia leucophylla",
                              species == "Malacothamnus fasciculatus " ~ "Malacothamnus fasciculatus",
                              species == "dead HEAR" ~ "Heteromeles arbutifolia dead",
                              species == "dead MAFA" ~ "Malacothamnus fasciculatus dead",
                              species == "dead RHIL" ~ "Rhamnus ilicifolia dead",
                              species == "dead ARCA" ~ "Artemisia californica dead",
                              species == "dead SALE" ~ "Salvia leucophylla dead",
                              species == "ACGL Acmispon glaber" ~ "Acmispon glaber",
                              species == "dead Acmispon glaber" ~ "Acmispon glaber dead",
                              species == "Acmispon maritimus - round, sevfl" ~ "Acmispon maritimus",
                              species == "Acmispon strigosus - oval, sevfl" ~ "Acmispon strigosus",
                              species == "Sambucus nigra" ~ "Sambucus mexicana",
                              species == "Blitum californicum" ~ "Chenopodium californicum",
                              species == "Cryptantha sp." ~ "Cryptantha spp.",
                              TRUE ~ species)) %>% 
   mutate(
      year = as.character(year),
      site = as.character(site),
      transect = as.character(transect),
      distance = as.character(distance),
      vertical = as.character(vertical),
      species = as.character(species)
      )

glimpse(abcover_full) # look at new columns

sort(unique(abcover_full$species))
```

## species characteristics

```{r load species characteristics, include=TRUE}
specieslist <- file_transect_2019_load %>%
  dplyr::select(species, lifeform, status, lifecycle, family) %>%
   mutate(status = case_when(status == "Native" ~ "native", # oldname ~ newname
                                status == "Non-native" ~ "nonnative",
                                status == "thatch" ~ "ground",
                                status == "litter" ~ "ground",
                                status == "rock" ~ "ground",
                                TRUE ~ status)) %>%
   mutate(lifeform = case_when(lifeform == "Grass" ~ "grass",
                                lifeform == "Shrub" ~ "shrub",
                                lifeform == "Forb" ~ "forb",
                                lifeform == "thatch" ~ "ground",
                                lifeform == "litter" ~ "ground",
                                lifeform == "rock" ~ "ground",
                                TRUE ~ lifeform)) %>%
   mutate(lifecycle = case_when(lifecycle == "Annual" ~ "annual",
                                lifecycle == "Perennial" ~ "perennial",
                                lifecycle == "thatch" ~ "ground",
                                lifecycle == "litter" ~ "ground",
                                lifecycle == "rock" ~ "ground",
                                TRUE ~ lifecycle)) %>%
   mutate(family = case_when(family == "thatch" ~ "ground",
                             family == "litter" ~ "ground",
                             family == "rock" ~ "ground",
                                TRUE ~ family)) %>%
   mutate(species = case_when(species == "BG bare ground" ~ "bare_ground",
                                species == "ground" ~ "bare_ground",
                                species == "native_litter" ~ "litter",
                                species == "nonnative_thatch" ~ "thatch",
                                species == "Bromus diandrus BRDI" ~ "Bromus diandrus",
                                species == "Bromus rubens BRRU" ~ "Bromus rubens",
                                species == "Bromus hordeaceus BRHO" ~ "Bromus hordeaceus",
                                species == "Rapistrum rugosum - round pods" ~ "Rapistrum rugosum",
                                species == "HIIN Hirschfeldia incana - long pods" ~ "Hirschfeldia incana",
                                species == "Hirschfeldia incana - long pods" ~ "Hirschfeldia incana",
                                species == "Salvia lucophylla" ~ "Salvia leucophylla",
                                species == "Malacothamnus fasciculatus " ~ "Malacothamnus fasciculatus",
                                species == "dead HEAR" ~ "Heteromeles arbutifolia dead",
                                species == "dead MAFA" ~ "Malacothamnus fasciculatus dead",
                                species == "dead RHIL" ~ "Rhamnus ilicifolia dead",
                                species == "dead ARCA" ~ "Artemisia californica dead",
                                species == "dead SALE" ~ "Salvia leucophylla dead",
                                species == "ACGL Acmispon glaber" ~ "Acmispon glaber",
                                species == "Acmispon maritimus - round, sevfl" ~ "Acmispon maritimus",
                                species == "Acmispon strigosus - oval, sevfl" ~ "Acmispon strigosus",
                                species == "Mirabilis laevis var. crassifolia" ~ "Mirabilis laevis",
                                TRUE ~ species)) %>%
  add_row(species = "Cryptantha spp.",
          lifeform = "forb",
          status = "native",
          lifecycle = "annual",
          family = "Boraginaceae ") %>% 
    add_row(species = "Acmispon glaber dead",
          lifeform = "forb",
          status = "native",
          lifecycle = "annual",
          family = "Fabaceae ") %>% 
    add_row(species = "Uropappus lindleyi",
          lifeform = "forb",
          status = "native",
          lifecycle = "annual",
          family = "Asteraceae   ") %>% 
  distinct()

#View(specieslist)
sort(unique(specieslist$species))
```

-- code to update list of species characteristics
```{r playing with da species list}
ab_species <- sort(unique(abcover_full$species))
species_species <- sort(unique(specieslist$species))

#These are the species that are in abcover_full that are NOT in the species list
difab <- setdiff(ab_species, species_species)
difab 

#These are the species that are in the species list that are NOT in abcover_full
difsp <- setdiff(species_species, ab_species)
difsp

# # add species to the specieslist
# new.specieslist <- specieslist %>%
#   add_row(species = "Cryptantha spp.",
#           lifeform = "forb",
#           status = "native",
#           lifecycle = "annual",
#           family = "Boraginaceae ")
# #           
# # Rename species in the specieslist if needed
# new.specieslist <- specieslist %>%
#     mutate(species = case_when(species == "" ~ "",
#                                TRUE ~ species))
# 
# # Rename species in the data frame (abcover_full) if needed
# new.abcover_full <- abcover_full %>%
#     mutate(species = case_when(species == "Cryptantha sp." ~ "Cryptantha spp.",
#                               species == "dead Acmispon glaber" ~ "Acmispon glaber dead",
#                                TRUE ~ species))
# 
# new.ab_species <- sort(unique(new.abcover_full$species))
# new.species_species <- sort(unique(new.specieslist$species))
# 
# new.ab_species == new.species_species
# 
# #These are the species that are in abcover_full that are NOT in the species list
# new.difab <- setdiff(new.ab_species, new.species_species)
# new.difab
# 
# #These are the species that are in the species list that are NOT in abcover_full
# new.difsp <- setdiff(new.species_species, new.ab_species)
# new.difsp
# # 
# 
# # Run the code below when you are sure you added everything correctly 
# specieslist <- new.specieslist
# abcover_full <- new.abcover_full
# 
# write.csv(specieslist, file = "processed/specieslist.csv") # species and their characteristics :)

```

### left_join species characteristics
```{r left_join species characteristics}
abcover_charateristics <- abcover_full %>% 
  left_join(specieslist, by = "species") 
  

#sort(unique(abcover_charateristics$species))

# write.csv(abcover_charateristics, file = "processed/ab_specieslistwithcharateristics_08102024.csv") # species and their characteristics :)
```

## leaf type
```{r}
#shrub_leaftype <- read_excel("shrub_leaftype.xlsx") #original data

shrub_leaftype <- read.csv("shrub_leaftype.csv") %>% 
  dplyr::select("species", "leaftype") %>% 
   mutate(
      species = as.character(species),
      leaftype = as.character(leaftype)
      ) %>% 
  mutate(
    leaftype = if_else(grepl("dead", species, ignore.case = TRUE), "dead_shrub", leaftype)
  ) %>% 
  add_row(species = "Salvia apiana",
           leaftype = "nonsclero") %>% 
    add_row(species = "Cenothus oliganthus",
           leaftype = "nonsclero") %>% 
   add_row(species = "Quercus agrifolia",
           leaftype = "sclerophyllous") %>% 
    add_row(species = "no_shrubs",
           leaftype = "no_shrubs") %>% 
  add_row(species = "Ceanothus cuneatus", 
          leaftype = "sclerophyllous") %>% 
  add_row(species = "unknown5 shrub",
           leaftype = "unknown") 

print(sort(shrub_leaftype$species))
```

-- code to update list of shrub leaf characteristics
```{r update schlero leaf data}

#These are the species that are in abcover_full that are NOT in the species list
ab_shrubs_prep <- abcover_charateristics %>% 
  filter(lifeform == "shrub")
ab_shrubs <- sort(unique(ab_shrubs_prep$species))

shrub_shrubs_prep <- specieslist %>% 
  filter(lifeform == "shrub")
shrub_shrubs <- sort(unique(shrub_shrubs_prep$species))

# compare shrub lists
#These are the species that are in the species list that are NOT in abcover_full
difshr <- setdiff(ab_shrubs, shrub_shrubs)
difshr


# new.shrub_leaftype <- shrub_leaftype %>%
#   add_row(species = "", leaftype = "")
# 
# # Run the code below when you are sure you added everything correctly
# shrub_leaftype <- new.shrub_leaftype
# 
# write.csv(shrub_leaftype, file = "shrub_leaftype.csv")
```

### left_join leaftype
```{r}
abcover_charateristics_leaftype <- abcover_charateristics %>% 
  left_join(shrub_leaftype, by = "species")
```

# Data prep
```{r data check, include = TRUE}
abcover_charateristics_leaftype %>% 
  group_by(site, transect) %>%
  summarize(data_points = length(unique(distance))) # number of "hits" per transect

abcover_charateristics_leaftype %>% 
  group_by(site) %>%
  summarize(n_transects = length(unique(transect))) # number of transects per site
# sort(unique(abcover_full$site_rep))
```
- omit ground
### edit df 
```{r omit ground as a status}
abcover_omitground <- abcover_charateristics_leaftype %>% 
  filter(vertical != "ground", 
         vertical != "ground cover") %>% 
  filter(species != "no_species", 
         species != "thatch") %>% 
  mutate(lifeform_status = paste(lifeform, status, sep = "_")) %>% 
  mutate(lifeform_status_leaftype = paste(lifeform_status, leaftype, sep = "_"))

# sort(unique(abcover_omitground$status))
# names(abcover_omitground)
```

### transect percent cover by native or non-native stauts
```{r hist percent cover by site and status}

# I'm not interested in cover by total native vs. total non-native

# cover_bystatus <- abcover_omitground %>% 
#   group_by(site, transect, site_rep, year, status) %>%
#   dplyr::summarize(
#     count_per_transect = n_distinct(site_rep_dist),
#     percentcover = n_distinct(site_rep_dist)/41 # <-- calculate percent cover by transect, lifeform, and status
#     ) 

# # view(cover_bystatus)
# hist(cover_bystatus$percentcover)
# 
# # jitter - by site and status
# ggplot(data = cover_bystatus, 
#        aes(y = percentcover*100, x = site, color = status)) + 
#   geom_jitter() +
#   facet_wrap(~status)

```

### percent cover - by lifeform_status and lifeform_status_leaftype
```{r hist percent cover by lifeform and status}

cover_bylfstatus <- abcover_omitground %>% # total percent cover of shrubs_native
   group_by(year, site, transect, site_rep, lifeform_status) %>%
  dplyr::summarize(
    lfstatus_count_per_transect = n_distinct(site_rep_dist),
    lifeform_status_percentcover = n_distinct(site_rep_dist)/41 # <-- calculate percent cover by transect, lifeform, and status
    ) %>%  
    dplyr::select(!c(lfstatus_count_per_transect)) %>% 
  ungroup() 

# view(cover_bylfstatus)

join_cover <- cover_bylfstatus %>% 
   dplyr::select(site_rep, lifeform_status, lifeform_status_percentcover) %>%
  unite("join", 1:2, sep = "_")
  
cover_bylfstatusleaftype <- abcover_omitground %>% 
   group_by(year, site, transect, site_rep, lifeform_status, lifeform_status_leaftype) %>%
   dplyr::summarize(
    leaftype_count_per_transect = n_distinct(site_rep_dist),
    lifeform_status_leaftype_percentcover = n_distinct(site_rep_dist)/41
    ) %>%  
   dplyr::select(!c(leaftype_count_per_transect)) %>% 
  ungroup() %>% 
  mutate(join = paste(site_rep, lifeform_status, sep = "_")) %>% 
  left_join(join_cover, by = "join") %>% 
   dplyr::select(!c(join))

# view(cover_bylfstatusleaftype)
```

```{r view data - lifeform_status_leaftype_percentcover }

# hist(percentcover$lifeform_status_leaftype_percentcover) 
# 
# # jitter - all sites
# ggplot(data = percentcover,
#        aes(y = lifeform_status_leaftype_percentcover*100, x = site, color = lifeform_status)) +
#   geom_point() +
#   facet_wrap(~lifeform_status)
# # 
# # exclude INT transects
# ggplot(data = cover_bylfstatus %>% filter(site == "1" | site == "2"), 
#        aes(y = percentcover*100, x = site, color = lifeform_status)) +
#   geom_point() +
#   facet_wrap(~lifeform_status)
# 
# # only INT sites
# ggplot(data = cover_bylfstatus %>% filter(site == "INT1" | site == "INT2" | site == "INT3" | site == "INT4" | site == "INT5"),
#        aes(y = percentcover*100, x = site, color = lifeform_status)) +
#   geom_point() +
#   facet_wrap(~lifeform_status)

```

- Here I'm transposing the dataframes from long to wide  because I want to visualize native shrub by leaftype cover by non-native grass cover.
```{r transpose cover_bylfstatus}
cover_bylfstatus_wide <- cover_bylfstatus %>%
  dplyr::select(site, site_rep, lifeform_status, lifeform_status_percentcover) %>% 
   pivot_wider(names_from = lifeform_status, values_from = lifeform_status_percentcover) %>%
   replace_na(replace = list(grass_native = 0,  # Replace NA with 0 for each value column
                             grass_nonnative = 0,
                             forb_native = 0,
                             forb_nonnative = 0,
                             forb_unknown = 0,
                             shrub_native = 0,
                             fern_native = 0,
                             unknown_unknown = 0))
# view(cover_bylfstatus_wide)

cover_byleaftype_wide <- cover_bylfstatusleaftype %>% 
  dplyr::select(site, site_rep, lifeform_status_leaftype, lifeform_status_leaftype_percentcover) %>% 
  pivot_wider(names_from = lifeform_status_leaftype, values_from = lifeform_status_leaftype_percentcover) %>%
  replace_na(replace = list(fern_native_NA = 0,
                            unknown_unknown_NA = 0,
                            forb_native_NA = 0,
                            forb_nonnative_NA = 0,
                            forb_unknown_NA = 0,
                            shrub_native_dead_shrub = 0,
                            shrub_native_nonsclero = 0,
                            shrub_native_sclerophyllous = 0,
                            grass_native_NA = 0,
                            grass_nonnative_NA = 0))

# view(cover_byleaftype_wide)
```
 
# REGRESSIONS
This is the variation of...
### x = scl 
- y = non-native grass cover 
```{r}
ggplot(data = (cover_byleaftype_wide %>%  
                 filter(shrub_native_sclerophyllous > 0.01)
               ), 
       aes(x = shrub_native_sclerophyllous*100,
           y = grass_nonnative_NA*100
           )) + 
   geom_point(aes(color = site), size = 3) +
   scale_color_manual(values = c("blue", "maroon", "maroon", "maroon", "maroon", "maroon")) +
  geom_smooth(method = "lm", se = TRUE, color = "gray50", linetype = "solid") + # se = confidence interval 
  labs(
    x = "Schlerophylous shrub cover (%)",
    y = "Non-native grass cover (%)",
    title = "Linear regression of non-native grass by sclerophyllous shrub percent cover"
    ) +
scale_x_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 10)) + # Set x-axis limits and breaks
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 10)) + # Set y-axis limits and breaks
  theme_bw()


# Fit the linear model
model.s <- lm(grass_nonnative_NA ~ shrub_native_sclerophyllous, data = cover_byleaftype_wide %>%  
                 filter(shrub_native_sclerophyllous > 0.01)) # response variable ~ independent variable

# Print the summary of the model
model.s_summary <- summary(model.s)

# Extract the R^2 value
r_squared <- round(model.s_summary$r.squared, 3)
print(paste("Multiple R^2:", r_squared))
#  "Multiple R^2: 0.442"
```

### x = css
y = non-native grass cover 
```{r}
ggplot(data = (cover_byleaftype_wide %>%  
                 filter(shrub_native_nonsclero > 0.01)
               ), 
       aes( x = shrub_native_nonsclero*100, 
            y = grass_nonnative_NA*100)
       ) + 
   geom_point(aes(color = site), size = 3) +
   scale_color_manual(values = c("blue", "blue", "maroon", "maroon", "maroon", "maroon", "maroon")) +
  geom_smooth(method = "lm", se = TRUE, color = "gray50", linetype = "solid") + # se = confidence interval 
  labs(
    x = "Sage scrub cover (%)",
    y = "Non-native grass cover (%)",
    title = "Linear regression of non-native grass by sage scrub shrub percent cover"
    ) +
scale_x_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 10)) + # Set x-axis limits and breaks
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 10)) + # Set y-axis limits and breaks
  theme_bw()


# Fit the linear model <- for all sites
model.s <- lm(grass_nonnative_NA ~ shrub_native_nonsclero, # response variable ~ independent variable
              data = cover_byleaftype_wide %>%  
                 filter(shrub_native_nonsclero > 0.01))
# Print the summary of the model
model.s_summary <- summary(model.s)
# Extract the R^2 value
r_squared <- round(model.s_summary$r.squared, 3)
print(paste("Multiple R^2:", r_squared))
# [1] "Multiple R^2: 0.327" <-- all sites

# Fit the linear model <- for sites 1 and 2
model.s2 <- lm(grass_nonnative_NA ~ shrub_native_nonsclero, # response variable ~ independent variable
              data = cover_byleaftype_wide %>%  
                 filter(shrub_native_nonsclero > 0.01) %>% 
                filter(site == "1" | site == "2"))
model.s2_summary <- summary(model.s2)
r_squared_s2 <- round(model.s2_summary$r.squared, 3)
print(paste("Multiple R^2:", r_squared_s2))
# [1] "Multiple R^2: 0.684" <-- sites 1 and 2

ggplot(data = (cover_byleaftype_wide %>%  
                 filter(site == "1" | site == "2") %>% 
                 filter(shrub_native_nonsclero > 0.01) 
               ), 
       aes( x = shrub_native_nonsclero*100, 
            y = grass_nonnative_NA*100)
       ) + 
   geom_point(aes(color = site), size = 3) +
   scale_color_manual(values = c("maroon", "pink", "maroon", "maroon", "maroon")) +
  geom_smooth(method = "lm", se = TRUE, color = "gray50", linetype = "solid") + # se = confidence interval 
  labs(
    x = "Sage scrub cover (%)",
    y = "Non-native grass cover (%)",
    title = "Linear regression of non-native grass by sage scrub shrub percent cover"
    ) +
scale_x_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 10)) + # Set x-axis limits and breaks
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 10)) + # Set y-axis limits and breaks
  theme_bw()

##################

# Fit the linear model <- for sites INT1-5
model.s3 <- lm(grass_nonnative_NA ~ shrub_native_nonsclero, # response variable ~ independent variable
              data = (cover_byleaftype_wide %>%  
               filter(site != "1" & site != "2") %>% 
                 filter(shrub_native_nonsclero > 0.01)
              ))
model.s3_summary <- summary(model.s3)
r_squared_s3 <- round(model.s3_summary$r.squared, 3)
print(paste("Multiple R^2:", r_squared_s3))
# [1] "Multiple R^2: 0.693" <-- sites INT

ggplot(data = (cover_byleaftype_wide %>%  
                 filter(site != "1" & site != "2") %>% 
                 filter(shrub_native_nonsclero > 0.01) 
               ), 
       aes( x = shrub_native_nonsclero*100, 
            y = grass_nonnative_NA*100)
       ) + 
   geom_point(aes(color = site), size = 3) +
   scale_color_manual(values = c("maroon", "red", "cyan", "green", "blue")) +
  geom_smooth(method = "lm", se = TRUE, color = "gray50", linetype = "solid") + # se = confidence interval 
  labs(
    x = "Sage scrub cover (%)",
    y = "Non-native grass cover (%)",
    title = "Linear regression of non-native grass by sage scrub shrub percent cover"
    ) +
scale_x_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 10)) + # Set x-axis limits and breaks
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 10)) + # Set y-axis limits and breaks
  theme_bw()
```

### x = total shrub

- y = non-native forb cover
```{r}
############ non-native slope
# Fit the linear model
model.nnf <- lm(forb_nonnative ~ shrub_native, data = cover_bylfstatus_wide) # response variable ~ independent variable

# Print the summary of the model
model.nnf_summary <- summary(model.nnf)
# Extract the intercept, slope, and R^2 values
interceptnnf <- round(coef(model.nnf)[1], 2)
slopennf <- round(coef(model.nnf)[2], 2)
r_squarednnf <- round(model.nnf_summary$r.squared, 3)
print(paste("Multiple R^2:", r_squarednnf))
# [1] "Multiple R^2: 0.108"
# Create the label for the equation and R^2
eq_label_nnf <- paste0("Non-native forb: y = ", slopennf, "x + ", interceptnnf, "\n", "R² = ", r_squarednnf)


######### native forb slope
# Fit the linear model
model.nf <- lm(forb_native ~ shrub_native, data = cover_bylfstatus_wide) # response variable ~ independent variable
model.nf_summary <- summary(model.nf)
# Extract the intercept, slope, and R^2 values
interceptnf <- round(coef(model.nf)[1], 2)
slopenf <- round(coef(model.nf)[2], 2)
r_squarednf <- round(model.nf_summary$r.squared, 3)
print(paste("Multiple R^2:", r_squarednf))
# [1] "Multiple R^2: 0.002"
# Create the label for the equation and R^2
eq_label_nf <- paste0("Native forb: y = ", slopenf, "x + ", interceptnf, "\n", "R² = ", r_squarednf)

fig.1d <- ggplot(data = cover_bylfstatus_wide) + #%>%  filter(forb_native > 0.01 | forb_nonnative > 0.01 | forb_unknown > 0.01)) +
  geom_point(aes(x = shrub_native * 100, y = forb_native * 100, color = "forb_native"), show.legend = TRUE) +
  geom_smooth(aes(x = shrub_native * 100, y = forb_native * 100, color = "forb_native"), 
              method = "lm", se = TRUE, linetype = "solid", show.legend = TRUE) +
  geom_point(aes(x = shrub_native * 100, y = forb_nonnative * 100, color = "forb_nonnative"), show.legend = TRUE) +
  geom_smooth(aes(x = shrub_native * 100, y = forb_nonnative * 100, color = "forb_nonnative"), 
              method = "lm", se = TRUE, linetype = "dashed", show.legend = TRUE) +
  labs(
     # title = "Comparison of native and non-native forb percent cover by Nonnative Grass percent cover",
      color = "Status",
    x = "Native shrub cover (%)",
    y = "Forb cover (%)"
    ) +
  scale_color_manual(values = c("forb_native" = "blue", "forb_nonnative" = "red"),
                     labels = c("Native ", "Non-native")) +
  xlim(0, 100) +
  ylim(0, 100) +
  theme_bw() +
  annotate("text", x = 60, y = 95, label = eq_label_nnf, color = "black", size = 4, hjust = 0) +
  annotate("text", x = 60, y = 80
           , label = eq_label_nf, color = "black", size = 4, hjust = 0)

fig.1d
```

- y = native and non-native grass cover 
```{r}

############ non-native slope
# Fit the linear model
model.nng <- lm(grass_nonnative ~ shrub_native, data = cover_bylfstatus_wide) # response variable ~ independent variable

# Print the summary of the model
model.nng_summary <- summary(model.nng)
# Extract the intercept, slope, and R^2 values
interceptnng <- round(coef(model.nng)[1], 2)
slopenng <- round(coef(model.nng)[2], 2)
r_squarednng <- round(model.nng_summary$r.squared, 3)
print(paste("Multiple R^2:", r_squarednng))
# [1] "Multiple R^2: 0.734"
# Create the label for the equation and R^2
eq_label_nng <- paste0("Non-native grass: y = ", slopenng, "x + ", interceptnng, "\n", "R² = ", r_squarednng)

######### native grass slope
# Fit the linear model
model.ng <- lm(grass_native ~ shrub_native, data = cover_bylfstatus_wide) # response variable ~ independent variable
model.ng_summary <- summary(model.ng)
# Extract the intercept, slope, and R^2 values
interceptng <- round(coef(model.ng)[1], 2)
slopeng <- round(coef(model.ng)[2], 2)
r_squaredng <- round(model.ng_summary$r.squared, 3)
print(paste("Multiple R^2:", r_squaredng))
# [1] "Multiple R^2: 0.261"
# Create the label for the equation and R^2
eq_label_ng <- paste0("Native grass: y = ", slopeng, "x + ", interceptng, "\n", "R² = ", r_squaredng)

fig.1f <- ggplot(data = cover_bylfstatus_wide) + #%>%  filter(forb_native > 0.01 | forb_nonnative > 0.01 | forb_unknown > 0.01)) +
  geom_point(aes(x = shrub_native * 100, y = grass_native * 100, color = "grass_native"), show.legend = TRUE) +
  geom_smooth(aes(x = shrub_native * 100, y = grass_native * 100, color = "grass_native"), 
              method = "lm", se = TRUE, linetype = "solid", show.legend = TRUE) +
  geom_point(aes(x = shrub_native * 100, y = grass_nonnative * 100, color = "grass_nonnative"), show.legend = TRUE) +
  geom_smooth(aes(x = shrub_native * 100, y = grass_nonnative * 100, color = "grass_nonnative"), 
              method = "lm", se = TRUE, linetype = "dashed", show.legend = TRUE) +
  labs(
     # title = "Comparison of native and non-native forb percent cover by Nonnative Grass percent cover",
      color = "Status",
    x = "Native shrub cover (%)",
    y = "Grass cover (%)"
    ) +
  scale_color_manual(values = c("grass_native" = "blue", "grass_nonnative" = "red"),
                     labels = c("Native ", "Non-native")) +
  xlim(0, 100) +
  ylim(0, 100) +
  theme_bw() +
  annotate("text", x = 0, y = 40, label = eq_label_nng, color = "black", size = 4, hjust = 0) +
  annotate("text", x = 0, y = 25, label = eq_label_ng, color = "black", size = 4, hjust = 0)

fig.1f
```

- y = non-native grass cover 
```{r}

ggplot(data = (cover_bylfstatus_wide), 
       aes(x = shrub_native*100,
           y = grass_nonnative*100
           )) + 
   geom_point(aes(color = site), size = 3) +
  scale_color_manual(values = c("blue", "blue", "maroon", "maroon", "maroon", "maroon", "maroon")) +
  geom_smooth(method = "lm", se = TRUE, color = "gray50", linetype = "solid") + # se = confidence interval 
  labs(
    x = "Native shrub cover (%)",
    y = "Non-native grass cover (%)",
   # title = "Linear regression of non-native grass by sclerophyllous shrub percent cover"
   color = "Site"
    ) +
scale_x_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 10)) + # Set x-axis limits and breaks
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 10)) + # Set y-axis limits and breaks
  theme_bw() +
   annotate("text", x = 0, y = 5, label = eq_label_nng, color = "black", size = 4, hjust = 0) 

```


- y = shrub cover by leaftype
```{r}
ggplot(data = (cover_bylfstatusleaftype %>%  
                 filter(lifeform_status == "shrub_native") %>% 
              mutate(site = case_when(
                           site %in% c("INT1", "INT2", "INT3", "INT4", "INT5") ~ "INT",
                           TRUE ~ site)
                        )
               ), 
       aes(y = lifeform_status_leaftype_percentcover*100, 
           x = lifeform_status_percentcover*100)) + 
   # geom_point(aes(color = site), size = 3) +
   # scale_color_manual(values = c("blue", "green", "maroon", "maroon", "maroon", "maroon", "maroon")) +
   
  geom_point(aes(color = lifeform_status_leaftype), size = 3) +
   scale_color_manual(values = c("black", "gray", "green")) +
   
   scale_shape_manual(values = c(4, 1, 16)) +
  
 # geom_smooth(method = "lm", se = TRUE, color = "gray50", linetype = "solid") + # se = confidence interval 
  labs(
    x = "Total shrub cover (%)",
    y = "Shrub cover by leaf type (%)",
    title = "Total shrub cover as a product of dead, non-scl, or scl shrubs"
    ) +
scale_x_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 10)) + # Set x-axis limits and breaks
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 10)) + # Set y-axis limits and breaks
  theme_bw() +
  geom_abline(intercept = 0, slope = 1) +
  facet_wrap(~site) # lifeform_status_leaftype

```


### x = nn grass

- scl shrub cover by nn grass
```{r regression nngrass x scl shrub}
 ggplot(data = cover_byleaftype_wide %>%  filter(shrub_native_sclerophyllous > 0.01), 
       aes(x = grass_nonnative_NA*100, 
         y = shrub_native_sclerophyllous*100)) + 
  # geom_point()+
     geom_point(aes(color = site), size = 3) +
     scale_color_manual(values = c("blue", "maroon", "maroon", "maroon", "maroon", "maroon")) +
  geom_smooth(method = "lm", se = TRUE, color = "gray50", linetype = "solid") + # se = confidence interval 
  labs(
    x = "Non-native grass cover (%)",
    y = "Native scl shrub cover (%)",
    title = "Linear regression of  scl shrub cover by non-native grass cover"
    ) +
  scale_x_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 10)) + # Set x-axis limits and breaks
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 10)) + # Set y-axis limits and breaks
  theme_bw()

# Fit the linear model
model.s <- lm(shrub_native_sclerophyllous ~ grass_nonnative_NA, data = cover_byleaftype_wide %>% filter(shrub_native_sclerophyllous > 0.01)) # response variable ~ independent variable

# print slope and intercept
cf <- round(coef(model.s), 3)
cat("Intercept:", cf[1], "\n")
cat("Slope:", cf[2], "\n")
# cf <- coef(model.s).   # <-- old code
# Intercept <- cf$(Intercept)
# Slope <- cf[2]
# Intercept <- round(Intercept, 3)
# Slope <- round(Slope, 3)
# print(paste("Intercept:", Intercept))
# print(paste("Slope:", Slope))


# Print the summary of the model
model.s_summary <- summary(model.s)
cat("Multiple R^2:", round(summary(model.s)$r.squared, 3), "\n")
# # Extract the R^2 value
# r_squared <- round(model.s_summary$r.squared, 3)   # <- old code
# print(paste("Multiple R^2:", r_squared))
# [1] "Multiple R^2: 0.442"
```

- y = sage scrub cover

```{r}
ggplot(data = cover_byleaftype_wide %>%  
         filter(shrub_native_nonsclero > 0.01) %>% 
         filter(site == "1" | site == "2"), 
       aes(x = grass_nonnative_NA*100, 
         y = shrub_native_nonsclero*100)) + 
      geom_point(aes(color = site), size = 3) +
   scale_color_manual(values = c("blue", "blue", "maroon", "maroon", "maroon", "maroon", "maroon")) +
  geom_smooth(method = "lm", se = TRUE, color = "gray50", linetype = "solid") + # se = confidence interval 
  labs(
    x = "Non-native grass cover (%)",
    y = "Non-scl shrub cover (%)",
    title = "Linear regression of  non-scl shrub cover by non-native grass cover"
    ) +
  scale_x_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 10)) + # Set x-axis limits and breaks
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 10)) + # Set y-axis limits and breaks
  theme_bw()

# Fit the linear model
model.s <- lm(shrub_native_nonsclero ~ grass_nonnative_NA, # response variable ~ independent variable
              data = cover_byleaftype_wide %>% 
                filter(shrub_native_nonsclero > 0.01) %>% 
                filter(site == "1" | site == "2")
              )

# Print the summary of the model
model.s_summary <- summary(model.s)

# Extract the R^2 value
r_squared <- round(model.s_summary$r.squared, 3)
print(paste("Multiple R^2:", r_squared))
# [1] "Multiple R^2: 0.327" <-- all sites
# [1] "Multiple R^2: 0.684" <-- sites 1 and 2
```

- y = total shrub cover
```{r}
# Fit the linear model
model.s <- lm(grass_nonnative ~ shrub_native, data = cover_bylfstatus_wide) # response variable ~ independent variable

# Print the summary of the model
model.s_summary <- summary(model.s)
intercept <- round(coef(model.s)[1], 2)
slope <- round(coef(model.s)[2], 2)
# Extract the R^2 value
r_squared <- round(model.s_summary$r.squared, 3)
print(paste("Multiple R^2:", r_squared))
# [1] "Multiple R^2: 0.734"


# adjusted_r_squared <- round(model.s_summary$adj.r.squared, 3)
# print(paste("Adjusted R^2:", adjusted_r_squared))

# Multiple R-squared = variance in the dependent variable that is predictable from the independent variables.  It indicates how well the independent variables explain the variation in the dependent variable. 

# Adjusted R-squared = adjusts for the number of predictors in the model.  It provides a more accurate measure when comparing models with a different number of predictors.

# Create the label for the equation and R^2
eq_label <- paste0("y = ", slope, "x + ", intercept, "\n", "R² = ", r_squared)

fig.1a <- ggplot(data = cover_bylfstatus_wide,
       aes(x = grass_nonnative*100, 
         y = shrub_native*100)) + 
      geom_point(aes(color = site), size = 3) +
   scale_color_manual(values = c("blue", "blue", "maroon", "maroon", "maroon", "maroon", "maroon")) +
  geom_smooth(method = "lm", se = TRUE, color = "gray50", linetype = "solid") + # se = confidence interval 
  labs(
    #  title = "Linear regression of  total shrub cover by non-native grass cover",
    x = "Non-native grass cover (%)",
    y = "Total shrub cover (%)", 
     color = "Site"
    ) +
  scale_x_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 10)) + # Set x-axis limits and breaks
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 10)) + # Set y-axis limits and breaks
  theme_bw() + 
  annotate("text", x = 5, y = 5, label = eq_label, color = "black", size = 4, hjust = 0)
  
fig.1a
```


- y = native shrub cover by leaf type
```{r regression shrub leaftype x nn grass}

# broken code


# ggplot(data = cover_byleaftype_wide) +
#   
#   geom_point(aes(x = nonnative_grass_NA * 100, y = native_shrub_nonsclero * 100, color = "Native Shrub Nonsclero"), size = 4, show.legend = TRUE) +
#   geom_smooth(aes(x = nonnative_grass_NA * 100, y = native_shrub_nonsclero * 100, color = "Native Shrub Nonsclero"), 
#               method = "lm", se = TRUE, linetype = "solid", show.legend = TRUE) +
#   
#   geom_point(aes(x = nonnative_grass_NA * 100, y = native_shrub_sclerophyllous * 100, color = "Native Shrub Sclero"), size = 4,  show.legend = TRUE) +
#   geom_smooth(aes(x = nonnative_grass_NA * 100, y = native_shrub_sclerophyllous * 100, color = "Native Shrub Sclero"), 
#               method = "lm", se = TRUE, linetype = "dashed", show.legend = TRUE) +
#   labs(
#     x = "Percent cover non-native grass (%)",
#     y = "Percent cover native Shrub (%)",
#     title = "Comparison of Native Shrub percent cover by Nonnative Grass percent cover",
#     color = "Legend"
#     ) +
#   scale_color_manual(values = c("Native Shrub Nonsclero" = "blue", "Native Shrub Sclero" = "red"),
#                      labels = c("Non-sclerophyllous", "Sclerophyllous")) +
#   xlim(0, 100) +
#   ylim(0, 100) +
#   theme_bw()

#only six transects had schlero shrubs present: INT 1-5, Site1 transect 4
#cover_byleaftype_wide %>% filter(native_shrub_sclerophyllous > 0) %>% group_by(site_rep, year) %>%  summarize(native_shrub_sclerophyllous = native_shrub_sclerophyllous)

# model.nonscl <- lm(native_shrub_nonsclero ~ nonnative_grass_NA, data = cover_byleaftype_wide)
# model.nonscl_summary <- summary(model.nonscl)
# r_squared <- round(model.nonscl_summary$r.squared, 3)
# print(paste("Multiple R^2:", r_squared))
# 
# model.scl <- lm(native_shrub_sclerophyllous ~ nonnative_grass_NA, data = cover_byleaftype_wide)
# model.scl_summary <- summary(model.scl)
# r_squared <- round(model.scl_summary$r.squared, 3)
# print(paste("Multiple R^2:", r_squared))
```

- y = native and non-native forb cover
```{r regression forb x grass}
############ non-native slope
# Fit the linear model
model.nnf <- lm(forb_nonnative ~ grass_nonnative, data = cover_bylfstatus_wide) # response variable ~ independent variable

# Print the summary of the model
model.nnf_summary <- summary(model.nnf)
# Extract the intercept, slope, and R^2 values
interceptnnf <- round(coef(model.nnf)[1], 2)
slopennf <- round(coef(model.nnf)[2], 2)
r_squarednnf <- round(model.nnf_summary$r.squared, 3)
print(paste("Multiple R^2:", r_squarednnf))
# [1] "Multiple R^2: 0.097"
# Create the label for the equation and R^2
eq_label_nnf <- paste0("Non-native forb: y = ", slopennf, "x + ", interceptnnf, "\n", "R² = ", r_squarednnf)


######### native forb slope
# Fit the linear model
model.nf <- lm(forb_native ~ grass_nonnative, data = cover_bylfstatus_wide) # response variable ~ independent variable
model.nf_summary <- summary(model.nf)
# Extract the intercept, slope, and R^2 values
interceptnf <- round(coef(model.nf)[1], 2)
slopenf <- round(coef(model.nf)[2], 2)
r_squarednf <- round(model.nf_summary$r.squared, 3)
print(paste("Multiple R^2:", r_squarednf))
# [1] "Multiple R^2: 0.01"
# Create the label for the equation and R^2
eq_label_nf <- paste0("Native forb: y = ", slopenf, "x + ", interceptnf, "\n", "R² = ", r_squarednf)

fig.1c <- ggplot(data = cover_bylfstatus_wide) + #%>%  filter(forb_native > 0.01 | forb_nonnative > 0.01 | forb_unknown > 0.01)) +
  geom_point(aes(x = grass_nonnative * 100, y = forb_native * 100, color = "forb_native"), show.legend = TRUE) +
  geom_smooth(aes(x = grass_nonnative * 100, y = forb_native * 100, color = "forb_native"), 
              method = "lm", se = TRUE, linetype = "solid", show.legend = TRUE) +
  geom_point(aes(x = grass_nonnative * 100, y = forb_nonnative * 100, color = "forb_nonnative"), show.legend = TRUE) +
  geom_smooth(aes(x = grass_nonnative * 100, y = forb_nonnative * 100, color = "forb_nonnative"), 
              method = "lm", se = TRUE, linetype = "dashed", show.legend = TRUE) +
  labs(
     # title = "Comparison of native and non-native forb percent cover by Nonnative Grass percent cover",
      color = "Status",
    x = "Non-native grass cvoer (%)",
    y = "Forb cover (%)"
    ) +
  scale_color_manual(values = c("forb_native" = "blue", "forb_nonnative" = "red"),
                     labels = c("Native ", "Non-native")) +
  xlim(0, 100) +
  ylim(0, 100) +
  theme_bw() +
  annotate("text", x = 0, y = 95, label = eq_label_nnf, color = "black", size = 4, hjust = 0) +
  annotate("text", x = 0, y = 80
           , label = eq_label_nf, color = "black", size = 4, hjust = 0)

fig.1c
```

- y = native grass
```{r regression grass x grass}

# Fit the linear model
model.g <- lm(grass_native ~ grass_nonnative, data = cover_bylfstatus_wide) # response variable ~ independent variable
model.g_summary <- summary(model.g)
# Extract the intercept, slope, and R^2 values
interceptg <- round(coef(model.g)[1], 2)
slopeg <- round(coef(model.g)[2], 2)
r_squaredg <- round(model.g_summary$r.squared, 3)
print(paste("Multiple R^2:", r_squaredg))
# [1] "Multiple R^2: 0.497"
# Create the label for the equation and R^2
eq_label_g <- paste0("y = ", slopeg, "x + ", interceptg, "\n", "R² = ", r_squaredg)

fig.1e <- ggplot(data = cover_bylfstatus_wide) +
  geom_point(aes(x = grass_nonnative * 100, y = grass_native * 100, color = "grass_native"), show.legend = TRUE) +
  geom_smooth(aes(x = grass_nonnative * 100, y = grass_native * 100, color = "grass_native"), 
              method = "lm", se = TRUE, linetype = "solid", show.legend = TRUE) +
  labs(
    x = "Non-native grass cover (%)",
    y = "Native grass cover (%)",
    #title = "Comparison of Native grass percent cover by Nonnative Grass percent cover",
    color = "Legend"
    ) +
  scale_color_manual(values = c("grass_native" = "blue"),
                     labels = c("Native ", "Non-native")) +
  xlim(0, 100) +
  ylim(0, 100) +
  theme_bw() + 
 annotate("text", x = 0, y = 95, label = eq_label_g, color = "black", size = 4, hjust = 0) 
 
#14 transecrs have native grass present - mostly at Site 1 and at INT transects
#cover_bylfstatus_wide %>% filter(grass_native > 0) %>% group_by(site_rep, year) %>%  summarize(native_grass = grass_native)

fig.1e
```


### Figure 1 - cover regressions
```{r}

# Save the plot to a PDF file with specified size
pdf("fig.cover_regression.pdf", width = 8, height = 10)  # 8x10 inches (portrait size)

# Add labels to the plots using cowplot's draw_label() function
fig.1a_labeled <- ggdraw(fig.1a) + draw_label("A", x = 0.85, y = 0.92, size = 15)  # Add letter "A" in the top-right corner
fig.1c_labeled <- ggdraw(fig.1c) + draw_label("B", x = 0.85, y = 0.92, size = 15)  # Add letter "B"
fig.1d_labeled <- ggdraw(fig.1d) + draw_label("D", x = 0.85, y = 0.92, size = 15)  # Add letter "C"
fig.1e_labeled <- ggdraw(fig.1e) + draw_label("C", x = 0.85, y = 0.92, size = 15)  # Add letter "D"
fig.1f_labeled <- ggdraw(fig.1f) + draw_label("E", x = 0.85, y = 0.92, size = 15)  # Add letter "E"

# Combine the plots in a 2x3 layout
grid.arrange(fig.1a_labeled, NULL,
             fig.1c_labeled, fig.1d_labeled, 
             fig.1e_labeled, fig.1f_labeled,
             nrow = 3, 
             ncol = 2, 
             widths = c(1, 1), # Custom widths for each column
             heights = c(1, 1, 1) # Custom heights for each row
             ) 


dev.off()  # Close the PDF device
```



### canopy height
```{r}
# stand height 

standheight <- read_csv("deg_maxheight.csv",
                             col_types = cols(
                               year = col_character(),
                               site = col_character(),
                               rep = col_character(),
                               distance = col_character(),
                               species = col_character(),
                               height_cm = col_double()
                               )) %>%
  dplyr::select('site', 'rep', 'species', 'height_cm') %>% 
  # mutate(rep = case_when(rep == "1" ~ "01", # oldname ~ newname
  #                        rep == "2" ~ "02",
  #                        rep == "3" ~ "03",
  #                        rep == "4" ~ "04",
  #                        rep == "5" ~ "05",
  #                        rep == "6" ~ "06",
  #                        rep == "7" ~ "07",
  #                        rep == "8" ~ "08",
  #                        rep == "9" ~ "09",
  #                             TRUE ~ rep)) %>% 
  mutate(site_rep = paste(site, rep, sep = "_")) %>% 
  group_by(site_rep) %>% 
  summarise(avgheight_cm = mean(height_cm, na.rm = TRUE)) %>% 
  ungroup() 
  

height_cover <- cover_bylfstatus_wide %>% left_join(standheight, by = "site_rep")


# Fit the linear model: canopy height x nn grass cover
model.h <- lm(avgheight_cm ~ grass_nonnative, data = height_cover) # response variable ~ independent variable

# Print the summary of the model
model.h.summary <- summary(model.h)

# Extract the intercept, slope, and R^2 values
intercept <- round(coef(model.h)[1], 2)
slope <- round(coef(model.h)[2], 2)
r_squared <- round(model.h.summary$r.squared, 3)
print(paste("Multiple R^2:", r_squared))
# [1] "Multiple R^2: 0.365"
# print slope and intercept
cf <- round(coef(model.h), 3)
cat("Intercept:", cf[1], "\n")
cat("Slope:", cf[2], "\n")
# > cat("Intercept:", cf[1], "\n")
# Intercept: 164.522 
# > cat("Slope:", cf[2], "\n")
# Slope: -93.231 

intercepth <- round(coef(model.h)[1], 2)
slopeh <- round(coef(model.h)[2], 2)

# Create the label for the equation and R^2
eq_label_h <- paste0("y = ", slopeh, "x + ", intercepth, "\n", "R² = ", r_squared)

ggplot(data = height_cover) + 
  geom_point(aes(x = grass_nonnative * 100, 
                 y = avgheight_cm)) +
    xlim(0, 100) +
  ylim(0, 300) +
  labs(
    x = "Non-native grass (%)",
    y = "Average stand height (cm)",
  #  title = "Mean stand height by Nonnative Grass percent cover",
     color = "Legend") +
   # scale_y_continuous(breaks = seq(0, max(300), by = 50)) +
  geom_smooth(aes(x = grass_nonnative * 100, 
                  y = avgheight_cm), 
              method = "lm", se = TRUE, linetype = "solid", show.legend = TRUE) +
  theme_bw() + 
   annotate("text", x = 0, y = 15, label = eq_label_h, color = "black", size = 4, hjust = 0) 

# (linear regression: y = -93.23x + 164.52; R² = 0.365) 
```


### shrub density

```{r}

###################### shrub density - native


######## 2019 
shrubdensitylife_load <- read_csv("deg_beltdensity_bylifestage.csv", 
    col_types = cols(
       site = col_character(),
      transect = col_character(), 
      species = col_character(), 
      dead = col_integer(),
      immature = col_integer(),
      mature = col_integer(), 
      resprout = col_integer(), 
      seedling = col_integer()
      )
     ) %>% 
  mutate(transect = ifelse(
    site == "INT2", "1", transect
  )) %>% 
   mutate(transect = ifelse(
    site == "INT3", "1", transect
  )) %>% 
  dplyr::select(-StandType, -hillslope) %>% 
  as_tibble() %>% 
  rename("rep" = "transect") %>% 
  pivot_longer(cols = 4:8, names_to = "lifestage", values_to = "density_80m2") %>% 
  mutate(site_rep = paste(site, rep, sep = "_")) %>% 
   mutate(density_m2 = (density_80m2 / 80)) %>% 
  dplyr::select(-site, -rep, -density_80m2) %>% 
  mutate(lifestage = case_when(lifestage == "resprout" ~ "immature", 
                               TRUE ~ lifestage)) %>% 
   mutate(species = case_when(species == "Cenothus oliganthus" ~ "Ceanothus oliganthus", 
                               TRUE ~ species))


######## 2024   
shrubdensity_2024 <- read_csv("shrubdensity_2024.csv", 
      col_types = cols(
      site = col_character(),
      transect = col_character(), 
      species = col_character(), 
      lifestage = col_character(),
      density_80m2 = col_integer()
      )
      ) %>% 
  dplyr::select(site, transect, species, lifestage, density_80m2) %>% 
  rename("rep" = "transect") %>% 
  mutate(density_m2 = (density_80m2 / 80)) %>% 
 na.omit() %>% 
  mutate(site_rep = paste(site, rep, sep = "_")) %>% 
  dplyr::select(site_rep, species, lifestage, density_m2) %>% 
   mutate(lifestage = case_when(lifestage == "resprout" ~ "immature", 
                               TRUE ~ lifestage))


########## bind with shrub species
denspp  <- shrubdensitylife_load  %>% 
  bind_rows(shrubdensity_2024)
denspp_cover <- height_cover %>%  # left join nn grass cover
  dplyr::select(site, site_rep, grass_nonnative) %>% 
  left_join(denspp, by = "site_rep") %>% 
  filter(site_rep != "INT4_1") %>% # omit INT4_1
  left_join(shrub_leaftype, by = "species") %>% 
  mutate(lifestage = factor(lifestage, levels = c("seedling", "immature", "mature", "dead")))


##### bind WITHspecies##### bind WITHOUT shrub species
density2019 <- shrubdensitylife_load %>% # group shrub density by lifestage
  group_by(site_rep, lifestage) %>% 
  summarise(sum_density_m2 = sum(density_m2)) # 75 rows
density2024 <- shrubdensity_2024 %>%  
  group_by(site_rep, lifestage) %>% 
  summarise(sum_density_m2 = sum(density_m2)) # 104 rows
density <- density2019 %>%  
  bind_rows(density2024) # 179 rows
density_cover <- height_cover %>%  # left join nn grass cover
  dplyr::select(site, site_rep, grass_nonnative) %>% 
  left_join(density, by = "site_rep") %>% 
  filter(site_rep != "INT4_1") # omit INT4_1


```

```{r}

######################## shrub density - linear models

hist(density_cover$sum_density_m2)
shapiro.test(density_cover$sum_density_m2) # not normal

# test residuals
plot(model.seedling)

qqnorm(residuals(model.seedling)) # run together
qqline(residuals(model.seedling))



##################### seedling
# Fit the linear model: canopy height x nn grass cover
# a GLM is better for count data - negative binomial distribution
model.seedling <- glm.nb(sum_density_m2 ~ grass_nonnative, 
   data = density_cover %>% filter(lifestage == "seedling")) # response variable ~ independent variable
# AIC: 49.263 - AIC: 150.4 when I ran glm.nb(sum_density_m2 ~ grass_nonnative + lifestage)

# Print the summary of the model
model.seedling.summary <- summary(model.seedling)
# Summary of Fit:
# Pseudo R²: Offers insight into explained variance.
# AIC: Useful for comparing models.
# Residual Deviance: Should be close to degrees of freedom, which in your case, it is.
# Significance of predictors: Your predictor (grass_nonnative) is significant, indicating a strong relationship.
null_model <- glm.nb(sum_density_m2 ~ 1, data = density_cover %>% filter(lifestage == "seedling"))
pseudo_r2 <- 1 - (logLik(model.seedling) / logLik(null_model))
round(pseudo_r2, 3) # 'log Lik.' 0.1976203 (df=3)

model.seedling <- glm.nb(sum_density_m2 ~ grass_nonnative, 
   data = density_cover %>% filter(lifestage == "seedling"))
# Residual deviance: 24.132  on 33  degrees of freedom
# AIC: 47.985

##################### mature
model.mature <- glm.nb(sum_density_m2 ~ grass_nonnative, 
   data = density_cover %>% filter(lifestage == "mature"))
model.mature.summary <- summary(model.mature)
null_model2 <- glm.nb(sum_density_m2 ~ 1, data = density_cover %>% filter(lifestage == "mature"))
pseudo2_r2 <- 1 - (logLik(model.seedling) / logLik(null_model2))
round(pseudo2_r2, 3) # 'log Lik.' 0.045 (df=3)



ggplot(data = density_cover %>% filter(lifestage == "mature")
       ) + 
  geom_point(aes(x = grass_nonnative * 100, 
                 y = sum_density_m2))

ggplot(data = density_cover) + 
  geom_point(aes(x = grass_nonnative * 100, 
                 y = sum_density_m2)) +
 facet_wrap(~lifestage)
```


```{r}
################# density figures

ggplot(data = density_cover %>% filter(sum_density_m2 > 0)) + 
  geom_point(aes(x = grass_nonnative * 100, 
                 y = sum_density_m2), 
             size = 3) +
  theme_bw() 

plot_denspp <- ggplot(data = denspp_cover %>% 
         filter(density_m2 > 0) %>% 
         filter(species != "unknown5 shrub") %>% 
         filter(leaftype == "nonsclero"), 
       aes(color = species, shape = site)) + 
  geom_point(aes(x = grass_nonnative * 100, 
                 y = density_m2), 
             size = 3) +
   scale_color_manual(values = c("darkolivegreen3", "green", "dodgerblue", "plum", "orange3", "pink", "purple", "purple4", "blue")) +
  theme_bw() +
  facet_grid(~ lifestage) +
  ylim(0,3)
plot_denspp

plot_denspp_scl <- ggplot(data = denspp_cover %>% 
         filter(density_m2 > 0) %>% 
         filter(species != "unknown5 shrub") %>% 
         filter(leaftype == "sclerophyllous"), 
       aes(color = species)) + 
  geom_point(aes(x = grass_nonnative * 100, 
                 y = density_m2), 
             size = 3) +
   scale_color_manual(values = c("dodgerblue", "darkolivegreen", "green", "red", "orchid")) +
  theme_bw() +
  facet_grid(~ lifestage) +
  ylim(0,3)
plot_denspp_scl

# Combine plots
grid.arrange(plot_denspp, 
             plot_denspp_scl,
             nrow = 2, 
             ncol = 1, 
             widths = c(1), # Custom widths for each column
             heights = c(1, 1) # Custom heights for each row
             ) 


```
