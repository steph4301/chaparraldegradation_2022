---
title: "ch1_standdeg_seedbank"
author: "Stephanie Ma Lucero"
date: "2023-12-21"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r install libraries, include=TRUE}
library(here) # similar to set working directory
library(tidyverse) # data wrangling - includes ggplot2, dplyr, tidyr, readr, purr, tibble, stringr, forcats
library(ggplot2) # data visualization
library(dplyr)
library(ggthemes)
library(plotly)
library(ggpubr) # customize ggplot2 for publication
library(vegan) #community ecology package - includes, MASS, cluster, mgcv
library(readxl) # for .xls and .xlsx sheets
library(multcompView) #Visualizations of Paired Comparisons, functions: TukeyHSD, dist{stats}, simint, simtest, csimint, csimtest{multcomp}, friedmanmc, kruskalmc{pgirmess}
library(skimr)
```

# Load data

```{r load seedbank data, include=TRUE}

# STAND COMPARISONS BY SEEDBANK SPECIES RICHNESS AND GERMINATION COUNTS - OMIT Zeros
# 1. species richness - use "species_richness" column 
# 2. native species richness - filter status == "native"
# 3. germination abundance - "genus_abundance" column and "count" column
# 4. germination of fire followers - ask Rob how he would select for not present in CK but present in treated tray.

#seedbank_load_raw <- read.csv("deg_seedbank_20231007.csv", header = TRUE, na.strings=c("","NA"))
#seedbank_load_slice <- seedbank_load_raw %>% slice(1:2127) 

germination_m2_load <- read_xlsx("processed/germination_m2.xlsx")
glimpse(germination_m2_load)

seedbank <- germination_m2_load %>%
  mutate(site = fct_relevel(site, 
            "INT1", "INT2", "INT3","ENH1", "ENH2", "DEG1", "DEG2")) %>% 
  mutate(treatment = fct_relevel(treatment, 
                                 "control", "charate", "oven", "ovenchar")) %>% 
  dplyr::select(c(stand, site, soilcore, depth_name, subsample_cm3, subsample_g,treatment, rep, species_diversity, genus_abundance, lifeform, status, lifescycle, family, count, stand_core, stand_core_depth, stand_core_depth_treat, n_per_cm3, n_per_m3, n_per_g, n_per_kg))

#glimpse(seedbank)

seedbank <- seedbank %>%
  mutate(#year = as.character(year),
                                stand = as.character(stand), 
                                site = as.character(site),
                                soilcore = as.character(soilcore), 
                                depth_name = as.character(depth_name),
                                treatment = as.character(treatment), 
                                rep = as.integer(rep),                        
                                species_diversity = as.character(species_diversity), 
                                genus_abundance = as.character(genus_abundance), 
                                lifeform = as.character(lifeform), 
                                status = as.character(status), 
                                lifescycle = as.character(lifescycle), 
                                family = as.character(family),
                                count = as.integer(count)
                              ) %>%
  mutate(stand = fct_relevel(stand, 
            "intact", "enhanced", "degraded")) %>% 
  mutate(treatment = fct_relevel(treatment, 
                                 "control", "charate", "oven", "ovenchar"))
  # #mutate(stand = fct_recode(stand, 
  #                               "shrub_dominated" = "intact", # rename stand types
  #                               "matrix" = "enhanced",
  #                               "grass_dominated" = "degraded"))

seedbank <- seedbank %>% 
  mutate(stand_core = fct_relevel(stand_core, 
                                  "INT1_1", "INT1_2" , "INT1_3" ,"INT2_4"  ,"INT2_5" , "INT2_6",  "INT3_7" , "INT3_8" , "INT3_9",
                                  "ENH1_1" , "ENH1_2" , "ENH1_3" , "ENH1_4" , "ENH1_5" , "ENH2_6" , "ENH2_7" , "ENH2_8"  ,"ENH2_9"  ,"ENH2_10", 
                                 "DEG1_1" , "DEG1_2"  ,"DEG1_3"  ,"DEG1_4" , "DEG2_5" , "DEG2_6" , "DEG2_7" ))  %>% 
  mutate(site = fct_relevel(site, "INT1", "INT2", "INT3", "ENH1", "ENH2", "DEG1", "DEG2"))


seedbank$stand_core_treat <- paste(seedbank$stand_core, seedbank$treatment, sep="_") 


unique(seedbank$stand)
unique(seedbank$site)
unique(seedbank$soilcore)
unique(seedbank$depth_name)
unique(seedbank$treatment)
sort(unique(seedbank$species_diversity))
length(unique(seedbank$species_diversity)) #65 unique species
unique(seedbank$status)
unique(seedbank$stand_core_depth)
unique(seedbank$stand_core_treat) # wrap by treatment instead of ordering

```

# List species diversity
```{r}
native_seedbank <- seedbank %>% 
  filter(status == "native")
sort(unique(native_seedbank$species_diversity)) # 47 species
sort(unique(native_seedbank$family)) # 22 families

nonnative_seedbank <- seedbank %>% 
  filter(status == "nonnative")
sort(unique(nonnative_seedbank$species_diversity)) #17 species
sort(unique(nonnative_seedbank$family)) # 6 families

unknown_seedbank <- seedbank %>% 
  filter(status == "unknown")
sort(unique(unknown_seedbank$species_diversity)) # 1 species
```

# List shrub germination by hillslope
```{r}
shrub_seedbank <- seedbank %>% 
  filter(lifeform == "shrub")
sort(unique(shrub_seedbank$species_diversity)) # 10 species
sort(unique(shrub_seedbank$family)) 
length(unique(shrub_seedbank$family)) # 7 families
```


# Explore seedbank data by germination (#seeds/g sieved soil)
```{r group germination by tray}
# total number of germinates per tray


germ_tray_prep <- seedbank %>% 
  group_by(site, soilcore, stand_core, depth_name, stand_core_depth_treat, subsample_g) %>% 
  summarize(germination_n = sum(count))

germ_tray <- germ_tray_prep %>% 
            summarize(seeds_per_g = (germination_n/subsample_g))

dim(germ_tray)
# 104 rows = (7 DEG + 10 ENH + 9 INT) * 4 treatments

#view(germ_tray)

```

```{r}
plot(data = germ_tray, n_per_g ~ subsample_g)
boxplot(seedbank$n_per_g)
histogram(seedbank$n_per_g)
```

