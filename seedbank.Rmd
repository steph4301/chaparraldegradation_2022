---
title: "ch1_standdeg_seedbank"
author: "Stephanie Ma Lucero"
date: "2023-12-21"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r install libraries, include=TRUE}
library(here) # similar to set working directory
library(tidyverse) # data wrangling - includes ggplot2, dplyr, tidyr, readr, purr, tibble, stringr, forcats
library(ggplot2) # data visualization
library(dplyr)
library(ggthemes)
library(plotly)
library(ggpubr) # customize ggplot2 for publication
library(vegan) #community ecology package - includes, MASS, cluster, mgcv
library(readxl) # for .xls and .xlsx sheets
library(multcompView) #Visualizations of Paired Comparisons, functions: TukeyHSD, dist{stats}, simint, simtest, csimint, csimtest{multcomp}, friedmanmc, kruskalmc{pgirmess}
library(skimr)
#library(mass)
library(ggpmisc)
library(segmented)
```

# Load data

```{r load seedbank data, include=TRUE}

# STAND COMPARISONS BY SEEDBANK SPECIES RICHNESS AND GERMINATION COUNTS - OMIT Zeros
# 1. species richness - use "species_richness" column 
# 2. native species richness - filter status == "native"
# 3. germination abundance - "genus_abundance" column and "count" column
# 4. germination of fire followers - ask Rob how he would select for not present in CK but present in treated tray.

#seedbank_load_raw <- read.csv("deg_seedbank_20231007.csv", header = TRUE, na.strings=c("","NA"))
#seedbank_load_slice <- seedbank_load_raw %>% slice(1:2127) 

germination_m2_load <- read_xlsx("processed/germination_m2.xlsx")
glimpse(germination_m2_load)

average_cover <- read.csv("nat_nn_cover.csv", header = TRUE, na.strings=c("","NA"))

seedbank <- germination_m2_load %>%
  mutate(site = fct_relevel(site, 
            "INT1", "INT2", "INT3","ENH1", "ENH2", "DEG1", "DEG2")) %>% 
  mutate(treatment = fct_relevel(treatment, 
                                 "control", "charate", "oven", "ovenchar")) %>% 
  dplyr::select(c(stand, site, soilcore, depth_name, subsample_cm3, subsample_g,treatment, rep, species_diversity, genus_abundance, lifeform, status, lifescycle, family, count, stand_core, stand_core_depth, stand_core_depth_treat, n_per_cm3, n_per_m3, n_per_g, n_per_kg))

#glimpse(seedbank)

seedbank <- seedbank %>%
  mutate(#year = as.character(year),
                                stand = as.character(stand), 
                                site = as.character(site),
                                soilcore = as.character(soilcore), 
                                depth_name = as.character(depth_name),
                                treatment = as.character(treatment), 
                                rep = as.integer(rep),                        
                                species_diversity = as.character(species_diversity), 
                                genus_abundance = as.character(genus_abundance), 
                                lifeform = as.character(lifeform), 
                                status = as.character(status), 
                                lifescycle = as.character(lifescycle), 
                                family = as.character(family),
                                count = as.integer(count)
                              ) %>%
  mutate(stand = fct_relevel(stand, 
            "intact", "enhanced", "degraded")) %>% 
  mutate(treatment = fct_relevel(treatment, 
                                 "control", "charate", "oven", "ovenchar"))
  # #mutate(stand = fct_recode(stand, 
  #                               "shrub_dominated" = "intact", # rename stand types
  #                               "matrix" = "enhanced",
  #                               "grass_dominated" = "degraded"))

seedbank <- seedbank %>% 
  mutate(stand_core = fct_relevel(stand_core, 
                                  "INT1_1", "INT1_2" , "INT1_3" ,"INT2_4"  ,"INT2_5" , "INT2_6",  "INT3_7" , "INT3_8" , "INT3_9",
                                  "ENH1_1" , "ENH1_2" , "ENH1_3" , "ENH1_4" , "ENH1_5" , "ENH2_6" , "ENH2_7" , "ENH2_8"  ,"ENH2_9"  ,"ENH2_10", 
                                 "DEG1_1" , "DEG1_2"  ,"DEG1_3"  ,"DEG1_4" , "DEG2_5" , "DEG2_6" , "DEG2_7" ))  %>% 
  mutate(site = fct_relevel(site, "INT1", "INT2", "INT3", "ENH1", "ENH2", "DEG1", "DEG2")) %>% 
  left_join(average_cover, by = 'site')


seedbank$stand_core_treat <- paste(seedbank$stand_core, seedbank$treatment, sep="_") 
seedbank$stand_core_depth_treat_status <- paste(seedbank$stand_core_depth_treat, seedbank$status, sep="_") 
seedbank$stand_core_depth_treat_lifeform <- paste(seedbank$stand_core_depth_treat, seedbank$lifeform, sep="_") 

unique(seedbank$stand)
unique(seedbank$site)
unique(seedbank$soilcore)
unique(seedbank$depth_name)
unique(seedbank$treatment)
sort(unique(seedbank$species_diversity))
length(unique(seedbank$species_diversity)) #65 unique species
unique(seedbank$status)
unique(seedbank$stand_core_depth)
unique(seedbank$stand_core_treat) # wrap by treatment instead of ordering

#view(seedbank)
```



# Total germination
```{r}
sum(seedbank$count)
```

# List species diversity
```{r}
native_seedbank <- seedbank %>%  # native diversity
  filter(status == "native") 
sort(unique(native_seedbank$species_diversity)) # 47 species
sort(unique(native_seedbank$family)) # 22 families

nonnative_seedbank <- seedbank %>%  # non-native diversity
  filter(status == "nonnative")
sort(unique(nonnative_seedbank$species_diversity)) #17 species
sort(unique(nonnative_seedbank$family)) # 6 families

unknown_seedbank <- seedbank %>%  # unknown spp. diversity
  filter(status == "unknown")
sort(unique(unknown_seedbank$species_diversity)) # 1 species
```

# List shrub germination by hillslope
```{r}
shrub_seedbank <- seedbank %>% 
  filter(lifeform == "shrub")
sort(unique(shrub_seedbank$species_diversity)) # 10 species
sort(unique(shrub_seedbank$family)) 
length(unique(shrub_seedbank$family)) # 7 families
```

# Explore seedbank data by germination (#seeds/g sieved soil)
```{r group germination by tray}

germ_tray_prep <- seedbank %>% # 2 columns of data
  group_by(stand_core_depth_treat) %>% 
  summarize(germination_n_per_tray = sum(count)) # total number of germinates per tray

seedbank_prep <- seedbank %>% 
  group_by(stand, site, soilcore, depth_name, treatment, stand_core, stand_core_depth, stand_core_depth_treat, nonnative_grass, native_shrub) %>% 
  summarize(subsample_g = mean(subsample_g))
#dim(seedbank_prep)
# 205 rows 
# 11 columns

# left join, log transform
germ_tray <- germ_tray_prep %>% 
  left_join(seedbank_prep, by = "stand_core_depth_treat") %>% 
  mutate(seeds_per_g = (germination_n_per_tray/subsample_g), 
         seeds_per_g_log = log(seeds_per_g)) # transform data: log

dim(germ_tray)
# 205 rows = [(7 DEG + 10 ENH + 9 INT) * 4 treatments * 2 depths] - 3 trays with no data
# no data for ENH1_5_deep_oven, ENH2_8_surface_control, ENH2_8_surface_char 
### Omit three trays as NA or include as 0 germinants per tray? 
# 14 columns - 3 additional columns: seeds_per_g, seeds_per_g_log, germination_n
 
glimpse(germ_tray)
head(germ_tray)
# write.csv(germ_tray,"processed/germ_tray.csv")
```

```{r explore figures - no data transformation}
boxplot(germ_tray$seeds_per_g)
histogram(germ_tray$seeds_per_g)
histogram(germ_tray$germination_n_per_tray)

boxplot(seeds_per_g ~ stand_core, data=germ_tray, main="Seeds/g by hillslope and rep",
   xlab="Hillslope_rep", ylab="Seeds per gram")

boxplot(seeds_per_g ~ site, data=germ_tray, main="Seeds/g by hillslope and rep",
   xlab="Hillslope", ylab="Seeds per gram")

boxplot(seeds_per_g ~ subsample_g, data=germ_tray, main="Seeds/g by Subsample weight (g)",
   xlab="Subsample Weight (g)", ylab="Seeds per gram")

boxplot(seeds_per_g ~ native_shrub, data=germ_tray, main="Seeds/g by Native shrub cover (%)",
   xlab="Average native cover (%)", ylab="Seeds per gram")

boxplot(seeds_per_g ~ nonnative_grass, data=germ_tray, main="Seeds/g by Non-native grass cover (%)",
   xlab="Non-native grass cover (%)", ylab="Seeds per gram")

qplot(subsample_g, seeds_per_g, data = germ_tray) # by seeds/g
qplot(native_shrub, seeds_per_g, data = germ_tray) # by native shrub cover
qplot(nonnative_grass, seeds_per_g, data = germ_tray) # by nonnative grass cover
qplot(depth_name, seeds_per_g, data = germ_tray) # by soil depth
qplot(treatment, seeds_per_g, data = germ_tray) # by treatment

qplot(native_shrub, seeds_per_g, data = germ_tray, facets = . ~ depth_name)
qplot(subsample_g, seeds_per_g, data = germ_tray, facets = . ~ treatment)
qplot(site, seeds_per_g, data = germ_tray, facets = . ~ depth_name)
qplot(nonnative_grass, seeds_per_g, data = germ_tray, facets = . ~ depth_name)
qplot(native_shrub, seeds_per_g, data = germ_tray, facets = . ~ depth_name)

```

```{r explore figures - with data transformation}
boxplot(germ_tray$seeds_per_g_log)
histogram(germ_tray$seeds_per_g_log)

boxplot(seeds_per_g_log ~ stand_core, data=germ_tray, main="Seeds/g by hillslope and rep",
   xlab="Hillslope_rep", ylab="Seeds per gram")

boxplot(seeds_per_g_log ~ site, data=germ_tray, main="Seeds/g by hillslope and rep",
   xlab="Hillslope", ylab="Seeds per gram")

boxplot(seeds_per_g_log ~ subsample_g, data=germ_tray, main="Seeds/g by Subsample weight (g)",
   xlab="Subsample Weight (g)", ylab="Seeds per gram")

qplot(subsample_g, seeds_per_g_log, data = germ_tray)
qplot(subsample_g, seeds_per_g_log, data = germ_tray, facets = . ~ depth_name)
qplot(subsample_g, seeds_per_g_log, data = germ_tray, facets = . ~ treatment)
qplot(site, seeds_per_g_log, data = germ_tray, facets = . ~ depth_name)
```

### Normality
```{r normality}
ggqqplot(germ_tray$seeds_per_g) 

shapiro.test(germ_tray$seeds_per_g) # not transformed
# data:  germ_tray$seeds_per_g
# W = 0.62208, p-value < 2.2e-16  <-- not normally distributed

ggqqplot(germ_tray$seeds_per_g_log) # log transformed
shapiro.test(germ_tray$seeds_per_g_log)
# data:  germ_tray$seeds_per_g_log
# W = 0.98299, p-value = 0.0141 <-- closer to normal!

# poisson distribution?
plot(germ_tray(poisson.dist[]))
```

# seed/g by hillslope
```{r stats - seed/g by hillslope, include = TRUE}
kruskal.test(seeds_per_g_log ~ site, data = germ_tray)
# data:  seeds_per_g by site
# Kruskal-Wallis chi-squared = 64.181, df = 6, p-value = 6.338e-12 <-- sig differences

pairwise.wilcox.test(germ_tray$seeds_per_g_log, germ_tray$site,
                 p.adjust.method = "BH")
# 	Pairwise comparisons using Wilcoxon rank sum test with continuity correction 
# 
# data:  germ_tray$seeds_per_g and germ_tray$site 
# 
#      INT1    INT2    INT3    ENH1    ENH2    DEG1   
# INT2 0.06742 -       -       -       -       -      
# INT3 0.57288 0.53781 -       -       -       -      
# ENH1 0.09312 0.76696 0.54819 -       -       -      
# ENH2 0.69734 0.57288 0.76696 0.73886 -       -      
# DEG1 0.00021 2.7e-07 0.00024 2.7e-07 0.00117 -      
# DEG2 0.00010 3.1e-07 0.00010 3.0e-07 0.00024 0.10067

# DEG1 - INT1, INT2, INT3, ENH1, ENH2 
# DEG2 - INT1, INT2, INT3, ENH1, ENH2
# DEG1 and DEG2 are sig different from INT and ENH hillslopes. No diff between INT and ENH hillslopes.
```

# seed/g by native shrub cover
```{r visualize seed per g by native shrub cover}
qplot(native_shrub, seeds_per_g, data = germ_tray) # by native shrub cover
boxplot(seeds_per_g ~ native_shrub, data=germ_tray, main="Seeds/g by Native shrub cover (%)",
   xlab="Average native cover (%)", ylab="Seeds per gram")
```

```{r plot seed density per g x native shrub cover}

# scatterplot - seed density x native shrub 
formula1 <- germ_tray$seeds_per_g_log ~ germ_tray$native_shrub
seeddensity_nativeshrub <- ggplot(data = germ_tray, 
       aes(x = native_shrub*100, y = seeds_per_g_log, color = site)) + #color = standtype
  geom_point(size = 3, alpha = 0.8) +
  ylim(0, -10)+
  xlim(0,100) +
  geom_smooth(method = "lm", se = FALSE, linetype = "solid", color = "black") +  # lm, loess, glm
  # scale_color_manual(values = c(standcolors),
  #                     name = "Hillslope",
  #                     # labels = c("DEG2" = "shrub dominated", 
  #                     #            "matrix" = "matrix", 
  #                     #            "degraded" = "grass dominated")
  #                     ) + #rename standtypes labels
  labs(x = "Native shrub cover (%)", 
       y = "Seed density (log(#/g))", 
       title = "Seed density by Native Shrub Cover") +
  theme_bw() +  
  stat_poly_line() +
  stat_poly_eq(use_label(c("eq", "R2")))

seeddensity_nativeshrub_print <- seeddensity_nativeshrub + theme(legend.position = c(0.1, 0.7)) # Key location offset from (0,0)

seeddensity_nativeshrub.lm = lm(seeds_per_g_log ~ native_shrub, data=germ_tray)
summary(seeddensity_nativeshrub.lm)
# Residual standard error: 1.086 on 203 degrees of freedom
# Multiple R-squared:  0.124,	Adjusted R-squared:  0.1197 
# F-statistic: 28.73 on 1 and 203 DF,  p-value: 2.245e-07 <-- significant regression
```

# seed/g by native shrub cover
```{r seed density per g x non-native grass cover}
# scatterplot - seed density x nn grass cover
seeddensity_nngrass <- ggplot(data = germ_tray, 
       aes(x = nonnative_grass*100, y = seeds_per_g_log, color = site)) + #color = standtype
  geom_point(size = 3, alpha = 0.8) +
  ylim(-10,0)+
  xlim(0,100) +
  geom_smooth(method = "lm", se = FALSE, linetype = "solid", color = "black") +  # lm, loess, glm
  # scale_color_manual(values = c(standcolors),
  #                     name = "Hillslope",
  #                     # labels = c("DEG2" = "shrub dominated", 
  #                     #            "matrix" = "matrix", 
  #                     #            "degraded" = "grass dominated")
  #                     ) + #rename standtypes labels
  labs(x = "Non-native grass cover (%)", 
       y = "Seed density (log(#/g))", 
       title = "Seed density by Non-native Grass Cover") +
  theme_bw() +  
  stat_poly_line() +
   stat_poly_eq(
    aes(label = paste(after_stat(eq.label), after_stat(adj.rr.label), sep = "~~~~")),
    formula = formula1, 
    parse=TRUE
 )
  stat_poly_eq(use_label(c("eq", "R2")))

seeddensity_nativeshrub_print <- seeddensity_nngrass + theme(legend.position = c(0.1, 0.2)) # Key location offset from (0,0)

seeddensity_nngrass.lm = lm(seeds_per_g_log ~ nonnative_grass, data=germ_tray)
# summary(seeddensity_nngrass.lm)
# Residual standard error: 1.106 on 203 degrees of freedom
# Multiple R-squared:  0.09099,	Adjusted R-squared:  0.08651 
# F-statistic: 20.32 on 1 and 203 DF,  p-value: 1.106e-05 <-- significant regression
```

# seed/g by soil depth
```{r stats - seed/g by depth, include = TRUE}
kruskal.test(seeds_per_g_log ~ depth_name, data = germ_tray)
# data:  seeds_per_g_log by depth_name
# Kruskal-Wallis chi-squared = 65.903, df = 1, p-value = 4.737e-16 <-- sig differences

pairwise.wilcox.test(germ_tray$seeds_per_g, germ_tray$depth_name,
                 p.adjust.method = "BH")
#         deep   
# surface 4.8e-16

germ_tray %>% 
  group_by(depth_name) %>% 
  summarize(total_germ = sum(germination_n))
# depth_name  total_germ
# deep	      762			
# surface	    3209	

```

# seed/g by treatment
```{r stats - seed/g by depth, include = TRUE}
kruskal.test(seeds_per_g_log ~ treatment, data = germ_tray)
# data:  seeds_per_g_log by treatment
# Kruskal-Wallis chi-squared = 2.3083, df = 3, p-value = 0.5109 <-- no sig diff
```

# STATUS - seed density

```{r group germination by status and tray}
germ_tray_prep_status <- seedbank %>% 
  group_by(stand_core_depth_treat_status) %>% 
  summarize(germination_n = sum(count)) %>% 
  filter(germination_n > 0)
glimpse(germ_tray_prep_status) # [1] 371 rows, 2 columns: stand_core_depth_treat_status, germination_n_per_tray

seedbank_prep_status <- seedbank %>% 
  group_by(stand, site, soilcore, depth_name, status, treatment, stand_core, stand_core_depth, stand_core_depth_treat, stand_core_depth_treat_status, native_shrub, nonnative_grass) %>% 
  summarize(subsample_g = mean(subsample_g)) 
dim(seedbank_prep_status) # 393 rows

germ_tray_status <- germ_tray_prep_status %>% 
  left_join(seedbank_prep_status, by = "stand_core_depth_treat_status") %>% 
  mutate(seeds_per_g = (germination_n/subsample_g), 
         seeds_per_g_log = log(seeds_per_g))
dim(germ_tray_status) 
# 371 rows = 205 rows * 2 status
#  205 rows = [(7 DEG + 10 ENH + 9 INT) * 4 treatments * 2 depths] - 3 trays with no data
view(germ_tray_status)
```

```{r}
ggqqplot(germ_tray_status$seeds_per_g) 
ggqqplot(germ_tray_status$seeds_per_g_log) 
histogram(germ_tray_status$germination_n)

boxplot(germination_n ~ status, data=germ_tray_status, 
        main="Germination by Status",
   xlab="Status", ylab="Seeds per tray")

boxplot(seeds_per_g ~ status, data=germ_tray_status, 
        main="Seeds/g by Status",
   xlab="Status", ylab="Seeds per gram")

boxplot(seeds_per_g_log ~ status, data=germ_tray_status, 
        main="Seeds/g (log) by Status",
   xlab="Status", ylab="Seeds per gram (log)")

qplot(subsample_g, seeds_per_g, data = germ_tray_status, facets = . ~ status)
qplot(native_shrub, seeds_per_g, data = germ_tray_status, facets = . ~ status)
qplot(nonnative_grass, seeds_per_g, data = germ_tray_status, facets = . ~ status)
```


# NATIVE and NON-NATIVE seed/g by cover 
```{r visualize seed per g by native shrub cover}
qplot(native_shrub, seeds_per_g, data = germ_tray_status) # by native shrub cover
qplot(native_shrub, seeds_per_g, data = germ_tray_status, facets = . ~ status)

boxplot(seeds_per_g ~ native_shrub, data=germ_tray_status, main="Seeds/g by Native shrub cover (%)",
   xlab="Average native cover (%)", ylab="Seeds per gram")
```

```{r native germination x native shrub cover}
# scatterplot - native seed density x native shrub cover
nativedensity_nativeshrub <- ggplot(data = germ_tray_status %>% filter(status == "native"), 
       aes(x = native_shrub*100, y = seeds_per_g_log, color = site)) + #color = standtype
  geom_point(size = 3, alpha = 0.8) +
  ylim(-10,0)+
  xlim(0,100) +
  geom_smooth(method = "lm", se = FALSE, linetype = "solid", color = "black") +  # lm, loess, glm
  labs(x = "Native shrub cover (%)", 
       y = "Native seed density (log(#/g))", 
       title = "Native seed density by Native Shrub Cover") +
  theme_bw() +  
  stat_poly_line() +
   stat_poly_eq(
    aes(label = paste(after_stat(eq.label), after_stat(adj.rr.label), sep = "~~~~")),
    formula = formula1, 
    parse=TRUE
 )
  
nativedensity_nativeshrub_print <- nativedensity_nativeshrub + theme(legend.position = c(0.1, 0.35)) # Key location offset from (0,0)

nativegermination_nativeshrub.lm = lm(seeds_per_g_log ~ native_shrub, 
                                      data = (germ_tray_status %>% filter(status =="native")))
summary(nativegermination_nativeshrub.lm)
# Residual standard error: 1.106 on 203 degrees of freedom
# Multiple R-squared:  0.09099,	Adjusted R-squared:  0.08651 
# F-statistic: 20.32 on 1 and 203 DF,  p-value: 1.106e-05 <-- significant regression
length(germ_tray_NAT$status) 
#168
```

```{r native germination x nonnative grass cover}
# scatterplot - native seed density x native shrub cover
nativedensity_nngrass <- ggplot(data = germ_tray_status %>% filter(status == "native"), 
       aes(x = nonnative_grass*100, y = seeds_per_g_log, color = site)) + #color = standtype
  geom_point(size = 3, alpha = 0.8) +
  ylim(-10,0)+
  xlim(0,100) +
  geom_smooth(method = "lm", se = FALSE, linetype = "solid", color = "black") +  # lm, loess, glm
  labs(x = "Non-native grass cover (%)", 
       y = "Native seed density (log(#/g))", 
       title = "Native seed density by Non-native Grass Cover") +
  theme_bw() +  
  stat_poly_line() +
   stat_poly_eq(
    aes(label = paste(after_stat(eq.label), after_stat(adj.rr.label), sep = "~~~~")),
    formula = formula1, 
    parse=TRUE
 )


nativedensity_nngrass.lm = lm(seeds_per_g_log ~ nonnative_grass, 
                                      data = (germ_tray_status %>% filter(status =="native")))
summary(nativedensity_nngrass.lm)
# Residual standard error: 0.8465 on 166 degrees of freedom
# Multiple R-squared:  0.4276,	Adjusted R-squared:  0.4242 
# F-statistic:   124 on 1 and 166 DF,  p-value: < 2.2e-16 <-- sig
```

```{r nonnative germination x native shrub cover}
nndensity_nativeshrub <- ggplot(data = germ_tray_status %>% filter(status == "nonnative"), 
       aes(x = native_shrub*100, y = seeds_per_g_log, color = site)) + #color = standtype
  geom_point(size = 3, alpha = 0.8) +
  ylim(-10,0)+
  xlim(0,100) +
  geom_smooth(method = "lm", se = FALSE, linetype = "solid", color = "black") +  # lm, loess, glm
  labs(x = "Native shrub cover (%)", 
       y = "Non-native seed density (log(#/g))", 
       title = "Non-native seed density by Native Shrub Cover") +
  theme_bw() +  
  stat_poly_line() +
   stat_poly_eq(
    aes(label = paste(after_stat(eq.label), after_stat(adj.rr.label), sep = "~~~~")),
    formula = formula1, 
    parse=TRUE
 )

nngermination_nativeshrub.lm = lm(seeds_per_g_log ~ native_shrub, 
                                      data = (germ_tray_status %>% filter(status =="nonnative")))
summary(nngermination_nativeshrub.lm)
# Residual standard error: 1.315 on 200 degrees of freedom
# Multiple R-squared:  0.004608,	Adjusted R-squared:  -0.0003692 
# F-statistic: 0.9258 on 1 and 200 DF,  p-value: 0.3371 <-- NOT significant

length(germ_tray_NN$status)
#202
```


```{r nonnative germination x nonnative grass cover}
nndensity_nngrass <- ggplot(data = germ_tray_status %>% filter(status == "nonnative"), 
       aes(x = nonnative_grass*100, y = seeds_per_g_log, color = site)) + #color = standtype
  geom_point(size = 3, alpha = 0.8) +
  ylim(-10,0)+
  xlim(0,100) +
  geom_smooth(method = "lm", se = FALSE, linetype = "solid", color = "black") +  # lm, loess, glm
  labs(x = "Non-native grass cover (%)", 
       y = "Non-native seed density (log(#/g))", 
       title = "Non-native seed density by Non-native Grass Cover") +
  theme_bw() +  
  stat_poly_line() +
   stat_poly_eq(
    aes(label = paste(after_stat(eq.label), after_stat(adj.rr.label), sep = "~~~~")),
    formula = formula1, 
    parse=TRUE
 )

nngermination_nngrass.lm = lm(seeds_per_g_log ~ nonnative_grass, 
                                      data = (germ_tray_status %>% filter(status =="nonnative")))
summary(nngermination_nngrass.lm)
# Residual standard error: 1.313 on 200 degrees of freedom
# Multiple R-squared:  0.008333,	Adjusted R-squared:  0.003375 
# F-statistic: 1.681 on 1 and 200 DF,  p-value: 0.1963 <-- NOT sig
```
# native and non-native seed density (seeds/g) by hillslope
```{r}
germ_tray_NAT <- germ_tray_status %>% filter(status == "native")
germ_tray_NN <- germ_tray_status %>% filter(status == "nonnative")

boxplot(seeds_per_g ~ site, data=germ_tray_NAT, main="Native seed density (seeds/g) by Hillslope",
   xlab="Hillslope", ylab="Native Seeds per gram")

boxplot(seeds_per_g ~ site, data=germ_tray_NN, main="Non-native seed density (seeds/g) by Hillslope",
   xlab="Hillslope", ylab="Non-native Seeds per gram")
```

```{r native seed density x hillslope}

shapiro.test(germ_tray_NAT$seeds_per_g_log)
# data:  germ_tray_NAT$seeds_per_g_log
# W = 0.95871, p-value = 7.193e-05 <-- not normally distributed

kruskal.test(seeds_per_g_log ~ site, data = germ_tray_NAT)
# data:  seeds_per_g_log by site
# Kruskal-Wallis chi-squared = 75.613, df = 6, p-value = 2.87e-14 <-- significant diff
pairwise.wilcox.test(germ_tray_NAT$seeds_per_g_log, germ_tray_NAT$site,
                 p.adjust.method = "BH")
# 
#      DEG1    DEG2    ENH1    ENH2    INT1    INT2   
# DEG2 0.06559 -       -       -       -       -      
# ENH1 0.00250 0.76057 -       -       -       -      
# ENH2 0.00334 0.84515 0.88832 -       -       -      
# INT1 6.7e-07 0.00036 3.2e-05 6.3e-05 -       -      
# INT2 6.7e-07 2.5e-05 6.7e-07 3.4e-06 0.14178 -      
# INT3 3.7e-06 0.00250 0.00159 0.00236 0.84515 0.13795
# 
# DEG1 is sig different than ENH and INT hillslopes
# DEG 2 is sig different than INT hillslopes
# ENH 1 and ENH2 are sig diff than INT 
# 
# --> INT hill slopes sig diff from ENH and DEG hill slopes
# --> DEG 1 sig diff from ENH and INT 

```
```{r nn seed density x hillslope}

shapiro.test(germ_tray_NN$seeds_per_g_log)
# data:  germ_tray_NN$seeds_per_g_log 
# W = 0.95122, p-value = 2.228e-06 <-- not normally distributed

kruskal.test(seeds_per_g_log ~ site, data = germ_tray_NN)
# data:  seeds_per_g_log by site
# Kruskal-Wallis chi-squared = 78.136, df = 6, p-value = 8.665e-15

pairwise.wilcox.test(germ_tray_NN$seeds_per_g_log, germ_tray_NN$site,
                 p.adjust.method = "BH")
#      DEG1    DEG2    ENH1    ENH2    INT1    INT2   
# DEG2 7.1e-06 -       -       -       -       -      
# ENH1 2.0e-06 2.9e-09 -       -       -       -      
# ENH2 0.00660 7.1e-07 0.63831 -       -       -      
# INT1 0.02518 0.09225 7.1e-07 0.00012 -       -      
# INT2 0.87482 9.5e-05 2.5e-05 0.00654 0.04974 -      
# INT3 0.87482 0.00355 0.00037 0.01340 0.06445 0.87482
# 
# DEG1-similar to INT2 and INT3
# DEG2 and INT1 are similar
# ENH1 and ENH2 are similar
# INT3 is similar to INT1 and INT2
```

# native density (seeds/g) by depth
```{r native density x depth}

kruskal.test(seeds_per_g_log ~ depth_name, data = germ_tray_NAT)
# data:  seeds_per_g_log by depth_name
# Kruskal-Wallis chi-squared = 21.28, df = 1, p-value = 3.969e-06
pairwise.wilcox.test(germ_tray_NAT$seeds_per_g_log, germ_tray_NAT$depth_name,
                 p.adjust.method = "BH")
#         deep   
# surface 4.8e-16

germ_tray_NAT %>% 
  group_by(depth_name) %>% 
   summarize(mean_NATseeddensity = mean(seeds_per_g), 
            sd = sd(seeds_per_g),
            N = length(seeds_per_g), 
            se = ((sd(seeds_per_g))/sqrt(length((seeds_per_g)))))

# depth_name  mean_NATseeddensity   SD          N   SE
# surface	    0.03344313	          0.030364873	86	0.003274328
# deep	      0.01190290	          0.009405198	82	0.001038630
```

```{r nonnative density x depth, include=TRUE}

kruskal.test(seeds_per_g_log ~ depth_name, data = germ_tray_NN)
# data:  seeds_per_g_log by depth_name
# Kruskal-Wallis chi-squared = 58.4, df = 1, p-value = 2.139e-14
pairwise.wilcox.test(germ_tray_NN$seeds_per_g_log, germ_tray_NN$depth_name,
                 p.adjust.method = "BH")
#         deep   
# surface 2.2e-14

germ_tray_NN %>% 
  group_by(depth_name) %>% 
     summarize(mean_NNseeddensity = mean(seeds_per_g), 
            sd = sd(seeds_per_g),
            N = length(seeds_per_g), 
            se = ((sd(seeds_per_g))/sqrt(length((seeds_per_g)))))

# depth_name  mean_NNseeddensity  SE          N   SE
# surface	    0.074631569	      	0.109261371	101	0.0108719127
# deep	      0.009844989			    0.007540058	101	0.0007502638
```

# LIFEFORM - seed density (log seed density/g soil)
```{r lifeform seed density}
germ_tray_prep_lifeform <- seedbank %>% 
  group_by(stand_core_depth_treat_lifeform) %>% 
  summarize(germination_n = sum(count)) %>% 
  filter(germination_n > 0)
dim(germ_tray_prep_lifeform) #476 rows

seedbank_prep_lifeform <- seedbank %>% 
  group_by(stand, site, soilcore, depth_name, status, treatment, lifeform, stand_core, stand_core_depth, stand_core_depth_treat, stand_core_depth_treat_lifeform, native_shrub, nonnative_grass) %>% 
  summarize(subsample_g = mean(subsample_g)) 
dim(seedbank_prep_lifeform) # 546 rows

germ_tray_lifeform <- germ_tray_prep_lifeform %>% 
  left_join(seedbank_prep_lifeform, by = "stand_core_depth_treat_lifeform") %>% 
  mutate(seeds_per_g = (germination_n/subsample_g), 
         seeds_per_g_log = log(seeds_per_g))
dim(germ_tray_lifeform) 
# 476 rows 
#  476 rows = [(7 DEG + 10 ENH + 9 INT) * 4 treatments * 2 depths * 4 lifeforms] - minus a lot of lifeforms/tray
view(germ_tray_lifeform)

germ_tray_lifeform %>% 
  group_by(lifeform, status) %>% 
  summarize(total_germ = sum(germination_n),
            mean_seeddensity_lifeform = mean(seeds_per_g))


qplot(site, seeds_per_g, data = germ_tray_lifeform, facets = . ~ lifeform)
qplot(site, seeds_per_g, data = germ_tray_lifeform %>%  filter(status == "native"), facets = . ~ lifeform)
qplot(site, seeds_per_g, data = germ_tray_lifeform %>%  filter(status == "nonnative"), facets = . ~ lifeform)
qplot(native_shrub, seeds_per_g, data = germ_tray_lifeform, facets = . ~ lifeform)
qplot(nonnative_grass, seeds_per_g, data = germ_tray_lifeform, facets = . ~ lifeform)

boxplot(seeds_per_g ~ site, data=germ_tray_NN, main="Non-native seed density (seeds/g) by Hillslope",
   xlab="Hillslope", ylab="Non-native Seeds per gram")
```
## nn grass density
```{r nn grass seed density visualize}

germ_tray_lifeform_nngrass <- germ_tray_lifeform %>% 
  filter(status == "nonnative") %>% 
  filter(lifeform == "grass")

boxplot(seeds_per_g ~ site, data=germ_tray_lifeform_nngrass, main="Non-native Grass density (seeds/g) by Hillslope",
   xlab="Hillslope", ylab="Non-native Grass seeds per gram")
```

```{r nn grass seed density linear regression}
ggplot(data = germ_tray_lifeform_nngrass, 
       aes(x = nonnative_grass*100, y = seeds_per_g_log, color = site)) + #color = standtype
  geom_point(size = 3, alpha = 0.8) +
  ylim(-10,0)+
  xlim(0,100) +
  geom_smooth(method = "lm", se = FALSE, linetype = "solid", color = "black") +  # lm, loess, glm
  labs(x = "Non-native grass cover (%)", 
       y = "Non-native grass density (log(#/g))", 
       title = "Non-native grass density by Non-native Grass Cover") +
  theme_bw() +  
  stat_poly_line() +
   stat_poly_eq(
    aes(label = paste(after_stat(eq.label), after_stat(adj.rr.label), sep = "~~~~")),
    formula = formula1, 
    parse=TRUE
 )

nngrass_nngrass.lm = lm(seeds_per_g_log ~ native_shrub, 
                                      data = germ_tray_lifeform_nngrass)
summary(nngrass_nngrass.lm)
# Residual standard error: 1.38 on 161 degrees of freedom
# Multiple R-squared:  0.02668,	Adjusted R-squared:  0.02063 
# F-statistic: 4.413 on 1 and 161 DF,  p-value: 0.03722 <-- sig
```

```{r nn grass seed density hillslope}

kruskal.test(seeds_per_g_log ~ site, data = germ_tray_lifeform_nngrass)
# data:  seeds_per_g_log by site
# Kruskal-Wallis chi-squared = 52.09, df = 6, p-value = 1.789e-09 <-- significant

pairwise.wilcox.test(germ_tray_lifeform_nngrass$seeds_per_g_log, germ_tray_lifeform_nngrass$site,
                 p.adjust.method = "BH")
# data:  germ_tray_lifeform_nngrass$seeds_per_g_log and germ_tray_lifeform_nngrass$site 
# 
#      DEG1    DEG2    ENH1    ENH2    INT1    INT2   
# DEG2 0.17049 -       -       -       -       -      
# ENH1 4.5e-07 0.00089 -       -       -       -      
# ENH2 0.00065 0.00378 0.69839 -       -       -      
# INT1 0.00885 0.00205 0.00845 0.21904 -       -      
# INT2 0.02445 0.00205 0.00011 0.02737 0.29222 -      
# INT3 0.00130 0.00287 0.11585 0.30848 0.30848 0.08059

germ_tray_lifeform_nngrass%>% 
  group_by(site) %>% 
       summarize(mean_NNgrassseeddensity = mean(seeds_per_g), 
            sd = sd(seeds_per_g),
            N = length(seeds_per_g), 
            se = ((sd(seeds_per_g))/sqrt(length((seeds_per_g)))))

```





## nat shrub density
```{r native shrub density visualize}
germ_tray_lifeform_natshrub <- germ_tray_lifeform %>% 
  filter(status == "native") %>% 
  filter(lifeform == "shrub")

length(germ_tray_lifeform_natshrub$status) #106

boxplot(seeds_per_g ~ site, data=germ_tray_lifeform_natshrub, main="Native Shrub density (seeds/g) by Hillslope",
   xlab="Hillslope", ylab="Native Shrub seeds per gram")
boxplot(seeds_per_g ~ native_shrub, data=germ_tray_lifeform_natshrub, main="Native Shrub density (seeds/g) by Hillslope",
   xlab="Native shrub cover", ylab="Native Shrub seeds per gram")
boxplot(seeds_per_g ~ nonnative_grass, data=germ_tray_lifeform_natshrub, main="Native Shrub density (seeds/g) by Hillslope",
   xlab="Nonnative grass cover", ylab="Native Shrub seeds per gram")
```

```{r nn grass seed density linear regression}
ggplot(data = germ_tray_lifeform_natshrub, 
       aes(x = nonnative_grass*100, y = seeds_per_g_log, color = site)) + #color = standtype
  geom_point(size = 3, alpha = 0.8) +
  ylim(-10,0)+
  xlim(0,100) +
  geom_smooth(method = "lm", se = FALSE, linetype = "solid", color = "black") +  # lm, loess, glm
  labs(x = "Non-native grass cover (%)", 
       y = "Native shrub seed density (log(#/g))", 
       title = "Native shrub seed density by Non-native Grass Cover") +
  theme_bw() +  
  stat_poly_line() +
   stat_poly_eq(
    aes(label = paste(after_stat(eq.label), after_stat(adj.rr.label), sep = "~~~~")),
    formula = formula1, 
    parse=TRUE
 )

ggplot(data = germ_tray_lifeform_natshrub, 
       aes(x = native_shrub*100, y = seeds_per_g_log, color = site)) + #color = standtype
  geom_point(size = 3, alpha = 0.8) +
  ylim(-10,0)+
  xlim(0,100) +
  geom_smooth(method = "lm", se = FALSE, linetype = "solid", color = "black") +  # lm, loess, glm
  labs(x = "Native shrub cover (%)", 
       y = "Native shrub seed density (log(#/g))", 
       title = "Native shrub seed density by Native Shrub Cover") +
  theme_bw() +  
  stat_poly_line() +
   stat_poly_eq(
    aes(label = paste(after_stat(eq.label), after_stat(adj.rr.label), sep = "~~~~")),
    formula = formula1, 
    parse=TRUE
 )
```
```{r nn grass seed density linear regression stats}
natshrub_nngrass.lm = lm(seeds_per_g_log ~ nonnative_grass, 
                                      data = germ_tray_lifeform_natshrub)
summary(natshrub_nngrass.lm)
# Residual standard error: 0.8994 on 104 degrees of freedom
# Multiple R-squared:  0.1561,	Adjusted R-squared:  0.148 
# F-statistic: 19.23 on 1 and 104 DF,  p-value: 2.778e-05 <-- sig
```

```{r native shrub seed density hillslope}

kruskal.test(seeds_per_g_log ~ site, data = germ_tray_lifeform_natshrub)

pairwise.wilcox.test(germ_tray_lifeform_natshrub$seeds_per_g_log, germ_tray_lifeform_natshrub$site,
                 p.adjust.method = "BH")
# data:  germ_tray_lifeform_natshrub$seeds_per_g_log and germ_tray_lifeform_natshrub$site 
#      DEG1    DEG2    ENH1    ENH2    INT1    INT2   
# DEG2 -       -       -       -       -       -      
# ENH1 0.00025 0.01308 -       -       -       -      
# ENH2 0.00032 0.01685 0.33942 -       -       -      
# INT1 0.00034 0.01741 0.75709 0.72624 -       -      
# INT2 0.00032 0.01685 0.01901 0.09168 0.08204 -      
# INT3 0.00057 0.01901 0.59751 0.25826 0.56245 0.02368

germ_tray_lifeform_natshrub%>% 
  group_by(site) %>% 
       summarize(mean_NATgrassseeddensity = mean(seeds_per_g), 
            sd = sd(seeds_per_g),
            N = length(seeds_per_g), 
            se = ((sd(seeds_per_g))/sqrt(length((seeds_per_g)))))

```


```{r hold notes here}

```

