---
title: "above ground species richness"
author: "Stephanie Ma Lucero"
date: "2024-02-19"
output: html_document
---

<-- 1.1_transect_continuous.Rmd

--> ???


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


 markdown for analyzing total above ground species richness 
- combining species lists from point-intercept transects and belt transects
 
library
```{r install libraries, message=FALSE}


# library(ggpubr) # customize ggplot2 for publication
# library(broom)
# library(AICcmodavg)
# library(janitor)
# library(multcompView)
# library(plotly)
# if (!require(devtools)) {
#   install.packages("devtools")
# }
# devtools::install_github("gavinsimpson/ggvegan")
# library(ggpmisc)
```

- load colors
```{r }

# library(calecopal) 
 
# Stand colors: INTACT, MATRIX, DEGRADED 
# cal_palette(name = "chaparral3", n = 3, type = "continuous") 
# deg <- "#D3E3CA"
# mat <- "#92A587"
# int <- "#2F3525"
# standcolors <- c(int, mat, deg)
# 
# # Lifeform colors: shrub, grass, forb
# cal_palette(name = "chaparral3", n = 3, type = "continuous") 
# shrub <- "#D3E3CA"
# grass <- "#92A587"
# forb <- "#2F3525"
# lifeformcolors <- c(int, mat, deg)
# 
# # Status colors: native, exotic 
# cal_palette(name = "chaparral1", n = 6, type = "continuous") 
# native <- "#AEBFA8"
# exotic <- "#F19B34"
# statuscolors <- c(native, exotic)
```


### load data 
```{r}

# NOTES: (August 5-6, 2025)
# 
# 2017-2019 data --> I double checked the raw data sheets (paper) against the raw data in Google sheets (PIRU_Transect_Belt - sheet: belt_transects_raw)
# and entered any missing species from 2017-2019 (Site 1 transects 1-6, Site 2 transects 1-6, INT1, INT2, INT3, INT4).
# 
# 2024 data --> For the 2024 species richness data, I double checked  species richness lists on the paper datasheets (raw datasheets collected in the field) against the data entered in the Google Sheets file "Transects_2014" on sheet = "specieslist. The species richness #s in the google sheet match the species richness #s that were recorded in the field.
# 
# # # SEE DATA FOLDER for yellow legal pad notes



################## don't load point-intercept transect data 
# species from point-intercept transect data in 1.1_transect_continuous.Rmd
# species observed in 2017-2024 point intercept transects
# point_spprich <- abcover_full %>%  # 2019 point intercept     # 2024 point intercept
#   dplyr::select(site, transect, site_rep, species) %>% 
#   dplyr::distinct(site, transect, species)

# length(unique(point_spprich$site_rep))   # 40
# sort(unique(point_spprich$species))  <--  "unknown2 forb"; "unknown3" 
# names(point_spprich)    


################## load belt transect data

# 2019 belt transect 
belt.spp_2019_load <- read.csv("data/PIRU_Transect_Belt - belt_transects_raw.csv") %>% # <-- download as .csv from Google Sheets
  # read.csv(here("data/deg_beltdensity_byspecies.csv")) %>% 
  dplyr::select(ch1_site, ch1_transect, Sci_Nomenclature) %>% 
  rename(
    site = ch1_site, # new = old name
    transect = ch1_transect, 
    species = Sci_Nomenclature) %>% 
  mutate(transect = as.character(transect)) %>% 
  filter(!species == "") # site 1, transect 4 (aka. ENH1, transect 1) has an empty cell where LUSU could have been IDed in the plot but the photos are from Site 1, transect 1 (aka. DEG1, transect 1)
  
dim(belt.spp_2019_load)
# 1067-1 = 1666   3
# sort(unique(belt.spp_2019_load$species)) <--  "unknown shrub", "Unknown 3 Grindelia?", "Unknown pretty seed"


# 2024 belt transect data
belt.spp_2024_load <- read.csv("data/Transects_2024 - specieslist.csv") %>% 
   dplyr::select(site, rep, species) %>% 
  rename(transect = rep) %>% # new = old name
   mutate(transect = as.character(transect))
# dim(belt.spp_2024_load)  # 375  3
# sort(unique(belt.spp_2024_load$species))
#   "unknown seedling (photo)" <-- Collected at INT5 - look at PIRU_Transect_Belt (google sheets) sheet = NOTES for photos of this unknown seedling=
#   "unknown7 forb - unknown oval shaped leaf, red colored stem at the base - no photos" <-- Collected at Site 2, transect 20 (June 1, 2025) with Omar and Wyatt
#   "unknown collected aster (NB2312 page 123)" <- Collected at Site 2, transect 15 - the plant could be Lactuca serriola, but I don't think it is. It was collected and dried in notebook NB2401 on page 123.

spprich <- bind_rows(belt.spp_2019_load, belt.spp_2024_load) %>% 
  mutate(transect = case_when(site == "INT5" ~ "1", 
                              TRUE ~ transect)) %>% 
  mutate(site_rep = paste(site, transect, sep = "_")) %>% 
  relocate(site_rep, .after = transect) %>% 
  
  # here I am correcting species names
  mutate(species = case_when(species == "ACGL Acmispon glaber" ~ "Acmispon glaber", # old name ~ new name
                             species == "Acmispon maritimus - round, sevfl" ~ "Acmispon maritimus",
                             species == "Acmispon strigosus - oval, sevfl" ~ "Acmispon strigosus",
                             species == "Avena barbata AVBA" ~ "Avena barbata",
                             species == "Avena Barbara" ~ "Avena barbata",
                             species == "Bromus diandrus BRDI" ~ "Bromus diandrus",
                             species == "Bromus hordeaceus BRHO" ~ "Bromus hordeaceus",
                             species == "Bromus madritensis" ~ "Bromus rubens",
                             species == "Bromus rubens BRRU" ~ "Bromus rubens",
                             species == "CAMA Calystegia macrostegia" ~ "Calystegia macrostegia",
                             species == "Cenothus oliganthus" ~ "Ceanothus oliganthus",
                             species == "Centaurea melitensis " ~ "Centaurea melitensis",
                             species == "Centaria melitensis" ~ "Centaurea melitensis",
                             species == "Cryptantha sp." ~ "Cryptantha spp.",
                             species == "Dipterostemon capitatus DICA" ~ "Dipterostemon capitatus",
                             species == "Emmenanthe penduliflora EMPE" ~ "Emmenanthe penduliflora",
                             species == "Eriodictyon californicum" ~ "Eriodictyon crassifolium",
                             species == "Erodium cicutarium ERCI" ~ "Erodium cicutarium",
                             species == "Eriodium cicutarium" ~ "Erodium cicutarium",
                             species == "Erodium spp. " ~ "Erodium spp.",
                             species == "Galium" ~ "Galium spp.",
                             species == "HIIN Hirschfeldia incana - long pods" ~ "Hirschfeldia incana",
                             species == "Hirschfeldia incanna" ~ "Hirschfeldia incana",
                             species == "Lupinus bicolor - skinny leaves LUBI" ~ "Lupinus bicolor",
                             species == "Lupin spp." ~ "Lupinus spp.",
                             species == "Lupinus spp. " ~ "Lupinus spp.",
                             species == "Lupinus succulentus - wide leaves" ~ "Lupinus succulentus",
                             species == "Lupinus succulentus - wide leaves LUSU" ~ "Lupinus succulentus",
                             species == "Malacothamnus fasciculatus " ~ "Malacothamnus fasciculatus",   
                             species == "Phacelia hubbyi PHHU" ~ "Phacelia hubbyi",
                             species == "Phacelia tanacetifolia PHTA" ~ "Phacelia tanacetifolia",
                             species == "Rapistrum rugosum - round pods" ~ "Rapistrum rugosum",
                             species == "Salvia lucophylla" ~ "Salvia leucophylla",
                             species == "Sambucus nigra" ~ "Sambucus mexicana",
                             species == "Sambucs nigra" ~ "Sambucus mexicana",
                             species == "Stipa lepida STLE" ~ "Stipa lepida",
                             
                             species == "Avena spp." ~ "Avena barbata",
                             species == "Calestigia macrostegia" ~ "Calystegia macrostegia",
                             species == "Eucrypta spp." ~ "Eucrypta chrysanthemifolia", # renamed Eucrypta spp. to E. chrysanthemifolia since only one species is found in Ventura County (the second species is a desert species)
                             TRUE ~ species)) %>% 
  
   # here I am omitting variables that are not vascular species
  filter(!species %in% c("bare_ground", "litter", "native_thatch", "moss", "no_species", "wood", "nonnative_litter", "rock", "thatch", "native plant outside of plot")) %>% 
  
  # here I am omitting dead perennial species since in the Methods I wrote:
  # To account for seasonal differences among annual species, percent cover and species richness were calculated by treating “dead” individuals as “alive”. This approach was used since all annual species that were recorded as “dead” were also observed as “alive” within the same transect. 
  # For perennial species, percent cover and species richness were calculated separately for “alive” and “dead” individuals. _Only one transect (transect 1.3) contained a perennial species (Malacothamnus fasciculatus) that was found dead but not also alive._
    dplyr::filter(!str_detect(species, "dead")) %>% 
  left_join(groupsdash, by = "site_rep") %>% 
  left_join(specieslist, by = "species") #%>%  # dim = [1] 1436    9 without distinct()
  # distinct() # dim = [1] 596   9 with distinct()





# sort(unique(spprich$site))
# length(unique(spprich$site_rep))
  
sort(unique(spprich$species))

# here I'm checking for species I need to add to the Species Characteristics List
in_spprich <- sort(unique(spprich$species))
in_spplist <- sort(unique(specieslist$species))

#These are the species that are in spprich that are NOT in the species list
needtoadd <- setdiff(in_spprich, in_spplist)
needtoadd 

#These are the species that are in the species list that are NOT in spprich
extraspp <- setdiff(in_spplist, in_spprich)
extraspp # it's ok if spp in the species list are not recorded in spprich

head(spprich, 10)

```


-  data prep - old (coded before August 2025)
```{r, eval = FALSE}
################## data prep point-intercept transect data
# point_spprich_clean <- point_spprich %>% 



# belt.spp_2019 <- belt.spp_2019_load %>% 
 


# belt.spp_2024 <- belt.spp_2024_load %>% 
#   dplyr::select(site, rep, species) %>% 
#   mutate(site_rep = paste(site, rep, sep = ".")) %>% 
#   filter(species != "moss") %>%
#   mutate(species = str_replace(species, " ", "_")) %>% 
#   mutate(species = case_when(species == "Toxicodendron_pubescens" ~ "Toxicodendron_diversilobum", # old name ~ new name
#                              species == "Sambucus_nigra" ~ "Sambucus_mexicana",
#                              TRUE ~ species))

# 
# 
# ################## load point intercept transect data
# 
# abcover_full_load <- read.csv("deg_percentcover_byspecies_bylifeform.csv", header = TRUE, na.strings=c("","NA")) # point-intercept data
# 
# file_transect_2019_load <- read_excel("deg_percentcover_byspecies_bylifeform_2024.xlsx", sheet = "2019_data")
# 
# ab_sppr_raw <- abcover_full_load %>% 
#   dplyr::select(!c(X, distance, vertical)) %>% 
#   filter(status != "ground") %>% # unselect ground
#    mutate(site = case_when(
#     site == "Intact_1" ~ "Intact1",
#       site == "Intact_2" ~ "Intact2",
#       site == "Intact_3" ~ "Intact3",
#     TRUE ~ as.character(site)  # Keep other observations unchanged
#   )) %>% 
#   mutate(site_rep = paste(site, rep, sep = "_")) %>%
#    mutate(site_rep = case_when(
#     site_rep == "DEG2_4" ~ "DEG2_1", # old name ~ new name
#       site_rep == "DEG2_5" ~ "DEG2_2",
#       site_rep == "DEG2_6" ~ "DEG2_3",
#      site_rep == "ENH2_4" ~ "ENH2_1",
#       site_rep == "ENH2_5" ~ "ENH2_2",
#      site_rep == "ENH2_6" ~ "ENH2_3",
#     TRUE ~ as.character(site_rep))) %>%   # Keep other observations unchanged
#    filter(!is.na(site)) %>% # omit blank cells in species 
#     as_tibble() %>% 
#   mutate(species = case_when(
#     species == "Avena barbata dead" ~ "Avena barbata", # old name ~ new name
#     species == "Bromus diandrus dead" ~ "Bromus diandrus", 
#      species == "Bromus madritensis" ~ "Bromus rubens", 
#      species == "Bromus rubens dead" ~ "Bromus rubens", 
#        species == "Bromus spp. dead" ~ "Bromus spp.", 
#      species == "Centaurea melitensis dead" ~ "Centaurea melitensis", 
#     species == "Elymus condensatus dead" ~ "Elymus condensatus", 
#    species == "Heteromeles arbutifolia dead" ~ "Heteromeles arbutifolia",
#    species == "Hirschfeldia incana dead" ~ "Hirschfeldia incana",
#     species == "Malacothamnus fasciculatus dead" ~ "Malacothamnus fasciculatus", 
#    species == "Salvia leucophylla dead" ~ "Salvia leucophylla",
#    species == "Stipa lepida dead" ~ "Stipa lepida",
#    TRUE ~ as.character(species)
#   )) %>% 
#    mutate(site_rep_species = paste(site_rep, species, sep = "_")) 



```

(coded before August 2025)
```{r, eval = FALSE}




# belt.spprich <- bind_rows(belt.spp_2019, belt.spp_2024) 
# sort(unique(belt.spprich$species))


# List of seven unknown species: chaparraldegradation2022 > chaparraldegradation2022 > unknown_spp.xlsx

# specieslist 

### join species characteristics
# sppchar <- read.csv("processed/specieslist.csv") %>% # species and their characteristics :) Created in 1.1_transect_continuous.Rmd
#   dplyr::select(!c(X)) %>%
#   # mutate(species = str_replace(species, " ", "_")) %>%
#   mutate(species = gsub("\u00A0", " ", species, fixed = TRUE)) %>%
#   mutate(species = str_replace(species, " ", "_")) %>% 
#   mutate(family = case_when(family == "Agavaceae  " ~ "Agavaceae", # old name ~ new name
#                              family == "Boraginaceae " ~ "Boraginaceae",
#                               family == "Chenopodiaceae  " ~ "Chenopodiaceae",
#                               family == "Fagaceae  " ~ "Fagaceae",
#                             family == "Onagraceae  " ~ "Onagraceae",
#                             family == "Ranunculaceae  " ~ "Ranunculaceae",
#                             family == "Urticaceae  " ~ "Urticaceae",
#                              TRUE ~ family))

#These are the species that are in belt.spprich that are NOT in the species characteristics list
# a <- sort(unique(belt.spprich$species))
# b <- sort(unique(sppchar$species))
# c <- sort(unique(specieslist$species))

# speciesmissingfrom.sppchar <- setdiff(c, b) # <- KIT - can you help resolve this issue? I added the missing species and their characteristics to "processed/specieslist.csv" but they're not joining

# speciesmissingfrom.sppchar 

# speciesmissingfrom.belt <- setdiff(b, a)
# speciesmissingfrom.belt

# list of seven unknown species
# unknown.spp <- read_excel("unknown_spp.xlsx")

# belt <- belt.spprich %>% 
#   left_join(sppchar, by = "species") %>% 
#    mutate(site_rep_species = paste(site_rep, species, sep = "_")) 


```

- point intercept - old code (coded before August 2025)
```{r}

# sort(unique(ab_sppr_raw$species))
# length(unique(ab_sppr_raw$site_rep_species))
# 107

# ptintcp_list <- list(unique(ab_sppr_raw$site_rep_species))

```


# RICHNESS - overall

### - totals for above ground transects
```{r}

# find duplicate species
spprich %>% 
  dplyr::select(species) %>% 
  dplyr::filter(str_detect(species, "spp.")) %>% 
  distinct()
# Erodium spp.				
# Lupinus spp.				
# Cryptantha spp.				
# Galium spp.				
# Phacelia spp.				
# Thysanocarpus spp.				
# Trifolium spp.

spprich %>% 
  dplyr::select(species) %>% 
  # dplyr::filter(str_detect(species, "Erodium")) %>%  # Erodium cicutarium & Erodium spp.
  # dplyr::filter(str_detect(species, "Lupinus")) %>% # Lupinus bicolor & Lupinus succulentus & Lupinus spp.
  # 
  # dplyr::filter(str_detect(species, "Cryptantha")) %>% # Cryptantha spp.
  # 
  # dplyr::filter(str_detect(species, "Galium")) %>% # Galium porrigens	& Galium spp.	& Galium californicum
  # dplyr::filter(str_detect(species, "Phacelia")) %>% # Phacelia hubbyi				Phacelia viscida			Phacelia distans				Phacelia spp.				Phacelia tanacetifolia
  # dplyr::filter(str_detect(species, "Thysanocarpus")) %>% # Thysanocarpus curvipes  Thysanocarpus spp.
  dplyr::filter(str_detect(species, "Trifolium")) %>% # Trifolium gracilentum				Trifolium spp.
  distinct()


############# species 
# omit duplicate species from total spp richness count
length(
  (spprich %>% 
  dplyr::select(species) %>% 
    
  ### here I'm omitting the species with "spp." if we already account for the species the plant could be 
  ### (e.g., omitting Lupinus spp. becuase we account for Lupinus bicolor & Lupinus succulentus, the two speices we had out at Piru)
  ### This often happen when we didn't record which species we saw in the transect
    filter(!species %in% c("Erodium spp.", 
                         "Lupinus spp.", 
                         "Galium spp.", 
                         "Phacelia spp.", 
                         "Thysanocarpus spp.", 
                         "Trifolium spp.")) %>% 
     dplyr::filter(!str_detect(species, "Unknown|unknown")) %>% # 6 unknown species
  distinct())$species) #  81 known species


############# genera 
length(
  (spprich %>% 
  dplyr::select(species) %>% 
     dplyr::filter(!str_detect(species, "Unknown|unknown")) %>% # 6 unknown genera
  separate(species, into = c("genera", "species"), sep = " ") %>% 
    dplyr::select(genera) %>% 
    
      distinct()) $genera)  # 67 known genera


############# family
length(
  (spprich %>% 
  dplyr::select(family) %>%
    dplyr::filter(!str_detect(family, "Unknown|unknown")) %>% # omit unknown families "unknown"
    distinct())$family) # 38 known families
```

```{r, eval = FALSE}

############################################ OLD CODE
# belt.spprich_total <- belt %>% 
#   filter(species != "Erodium_spp.") %>% 
#   filter(species != "Galium_spp.") %>% 
#   filter(species != "Lupinus_spp.") %>% 
#     filter(species != "Phacelia_spp.") %>% 
#     filter(species != "Trifolium_spp.")
# sort(unique(belt.spprich_total$species))
# 
# length(sort(unique(belt.spprich_total$species)))
#### 87 species

   
# erodium <- belt.spp_2019 %>%  filter(grepl("Erodium", species))
# lupin <- belt.spp_2019 %>%  filter(grepl("Lupinus", species))
# 
# belt.spp_2019 %>% 
#   filter(!(species == "Lupinus spp." & site_rep == "1.1")) %>% 
#   filter(!(species == "Lupinus spp." & site_rep == "1.2"))


```

### - by status and lifeform
```{r}
############# native
length(
  (spprich %>% 
     filter(status == "native") %>% 
     dplyr::select(species) %>% 
      filter(!species %in% c("Erodium spp.", # omit duplicate "spp." species
                         "Lupinus spp.", 
                         "Galium spp.", 
                         "Phacelia spp.", 
                         "Thysanocarpus spp.", 
                         "Trifolium spp.")) %>% 
     dplyr::filter(!str_detect(species, "Unknown|unknown")) %>% # omit unknown species
  distinct())$species) # n = 67 species

# native species by lifeform
spprich %>% 
     filter(status == "native") %>% 
      filter(!species %in% c("Erodium spp.", # omit duplicate "spp." species
                         "Lupinus spp.", 
                         "Galium spp.", 
                         "Phacelia spp.", 
                         "Thysanocarpus spp.", 
                         "Trifolium spp.")) %>% 
     dplyr::filter(!str_detect(species, "Unknown|unknown")) %>%
  group_by(lifeform) %>% 
  summarize(n_lifeform = length(unique(species)))
#   lifeform     n_lifeform

# 1 fern                  2
# 2 forb                 46
# 3 forb or vine          2
# 4 grass                 2
# 5 shrub                14
# 6 tree                  1



############# nonnative
length(
  (spprich %>% 
     filter(status == "nonnative") %>% 
     dplyr::select(species) %>% 
     dplyr::filter(!str_detect(species, "Unknown|unknown")) %>% # omit unknown species
    filter(!species %in% c("Erodium spp.", # omit duplicate "spp." species
                         "Lupinus spp.", 
                         "Galium spp.", 
                         "Phacelia spp.", 
                         "Thysanocarpus spp.", 
                         "Trifolium spp.")) %>% 
  distinct())$species)  # n = 14 nonnative species

# nonnative species by lifeform
spprich %>% 
     filter(status == "nonnative") %>% 
      filter(!species %in% c("Erodium spp.", # omit duplicate "spp." species
                         "Lupinus spp.", 
                         "Galium spp.", 
                         "Phacelia spp.", 
                         "Thysanocarpus spp.", 
                         "Trifolium spp.")) %>% 
     dplyr::filter(!str_detect(species, "Unknown|unknown")) %>%
  group_by(lifeform) %>% 
  summarize(n_lifeform = length(unique(species)))
#   lifeform n_lifeform
#  forb              9
#  grass             5

67+14
# 81


```


# TRANSECT spprich

### - x nngrass
```{r}
###### total richness
spprich_trans <- spprich %>% # transect: total spp richness 
  distinct() %>% 
  group_by(site_rep) %>% 
  summarize(N_spprich = length(species)) %>% 
  left_join(
    (cover_bylfstatus_wide %>% 
       mutate(site_rep = case_when(
         site_rep == "INT5_5" ~ "INT5_1", TRUE ~ site_rep))
     ), by = c("site_rep"))

plot_spprich <- ggplot(data = spprich_trans,
       aes(x = grass_nonnative*100, 
         y = N_spprich)) + 
      geom_point(size = 3) +

    geom_smooth(method = "lm", se = TRUE, color = "gray50", linetype = "solid") + # se = confidence interval
   # stat_smooth(method = "lm", formula = y ~ poly(x, 2), se = TRUE, color = "black", linewidth = 1) +
  
  labs(
    #  title = "Linear regression of  total shrub cover by non-native grass cover",
    x = "Non-native grass cover (%)",
    y = "Species Richness (n)"
    ) +
  scale_x_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 10)) + # Set x-axis limits and breaks
  scale_y_continuous(limits = c(0, 30), breaks = seq(0, 30, by = 5), expand = expansion(mult = c(0, 0.05))) + # Set y-axis limits and breaks
  theme_bw() +
  theme(axis.text = element_text(size = 16)) + # axes numbers
  theme(axis.title = element_text(size = 20)) + # axes titles
  theme(legend.title=element_text(size = 16)) + 
  theme(legend.text=element_text(size = 16))

plot_spprich
```

### - x status
```{r}

######## richness by status
spprich_trans_status <- spprich %>%  # transect: spp richness by status
  distinct() %>% 
  group_by(site_rep, status) %>% 
  summarize(N_spprich = length(species)) %>% 
  left_join(
    (cover_bylfstatus_wide %>% 
       mutate(site_rep = case_when(
         site_rep == "INT5_5" ~ "INT5_1", TRUE ~ site_rep))
     ), by = c("site_rep"))


plot_spprich_native <- ggplot(data = spprich_trans_status 
                              %>%  filter(status == "native"), # or status == "nonnative"
       aes(x = grass_nonnative*100, 
         y = N_spprich)) + 
      geom_point(aes(color = status, shape = status), size = 3) +
  geom_smooth(method = "lm", se = TRUE, color = "gray50", linetype = "solid") + # se = confidence interval
  labs(
    #  title = "Linear regression of  total shrub cover by non-native grass cover",
    x = "Non-native grass cover (%)",
    y = "Species Richness (n)", 
   color = "Status", 
   shape = "Status"
    ) +
  scale_x_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 10)) + # Set x-axis limits and breaks
  scale_y_continuous(limits = c(0, 30), breaks = seq(0, 30, by = 5), expand = expansion(mult = c(0, 0.05))) + # Set y-axis limits and breaks
  theme_bw() +
  theme(axis.text = element_text(size = 16)) + # axes numbers
  theme(axis.title = element_text(size = 20)) + # axes titles
  theme(legend.title=element_text(size = 16)) + 
  theme(legend.text=element_text(size = 16))




plot_spprich_native

```

### - x status and lifeform
```{r}

######## richness by status and lifeform
spprich_trans_status_lf <- spprich %>%  
  distinct() %>% 
  group_by(site_rep, status, lifeform) %>% 
  summarize(N_spprich = length(species)) %>% 
  left_join(
    (cover_bylfstatus_wide %>% 
       mutate(site_rep = case_when(
         site_rep == "INT5_5" ~ "INT5_1", TRUE ~ site_rep))
     ), by = c("site_rep"))


### shrubs
plot_spprich_shrub <- ggplot(data = spprich_trans_status_lf %>% 
                               # filter(grass_nonnative < .6) %>% 
                               filter(status == "native" & lifeform == "shrub"),
                               
       aes(x = grass_nonnative*100, 
         y = N_spprich)) + 
      geom_point(aes(color = status, shape = status), size = 3) +
  geom_smooth(method = "lm", se = TRUE, color = "gray50", linetype = "solid") + # se = confidence interval
  labs(
    #  title = "Linear regression of  total shrub cover by non-native grass cover",
    x = "Non-native grass cover (%)",
    y = "Native shrub speices richness (n)", 
   color = "Status", 
   shape = "Status"
    ) +
  scale_x_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 10)) + # Set x-axis limits and breaks
  scale_y_continuous(limits = c(0, 30), breaks = seq(0, 30, by = 5), expand = expansion(mult = c(0, 0.05))) + # Set y-axis limits and breaks
  theme_bw() +
  theme(axis.text = element_text(size = 16)) + # axes numbers
  theme(axis.title = element_text(size = 20)) + # axes titles
  theme(legend.title=element_text(size = 16)) + 
  theme(legend.text=element_text(size = 16))

plot_spprich_shrub

plot_spprich_nng <- ggplot(data = spprich_trans_status_lf 
                              %>%  filter(status == "nonnative" & lifeform == "grass"), 
       aes(x = grass_nonnative*100, 
         y = N_spprich)) + 
      geom_point(aes(color = status, shape = status), size = 3) +
  geom_smooth(method = "lm", se = TRUE, color = "gray50", linetype = "solid") + # se = confidence interval
 stat_smooth(method = "lm", formula = y ~ poly(x, 2), se = TRUE, color = "black", linewidth = 1) +
    labs(
    #  title = "Linear regression of  total shrub cover by non-native grass cover",
    x = "Non-native grass cover (%)",
    y = "Non-native grass species richness (n)", 
   color = "Status", 
   shape = "Status"
    ) +
  scale_x_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 10)) + # Set x-axis limits and breaks
  scale_y_continuous(limits = c(0, 6), breaks = seq(0, 5, by = 1), expand = expansion(mult = c(0, 0.05))) + # Set y-axis limits and breaks
  theme_bw() +
  theme(axis.text = element_text(size = 16)) + # axes numbers
  theme(axis.title = element_text(size = 20)) + # axes titles
  theme(legend.title=element_text(size = 16)) + 
  theme(legend.text=element_text(size = 16))

plot_spprich_nng

```

### - by lifecycle
```{r}

######## richness by status and lifeform
spprich_trans_status_lf_lc <- spprich %>%  
  distinct() %>% 
  group_by(site_rep, status, lifeform, lifecycle) %>% 
  summarize(N_spprich = length(species)) %>% 
  left_join(
    (cover_bylfstatus_wide %>% 
       mutate(site_rep = case_when(
         site_rep == "INT5_5" ~ "INT5_1", TRUE ~ site_rep))
     ), by = c("site_rep"))


### perennial
plot_spprich_perennial <- ggplot(data = spprich_trans_status_lf_lc %>% 
          group_by(site_rep, lifecycle, grass_nonnative) %>% 
          summarize(tot_N_spprich = sum(N_spprich)) %>% 
          filter(lifecycle == "perennial"),
                               
       aes(x = grass_nonnative*100, 
         y = tot_N_spprich)) + 
      geom_point(aes(color = lifecycle, shape = lifecycle), size = 3) +
  geom_smooth(method = "lm", se = TRUE, color = "gray50", linetype = "solid") + # se = confidence interval
   stat_smooth(method = "lm", formula = y ~ poly(x, 2), se = TRUE, color = "black", linewidth = 1) +
  labs(
    #  title = "Linear regression of  total shrub cover by non-native grass cover",
    x = "Non-native grass cover (%)",
    y = "Perennial species richness (n)", 
   color = "Lifecylce", 
   shape = "Lifecylce"
    ) +
  scale_x_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 10)) + # Set x-axis limits and breaks
  scale_y_continuous(limits = c(0, 20), breaks = seq(0, 25, by = 5), expand = expansion(mult = c(0, 0.05))) + # Set y-axis limits and breaks
  theme_bw() +
  theme(axis.text = element_text(size = 16)) + # axes numbers
  theme(axis.title = element_text(size = 20)) + # axes titles
  theme(legend.title=element_text(size = 16)) + 
  theme(legend.text=element_text(size = 16))


### perennial
plot_spprich_annual <- ggplot(data = spprich_trans_status_lf_lc %>% 
          group_by(site_rep, lifecycle, grass_nonnative) %>% 
          summarize(tot_N_spprich = sum(N_spprich)) %>% 
          filter(lifecycle == "annual"),
                               
       aes(x = grass_nonnative*100, 
         y = tot_N_spprich)) + 
      geom_point(aes(color = lifecycle, shape = lifecycle), size = 3) +
  geom_smooth(method = "lm", se = TRUE, color = "gray50", linetype = "solid") + # se = confidence interval
   stat_smooth(method = "lm", formula = y ~ poly(x, 2), se = TRUE, color = "black", linewidth = 1) +
  labs(
    #  title = "Linear regression of  total shrub cover by non-native grass cover",
    x = "Non-native grass cover (%)",
    y = "Annual species richness (n)", 
   color = "Lifecylce", 
   shape = "Lifecylce"
    ) +
  scale_x_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 10)) + # Set x-axis limits and breaks
  scale_y_continuous(limits = c(0, 20), breaks = seq(0, 25, by = 5), expand = expansion(mult = c(0, 0.05))) + # Set y-axis limits and breaks
  theme_bw() +
  theme(axis.text = element_text(size = 16)) + # axes numbers
  theme(axis.title = element_text(size = 20)) + # axes titles
  theme(legend.title=element_text(size = 16)) + 
  theme(legend.text=element_text(size = 16))



```


# CLUSTER spprich
```{r}

spprich_cov <- spprich_trans %>%
  mutate(cluster = as.character(cluster)) %>% 
  mutate(cluster = case_when(
                            cluster == "1" ~ "NNG",
                             cluster == "3" ~ "ssG",
                             cluster == "2" ~ "ssF",
                             cluster == "4" ~ "ssFG",
                             cluster == "5" ~ "EVG",
                             TRUE ~ cluster)) %>% 
  group_by(cluster) %>%
  summarise(
    mean_cluster_spprich = mean(N_spprich),
    n = length(N_spprich),
    sd = sd(N_spprich),
    se = ((sd(N_spprich))/sqrt(length((N_spprich)))), 
    .groups = "drop") 
#   cluster mean_cluster_spprich     n    sd    se
#   <chr>                  <dbl> <int> <dbl> <dbl>
# 1 EVG                     17.4     5  6.43 2.87 
# 2 NNG                     12.5    10  2.32 0.734
# 3 ssF                     17.1     7  2.73 1.03 
# 4 ssFG                    17.5     8  4.14 1.46 
# 5 ssG                     12.4    10  3.47 1.10 

hist(spprich_trans$N_spprich)
shapiro.test(spprich_trans$N_spprich)
# W = 0.9774, p-value = 0.5939 <- normal!

aov_cluster_spprich <- aov(N_spprich ~ cluster, 
                           spprich_trans %>% mutate(cluster = as.character(cluster)) %>% 
                             mutate(cluster = case_when(
                                     cluster == "1" ~ "NNG",
                                     cluster == "3" ~ "ssG",
                                     cluster == "2" ~ "ssF",
                                     cluster == "4" ~ "ssFG",
                                     cluster == "5" ~ "EVG",
                                     TRUE ~ cluster))
                           )
summary(aov_cluster_spprich) # <- sig
TukeyHSD(aov_cluster_spprich, conf.level=.95)
# cluster
#                diff          lwr         upr     p adj
# NNG-EVG  -4.9000000 -10.77379714  0.97379714 0.1396574
# ssF-EVG  -0.2571429  -6.53649613  6.02221041 0.9999543
# ssFG-EVG  0.1000000  -6.01364189  6.21364189 0.9999988
# ssG-EVG  -5.0000000 -10.87379714  0.87379714 0.1266398
# 
# ssF-NNG   4.6428571  -0.64200614  9.92772042 0.1078427
# ssG-NNG  -0.1000000  -4.89593528  4.69593528 0.9999969
#
# ssFG-ssF  0.3571429  -5.19307374  5.90735946 0.9997244
# 
# ssFG-NNG  5.0000000  -0.08685754 10.08685754 0.0559772  <-- kinda
# ssG-ssF  -4.7428571 -10.02772042  0.54200614 0.0962086  <-- kinda
# ssG-ssFG -5.1000000 -10.18685754 -0.01314246 0.0491466 <-- sig
```


```{r}
print("you've reached the end of the code!")

```


# END




##### - genera
```{r, eval = FALSE}
################ genera richness

belt.genrich <- belt %>% 
  separate(col = species, into = c("Genus", "Species"), sep = "_") %>%
  dplyr::select("Genus") 
length(sort(unique(belt.genrich$Genus))) - 4 # minus 4 unknowns
# 67 

```

##### - family
```{r, eval = FALSE}


################ family richness

belt_famrich <- belt %>% 
   dplyr::select("family") 
# sort(unique(belt_famrich$family))
length(sort(unique(belt_famrich$family))) - 1 # duplicate Chenopodiaceae
# 36

```


```{r duplicate sppr, include=FALSE, eval = FALSE}

# total spp richness using ab_sppr_raw and belt dfs - same calculation as above (n = 87)

ab_sppr_raw2 <- ab_sppr_raw %>% 
  dplyr::select(site, rep, species, site_rep, lifeform, status, lifecycle, family, site_rep_species)


belt2 <- belt %>% 
   mutate(species = str_replace(species, "_", " "))
  sort(unique(belt2$species))
  
ab_totalsppr <- dplyr::union(ab_sppr_raw2, belt2) 
length(unique(ab_totalsppr$species)) -6 # Bromus spp., Erodium spp.,  "Galium spp."  , Lupinus spp., Phacelia spp, Trifolium spp.
# 87

```

```{r, eval = FALSE}
# difference in n species in point intercept transect vs. belt transect
trans_n <- length(unique(ab_sppr_raw %>% 
  dplyr::select(species) %>% 
  pull(species))) - 2 # Bromus spp, Erodium spp
trans_n
# 31

# z <- ab_sppr_raw %>% 
#   dplyr::select(species)
# sort(unique(z$species))

belt_n <- length(unique(belt %>% 
  dplyr::select(species) %>% 
  pull(species))) - 5 # erodium sop., galium spp, lupinus spp., phacelia spp., trifolium spp
belt_n
# 87

# y <- belt %>%
#   dplyr::select(species)
# sort(unique(y$species))

87-31
# 56

round(31/87*100, 2)
# [1] 35.63
```


# NATIVE lifeforms
```{r, eval = FALSE}

####### shrub
length(sort(unique(
  belt %>% 
  filter(status == "native") %>% 
  filter(lifeform == "shrub") %>% 
    pull(species))))
# 14


####### grass
length(sort(unique(
  belt %>% 
  filter(status == "native") %>% 
  filter(lifeform == "grass") %>% 
    pull(species))))
#2


####### forb
length(sort(unique(
  belt %>% 
  filter(status == "native") %>% 
  filter(lifeform == "forb") %>% 
    pull(species)))) - 4 # remove four "spp." -->  "Galium_spp."     "Lupinus_spp."    "Phacelia_spp."  "Trifolium_spp." 
# 48

# and one fern 
```

# NN lifeforms
```{r, eval = FALSE}

####### grass
length(sort(unique(
  belt %>% 
  filter(status == "nonnative") %>% 
  filter(lifeform == "grass") %>% 
    pull(species))))
# 5

####### forb
length(sort(unique(
  belt %>% 
  filter(status == "nonnative") %>% 
  filter(lifeform == "forb") %>% 
    pull(species))))
# 12


```


# sampling effort

```{r, eval = FALSE}

# Calculate species accumulation
species_accum <- specaccum(species_data)

# Plot the species accumulation curve
plot(species_accum, xlab = "Sampling Sites", ylab = "Species Richness", main = "Species Accumulation Curve")

# Add confidence intervals
plot(species_accum, ci.type="polygon", col="blue", ci.col="lightblue", xlab = "Sampling Sites", ylab = "Species Richness", main = "Species Accumulation Curve with CI")

# Add species richness estimator (Chao, Jackknife, etc.)
chao <- estimateR(belt.spp_2019)
chao

```




##### - shrub density 
```{r, eval = FALSE}
################################ shrub density


# native shrub density 
shrubdensitylife_full <- read_csv("~/Dropbox/GRADSCHOOL/Dissertation/R_dissertation/chaparraldegradation_2022/chaparraldegradation_2022/deg_beltdensity_bylifestage.csv", 
    col_types = cols(
      StandType = col_character(), 
      Site = col_character(),
      rep = col_integer(),
      ScientificName = col_character(), 
      dead = col_integer(),
      immature = col_integer(),
      mature = col_integer(), 
      resprout = col_integer(), 
      seedling = col_integer()
      )
     ) %>% 
  rename()
  


shrubdensityspp_full <- read_csv("~/Dropbox/GRADSCHOOL/Dissertation/R_dissertation/chaparraldegradation_2022/chaparraldegradation_2022/data/deg_beltdensity_byspecies.csv")
# shrubdensityalive_full <- read_csv("~/Dropbox/GRADSCHOOL/Dissertation/R_dissertation/deg_beltdensity_seperatealive.csv")
```






overall native richness
- sppr
```{r native species richness, include=FALSE, eval=FALSE}
native_spp <- ab_totalsppr %>% 
   filter(status == "native") # %>% 
  # filter(species! = "Lupinus spp.") # unselect spp.
  # 

sort(unique(native_spp$species)) # 39 species
length(unique(native_spp$species)) # for Lupinus spp. ;  37 species
```

- family richness
```{r transect native family richness, eval=FALSE}
sort(unique(native_spp$family))
length(unique(native_spp$family))  # 24 families
```

overall non-native richness
- sppr
```{r nnnative species richness, eval=FALSE}
nn_sppr <- ab_totalsppr %>% 
   filter(status == "nonnative") 

sort(unique(nn_sppr$species))
length(unique(nn_sppr$species))-2 # for Bromus spp. and "Erodium spp." ; 10 species
```

- family richness
```{r transect native family richness, eval=FALSE}
sort(unique(nn_sppr$family))
length(unique(nn_sppr$family)) # 4 families
```
 stats - categorical by hillslope (n = 15)
- data prep
```{r, eval = FALSE}
ab_totalsppr_hillslope <- ab_totalsppr %>%  # n = 15
  group_by( site, site_rep) %>% #standtype,
  summarize(sppr = n_distinct(site_rep_species)) 
  

sppr_bystatus <- ab_totalsppr %>% # n = 33
  group_by(site, site_rep, status) %>% # standtype, 
  summarize(sppr = n_distinct(site_rep_species))
```

- normality 
```{r, eval = FALSE}
# data vis
length(ab_totalsppr_hillslope$sppr) # n = 15
hist(ab_totalsppr_hillslope$sppr) 

min(ab_totalsppr_hillslope$sppr) # 10 species
max(ab_totalsppr_hillslope$sppr) # 22 species

shapiro.test(ab_totalsppr_hillslope$sppr)
# Shapiro-Wilk normality test
# 
# data:  ab_totalsppr_hillslope$sppr
# W = 0.91175, p-value = 0.1441 <-- normally distributed
```

 - anova - hillslope
```{r, eval = FALSE}
summary(aov(sppr ~ site, ab_totalsppr_hillslope))
#  Df Sum Sq Mean Sq F value   Pr(>F)    
# site         6 223.60   37.27   31.94 3.62e-05 *** <-- sig
# Residuals    8   9.33    1.17                      

TukeyHSD(aov(sppr ~ site, ab_totalsppr_hillslope))
# Fit: aov(formula = sppr ~ site, data = ab_totalsppr_hillslope)
# 
# $site
#               diff          lwr       upr     p adj
# SD2-SD1   2.000000  -3.83171698  7.831717 0.8311488
# SD3-SD1  -3.000000  -8.83171698  2.831717 0.4961437
# MX1-SD1  -1.000000  -5.76157698  3.761577 0.9780860
# MX2-SD1  -9.666667 -14.42824364 -4.905090 0.0006579 <-- MX2-SD1
# GD1-SD1  -8.000000 -12.76157698 -3.238423 0.0023942 <--GD1-SD1  0.0023942
# GD2-SD1  -6.333333 -11.09491031 -1.571756 0.0104732 <--GD2-SD1 

# SD3-SD2  -5.000000 -10.83171698  0.831717 0.1015938
# MX1-SD2  -3.000000  -7.76157698  1.761577 0.3046200
# MX2-SD2 -11.666667 -16.42824364 -6.905090 0.0001711 <--MX2-SD2
# GD1-SD2 -10.000000 -14.76157698 -5.238423 0.0005182 <--GD1-SD2 0.0005182
# GD2-SD2  -8.333333 -13.09491031 -3.571756 0.0018235 <--GD2-SD2

# MX1-SD3   2.000000  -2.76157698  6.761577 0.6853253
# MX2-SD3  -6.666667 -11.42824364 -1.905090 0.0076753 <--MX2-SD3
# GD1-SD3  -5.000000  -9.76157698 -0.238423 0.0390970 <--GD1-SD3 0.0390970
# GD2-SD3  -3.333333  -8.09491031  1.428244 0.2198423

# MX2-MX1  -8.666667 -12.03361004 -5.299723 0.0001192 <-- MX2-MX1
# GD1-MX1  -7.000000 -10.36694337 -3.633057 0.0005566 <--GD1-MX1
# GD2-MX1  -5.333333  -8.70027670 -1.966390 0.0035214 <--GD2-MX1

# GD1-MX2   1.666667  -1.70027670  5.033610 0.5337581
# GD2-MX2   3.333333  -0.03361004  6.700277 0.0525268 <-- 0.053

# GD2-GD1   1.666667  -1.70027670  5.033610 0.5337581

# SUMMARY
# GD1 is sig diff from INT hillslopes
# GD2 is sig diff from INT1 and 2 and MX1 but not INT3

# MX2 is sig diff from INT and MX1 hillslopes




```

```{r, eval = FALSE}
ggplot(ab_totalsppr_hillslope) +
  stat_summary(
     mapping = aes(x = site, y = sppr),
    fun.min = min,
    fun.max = max,
    fun = median
  )+
  ylim(0,25)

ggplot(data = ab_totalsppr_hillslope, 
       mapping = aes(x = site, y = sppr)) + 
  geom_boxplot() +
  ylim(0,25)

boxplot(sppr ~ site, data = ab_totalsppr_hillslope)
```


```{r, eval = FALSE}
sppr_lm <- ggplot(data = ab_totalsppr_hillslope, 
       aes(x = site, y = sppr)) +
  geom_point(aes(color = site, shape = site), size = 3, alpha = 0.8) +
  scale_color_manual(values = c( "lightblue", "cornflowerblue", "blue","green", "darkgreen", "orange", "brown")) + #"gray0",
   scale_shape_manual(values = c(17, 17, 17, 15, 15, 16,16)) + 
   ylim(0, 25) +
  geom_smooth(method = "lm", se = FALSE, linetype = "solid", color = "black") +  # lm, loess, glm
  labs(x = "Hillslope", 
       y = "Species richness (#)", 
       title = "Species richness by hillslope") +
  
   stat_poly_line() +
  stat_poly_eq(use_label(c("eq", "R2"))) +
  theme_bw() 
sppr_lm

sppr_bystatus_lm <- ggplot(data = sppr_bystatus, 
       aes(x = site, y = sppr)) +
    geom_point(aes(color = site, shape = status), size = 3, alpha = 0.8, stroke = 2) +
   scale_fill_manual(values = c("gray", "white", "black")) +  # Fill colors for each status
  scale_color_manual(values = c( "lightblue", "cornflowerblue", "blue","green", "darkgreen", "orange", "brown")) + #"gray0",
 #  scale_shape_manual(values = c(17, 17, 17, 15, 15, 16,16)) + 
   ylim(0, 25) +
  geom_smooth(method = "lm", se = FALSE, linetype = "solid", color = "black") +  # lm, loess, glm
  labs(x = "Hillslope", 
       y = "Species richness (#)", 
       title = "Native and Non-native species richness by hillslope") +
   stat_poly_line() +
  stat_poly_eq(use_label(c("eq", "R2"))) +
  theme_bw() 
sppr_bystatus_lm


sppr_bystatus$site_rep <- factor(sppr_bystatus$site_rep, levels=c("Intact1_1", "Intact2_2", "Intact3_3", "ENH1_1", "ENH1_2", "ENH1_3", "ENH2_1", "ENH2_2", "ENH2_3", "DEG1_1", "DEG1_2", "DEG1_3", "DEG2_1", "DEG2_2", "DEG2_3"))

ggplot(data = sppr_bystatus, 
       aes(x = site_rep, y = sppr)) +
    geom_point(aes(color = site, shape = status), size = 3, alpha = 0.8) +
  scale_color_manual(values = c( "lightblue", "cornflowerblue", "blue","green", "darkgreen", "orange", "brown")) + #"gray0",
  # scale_shape_manual(values = c(17, 17, 17, 15, 15, 16,16)) + 
   ylim(0, 25) +
  geom_smooth(method = "lm", se = FALSE, linetype = "solid", color = "black") +  # lm, loess, glm
  labs(x = "Hillslope", 
       y = "Species richness (#)", 
       title = "Native and Non-native species richness by transect") +
   stat_poly_line() +
  stat_poly_eq(use_label(c("eq", "R2"))) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) # turn x-axis labels 90 degrees

```

 - anova - status x hillslope

- normality - native
```{r native anova sppr, eval = FALSE}
# data vis
length(sppr_bystatus$sppr) # n = 33 = 15 x 2 + 3 unknowns

hist((sppr_bystatus %>% 
       filter(status == "native"))$
       sppr) 

min((sppr_bystatus %>% 
       filter(status == "native"))$
       sppr) # 3 native species
max((sppr_bystatus %>% 
       filter(status == "native"))$
       sppr) # 18 native species

shapiro.test((sppr_bystatus %>% 
       filter(status == "native"))$
       sppr)
# Shapiro-Wilk normality test
# 
# data:  (sppr_bystatus %>% filter(status == "native"))$sppr
# W = 0.96634, p-value = 0.8007 <-- normaly distributed


summary(aov(sppr ~ site, sppr_bystatus %>% 
       filter(status == "native")))
# Df Sum Sq Mean Sq F value   Pr(>F)    
# site         6  264.9   44.16   35.32 2.47e-05 ***
# Residuals    8   10.0    1.25   

TukeyHSD(aov(sppr ~ site, sppr_bystatus %>% 
       filter(status == "native")))
# $site
#                diff         lwr        upr     p adj
# SD2-SD1   2.0000000  -4.0364006  8.0364006 0.8502944 <-- SDs are all similar 
# SD3-SD1  -3.0000000  -9.0364006  3.0364006 0.5298787
# SD3-SD2  -5.0000000 -11.0364006  1.0364006 0.1174050
# 
# MX1-SD1  -2.3333333  -7.2620338  2.5953671 0.5767649
# MX1-SD2  -4.3333333  -9.2620338  0.5953671 0.0911244
# MX1-SD3   0.6666667  -4.2620338  5.5953671 0.9977271.      SD3 and MX1 are the same
# 
# MX2-SD1 -11.6666667 -16.5953671 -6.7379662 0.0002199 <-- SD1 greater than MX2, GD1 and 2
# GD1-SD1  -8.3333333 -13.2620338 -3.4046329 0.0022958 <--
# GD2-SD1  -7.0000000 -11.9287004 -2.0712996 0.0070286 <--
# 


# 
# MX2-SD2 -13.6666667 -18.5953671 -8.7379662 0.0000686 <-- SD2 greater than MX2, GD1 and 2
# GD1-SD2 -10.3333333 -15.2620338 -5.4046329 0.0005245 <--
# GD2-SD2  -9.0000000 -13.9287004 -4.0712996 0.0013684 <--
# 

# MX2-SD3  -8.6666667 -13.5953671 -3.7379662 0.0017665 <-- SD3 greater than MX2 and GD1 BUT NOT diff than GD2
# GD1-SD3  -5.3333333 -10.2620338 -0.4046329 0.0334505 <--
# GD2-SD3  -4.0000000  -8.9287004  0.9287004 0.1275715 
# 
# MX2-MX1  -9.3333333 -12.8184508 -5.8482158 0.0000889 <-- MX1 greater than MX2 and GD1 and 2
# GD1-MX1  -6.0000000  -9.4851175 -2.5148825 0.0020356 <--
# GD2-MX1  -4.6666667  -8.1517842 -1.1815492 0.0100614 <--
# 
# GD1-MX2   3.3333333  -0.1517842  6.8184508 0.0620313 <-- 0.06
# GD2-MX2   4.6666667   1.1815492  8.1517842 0.0100614 <-- MX2 less than GD2
# GD2-GD1   1.3333333  -2.1517842  4.8184508 0.7593849

boxplot(sppr ~ site, data = sppr_bystatus %>% 
       filter(status == "native"))
```

- normality - nn
```{r nn anova sppr, eval = FALSE}
hist((sppr_bystatus %>% 
       filter(status == "nonnative"))$
       sppr) 
min((sppr_bystatus %>% 
       filter(status == "nonnative"))$
       sppr) # 4 nn species
max((sppr_bystatus %>% 
       filter(status == "nonnative"))$
       sppr) # 6 nn species

shapiro.test((sppr_bystatus %>% 
       filter(status == "nonnative"))$
       sppr)
# Shapiro-Wilk normality test
# 
# data:  (sppr_bystatus %>% filter(status == "nonnative"))$sppr
# W = 0.78295, p-value = 0.00224 <-- not normally distributed
```




```{r, eval = FALSE}


# Renaming observations
ab_diversity_load <- abcover_full_raw %>%
  #dplyr::select(!c(species == "bare_ground")) 
   mutate(species = case_when(
    species == "Avena barbata dead" ~ "Avena barbata", # old name ~ new name
        species == "Bromus diandrus dead" ~ "Bromus diandrus", 
           species == "Bromus rubens dead" ~ "Bromus rubens", 
       species == "Bromus spp." ~ "Bromus rubens", 
    species == "Bromus spp. dead" ~ "Bromus rubens",
          species == "Bromus madritensis" ~ "Bromus rubens",
     species == "Centaurea melitensis dead" ~ "Centaurea melitensis",
    species == "Erodium cicutarium" ~ "Erodium spp.", 
 #   species == "Elymus condensatus dead" ~ "Elymus condensatus",
 #   species == "Heteromeles arbutifolia dead" ~ "Heteromeles arbutifolia",
    species == "Hirschfeldia incana dead" ~ "Hirschfeldia incana",
 #   species == "Malacothamnus fasciculatus dead" ~ "Malacothamnus fasciculatus",
      #     species == "Salvia leucophylla dead" ~ "Salvia leucophylla",
     # species == "Stipa lepida dead" ~ "Stipa lepida",
    TRUE ~ as.character(species)  # Keep other observations unchanged
  )) %>% 
  mutate(site = case_when(
    site == "Intact_1" ~ "Intact1",
      site == "Intact_2" ~ "Intact2",
      site == "Intact_3" ~ "Intact3",
    TRUE ~ as.character(site)  # Keep other observations unchanged
  )) %>% 
  mutate(standtype = fct_relevel(standtype, 
            "intact", "matrix", "degraded")) %>% 
   mutate(site = fct_relevel(site, 
            "Intact1", "Intact2", "Intact3", "ENH1",    "ENH2", "DEG1",    "DEG2")) %>% 
  filter(species !="native_litter" ) %>% 
  filter(species != "nonnative_thatch") %>% 
  filter(species != "bare_ground") 

sort(unique(ab_diversity_load$species))
sort(unique(ab_diversity_load$site))
glimpse(ab_diversity_load)
#Rows: 1,450
#Columns: 10

# combine site and rep to one column
ab_diversity_load$site_rep <- paste(ab_diversity_load$site, ab_diversity_load$rep, sep="_") 
ab_diversity_load$site_rep_species <- paste(ab_diversity_load$site_rep, ab_diversity_load$species, sep="_") 
sort(unique(ab_diversity_load$site_rep)) 
#"DEG1_1"    "DEG1_2"    "DEG1_3"    "DEG2_4"    "DEG2_5"    "DEG2_6"    
#"ENH1_1"    "ENH1_2"    "ENH1_3"    "ENH2_4"    "ENH2_5"    "ENH2_6"    
#"Intact1_1" "Intact2_2" "Intact3_3"

glimpse(ab_diversity_load)  # species diversity from point-line intercept transect
# Rows: 1,445
#Columns: 10

ab_diversity <- ab_diversity_load %>% 
  dplyr::select(!c(distance, vertical))

#write.csv(ab_diversity, "processed/ab_diversity.csv")
```

-  Belt transect data
 load data
```{r SHRUB species richness by belt transect, include = TRUE, eval=FALSE}
belttrans_byspecies <- read.csv("deg_beltdensity_byspecies.csv")
sort(unique(belttrans_byspecies$species))
sort(unique(belttrans_byspecies$site))
sort(unique(belttrans_byspecies$origin))
sort(unique(belttrans_byspecies$lifespan))

belttrans_sppr <- belttrans_byspecies %>%  
   mutate(
     species = case_when(
        species == "Bromus madritensis" ~ "Bromus rubens", # old name ~ new name
        species == "Erodium cicutarium" ~ "Erodium spp.",      
#       species == "Lupinus spp." ~ "Lupinus bicolor", # lupins are in different transects so leaving as three seperate entries: LUBI, LUSU, and Lupinus spp.
#       species == "Lupinus spp." ~ "Lupinus succulentus",
    TRUE ~ as.character(species)  # Keep other observations unchanged
  )) %>% 
  
    mutate(status = case_when(
        status == "non-native" ~ "nonnative", 
        TRUE ~ as.character(status))) %>% 
  
  mutate(lifespan = case_when(
    lifespan == "Perennial" ~ "perennial", 
     TRUE ~ as.character(lifespan))) %>% 
   filter(site != "ENH2") # why am I omitting ENH2? (feb 7, 2024) <-- STEPHANIE

belttrans_sppr$site <- factor(belttrans_sppr$site, levels=c("Intact1", "Intact2", "Intact3", "ENH1", "DEG1", "DEG2"))
unique(belttrans_sppr$site)
unique(belttrans_sppr$species)
  
# combine site and rep to one column
belttrans_sppr$site_rep <- paste(belttrans_sppr$site, belttrans_sppr$rep, sep="_") 
belttrans_sppr$site_rep_species <- paste(belttrans_sppr$site_rep, belttrans_sppr$species, sep="_") 

belttrans_sppr <- belttrans_sppr %>% 
  dplyr::select(!c("transectsite", "lifestage")) 
sort(unique(belttrans_sppr$site))

glimpse(belttrans_sppr)
sort(unique(belttrans_sppr$site_rep))
sort(unique(belttrans_sppr$site))
sort(unique(belttrans_sppr$species))



write.csv(belttrans_sppr, "processed/belttrans_sppr.csv")
```


```{r belt transect join percent cover, include=TRUE, eval=FALSE}
belttrans_sppr_native <- belttrans_sppr %>% # join above ground species diversity with native transect percent cover
  left_join(nativecover3, by = "site_rep") 
sort(unique(belttrans_sppr_native$site_rep))

#view(belttrans_sppr_native_nn)
glimpse(belttrans_sppr_native)
# Rows: 904
# Columns: 21 

#write.csv(belttrans_sppr_native_nn, "processed/belttrans_sppr_native_nn.csv") #<-- export to EXCEL to create belt transect sppr figures.

```

```{r join sppr from belt and point-intercept transect, eval=FALSE}
# nov. 6, 2023
# KIT - Can you create a df of the total species list (point intercept transect + belt transect species list) at INT 1-3, ENH 1-3, and DEG 1-6?

belt_sppr <- belttrans_sppr %>% #select only site_rep_species from belt trans data
  dplyr::select(c(site_rep_species)) 

pointintercept_sppr <- ab_diversity_native_nn %>% #select only site_rep_species from belt trans data
  dplyr::select(c(site_rep_species))

belt_point_join_sppr <- belt_sppr %>% 
  full_join(pointintercept_sppr, by = "site_rep_species")

belt_point_join_sppr %>% 
  summarize(total_sppr = n_distinct(site_rep_species))
# ahhh.... standtype, site_rep, status, etc. needs to be brougt in from somewhere.... 


```


 Join transect and belt sppr.
```{r species richness above ground, include=TRUE, eval=FALSE}

# created ab_diversity_2 in EXCEL

ab_diversity_2 <- read.csv("processed/ab_diversity_2.csv", header = TRUE, na.strings=c("","NA")) # combined point-intercept transect and belt transect species diversity
nativecover <- read.csv("processed/abcover_nativecover_nngrasscover.csv") # native percent cover from ch1_standdeg_canopy.Rmd
nncover <- read.csv("processed/abcover_nonnativecover_nngrasscover.csv") # non-native percent cover from ch1_standdeg_canopy.Rmd

ab_diversity_2 <- ab_diversity_2 %>% 
  mutate(site = case_when(
    site == "Intact_1" ~ "Intact1",
      site == "Intact_2" ~ "Intact2",
      site == "Intact_3" ~ "Intact3",
    TRUE ~ as.character(site)  # Keep other observations unchanged
  )) %>% 
  mutate(standtype = fct_relevel(standtype, 
            "intact", "matrix", "degraded")) %>% 
   mutate(site = fct_relevel(site, 
            "Intact1", "Intact2", "Intact3", "ENH1",    "ENH2", "DEG1",    "DEG2")) %>% 
   na.omit() 

view(ab_diversity_2)
glimpse(ab_diversity_2)
# Rows: 2,018
# Columns: 9

nativecover <- nativecover %>% 
  dplyr::select(!c(X, standtype.x, standtype.y ))
nncover <- nncover %>% 
  dplyr::select(c(site_rep, percentcover_nonnative))

ab_diversity_2_native <- ab_diversity_2 %>% # join above ground species diversity with native transect percent cover
  left_join(nativecover, by = "site_rep")
ab_diversity_2_native_nn <- ab_diversity_2_native %>% # join above ground species diversity with non-native transect percent cover
  left_join(nncover, by = "site_rep")

view(ab_diversity_2_native_nn)
glimpse(ab_diversity_2_native_nn)
# Rows: 2,018
# Columns: 20

```

```{r species richness by stand type, eval=FALSE}

ab_diversity_2_native_nn %>% 
  filter(status =="native") %>% 
distinct(species) %>%
  pull(species)
#  [1] "Acmispon glaber"            "Acmispon maritimus"        
#  [3] "Apiastrum angustifolium"    "Artemisia californica"     
#  [5] "Baccharis pilularis"        "Calochortus clavatus"      
#  [7] "Cenothus oliganthus"        "Claytonia perfoliata"      
#  [9] "Dipterostemon capitatus"    "Elymus condensatus"        
# [11] "Eriodictyon crassifolium"   "Eriogonum fasciculatum"    
# [13] "Galium porrigens"           "Heteromeles arbutifolia"   
# [15] "Lupinus spp."               "Malacothamnus fasciculatus"
# [17] "Marah macrocarpa"           "Pellaea andromedifolia"    
# [19] "Rhamnus ilicifolia"         "Rhus ovata"                
# [21] "Salvia apiana"              "Salvia leucophylla"        
# [23] "Sambucus mexicana"          "Solanum xanti"             
# [25] "Stephanomeria virgata"      "Stipa lepida"  

ab_diversity_2_native_nn %>% 
  filter(status =="native") %>% 
distinct(family) %>%
  pull(family)
#  [1] "Fabaceae"             "Apiaceae"             "Asteraceae"          
#  [4] "Liliaceae"               "Montiaceae"          
#  [6] "Themidaceae"          "Poaceae"              "Namaceae"            
#  [9] "Rubiaceae"            "Rosaceae"            
# [11] "Malvaceae"            "Cucurbitaceae"        "Pteridaceae"         
# [14] "Rhamnaceae"           "Anacardiaceae"        "Lamiaceae"           
#  [17] "Solanacaeae" 

ab_diversity_2_native_nn %>% 
  filter(status =="nonnative") %>% 
distinct(species) %>%
  pull(species)
# [1] "Avena barbata"               "Bromus diandrus"            
#  [3] "Bromus hordeaceus"           "Bromus madritensis"         
#  [5] "Bromus rubens"               "Carduus pycnocephalus"      
#  [7] "Centaurea melitensis"        "Erodium spp."               
#  [9] "Hirschfeldia incana"         "Pseudognaphalium luteoalbum"

ab_diversity_2_native_nn %>% 
  filter(status =="nonnative") %>% 
distinct(family) %>%
  pull(family
    )
# [1] "Poaceae"      "Asteraceae"   "Geraniaceae"  "Brassicaceae"

ab_diversity_2_native_nn <- ab_diversity_2_native_nn %>% 
  dplyr::filter(species != "moss") %>% 
   dplyr::filter(species != "nonnative_thatch") %>% 
dplyr::filter(species != "native_litter") 

# combine site and site_rep_species to one column
ab_diversity_2_native_nn$site_rep_species <- paste(ab_diversity_2_native_nn$site_rep, ab_diversity_2_native_nn$species, sep="_") 

ab_diversity_2_native_nn %>% 
  distinct(species) %>%
  pull(species)


ab_div_bysiterep <- ab_diversity_2_native_nn %>% # number of unique species per transect
  group_by(standtype, site_rep) %>%  
  dplyr::summarize(num_species = length(unique(species)))
print(ab_div_bysiterep) 
```


```{r check - number of unique species per transect, include=TRUE, eval=FALSE}

ab_diversity_2_native_nn %>% 
   dplyr::filter(site_rep == "DEG1_1") %>% 
  distinct(species) %>%
  pull(species)
  
```

normal
```{r, eval=FALSE}
shapiro.test(ab_div_bysiterep$num_species)
# data:  ab_div_bysiterep$num_species
# W = 0.96712, p-value = 0.742 <-- normally distrubuted
```

figure regressions by Kit
```{r scatterplot species diversity by nn grass cover, include=TRUE, eval=FALSE} 

# KIT's code: this section

ab_diversity_2_native_nn_plot <- ab_diversity_2_native_nn %>%
  group_by(site_rep) %>%
  summarize(richness = n_distinct(species))

hold <- rep(c("DEG1_1", "DEG1_2", "DEG1_3", "DEG2_4", "DEG2_5", "DEG2_6", "ENH1_1", "ENH1_2", "ENH1_3", "ENH2_4", "ENH2_5", "ENH2_6", "Intact_1_1", "Intact_2_2", "Intact_3_3"), times = 3)

hold5 <- rep(c("DEG", "DEG", "DEG", "DEG", "DEG", "DEG", "ENH", "ENH", "ENH", "ENH", "ENH", "ENH", "Intact", "Intact", "Intact"), times = 3)

hold2 <- rep(c("total", "native", "nn"), each = 15)

hold3 <- rep(c(90,98,98,98,90,100,83,83,88,46,66,76,12,7,24), times = 3)

hold4 <- c(10,6,7,7,7,9,8,8,10,14,10,12,6,12,9,5,2,2,3,3,5,3,3,5,10,6,6,5,10,6,5,4,5,4,4,4,5,5,5,4,3,6,1,1,3)

abcover_diversity_plot <- data.frame(site_rep = hold, standtype = hold5, richness = hold4, nngrass = hold3, type = hold2)
  
# Stephanie isn't sure what this code is about... ?
# ab_diversity_2_native_nn_2 <- ab_diversity_2_native_nn %>%
#   left_join(ab_diversity_2_native_nn_plot, by = "site_rep")


ab_sppr_nngrass <- ggplot(data = abcover_diversity_plot, 
       aes(x = nngrass, y = richness, shape = type, color = type)) +
  geom_point(size = 3, alpha = 0.8) +
  scale_shape_manual(values = c(16, 17, 18)) +
  ylim(0, 20)+
  xlim(0,100) +
  geom_smooth(method = "lm", se = FALSE, linetype = "solid", color = "black") +  # lm, loess, glm
  scale_color_manual(values = c(standcolors),
                     name = "Stand Type",
                     labels = c("intact" = "shrub dominated", 
                                "matrix" = "matrix", 
                                "degraded" = "grass dominated")) + #rename standtypes labels
  labs(x = "Non-native grass cover (%)", 
       y = "Species richness (#)", 
       title = "Species richness x non-native grass cover") +
  theme_bw() +  
  stat_poly_line() +
  stat_poly_eq(use_label(c("eq", "R2")))

print(ab_sppr_nngrass)
```

stats
```{r species richness df from An code, eval=FALSE}
sppr <- specnumber(abcover_byspecies_nmdsprep_num)
sppr
# 11 15  7 15 13 16 11 13 13 10  8  9 12 10 12

abcover_byspecies_nmdsprep <- abcover_byspecies_nmdsprep %>% 
  mutate(standtype_ID = 1)

abcover_byspecies_nmdsprep$standtype_ID <- 1:15

sppr_df <- sppr %>% 
  enframe() %>% 
  full_join(abcover_byspecies_nmdsprep, by = c("name" = "standtype_ID")) %>% 
    rename(spp_rich = value)
view(sppr_df)
```

```{r stats spp richness, eval=FALSE}

shapiro.test(sppr_df$spp_rich)
# data:  sppr_df$spp_rich
# W = 0.97374, p-value = 0.9091 <-- normally distributed

summary(aov(spp_rich ~ standtype, data = sppr_df)) # by stand type

#             Df Sum Sq Mean Sq F value Pr(>F)  
# standtype    2  35.00  17.500   3.481 0.0643 .
# Residuals   12  60.33   5.028  

summary(aov(spp_rich ~ site, data = sppr_df)) # by hillslope (aka. site)
#             Df Sum Sq Mean Sq F value  Pr(>F)   
# site         6  83.33   13.89   9.259 0.00305 **
# Residuals    8  12.00    1.50 

TukeyHSD(aov(spp_rich ~ site, data = sppr_df))
histogram(sppr_df$spp_rich)

boxplot(spp_rich~site,data=sppr_df, main="Species richness by Hillslope",
   xlab="Hillslope", ylab="Species Richness (N)")
```

```{r species richness figure from An code, eval=FALSE}
#pal <- c("lightsalmon1", "gold1", "palegreen4")

plot_sppr <- ggplot(sppr_df, aes(x = site, y = spp_rich, fill = site)) +
  geom_boxplot() +
  #scale_fill_manual(spp_rich = pal) +
#  scale_x_discrete(labels = c("Intact \n (n = 9)", "Matrix \n (n = 6)", "Degraded \n (n = 6)")) +
  theme(legend.position = "none",
        plot.background = element_rect("white"),
        panel.background = element_rect("white"),
        panel.grid = element_line("grey90"),
        axis.line = element_line("gray25"),
        axis.text = element_text(size = 12, color = "gray25"),
        axis.title = element_text(color = "gray25"),
        legend.text = element_text(size = 12)) + 
  labs(x = "Hillslope",
       y = "Number of species per hillslope",
       title = "Above ground species richness")
plot_sppr

```





# USEFUL CODE
- names() = column titles
- head()
- tail()
- sort(unique(df$column))
- class() = tibble or data.frame?

f <-  belt %>% 
  filter(status == "native") %>% 
  filter(lifeform == "forb") %>% 
   filter(grepl("spp\\.", species))
sort(unique(f$species)) 

- Shannon Diversity
```{r shannon diversity, eval = FALSE}
# this doesn't make sense for % cover, but I could run it on shrub density. I could also run it on the seedbank data. 
shannondiv <- diversity(abcover_byspecies_nmdsprep_num)
head(shannondiv)

sppdiv_aov <- aov(shannondiv ~ standtype, data = abcover_byspecies_nmdsprep)
summary(sppdiv_aov)

#     Df Sum Sq Mean Sq F value Pr(>F)  
#standtype    2 0.2899 0.14493   3.924 0.0489 *
#Residuals   12 0.4433 0.03694        

```

# old code

```{r above ground - species richness - native richness, include = FALSE, eval = FALSE}

### SPECIES RICHNESS DATA IS IN CH1_DEGRADATION_ABCOVERNMDS.RMD FILE ###






# species richness, native richness
abrich_full <- read.csv("~/Dropbox/GRADSCHOOL/Dissertation/R_dissertation/chaparraldegradation_2022b/deg_abrich.csv", header = TRUE, na.strings=c("","NA")) %>% 
  dplyr::select('trasecttype', 'standtype', 'site', 'rep', 'distance', 'vertical', 'species', 'lifeform', 'status', 'lifecycle', 'Family', 'lifestage') %>% 
  rename(transecttype = trasecttype, 
         family = Family)
glimpse(abrich_full)


```
