---
title: "ch1_standdeg_seedbank"
author: "Stephanie Ma Lucero"
date: "2023-07-30"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r install libraries, include=TRUE}
library(here) # similar to set working directory
library(tidyverse) # data wrangling - includes ggplot2, dplyr, tidyr, readr, purr, tibble, stringr, forcats
library(ggplot2) # data visualization
library(dplyr)
library(ggthemes)
library(plotly)
library(ggpubr) # customize ggplot2 for publication
library(vegan) #community ecology package - includes, MASS, cluster, mgcv
library(readxl) # for .xls and .xlsx sheets
library(multcompView) #Visualizations of Paired Comparisons, functions: TukeyHSD, dist{stats}, simint, simtest, csimint, csimtest{multcomp}, friedmanmc, kruskalmc{pgirmess}
```

# Load data

```{r load seedbank data, include=TRUE}

# STAND COMPARISONS BY SEEDBANK SPECIES RICHNESS AND GERMINATION COUNTS - OMIT Zeros
# 1. species richness - use "species_richness" column 
# 2. native species richness - filter status == "native"
# 3. germination abundance - "genus_abundance" column and "count" column
# 4. germination of fire followers - ask Rob how he would select for not present in CK but present in treated tray.

#seedbank_load_raw <- read.csv("deg_seedbank_20231007.csv", header = TRUE, na.strings=c("","NA"))
#seedbank_load_slice <- seedbank_load_raw %>% slice(1:2127) 

germination_m2_load <- read_xlsx("processed/germination_m2.xlsx")
glimpse(germination_m2_load)

germination_m2_edit <- germination_m2_load %>%
  mutate(site = fct_relevel(site, 
            "INT1", "INT2", "INT3","ENH1", "ENH2", "DEG1", "DEG2")) %>% 
  mutate(treatment = fct_relevel(treatment, 
                                 "control", "charate", "oven", "ovenchar")) %>% 
  dplyr::select(c(stand, site, soilcore, depth_name, subsample_cm3, subsample_g,treatment, rep, species_diversity, genus_abundance, lifeform, status, lifescycle, family, count, stand_core, stand_core_depth, stand_core_depth_treat, n_per_cm3, n_per_m3, n_per_g, n_per_kg))

glimpse(germination_m2_edit)

average_cover <- read.csv("nat_nn_cover.csv", header = TRUE, na.strings=c("","NA"))

```
```{r data prep}
seedbank_load_w <- germination_m2_edit %>%
  mutate(#year = as.character(year),
                                stand = as.character(stand), 
                                site = as.character(site),
                                soilcore = as.character(soilcore), 
                                depth_name = as.character(depth_name),
                                treatment = as.character(treatment), 
                                rep = as.integer(rep),                        
                                species_diversity = as.character(species_diversity), 
                                genus_abundance = as.character(genus_abundance), 
                                lifeform = as.character(lifeform), 
                                status = as.character(status), 
                                lifescycle = as.character(lifescycle), 
                                family = as.character(family),
                                count = as.integer(count)
                              ) %>%
  mutate(stand = fct_relevel(stand, "intact", "enhanced", "degraded"), 
         site = fct_relevel(site,  "INT1", "INT2", "INT3", "ENH1", "ENH2", "DEG1", "DEG2"), 
         treatment = fct_relevel(treatment, "control", "charate", "oven", "ovenchar")
         )
  # #mutate(stand = fct_recode(stand, 
  #                               "shrub_dominated" = "intact", # rename stand types
  #                               "matrix" = "enhanced",
  #                               "grass_dominated" = "degraded"))

#tail(seedbank_load_w)

# combine SITE and CORE to one column
seedbank_load_w$stand_core <- paste(seedbank_load_w$site, seedbank_load_w$soilcore, sep="_") 

# combine SITE_CORE and DEPT to one column
seedbank_load_w$stand_core_depth <- paste(seedbank_load_w$stand_core, seedbank_load_w$depth_name, sep="_") 

# combine SITE_CORE_DEPTH and TREATMENT to one column
seedbank_load_w$stand_core_depth_treat <- paste(seedbank_load_w$stand_core_depth, seedbank_load_w$treatment, sep="_") 

# combine SITE_CORE and TREATMENT to one column
seedbank_load_w$stand_core_treat <- paste(seedbank_load_w$stand_core, seedbank_load_w$treatment, sep="_") 

seedbank_load_w <- seedbank_load_w %>% 
  mutate(stand_core = fct_relevel(stand_core, 
                                  "INT1_1", "INT1_2" , "INT1_3" ,"INT2_4"  ,"INT2_5" , "INT2_6",  "INT3_7" , "INT3_8" , "INT3_9",
                                  "ENH1_1" , "ENH1_2" , "ENH1_3" , "ENH1_4" , "ENH1_5" , "ENH2_6" , "ENH2_7" , "ENH2_8"  ,"ENH2_9"  ,"ENH2_10", 
                                 "DEG1_1" , "DEG1_2"  ,"DEG1_3"  ,"DEG1_4" , "DEG2_5" , "DEG2_6" , "DEG2_7" ))  %>% 
  mutate(site = fct_relevel(site, "INT1", "INT2", "INT3", "ENH1", "ENH2", "DEG1", "DEG2"))

unique(seedbank_load_w$stand)
unique(seedbank_load_w$site)
unique(seedbank_load_w$soilcore)
unique(seedbank_load_w$depth_name)
unique(seedbank_load_w$treatment)
sort(unique(seedbank_load_w$species_diversity))
length(unique(seedbank_load_w$species_diversity)) #65 unique species
unique(seedbank_load_w$status)
unique(seedbank_load_w$stand_core_depth)
unique(seedbank_load_w$stand_core_treat) # wrap by treatment instead of ordering

#str(seedbank_load_w)
#glimpse(seedbank_load_w)

```

```{r slice by stand type, include=TRUE}

INT_seedbank <- seedbank_load_w %>% 
  filter(stand == "intact")
unique(INT_seedbank$site)

ENH_seedbank <- seedbank_load_w %>% 
  filter(stand == "enhanced")
unique(ENH_seedbank$site)

DEG_seedbank <- seedbank_load_w %>% 
  filter(stand == "degraded")
unique(DEG_seedbank$site)
```

# Isolate the fire following species

```{r fire followers only, include = TRUE}

control_spp = seedbank_load_w$species_diversity[seedbank_load_w$treatment=="control"]
sort(unique(control_spp))

charate_spp = seedbank_load_w$species_diversity[seedbank_load_w$treatment=="charate"]
sort(unique(charate_spp))

oven_spp = seedbank_load_w$species_diversity[seedbank_load_w$treatment=="oven"]
sort(unique(oven_spp))

ovenchar_spp = seedbank_load_w$species_diversity[seedbank_load_w$treatment=="ovenchar"]
sort(unique(ovenchar_spp))

germinpretreatmenttray = unique(c(charate_spp, oven_spp, ovenchar_spp))

fire_only = tibble(germinpretreatmenttray[!germinpretreatmenttray %in% control_spp])
control_df = tibble(control_spp)
glimpse(fire_only) #17 species

#rename column header
names(fire_only)[names(fire_only) == "germinpretreatmenttray[!germinpretreatmenttray %in% control_spp]"] <- "species_diversity"

print(fire_only) # species list of 17 species
```

```{r fire followers by site total emergence, include=TRUE}

#left join data frames to create complete df of fire following species
seedbank_fire <- fire_only %>% 
  left_join(seedbank_load_w, by =  "species_diversity") %>% 
  left_join(average_cover, by = 'site') %>% 
  mutate(site = fct_relevel(site, "INT1", "INT2", "INT3", "ENH1", "ENH2")) %>% # no DEG1 or DEG2   
  mutate(n_per_g_log = log(n_per_g)) %>% 
  dplyr::select(!c(n_per_cm3, n_per_m3, percentcover_native, percentcover_nonnative, native_fern, native_grass, native_forb, nonnative_fern, nonnative_forb, nonnative_shrub))

view(seedbank_fire)
sort(unique(seedbank_fire$species_diversity))

write.csv(seedbank_fire, "~/Dropbox/GRADSCHOOL/Dissertation/R_dissertation/chaparraldegradation_2022b/processed/seedbank_fire.csv")
```

# 1. Absolute germination of fire following species 
```{r exploration germination, include=TRUE}
view(seedbank_fire %>% 
  na.omit() %>%
  group_by(status, species_diversity, family) %>%  # group by status and species 
  summarise(total_germination = sum(count), 
            average_germ_pergsoil = round(mean(n_per_g), 3))
  )

seedbank_fire %>% 
  na.omit() %>%
  #group_by(status) %>%  # group by status
    group_by(status, family) %>%  # group by status and family
  summarise(total_germination = sum(count), 
            average_germ_pergsoil = round(mean(n_per_g), 3))

#lifeform
seedbank_fire %>% 
  na.omit() %>%
 group_by(lifeform) %>%  # group by lifeform
  summarise(total_germination = sum(count))

# site - Note: Don't use absolute data since sampling effort is different. Data need to be standardized to compare results. 
seedbank_fire %>% 
  na.omit() %>%
  group_by(site) %>%  # group by site 
  summarise(total_germination = sum(count), 
            total_species = length(unique(species_diversity)),
            total_family = length(unique(family)),
            average_germ_pergsoil = round(mean(n_per_g), 4), 
            SE = round(((sd(n_per_g))/sqrt(length((n_per_g)))),4)
            )
# site    total_germination   total_species   average_germ_pergsoil   total_family
# INT1	    10    	          3                 0.005		                2
# INT2    	7	                4                 0.005			              3
# INT3    	11	              3                 0.004			              2
# ENH1	    9	                4                 0.004			              4
# ENH2    	11	              8                 0.003		                6

# treatment
seedbank_fire %>% 
  na.omit() %>%
  group_by(treatment) %>%  # group by treatment
  summarise(tot_germ_bytreat = sum(count))
# treatment   tot_germ_bytreat
# charate	      16			
# oven	        15			
# ovenchar	    17	
ggqqplot(seedbank_fire$n_per_g) 
shapiro.test(seedbank_fire$n_per_g) # not transformed, not sig
kruskal.test(n_per_g ~ treatment, data = seedbank_fire)
# data:  n_per_g by treatment
# Kruskal-Wallis chi-squared = 0.68986, df = 2, p-value = 0.7083
pairwise.wilcox.test(seedbank_fire$n_per_g, seedbank_fire$treatment,
                 p.adjust.method = "BH")
#           charate oven
# oven      0.77    -   
# ovenchar  1.00    0.77

seedbank_fire %>% 
  na.omit() %>%
  group_by(lifeform) %>%  # group by lifeform
  summarise(tot_species = length(unique(species_diversity)),
    tot_germ_bylifeform = sum(count))
# lifeform sum_germination
# forb	    33			
# shrub	    15	
```

# 2. Seed density 

## a) COMBINING surface and below germination data
```{r explore fire following seedbanks combine soil depth, include=TRUE}

# create combined soil depth df = total emergence by site
# N = 14 data points
# 
seedbank_fire_totalemerg <- seedbank_fire %>%  
  na.omit() %>%
  group_by(site, soilcore, stand_core, native_shrub, nonnative_grass) %>% 
  summarise(sum_germination_g = round(sum(n_per_g),4)) %>% 
  mutate(sum_germ_g_log = log(sum_germination_g))
#  site  soilcore native_shrub nonnative_grass sum_germination_g sum_germ_g_log
#  
#  1 INT1  1               0.707          0.244             0.0393          -3.24
#  no fire followers in INT1 - mid
#  2 INT1  3               0.707          0.244             0.0118          -4.44
#  
#  #  no fire followers in INT2 - top
#  3 INT2  5               0.707          0.0732            0.0061          -5.10
#  4 INT2  6               0.707          0.0732            0.0218          -3.83
#  
#  5 INT3  7               0.951          0.122             0.029           -3.54
#  6 INT3  8               0.951          0.122             0.0061          -5.10
#  7 INT3  9               0.951          0.122             0.0122          -4.41
#  
#  8 ENH1  1               0.642          0.626             0.0173          -4.06
#  no fire followers in ENH1 - 2
#  no fire followers in ENH1 - 3
#  9 ENH1  4               0.642          0.626             0.0086          -4.76
#  no fire followers in ENH1 - 5
#  
# 11 ENH2  6               0.390          0.846             0.0058          -5.15
# 12 ENH2  7               0.390          0.846             0.0058          -5.15
# 13 ENH2  8               0.390          0.846             0.0086          -4.76
# 14 ENH2  9               0.390          0.846             0.0086          -4.76
# 10 ENH2  10              0.390          0.846             0.0029          -5.84

# calculating average germination 
seedbank_fire_totalemerg %>% 
  na.omit() %>%
  group_by(site) %>%  # group by site
  dplyr::summarise(mean_germination = mean(sum_germination_g), 
                    sd = sd(sum_germination_g),
                    N = length(sum_germination_g),
                    SE = (sd(sum_germination_g)) / sqrt(length(sum_germination_g))
                   )

# site  mean_germination  sd          N SE
# INT1	0.02555000	0.019445436	2	0.013750000
# INT2	0.01395000	0.011101576	2	0.007850000
# INT3	0.01576667	0.011859314	3	0.006846978
# ENH1	0.01295000	0.006151829	2	0.004350000
# ENH2	0.00634000	0.002378655	5	0.001063767
```

### - normality
```{r seed density combining soil depth normality}
ggqqplot(seedbank_fire_totalemerg$sum_germination_g) 
shapiro.test(seedbank_fire_totalemerg$sum_germination_g) # not transformed
# data:  seedbank_fire_totalemerg$sum_germination_g
# W = 0.81117, p-value = 0.006883 <- not norm

ggqqplot(seedbank_fire_totalemerg$sum_germ_g_log) 
shapiro.test(seedbank_fire_totalemerg$sum_germ_g_log) # log transformed
# data:  seedbank_fire_totalemerg$sum_germ_g_log
# W = 0.95804, p-value = 0.6908 <---------------------- Normally distributed! WHAT!?!?!
```

### - differences site - cat
```{r seed density by site combining soil depths logged}

# using LOGGED data

aov(sum_germ_g_log ~ site, seedbank_fire_totalemerg)
summary(aov(sum_germ_g_log ~ site, seedbank_fire_totalemerg))
#             Df  Sum Sq  Mean Sq   F value   Pr(>F)
# site         4  2.867   0.7167    1.703     0.233 <-- no sig diff between hillslopes
# Residuals    9  3.788   0.4209 
```

### - differences by native shrub
```{r seed density by native shrub cover combining soil depths}

# using LOGGED data

ggplot(data = seedbank_fire_totalemerg, # <-- combining surface and below soil samples. 
       aes(x = native_shrub*100, 
           y = sum_germ_g_log, 
           color = site)) + #color = standtype
 # geom_point(size = 3) + #alpha = 0.8
  ylim(-10, 0)+
  xlim(0,100) +
  geom_jitter() +
  geom_smooth(method = "lm", se = FALSE, linetype = "solid", color = "black") +  # lm, loess, glm
  # scale_color_manual(values = c(standcolors),
  #                     name = "Hillslope",
  #                     # labels = c("DEG2" = "shrub dominated", 
  #                     #            "matrix" = "matrix", 
  #                     #            "degraded" = "grass dominated")
  #                     ) + #rename standtypes labels
  labs(x = "Native shrub cover (%)", 
       y = "Fire Following Seed density (log(#/g))", 
       title = "Site seed density by Native Shrub Cover") +
  theme_bw() +  
  stat_poly_line() +
  stat_poly_eq(use_label(c("eq", "R2")))

seedbank_fire_totalemerg_natshrub.lm = lm(sum_germ_g_log ~ native_shrub, data=seedbank_fire_totalemerg)
summary(seedbank_fire_totalemerg_natshrub.lm)
# Residual standard error: 0.644 on 12 degrees of freedom
# Multiple R-squared:  0.2522,	Adjusted R-squared:  0.1898 
# F-statistic: 4.046 on 1 and 12 DF,  p-value: 0.06728 <-- sig?


```

### - differences by non-native grass
```{r seed density by nonnative grass cover combining soil depths}

# using LOGGED data

ggplot(data = seedbank_fire_totalemerg, # <-- combining surface and below soil samples. 
       aes(x = nonnative_grass*100, 
           y = sum_germ_g_log, 
           color = site)) + #color = standtype
  #geom_point(size = 3, alpha = 0.8) +
  geom_jitter() +
  ylim(-10, 0)+
  xlim(0,100) +
  geom_smooth(method = "lm", se = FALSE, linetype = "solid", color = "black") +  # lm, loess, glm
  # scale_color_manual(values = c(standcolors),
  #                     name = "Hillslope",
  #                     # labels = c("DEG2" = "shrub dominated", 
  #                     #            "matrix" = "matrix", 
  #                     #            "degraded" = "grass dominated")
  #                     ) + #rename standtypes labels
  labs(x = "Non-native grass cover (%)", 
       y = "Fire Following Seed density (log(#/g))", 
       title = "Site seed density by Non-native Grass Cover") +
  theme_bw() +  
  stat_poly_line() +
  stat_poly_eq(use_label(c("eq", "R2")))

seedbank_fire_totalemerg_nngrass.lm = lm(sum_germ_g_log ~ nonnative_grass, data=seedbank_fire_totalemerg)
summary(seedbank_fire_totalemerg_nngrass.lm)
# Residual standard error: 0.6376 on 12 degrees of freedom
# Multiple R-squared:  0.2669,	Adjusted R-squared:  0.2058 
# F-statistic: 4.368 on 1 and 12 DF,  p-value: 0.05857 <-- not sig?
```


b) SEPERATE depths - Note: Don't use this --> combing above and below ground data and run stats at the scale of "site_core"
- visualize data
```{r seed density with seperate soil depths visualization, include = FALSE}
boxplot(n_per_g ~ site, data=seedbank_fire, main="Fire following seeds/g by site",
   xlab="Site", ylab="Fire Following seeds per gram")
histogram(seedbank_fire$n_per_g)
length(seedbank_fire$n_per_g) # <-- N = 44 

qplot(site, n_per_g, data = seedbank_fire)
qplot(site, n_per_g, data = seedbank_fire, facets = . ~ depth_name)

```
- normality
```{r seed density normality with seperate soil depths, include = FALSE}
ggqqplot(seedbank_fire$n_per_g) 
shapiro.test(seedbank_fire$n_per_g) # not transformed
# data:  seedbank_fire$n_per_g
# W = 0.78652, p-value = 1.505e-06  <-- not normally distributed

ggqqplot(seedbank_fire$n_per_g_log) 
shapiro.test(seedbank_fire$n_per_g_log) # log transformed
# data:  seedbank_fire$n_per_g_log
# W = 0.78523, p-value = 1.414e-06 <-- even worse :/
```
- differences by native shrub
```{r seed density by native shrub seperate soil depths, include = FALSE}
ggplot(data = seedbank_fire, # <-- not combining surface and below soil samples. 
       aes(x = native_shrub*100, y = n_per_g, color = site)) + #color = standtype
  geom_point(size = 3, alpha = 0.8) +
  ylim(0, 0.5)+
  xlim(0,100) +
  geom_smooth(method = "lm", se = FALSE, linetype = "solid", color = "black") +  # lm, loess, glm
  # scale_color_manual(values = c(standcolors),
  #                     name = "Hillslope",
  #                     # labels = c("DEG2" = "shrub dominated", 
  #                     #            "matrix" = "matrix", 
  #                     #            "degraded" = "grass dominated")
  #                     ) + #rename standtypes labels
  labs(x = "Native shrub cover (%)", 
       y = "Seed density (#/g))", 
       title = "Fire following seed density by Native Shrub Cover") +
  theme_bw() +  
  stat_poly_line() +
  stat_poly_eq(use_label(c("eq", "R2")))

fire_seeddensity_nativeshrub.lm = lm(n_per_g ~ native_shrub, data=seedbank_fire)
summary(fire_seeddensity_nativeshrub.lm)
# Residual standard error: 0.001361 on 42 degrees of freedom
# Multiple R-squared:  0.09764,	Adjusted R-squared:  0.07616 
# F-statistic: 4.545 on 1 and 42 DF,  p-value: 0.03892 <-- sig dif
```
- differences by non-native grass
```{r seed density by nn grass cover seperate soil depths, include = FALSE}
ggplot(data = seedbank_fire, 
       aes(x = nonnative_grass*100, y = n_per_g, color = site)) + #color = standtype
  geom_point(size = 3, alpha = 0.8) +
  ylim(0, 0.5)+
  xlim(0,100) +
  geom_smooth(method = "lm", se = FALSE, linetype = "solid", color = "black") +  # lm, loess, glm
  # scale_color_manual(values = c(standcolors),
  #                     name = "Hillslope",
  #                     # labels = c("DEG2" = "shrub dominated", 
  #                     #            "matrix" = "matrix", 
  #                     #            "degraded" = "grass dominated")
  #                     ) + #rename standtypes labels
  labs(x = "Non-native grass cover (%)", 
       y = "Seed density (#/g))", 
       title = "Fire following seed density by Non-native Grass Cover") +
  theme_bw() +  
  stat_poly_line() +
  stat_poly_eq(use_label(c("eq", "R2")))

fire_seeddensity_nngrass.lm = lm(n_per_g ~ nonnative_grass, data=seedbank_fire)
summary(fire_seeddensity_nngrass.lm)
# Residual standard error: 0.001296 on 42 degrees of freedom
# Multiple R-squared:  0.182,	Adjusted R-squared:  0.1625  <-- loss of fire following speices more strongly correlated with nngrass cover
# F-statistic: 9.344 on 1 and 42 DF,  p-value: 0.003881 <-- sig diff
```
- differences by site - cat
```{r seed density by site stats seperate soil depths, include = FALSE}
kruskal.test(n_per_g ~ site, data = seedbank_fire)
# data:  n_per_g by site
# Kruskal-Wallis chi-squared = 6.4651, df = 4, p-value = 0.167 <-- seed density by site is not sig different

pairwise.wilcox.test(seedbank_fire$n_per_g, seedbank_fire$site,
                 p.adjust.method = "BH")
#      INT1 INT2 INT3 ENH1
# INT2 0.55 -    -    -   
# INT3 0.47 0.75 -    -   
# ENH1 0.32 0.55 0.85 -   
# ENH2 0.27 0.31 0.55 0.55
```


# 3. Diversity

```{r seedbank_fire_diversity df}

# calculate number of species per site_core
#  ==> combine soil depth and tray treatment

seedbank_fire_diversity <- seedbank_fire %>% 
  group_by(stand_core, site, native_shrub, nonnative_grass) %>% # stand, soilcore
  dplyr::summarise(N_species = length(unique(species_diversity)),
                   N_family = length(unique(family)),
                   total_germination_count = sum(count)#, 
                   #total_n_per_g = sum(n_per_g),
                  # log_total_n_per_g = log(total_n_per_g)#,
                   #sppdiv_per_g = N_species/subsample_g,
                   #famdiv_per_g = N_family/subsample_g
                   )
# sample size N = 14
min(seedbank_fire_diversity$N_species) # 1
max(seedbank_fire_diversity$N_species) # 4

min(seedbank_fire_diversity$N_family) # 1
max(seedbank_fire_diversity$N_family) # 3

# testing things out...
soil_g <- seedbank_fire %>% 
  group_by(stand_core, stand_core_depth) %>% 
  summarize(soil_g = mean(subsample_g)) %>% 
  group_by(stand_core) %>% 
  summarize(total_soil_g = sum(soil_g))
  
seedbank_fire_diversity_soil <- seedbank_fire_diversity %>% 
  left_join(soil_g, by = "stand_core") %>% 
  mutate(spp_per_g = N_species/total_soil_g,
         fam_per_g = N_family/total_soil_g, 
         total_germ_per_g = total_germination_count/total_soil_g)

```

## a) species diversity

### - visualize 
```{r spp diversity explore data}
histogram(seedbank_fire_diversity$N_species)
histogram(seedbank_fire_diversity_soil$N_species)


qplot(stand_core, N_species, data = seedbank_fire_diversity)
qplot(native_shrub, N_species, data = seedbank_fire_diversity)
qplot(nonnative_grass, N_species, data = seedbank_fire_diversity)

boxplot(N_species ~ site, 
        data=seedbank_fire_diversity, 
        main="Species Diversity by hillslope",
        xlab="Site", ylab="Number of Species")
boxplot(spp_per_g ~ site, 
        data = seedbank_fire_diversity_soil,
        main="Species Density by hillslope",
        xlab="Site", ylab="Species Density (#/g soil)")

qplot(site, n_per_g, data = seedbank_fire)
qplot(site, n_per_g, data = seedbank_fire, facets = . ~ depth_name)

```
- absolute
```{r absolute spp and fam diversity by hillslope, include=FALSE}
seedbank_fire_absolute <- seedbank_fire %>% 
  group_by(site, native_shrub, nonnative_grass) %>% 
  summarize(total_spp_N = length(unique(species_diversity)), 
            total_family_N = length(unique(family))
            )
```

### - normality
```{r spp diversity normality}
ggqqplot(seedbank_fire_diversity$N_species) 
shapiro.test(seedbank_fire_diversity$N_species) 
# data:  seedbank_fire_diversity$N_species
# W = 0.87482, p-value = 0.04906 <-- not normally distributed

ggqqplot(seedbank_fire_diversity_soil$spp_per_g) 
shapiro.test(seedbank_fire_diversity_soil$spp_per_g) 
# data:  seedbank_fire_diversity_soil$spp_per_g
# W = 0.9234, p-value = 0.2461 <--- normally distributed
histogram(seedbank_fire_diversity_soil$spp_per_g)
```

### - differences by site - cat
```{r spp diversity by site cat}
kruskal.test(N_species ~ site, data = seedbank_fire_diversity)
# data:  N_species by site
# Kruskal-Wallis chi-squared = 2.9373, df = 4, p-value = 0.5684 <-- no diff
```
```{r}
aov(spp_per_g ~ site, data = seedbank_fire_diversity_soil)
summary(aov(spp_per_g ~ site, data = seedbank_fire_diversity_soil))
```

### - differences by native shrub
```{r species diversity by native shrub cover}

ggplot(data = seedbank_fire_diversity, 
       aes(x = native_shrub*100, y = N_species, color = site)) + #color = standtype
  geom_point(size = 3, alpha = 0.8) +
#  geom_jitter() +
  ylim(0, 5)+
  xlim(0,100) +
  geom_smooth(method = "lm", se = FALSE, linetype = "solid", color = "black") +  # lm, loess, glm
  # scale_color_manual(values = c(standcolors),
  #                     name = "Hillslope",
  #                     # labels = c("DEG2" = "shrub dominated", 
  #                     #            "matrix" = "matrix", 
  #                     #            "degraded" = "grass dominated")
  #                     ) + #rename standtypes labels
  labs(x = "Native shrub cover (%)", 
       y = "Number of fire following species (#)", 
       title = "Number of fire following species by Native Shrub Cover") +
  theme_bw() +  
  stat_poly_line() +
  stat_poly_eq(use_label(c("eq", "R2")))

seedbank_fire_diversity_natshrub.lm = lm(N_species ~ native_shrub, data=seedbank_fire_diversity)
summary(seedbank_fire_diversity_natshrub.lm)
# Residual standard error: 1.013 on 12 degrees of freedom
# Multiple R-squared:  0.003473,	Adjusted R-squared:  -0.07957  <-- weak correlation
# F-statistic: 0.04182 on 1 and 12 DF,  p-value: 0.8414 <-- not sig by native shrub cover
```

```{r spp density per g x native shrub cover}

ggplot(data = seedbank_fire_diversity_soil, 
       aes(x = native_shrub*100, y = spp_per_g, color = site)) + #color = standtype
  geom_point(size = 3, alpha = 0.8) +
#  geom_jitter() +
  ylim(0, 0.05)+
  xlim(0,100) +
  geom_smooth(method = "lm", se = FALSE, linetype = "solid", color = "black") +  # lm, loess, glm
  # scale_color_manual(values = c(standcolors),
  #                     name = "Hillslope",
  #                     # labels = c("DEG2" = "shrub dominated", 
  #                     #            "matrix" = "matrix", 
  #                     #            "degraded" = "grass dominated")
  #                     ) + #rename standtypes labels
  labs(x = "Native shrub cover (%)", 
       y = "Density of fire following species (#/g of soil)", 
       title = "Density of fire following species by Native Shrub Cover") +
  theme_bw() +  
  stat_poly_line() +
  stat_poly_eq(use_label(c("eq", "R2")))

seedbank_fire_spp_soil_natshrub.lm = lm(spp_per_g ~ native_shrub, data=seedbank_fire_diversity_soil)
summary(seedbank_fire_spp_soil_natshrub.lm)
```


### - differences by non-native grass
```{r species diversity by nonnative grass cover}
ggplot(data = seedbank_fire_diversity, 
       aes(x = nonnative_grass*100, y = N_species, color = site)) + #color = standtype
  geom_point(size = 3, alpha = 0.8) +
  geom_jitter() +
  ylim(0, 5)+
  xlim(0,100) +
  geom_smooth(method = "lm", se = FALSE, linetype = "solid", color = "black") +  # lm, loess, glm
  # scale_color_manual(values = c(standcolors),
  #                     name = "Hillslope",
  #                     # labels = c("DEG2" = "shrub dominated", 
  #                     #            "matrix" = "matrix", 
  #                     #            "degraded" = "grass dominated")
  #                     ) + #rename standtypes labels
  labs(x = "Non-native grass cover (%)", 
       y = "Number of fire following species (#)", 
       title = "Number of fire following species by Non-native Grass Cover") +
  theme_bw() +  
  stat_poly_line() +
  stat_poly_eq(use_label(c("eq", "R2")))

seedbank_fire_diversity_nngrass.lm = lm(N_species ~ nonnative_grass, data=seedbank_fire_diversity)
summary(seedbank_fire_diversity_nngrass.lm)
# Residual standard error: 1.015 on 12 degrees of freedom
# Multiple R-squared:  0.0001815,	Adjusted R-squared:  -0.08314  <-- no correlation with nn grass
# F-statistic: 0.002179 on 1 and 12 DF,  p-value: 0.9635 <-- not sig
```
```{r}
ggplot(data = seedbank_fire_diversity_soil, 
       aes(x = nonnative_grass*100, y = spp_per_g, color = site)) + #color = standtype
  geom_point(size = 3, alpha = 0.8) +
  geom_jitter() +
  ylim(0, 0.05)+
  xlim(0,100) +
  geom_smooth(method = "lm", se = FALSE, linetype = "solid", color = "black") +  # lm, loess, glm
  # scale_color_manual(values = c(standcolors),
  #                     name = "Hillslope",
  #                     # labels = c("DEG2" = "shrub dominated", 
  #                     #            "matrix" = "matrix", 
  #                     #            "degraded" = "grass dominated")
  #                     ) + #rename standtypes labels
  labs(x = "Non-native grass cover (%)", 
       y = "Density of fire following species (#/g of soil)", 
       title = "Density of fire following species by Non-native Grass Cover") +
  theme_bw() +  
  stat_poly_line() +
  stat_poly_eq(use_label(c("eq", "R2")))

seedbank_fire_spp_soil_nngrass.lm = lm(spp_per_g ~ nonnative_grass, data=seedbank_fire_diversity_soil)
summary(seedbank_fire_spp_soil_nngrass.lm)
# Residual standard error: 0.001694 on 12 degrees of freedom
# Multiple R-squared:  0.00145,	Adjusted R-squared:  -0.08176 
# F-statistic: 0.01743 on 1 and 12 DF,  p-value: 0.8972
```


## b) Family diversity
```{r}
# family diversity by stand_core:
seedbank_fire_diversity 

seedbank_fire %>% 
  group_by(stand_core) %>% 
  summarize(N_species_stand_core = length(unique(species_diversity))
            )

# family diversity by hill slope:
seedbank_fire_diversity %>%  
  group_by(site) %>% 
  summarize(N_family_hillslope = sum(N_family))
```
### - visualize 
```{r family diversity explore data}
histogram(seedbank_fire_diversity$N_family)
qplot(stand_core, N_family, data = seedbank_fire_diversity)
qplot(native_shrub, N_family, data = seedbank_fire_diversity)
qplot(nonnative_grass, N_family, data = seedbank_fire_diversity)

boxplot(N_family ~ site, data=seedbank_fire_diversity, main="Family Diversity by site",
   xlab="Site", ylab="Number of Families")
```

### - normality
```{r family diversity normality}
ggqqplot(seedbank_fire_diversity$N_family) 
shapiro.test(seedbank_fire_diversity$N_family) 
# data:  seedbank_fire_diversity$N_family
# W = 0.82293, p-value = 0.009727 <-- not norm dist
```

### - differences by site - cat
```{r family diversity diff by site}
kruskal.test(N_family ~ site, data = seedbank_fire_diversity)
# data:  N_family by site
# Kruskal-Wallis chi-squared = 5.4167, df = 4, p-value = 0.2472 <-- not sig diff 

pairwise.wilcox.test(seedbank_fire_diversity$N_family, seedbank_fire_diversity$site,
                 p.adjust.method = "BH")
```

### - differences by native shrub
```{r average family diversity diff by native shrub cover}

### STEPHANIE - START HERE - calculate p-values for linear regressions of 
### a1) average Family diversity x native shrub cover
### a2) average Family diversity x nonnative grass cover
### b1) absolute Family diversity x native shrub cover
### b2) absolute Family diversity x nonnative grass cover

ggplot(data = seedbank_fire_diversity, 
       aes(x = native_shrub*100, y = N_species, color = site)) + #color = standtype
  geom_point(size = 3, alpha = 0.8) +
#  geom_jitter() +
  ylim(0, 5)+
  xlim(0,100) +
  geom_jitter() +
  geom_smooth(method = "lm", se = FALSE, linetype = "solid", color = "black") +  # lm, loess, glm
  # scale_color_manual(values = c(standcolors),
  #                     name = "Hillslope",
  #                     # labels = c("DEG2" = "shrub dominated", 
  #                     #            "matrix" = "matrix", 
  #                     #            "degraded" = "grass dominated")
  #                     ) + #rename standtypes labels
  labs(x = "Native shrub cover (%)", 
       y = "Number of fire following species (#)", 
       title = "Average number of fire following species by Native Shrub Cover") +
  theme_bw() +  
  stat_poly_line() +
  stat_poly_eq(use_label(c("eq", "R2")))

seedbank_fire_avgfamdiv_natshrub.lm = lm(N_species ~ native_shrub, data=seedbank_fire_diversity)
summary(seedbank_fire_avgfamdiv_natshrub.lm)
```

```{r absolute family diversity diff by native shrub cover}

ggplot(data = seedbank_fire_absolute, 
       aes(x = native_shrub*100, y = total_family_N, color = site)) + #color = standtype
  geom_point(size = 3, alpha = 0.8) +
#  geom_jitter() +
  ylim(0, 10)+
  xlim(0,100) +
  geom_smooth(method = "lm", se = FALSE, linetype = "solid", color = "black") +  # lm, loess, glm
  # scale_color_manual(values = c(standcolors),
  #                     name = "Hillslope",
  #                     # labels = c("DEG2" = "shrub dominated", 
  #                     #            "matrix" = "matrix", 
  #                     #            "degraded" = "grass dominated")
  #                     ) + #rename standtypes labels
  labs(x = "Native shrub cover (%)", 
       y = "Number of fire following families (#)", 
       title = "Absolute number of fire following families by Native Shrub Cover") +
  theme_bw() +  
  stat_poly_line() +
  stat_poly_eq(use_label(c("eq", "R2")))

seedbank_fire_absolutefamdiv_natshrub.lm = lm(total_family_N ~ native_shrub, data=seedbank_fire_absolute)
summary(seedbank_fire_absolutefamdiv_natshrub.lm)
# Residual standard error: 0.8468 on 3 degrees of freedom
# Multiple R-squared:  0.8079,	Adjusted R-squared:  0.7439 
# F-statistic: 12.62 on 1 and 3 DF,  p-value: 0.03803 <-- sig diff

```

### - differences by non-native grass
```{r average family diversity diff by nonnative grass cover}

ggplot(data = seedbank_fire_diversity, 
       aes(x = native_shrub*100, y = N_species, color = site)) + #color = standtype
  geom_point(size = 3, alpha = 0.8) +
#  geom_jitter() +
  ylim(0, 5)+
  xlim(0,100) +
  geom_jitter() +
  geom_smooth(method = "lm", se = FALSE, linetype = "solid", color = "black") +  # lm, loess, glm
  # scale_color_manual(values = c(standcolors),
  #                     name = "Hillslope",
  #                     # labels = c("DEG2" = "shrub dominated", 
  #                     #            "matrix" = "matrix", 
  #                     #            "degraded" = "grass dominated")
  #                     ) + #rename standtypes labels
  labs(x = "Native shrub cover (%)", 
       y = "Number of fire following species (#)", 
       title = "Average number of fire following species by Native Shrub Cover") +
  theme_bw() +  
  stat_poly_line() +
  stat_poly_eq(use_label(c("eq", "R2")))

seedbank_fire_avgfamdiv_natshrub.lm = lm(N_species ~ native_shrub, data=seedbank_fire_diversity)
summary(seedbank_fire_avgfamdiv_natshrub.lm)
```


# END OF CODE

```{r fire followers plot, include = TRUE}
# # bar plot
# seedbank_fire_plot <- ggplot(seedbank_fire_totalemerg, aes(x = stand_core, y = sum, fill = stand)) +
#   geom_col(position = "dodge", width = 0.8) +
#   labs(
#     title = "Total emergence of species following fire", 
#     x = "Site", 
#     y = "Total emergence (N)") + # title, axes titles
#   scale_fill_manual(values = c(standcolors)) + # manual colors
#   # scale_fill_manual(values = cal_palette('chaparral2')) +  # continuous colors
#   #                  limits = c("intact", "matrix", "degraded"), # "limits" reorders the x-axis
#   #                  labels = c("Intact", "Matrix", "Degraded")) + # "labels" changes the name
#   theme_bw() +
#  # scale_x_discrete(
#  #   limits=c("intact", "matrix", "degraded"),
#  #   labels=c("intact" = "Intact", "matrix" = "Matrix", "degraded" = "Degraded")
#  #   )
#   scale_y_continuous(breaks = seq(0, max(seedbank_fire_totalemerg$sum), by = 1))
#  
# seedbank_fire_plot +
#   theme(axis.text.x = element_text(angle = 45
#                                   , hjust = 1))
# 
# seedbank_fire %>% 
#   group_by(stand_core) %>% 
#   summarise(sum = sum(count))
```

# SHRUB - species diversity

```{r SHRUB diversity, include = TRUE}

INT_speciesdiversity <- unique(SHRUB_seedbank$species_diversity) # list of names
print(INT_speciesdiversity)

# 39 species

#  [1] "Bromus diandrus"               "Claytonia parviflora"         
#  [3] "Emmenanthe penduliflora"       "Eucrypta chrysanthemifolia"   
#  [5] "Pseudognaphalium luteoalbum"   "Stipa lepida"                 
#  [7] "Unknown A - shrub"             "Astragalus trichopodus"       
#  [9] "Claytonia perfoliata"          "Nicotiana glauca"             
# [11] "Polypogon monspeliensis"       "Pseudognaphalium californicum"
# [13] "Sonchus oleraceus"             "Erigeron canadensis"          
# [15] "Malacothrix saxatilis"         "Artemisia californica"        
# [17] "Ribes spp."                    "Apiastrum angustifolium"      
# [19] "Cryptantha spp."               "Bromus madritensis"           
# [21] "Festuca myuros"                "Phacelia viscida"             
# [23] "Acmispon glaber"               "Bromus spp."                  
# [25] "Solanum xanti"                 "Centaurea melitensis"         
# [27] "Laennecia coulteri"            "Oxalis corniculata"           
# [29] "Salvia leucophylla"            "Marah macrocarpa"             
# [31] "Ceanothus oliganthus"          "Malacothamnus fasciculatus"   
# [33] "Melica imperfecta"             "Carduus pycnocephalus"        
# [35] "Phacelia tanacetifolia"        "Typha domingensis"            
# [37] "Madia gracilis"                "Uropappus lindleyi"           
# [39] "Stephanomeria virgata"            



SHRUB_seedbank %>% 
  group_by(status) %>% 
   summarize(N = length(unique(species_diversity)))
# status  N
# native	28			
# nonnative	11	

# NATIVE SPP
INT_speciesdiversity_native <-(SHRUB_seedbank %>% 
  filter(status == "native"))
INT_speciesdiversity_native_unique <- unique(INT_speciesdiversity_native$species_diversity)
print(INT_speciesdiversity_native_unique)
#  [1] "Claytonia parviflora"          "Emmenanthe penduliflora"      
#  [3] "Eucrypta chrysanthemifolia"    "Stipa lepida"                 
#  [5] "Unknown A - shrub"             "Astragalus trichopodus"       
#  [7] "Claytonia perfoliata"          "Pseudognaphalium californicum"
#  [9] "Erigeron canadensis"           "Malacothrix saxatilis"        
# [11] "Artemisia californica"         "Ribes spp."                   
# [13] "Apiastrum angustifolium"       "Cryptantha spp."              
# [15] "Phacelia viscida"              "Acmispon glaber"              
# [17] "Solanum xanti"                 "Laennecia coulteri"           
# [19] "Salvia leucophylla"            "Marah macrocarpa"             
# [21] "Ceanothus oliganthus"          "Malacothamnus fasciculatus"   
# [23] "Melica imperfecta"             "Phacelia tanacetifolia"       
# [25] "Typha domingensis"             "Madia gracilis"               
# [27] "Uropappus lindleyi"            "Stephanomeria virgata" 

INT_speciesdiversity_nn <-(SHRUB_seedbank %>% 
  filter(status == "nonnative"))
INT_speciesdiversity_nn_unique <- unique(INT_speciesdiversity_nn$species_diversity)
print(INT_speciesdiversity_nn_unique)  
# 1] "Bromus diandrus"             "Pseudognaphalium luteoalbum"
#  [3] "Nicotiana glauca"            "Polypogon monspeliensis"    
#  [5] "Sonchus oleraceus"           "Bromus madritensis"         
#  [7] "Festuca myuros"              "Bromus spp."                
#  [9] "Centaurea melitensis"        "Oxalis corniculata"         
# [11] "Carduus pycnocephalus"
```

```{r MATRIX seed bank, include=TRUE}
MATRIX_speciesdiversity <- unique(MATRIX_seedbank$species_diversity) # list of names
print(MATRIX_speciesdiversity)

# 41 species

# [1] "Bromus madritensis"                             
#  [2] "Centaurea melitensis"                           
#  [3] "Eriodictyon crassifolium"                       
#  [4] "Salvia leucophylla "                            
#  [5] "Typha domingensis"                              
#  [6] "Acmispon maritimus"                             
#  [7] "Malacothamnus fasciculatus"                     
#  [8] "Artemisia californica"                          
#  [9] "Diplacus aurantiacus"                           
# [10] "Sonchus oleraceus"                              
# [11] "Festuca myuros "                                
# [12] "Lactuca serriola "                              
# [13] "Hirschfeldia incana"                            
# [14] "Calochortus clavatus"                           
# [15] "Acmispon glaber"                                
# [16] "Erodium spp. "                                  
# [17] "Pseudognaphalium luteoalbum"                    
# [18] "Emmenanthe penduliflora"                        
# [19] "Logfia filaginoides"                            
# [20] "Stipa lepida"                                   
# [21] "Uropappus lindleyi"                             
# [22] "Asclepias fascicularis"                         
# [23] "Bromus hordeaceus"                              
# [24] "Juncus bufonius"                                
# [25] "Phacelia spp."                                  
# [26] "Festuca myuros"                                 
# [27] "Astragalus trichopodus "                        
# [28] "Avena barbara"                                  
# [29] "Bromus diandrus"                                
# [30] "Dipterostemon capitatus"                        
# [31] "Unknown D - brown dicot"                        
# [32] "Unknown C - bright green seedling, small leaves"
# [33] "Trifolium spp."                                 
# [34] "Acmispon strigosus"                             
# [35] "Thysanocarpus spp. "                            
# [36] "Stephanomeria virgata"                          
# [37] "Unknown E - plastic plant"                      
# [38] "Unknown G - fuzzy leaf dicot"                   
# [39] "Trifolium willdenovii"                          
# [40] "Lupinus bicolor "                               
# [41] "Solanum xanti"   

MATRIX_seedbank %>% 
  group_by(status) %>% 
   summarize(N = length(unique(species_diversity)))

# status    N
# native	  28			
# nonnative	12			
# unknown	  1	
```

```{r GRASS seed bank, include=TRUE}
GRASS_speciesdiversity <- unique(GRASS_seedbank$species_diversity) # list of names
print(GRASS_speciesdiversity)

# 20 species

# [1] "Astragalus trichopodus"      "Bromus madritensis"         
#  [3] "Emmenanthe penduliflora"     "Erodium cicutarium"         
#  [5] "Hirschfeldia incana"         "Erodium moschatum"          
#  [7] "Croton setiger"              "Nicotiana glauca"           
#  [9] "Bromus diandrus"             "Artemisia californica"      
# [11] "Acmispon maritimus"          "Centaurea melitensis"       
# [13] "Pseudognaphalium luteoalbum" "Trifolium gracelentum"      
# [15] "Galium porrigens"            "Fragaria vesca"             
# [17] "Malacothamnus fasciculatus"  "Eucrypta chrysanthemifolia" 
# [19] "Cryptantha spp."             "Erigeron canadensis"       

GRASS_seedbank %>% 
  group_by(status) %>% 
   summarize(N = length(unique(species_diversity)))
# status    N
# native	  12			
# nonnative	8	
```

# stand differences
```{r}
seedbank_native <- seedbank_load_v%>% 
  filter(status == "native") %>% 
  group_by(stand, stand_core) %>% 
  summarize(total_native_emergence = sum(count))
view(seedbank_native)

# bar plot
seedbank_native_plot <- ggplot(seedbank_native, aes(x = stand_core, y = total_native_emergence, fill = stand)) +
  geom_col(position = "dodge", width = 0.8) +
  labs(
    title = "Total emergence of native species", 
    x = "Site", 
    y = "Total emergence (N)") + # title, axes titles
  scale_fill_manual(values = c(standcolors)) + # manual colors
  # scale_fill_manual(values = cal_palette('chaparral2')) +  # continuous colors
  #                  limits = c("intact", "matrix", "degraded"), # "limits" reorders the x-axis
  #                  labels = c("Intact", "Matrix", "Degraded")) + # "labels" changes the name
  theme_bw() #+
 # scale_x_discrete(
 #   limits=c("intact", "matrix", "degraded"),
 #   labels=c("intact" = "Intact", "matrix" = "Matrix", "degraded" = "Degraded")
 #   )
 
seedbank_native_plot +
  theme(axis.text.x = element_text(angle = 90
                                  , hjust = 1))
```

